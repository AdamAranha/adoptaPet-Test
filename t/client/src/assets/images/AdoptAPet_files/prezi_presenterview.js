;(function(){var baseUrl;var __factory=function(){var React=arguments[0];var ReactDOM=arguments[1];var ReactTransitionGroup=arguments[2];var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_presenterview";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_bacon":dependencies[3],"prezi_cet":dependencies[4],"prezi_cet_model":dependencies[5],"prezi_cet_model_editor":dependencies[6],"prezi_client_player":dependencies[7],"prezi_externalserviceprovider":dependencies[8],"prezi_i18n":dependencies[9],"prezi_logger":dependencies[10],"prezi_presenterviewui":dependencies[11],"prezi_thumbnail_render":dependencies[12],"prezi_uaparser":dependencies[13],"prezi_utils":dependencies[14]}};})(),React,ReactDOM,ReactTransitionGroup);};})(arguments);var moduleImpl=(function(){return module(function(f,b,q,D){q=null;var g=f.dependencies.prezi_i18n,h=f.dependencies.prezi_logger,e=f.dependencies.prezi_presenterviewui,y=f.dependencies.prezi_thumbnail_render,w=f.dependencies.prezi_cet,m=f.dependencies.prezi_cet_model,k=f.dependencies.prezi_cet_model_editor,r=f.dependencies.prezi_utils,t={};Object.defineProperty(t,"__esModule",{value:!0});t.PathStepToPathElementIdMapImpl=class{constructor(a){this.getIdToPathPos=a;this.pathPosToId=new Map;this.dirty=!0}getByPathPosition(a){this.dirty&&
this.update();return this.pathPosToId.get(this.pathPositionDataKey(a))}getByPathElementId(a){this.dirty&&this.update();return this.idToPathPos.get(a)}hasPathPosition(a){this.dirty&&this.update();return this.pathPosToId.has(this.pathPositionDataKey(a))}hasPathElementId(a){this.dirty&&this.update();return this.idToPathPos.has(a)}makeDirty(){this.dirty=!0}pathPositionDataKey(a){return`${a.step}:${a.action}`}update(){this.pathPosToId.clear();this.idToPathPos=this.getIdToPathPos();for(let [a,c]of this.idToPathPos.entries())this.pathPosToId.set(this.pathPositionDataKey(c),
a);this.dirty=!1}};var u={};Object.defineProperty(u,"__esModule",{value:!0});var z=h.avro.Avro;u.NarrativeController=class{constructor(a,c,d){this.runner=a;this.getCurrentPosition=d;this.pathPosToId=new t.PathStepToPathElementIdMapImpl(c)}getNarrativeOfPathElementId(a){return this.runner.read((c)=>{const d=c.lookup.pathElement(a);return null==d?null:this.isFadeElement(d)?this.getNearestNonFadeElement(c,d).narrative:d.narrative})}getNearestNonFadeElementId(a){return this.runner.read((c)=>{const d=
c.lookup.pathElement(a);return this.getNearestNonFadeElement(c,d).id})}getNearestNonFadeElement(a,c){a=a.structuredPath.viewPathElementsInOrder;let d=a.findIndex((a)=>a.id===c.id);for(;0<=d&&this.isFadeElement(a[d]);)--d;if(0<=d)return a[d];throw Error(`Invalid path or path element id: ${c.id}`);}isFadeElement(a){return a.is(k.base.ObjectKind.fadeIn)||a.is(k.base.ObjectKind.fadeOut)}setNarrativeForPathPosition(a,c){this.runner.executeApiCommand({name:"set-narrative",run:(d)=>{const b=d.lookup.pathElement(a);
d=this.isFadeElement(b)?d.lookup.pathElement(this.getNearestNonFadeElement(d,b).id):b;d.narrative=c;d=this.pathPosToId.getByPathElementId(d.id);z.createDefaultLogger().logModifiedPresenterNote({step_index:null===d||void 0===d?void 0:d.step,action_index:null===d||void 0===d?void 0:d.action})}})}getNarrativeData(a){let c=this.pathPosToId.getByPathPosition(a);if(null==c){var d=a.step;for(a=a.action-1;0<=a&&null==(c=this.pathPosToId.getByPathPosition({step:d,action:a}));)--a;if(null==c)for(;0<=d&&null==
(c=this.pathPosToId.getByPathPosition({step:d,action:0}));)--d;null!=c&&(c=this.getNearestNonFadeElementId(c))}d=this.getNarrativeOfPathElementId(c);return{pathElementId:c,text:d}}playbackPathChangedStream(){return this.playbackPathChangedStreamInternal().map(()=>{this.pathPosToId.makeDirty();return{path:this.getPathData(),narrativeData:this.getNarrativeData(this.getCurrentPosition())}}).filter((a)=>null!=a)}playbackPathChangedStreamInternal(){return this.runner.scene.getIdleChangeStream(w.ChangeEventKind.Entity).filter((a)=>
a.some((a)=>a.kind!==w.ChangeEventKind.Entity||a.type!==m.ChangeType.AddEntity&&a.type!==m.ChangeType.RemoveEntity&&a.type!==m.ChangeType.ModifyComponent?!1:a.entity.isDef(m.CetModel.ID.PATH_ACTION)||a.entity.isDef(m.CetModel.ID.PATH_STEP))).map(()=>null)}hasAudio(a){switch(a.kind){case k.base.ObjectKind.visitStack:case k.base.ObjectKind.fadeIn:case k.base.ObjectKind.fadeOut:return!1;case k.base.ObjectKind.backToParent:case k.base.ObjectKind.zoom:case k.base.ObjectKind.visitPage:case k.base.ObjectKind.visitPlanet:case k.base.ObjectKind.visitOverview:return null!=
a.audio;default:r.Utils.assertNever(a)}}getPathData(){return this.runner.read((a)=>{a=a.structuredPath.viewPathElementsInOrder;return{path:a.map((a)=>a.id),pathElementsShownInProgressbar:a.filter((a)=>!this.isFadeElement(a)).map((a)=>a.id),pathElementsWithAudio:a.filter((a)=>this.hasAudio(a)).map((a)=>a.id)}})}};var p={debounce:function(a,b,d,e){return(...c)=>{let l=d&&!n[e];clearTimeout(n[e]);n[e]=setTimeout(()=>{delete n[e];d||a(...c)},b);l&&a(...c)}}};Object.defineProperty(p,"__esModule",{value:!0});
const n={},A=(0,p.debounce)((a,b)=>{a.setNarrativeForPathPosition(b.pathElementId,b.text)},500,!1,"PresenterViewCommunication.saveNarrative"),B=(a,b,d,l)=>{l=JSON.parse(l.newValue||"null");if(null!=l){var c=d.getPlayback();switch(l.kind){case e.NavigationTargetKind.next:d.flyToNextStep(()=>{h.avro.Avro.createDefaultLogger().logNavigatePrezi({navigation_type:"FORWARD_NAVBAR",action_index:c.getCurrentActionIndex(),step_index:c.getCurrentStepIndex(),total_step_number:c.getStepCount()})});break;case e.NavigationTargetKind.prev:d.flyToPreviousStep(()=>
{h.avro.Avro.createDefaultLogger().logNavigatePrezi({navigation_type:"BACKWARD_NAVBAR",action_index:c.getCurrentActionIndex(),step_index:c.getCurrentStepIndex(),total_step_number:c.getStepCount()})});break;case e.NavigationTargetKind.home:d.flyToHome(()=>{h.avro.Avro.createDefaultLogger().logNavigatePrezi({navigation_type:"GO_TO_START_KEYBOARD",action_index:c.getCurrentActionIndex(),step_index:c.getCurrentStepIndex(),total_step_number:c.getStepCount()})});break;case e.NavigationTargetKind.end:d.flyToEnd(()=>
{h.avro.Avro.createDefaultLogger().logNavigatePrezi({navigation_type:"GO_TO_END_KEYBOARD",action_index:c.getCurrentActionIndex(),step_index:c.getCurrentStepIndex(),total_step_number:c.getStepCount()})});break;case e.NavigationTargetKind.pathElementId:a=a.pathPosToId.getByPathElementId(l.pathElementId);d.flyToStepAction(a.step,a.action,()=>{h.avro.Avro.createDefaultLogger().logNavigatePrezi({navigation_type:"GO_TO_PATH",action_index:c.getCurrentActionIndex(),step_index:c.getCurrentStepIndex(),total_step_number:c.getStepCount()})});
break;default:throw r.Utils.assertNever(l);}e.removeLocalStorageItem(b,"desiredDirection")}},C=(a,c)=>{var d=a.getMetadata();const b=d.oid||d.desktopId;d=d.title;e.setLocalStorageItem(b,"presenterNotesPlaceholder",g.I18n.ts("Click to add presenter notes"));e.setLocalStorageItem(b,"presenterNotesWarning",g.I18n.ts("You need editing rights to add or change presenter notes"));const f=c.getPathData();e.setLocalStorageItem(b,"path",f);c=c.getNarrativeData(a.playerUI.getPathNavigator().getCurrentPosition());
e.removeLocalStorageItem(b,"currentPathElementWithNarrative");e.setLocalStorageItem(b,"currentPathElementWithNarrative",c);e.setLocalStorageItem(b,"title",d);e.setLocalStorageItem(b,"language",a.playerUI.getOptions().language);e.setLocalStorageItem(b,"detachOverlayText",g.I18n.ts("Detach the browser tab and drag it to your primary screen."));e.setLocalStorageItem(b,"shuffleScreenAvailable",a.presenterViewProvider.isSwitchPresenterViewScreenAvailable());e.setLocalStorageItem(b,"shuffleScreenDescription",
g.I18n.ts("Switch screen"));e.setLocalStorageItem(b,"audioMuted",a.playerUI.isMuted());e.setLocalStorageItem(b,"userCanEdit",a.playerUI.getOptions().userCanEdit);e.setLocalStorageItem(b,"v2UIStrings",{nextSteps:g.I18n.ts("Next steps"),clickToAddPresenterNotes:g.I18n.ts("Click to add presenter notes"),switchScreens:g.I18n.ts("Switch screens",{context:"switching forth and back to presenter notes and the presentation browser page"}),reset:g.I18n.ts("Reset")})};p.PresenterViewCommunication=class{constructor(a){this.needsThumbs=
!1;this.logger=h.LoggerModule.getLoggerManager().createLogger("prezi_presenterview.PresenterViewCommunication");this.oid=a.getMetadata().oid||a.getMetadata().desktopId;this.presenterViewProvider=a.presenterViewProvider;this.narrativeController=new u.NarrativeController(a.runner,a.idToPathPos,()=>a.playerUI.getPathNavigator().getCurrentPosition());this.init(a)}init(a){this.narrativeController.playbackPathChangedStream().onValue((a)=>{e.setLocalStorageItem(this.oid,"path",a.path);e.setLocalStorageItem(this.oid,
"currentPathElementWithNarrative",a.narrativeData)});a.navigationEventStream.onValue((a)=>{this.needsThumbs&&(a=a.getToPos(),e.setLocalStorageItem(this.oid,"currentPathElementWithNarrative",this.narrativeController.getNarrativeData(a)))});const b=(a,b)=>{if(this.needsThumbs&&null!=b.playbackPathPosition){var c=this.closeTo(b.canvas.width/b.canvas.height,4/3);e.getLocalStorageItem(this.oid,"is4by3")!==c&&e.setLocalStorageItem(this.oid,"is4by3",c);var d=b.canvas.toDataURL("image/png"),x=b.pathElementRef.id;
r.Utils.createIndexedStorage(e.IndexedDbId).then((a)=>a.put({key:x,value:d})).then(()=>e.setLocalStorageItem(this.oid,a,"",x))}};a.audioStream.onValue((a)=>{e.setLocalStorageItem(this.oid,"audioMuted",a.isMuted)});const d=(c)=>{null!=c.newValue&&(this.needsThumbs=!0,C(a,this.narrativeController),null==this.thumbnailJob&&(this.thumbnailJob=a.thumbnailService.monitorPath({size:y.ThumbnailSize._640,includePathElement:()=>!0,needHighQuality:!0})),this.thumbnailJob.getThumbnailStream().onValue((a)=>{b("thumbnails.preview",
a)}),e.removeLocalStorageItem(this.oid,"presenterViewOpened"))},f=()=>{h.avro.Avro.createDefaultLogger().logClosePresenterView();this.needsThumbs=!1;null!=this.thumbnailJob&&(this.thumbnailJob.cancel(),this.thumbnailJob=null);e.removeLocalStorageItem(this.oid,"presenterViewClosed")},g=(a)=>{a=JSON.parse(a.newValue||"null");null!=a&&(this.logger.info(a),e.removeLocalStorageItem(this.oid,"logEvent"))},k=(a)=>{a=JSON.parse(a.newValue||"null");if(null!=a)switch(a.eventSchemaName){case "LoadedPresenterView":h.avro.Avro.createDefaultLogger().logLoadedPresenterView();
break;case "StartPresenterViewTimer":h.avro.Avro.createDefaultLogger().logStartPresenterViewTimer();break;case "PausePresenterViewTimer":h.avro.Avro.createDefaultLogger().logPausePresenterViewTimer();break;case "SwitchPresenterViewScreen":h.avro.Avro.createDefaultLogger().logSwitchPresenterViewScreen();break;case "LeaveFullScreen":h.avro.Avro.createDefaultLogger().logLeaveFullScreen();break;case "PresentInFullScreen":h.avro.Avro.createDefaultLogger().logPresentInFullScreen()}e.removeLocalStorageItem(this.oid,
"glassboxEvent")},m=(a)=>{null!=a.newValue&&(this.presenterViewProvider.switchPresenterViewScreen(),e.removeLocalStorageItem(this.oid,"shuffleScreen"))};window.addEventListener("storage",(b)=>{this.oid=a.getMetadata().oid||a.getMetadata().desktopId;switch(b.key){case e.generateKey(this.oid,"desiredDirection"):B(this.narrativeController,this.oid,a.playerUI,b);break;case e.generateKey(this.oid,"desiredNarrative"):var c=this.narrativeController;b=JSON.parse(b.newValue||"null");null!=b&&A(c,b);break;
case e.generateKey(this.oid,"presenterViewOpened"):d(b);break;case e.generateKey(this.oid,"presenterViewClosed"):f(b);break;case e.generateKey(this.oid,"logEvent"):g(b);break;case e.generateKey(this.oid,"shuffleScreen"):m(b);break;case e.generateKey(this.oid,"audioMuted"):a.playerUI.setMuted("true"===b.newValue);break;case e.generateKey(this.oid,"glassboxEvent"):k(b)}})}closeTo(a,b){return.01>Math.abs(a-b)}};var v={};Object.defineProperty(v,"__esModule",{value:!0});v.PresenterViewDesktopDownloadComponent=
(a)=>b.createElement("div",{className:"presenter-view-desktop-download-modal"},b.createElement("div",{className:"modal",style:{display:"block",zIndex:1E3,color:"#475262"}},b.createElement("div",{className:"modal-vertical-alignment-helper"},b.createElement("div",{className:"modal-dialog modal-vertical-align-center"},b.createElement("div",{className:"modal-content"},b.createElement("div",{className:"desktop-download-header-container"},b.createElement("a",{className:"icon-close",onClick:a.onModalClose}),
b.createElement("div",{className:"presenter-view-svg-container"},b.createElement("svg",{width:"88px",height:"72px",viewBox:"0 0 88 72",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},b.createElement("g",{id:"Web",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},b.createElement("g",{id:"presenter_view-paid",transform:"translate(-48.000000, -59.000000)"},b.createElement("g",{id:"presenter-view",transform:"translate(48.000000, 59.000000)"},b.createElement("g",{id:"Asset-1"},b.createElement("g",
{id:"designs"},b.createElement("g",{id:"Artboard-2"},b.createElement("g",{id:"Asset-1"},b.createElement("g",{id:"Layer_2"},b.createElement("g",{id:"Layer_1-2"},b.createElement("path",{d:"M82.5389714,7.34673759 L82.5389714,53.8794326 L5.4208,53.8794326 L5.4208,7.34673759 L82.5389714,7.34673759 L82.5389714,7.34673759 Z M83.7961143,6.08787234 L4.16365714,6.08787234 L4.16365714,55.118156 L83.7961143,55.118156 L83.7961143,6.08787234 Z",id:"Shape",fill:"#81AAF0","fill-rule":"nonzero"}),b.createElement("path",
{d:"M19.2091429,33.1786525 L27.0537143,23.4551773",id:"Shape",stroke:"#81AAF0","stroke-linejoin":"round",fill:"#81AAF0","fill-rule":"nonzero"}),b.createElement("path",{d:"M32.6354286,23.0825532 L45.7952,33.8886525",id:"Shape",stroke:"#81AAF0","stroke-linejoin":"round",fill:"#81AAF0","fill-rule":"nonzero"}),b.createElement("path",{d:"M51.3769143,33.435461 L62.5856,19.8900709",id:"Shape",stroke:"#81AAF0","stroke-linejoin":"round",fill:"#81AAF0","fill-rule":"nonzero"}),b.createElement("ellipse",{id:"Oval",
stroke:"#81AAF0","stroke-linejoin":"round",cx:"16.9211429",cy:"36.1697163",rx:"3.76137143",ry:"3.76652482"}),b.createElement("ellipse",{id:"Oval",stroke:"#81AAF0","stroke-linejoin":"round",cx:"48.7872",cy:"36.1697163",rx:"3.76137143",ry:"3.76652482"}),b.createElement("ellipse",{id:"Oval",stroke:"#81AAF0","stroke-linejoin":"round",cx:"64.9842286",cy:"16.9846099",rx:"3.76137143",ry:"3.76652482"}),b.createElement("ellipse",{id:"Oval",stroke:"#81AAF0","stroke-linejoin":"round",cx:"29.6786286",cy:"20.7561702",
rx:"3.76137143",ry:"3.76652482"}),b.createElement("polyline",{id:"Shape",stroke:"#81AAF0","stroke-width":"1.25","stroke-linecap":"round","stroke-linejoin":"bevel",points:"34.7273143 70.6878014 43.9798857 54.6498582 53.2274286 70.6878014"}),b.createElement("path",{d:"M86.6976,1.25886525 L86.6976,6.07780142 L1.25714286,6.07780142 L1.25714286,1.25886525 L86.6976,1.25886525 L86.6976,1.25886525 Z M87.9547429,0 L0,0 L0,7.33666667 L87.9547429,7.33666667 L87.9547429,0 Z",id:"Shape",fill:"#81AAF0","fill-rule":"nonzero"})))))))))))),
b.createElement("div",{className:"desktop-download-header-text"},b.createElement("div",null,g.I18n.ts("Presenter View is optimized for our desktop app.")),b.createElement("div",null,g.I18n.ts("(Pssst... it comes with your license)")))),b.createElement("div",{className:"desktop-download-content-container"},b.createElement("div",{className:"desktop-download-feature-container"},g.I18n.ts("You\u2019ll get a special presenter\u2019s screen with your notes and a timer to guide you.")),b.createElement("div",
{className:"desktop-download-description-container"},b.createElement("div",null,g.I18n.ts("This feature is available only in our desktop app.")),b.createElement("div",null,g.I18n.ts("Don\u2019t have the app yet?"))),b.createElement("div",{className:"desktop-download-link-container"},b.createElement("a",{className:"btn-md blue",href:"/download/business/",target:"_blank",onClick:()=>h.avro.Avro.createDefaultLogger().logDownloadApp()},g.I18n.ts("Download it here")))))))),b.createElement("div",{className:"modal-backdrop fade in",
style:{zIndex:990}}));f={};Object.defineProperty(f,"__esModule",{value:!0});(function(a){a.init=function(a){new p.PresenterViewCommunication(a)};a.createPresenterViewDesktopDownloadModal=function(a){return b.createFactory(v.PresenterViewDesktopDownloadComponent)(a)}})(f.PresenterViewModule||(f.PresenterViewModule={}));q=f;f=document.createElement("style");f.textContent=".presenter-view-desktop-download-modal .modal-content{padding:0;width:595px;height:453px;border-radius:4px}.presenter-view-desktop-download-modal .modal-content .desktop-download-header-container{padding:54px 88px 57px 48px;background:#152235;display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between;color:#fff;line-height:1.33;letter-spacing:normal;font-size:18px;border-radius:4px 4px 0 0}.presenter-view-desktop-download-modal .modal-content .desktop-download-header-container .presenter-view-svg-container{margin-right:24px}.presenter-view-desktop-download-modal .modal-content .desktop-download-header-container .desktop-download-header-text{width:347px}.presenter-view-desktop-download-modal .modal-content .desktop-download-header-container .icon-close{position:absolute;right:10px;top:10px;color:#fff;font-weight:bold;text-decoration:none;cursor:pointer}.presenter-view-desktop-download-modal .modal-content .desktop-download-content-container{padding:30px 42px 30px 48px;border-radius:0 0 4px 4px}.presenter-view-desktop-download-modal .modal-content .desktop-download-content-container .desktop-download-feature-container{font-size:18px;font-weight:bold;line-height:normal;color:#4b5468;margin-bottom:24px}.presenter-view-desktop-download-modal .modal-content .desktop-download-content-container .desktop-download-description-container{font-size:16px;line-height:1.5;letter-spacing:.6px;color:#475262}.presenter-view-desktop-download-modal .modal-content .desktop-download-content-container .desktop-download-link-container{margin-top:43px;-ms-flex-pack:end;justify-content:flex-end;display:-ms-flexbox;display:flex}.presenter-view-desktop-download-modal .modal-content .desktop-download-content-container .desktop-download-link-container a{margin-right:-23px}\n";
document.body.appendChild(f);return q});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_presenterview",["require","react","react-dom","react-transition-group","prezi_bacon","prezi_cet","prezi_cet_model","prezi_cet_model_editor","prezi_client_player","prezi_externalserviceprovider","prezi_i18n","prezi_logger","prezi_presenterviewui","prezi_thumbnail_render","prezi_uaparser","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_presenterview.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("react"),require("react-dom"),require("react-transition-group"),require("prezi_bacon"),require("prezi_cet"),require("prezi_cet_model"),require("prezi_cet_model_editor"),require("prezi_client_player"),require("prezi_externalserviceprovider"),require("prezi_i18n"),require("prezi_logger"),require("prezi_presenterviewui"),require("prezi_thumbnail_render"),require("prezi_uaparser"),require("prezi_utils"));}else{this["prezi_presenterview"]=__factory(React,ReactDOM,ReactTransitionGroup,this["prezi_bacon"],this["prezi_cet"],this["prezi_cet_model"],this["prezi_cet_model_editor"],this["prezi_client_player"],this["prezi_externalserviceprovider"],this["prezi_i18n"],this["prezi_logger"],this["prezi_presenterviewui"],this["prezi_thumbnail_render"],this["prezi_uaparser"],this["prezi_utils"]);}}).call(this);