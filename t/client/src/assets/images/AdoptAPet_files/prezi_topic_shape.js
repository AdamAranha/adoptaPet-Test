;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_topic_shape";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.geometry":dependencies[0],"prezi_cet_model_editor":dependencies[1],"prezi_editor_commander":dependencies[2],"prezi_editor_commander_common":dependencies[3],"prezi_featureswitcher":dependencies[4],"prezi_i18n":dependencies[5],"prezi_logger":dependencies[6],"prezi_plugin_api":dependencies[7],"prezi_plugin_meta":dependencies[8],"prezi_service_data":dependencies[9],"prezi_styleschemeprovider":dependencies[10],"prezi_utils":dependencies[11]}};})());};})(arguments);var moduleImpl=(function(){return module(function(e){function y(a,b,c,d){a.document.executeApiCommand(b,{name:"setCoverLayout",run:(b)=>{if(c.hasTopicShapeLayout(d)){const f=c.getTopicShapeLayout(d);k.EditorCommander.createLayoutCommander(c,a.positionFinder).changeTopicCoverOnAllTopicsCmd(f).run(b);l.avro.Avro.createDefaultLogger().logSelectTopicShape({topic_shape_id:d})}}})}function z(a,b,c){if(null==b)return a[0];const d=a.findIndex((a)=>c(a)===b);return a[(d+1)%a.length]}var r=e.dependencies.prezi_cet_model_editor,k=e.dependencies.prezi_editor_commander,
p=e.dependencies.prezi_i18n,l=e.dependencies.prezi_logger,g=e.dependencies.prezi_plugin_api,t=e.dependencies.prezi_styleschemeprovider,v=e.dependencies.prezi_featureswitcher,u={nextCoverLayout:function(a,b,c,d,e,f){if(null!=e){var g=z(d,f,(a)=>a.id);a.document.executeApiCommand(b,{name:"changeLayoutGroup",run:(b)=>{if(c.hasTopicShapeLayout(g.id)){const d=k.EditorCommander.createLayoutCommander(c,a.positionFinder),f=c.getTopicShapeLayout(g.id);d.changeTopicCoverOnAllTopicsCmd(f).run(b);l.avro.Avro.createDefaultLogger().logRemixTopicShape({topic_shape_id:f.id})}}})}},
createShapePageContent:function(a,b,c,d,e,f,h,l){const n=b.button(g.ButtonSize.Small,g.ButtonAlign.Center,(b)=>[b.button({id:"cover-layout-test-button",color:g.ButtonColor.Ghost,content:{text:p.I18n.ts("Add test layout")},onClick:()=>{c.setTopicShapeLayoutFromXml(l,{read:a.document.read,toXml:()=>a.document.preziXml});d({coverLayoutInfo:c.getTopicShapeLayoutInfos().filter((a)=>4!==a.category)})}})]);var m=k.EditorCommander.createColorMixCommander();let w=null;null!=f&&(f=m.createMapping(f),m=f.visualStyleColors.find((a)=>
a.paletteColor.type===t.PaletteColorType.TopicAColor),null!=m&&(m=m.paletteColor.color.getRGBData(),w=Object.assign(Object.assign({},m),{intensity:f.visualBlendAlpha})));return[b.simpleList((b)=>({activeId:e,items:h.filter((a)=>4!==a.category).map((d)=>b.image({id:d.id,src:{url:d.thumbnail},onClick:(b)=>y(a,b,c,d.id),blendColor:w,dataLookup:d.id,title:v.isActive("js-developer-features")?d.id:null})),itemType:g.ListItemType.large,itemLayout:g.ListItemLayout.fixed})),v.isActive("js-bb-snippet-editing")?
n:null]}};Object.defineProperty(u,"__esModule",{value:!0});var h={};Object.defineProperty(h,"__esModule",{value:!0});var A=l.avro.Avro,x=r.base.isRefInstanceOf;(function(a){a[a.improperTopic=0]="improperTopic";a[a.applicable=1]="applicable"})(h.OverviewLayoutApplicability||(h.OverviewLayoutApplicability={}));class B{constructor(){this.layoutRepository=k.EditorCommander.getLayoutRepository();this.handleNextCoverLayoutClick=(a)=>{var b;const c=this.uiRoot.getState();u.nextCoverLayout(this.session,a,
this.layoutRepository,c.coverLayoutInfo,null===(b=c.currentTopicRef)||void 0===b?void 0:b.id,c.coverLayoutId)}}init(a){this.styleSchemeProvider=t.StyleSchemeProviderModule.getStyleSchemeProvider(a);this.layoutRepository.subscribe(()=>this.updateLayoutInfos(this.layoutRepository));const b=(a)=>(c,b)=>{const d=k.EditorCommander.createLayoutCommander(this.layoutRepository,this.session.positionFinder);this.layoutRepository.hasTopicShapeLayout(a)&&d.handleTopicThemeApplication(c,b,this.layoutRepository.getTopicShapeLayout(a))};
this.layoutRepository.loadCoverLayouts((c)=>{a.onTopicThemeApplication(c,b(c));return c});a.onTopicThemeApplication("test_cover_layout",b("test_cover_layout"));this.uiRoot=a.declareUI({currentTopicRef:null,colorPalette:null,coverLayoutId:null,coverLayoutInfo:this.layoutRepository.getTopicShapeLayoutInfos().filter((a)=>4!==a.category),colorPalettes:this.styleSchemeProvider.getAvailablePalettes(),shapeSidebarOpen:!1,selection:[]},({coverLayoutId:a,colorPalette:b,coverLayoutInfo:e,shapeSidebarOpen:f,
selection:h,currentTopicRef:l},q)=>{var c=null,d=k.EditorCommander.createColorMixCommander().createMapping(b);const n=d.visualStyleColors.find((a)=>a.paletteColor.type===t.PaletteColorType.TopicAColor);null!=n&&(c=n.paletteColor.color.getRGBData(),c=Object.assign(Object.assign({},c),{intensity:d.visualBlendAlpha}));d=e.find((b)=>b.id===a);q.createMenuItem({kind:g.MenuItemKind.mixerButton,enabled:!0,onClick:(a)=>this.handleNextCoverLayoutClick(a),onClickSecondary:()=>{f?this.uiRoot.sidebar.close("topic-shape"):
this.uiRoot.sidebar.open("topic-shape")},url:null!=d?d.thumbnail:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTYiIGhlaWdodD0iNTYiIHZpZXdCb3g9IjAgMCA1NiA1NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTI5LjI1IDEySDEyLjc1QzEwLjkyNzcgMTIgMTAgMTIuNTYxIDEwIDE0LjM4MzNWMzEuNjE2N0MxMCAzMy40MzkgMTAuOTI3NyAzNCAxMi43NSAzNEgyOS4yNUMzMS4wNzIzIDM0IDMyIDMzLjQzOSAzMiAzMS42MTY3VjE0LjM4MzNDMzIgMTIuNTYxIDMxLjA3MjMgMTIgMjkuMjUgMTJaIiBmaWxsPSIjMzc0MDUwIi8+CjxwYXRoIGQ9Ik0zNSAyMC41QzI4LjA5NjggMjAuNSAyMi41IDI2LjA5NjggMjIuNSAzM0MyMi41IDM5LjkwMzIgMjguMDk2OCA0NS41IDM1IDQ1LjVDNDEuOTAzMiA0NS41IDQ3LjUgMzkuOTAzMiA0Ny41IDMzQzQ3LjUgMjYuMDk2OCA0MS45MDMyIDIwLjUgMzUgMjAuNVoiIGZpbGw9IiMzNzQwNTAiIHN0cm9rZT0iI0Y2RjdGOSIgc3Ryb2tlLXdpZHRoPSIzIi8+Cjwvc3ZnPgo=",
blendColor:c,parent:g.TabMenuId.Style,weight:2,id:"topic-shape-mixer-button",title:p.I18n.ts("Topic shape")});q.createSidebar((c)=>({id:"topic-shape",root:{title:p.I18n.ts("Topic shape"),content:u.createShapePageContent(this.session,c,this.layoutRepository,(a)=>this.uiRoot.setState(a),a,b,e,"test_cover_layout")},onOpen:()=>{this.uiRoot.setState({shapeSidebarOpen:!0});A.createDefaultLogger().logShowTopicShapeOptions()},onClose:()=>{this.uiRoot.setState({shapeSidebarOpen:!1})}}));(0===h.length&&x(l,
r.base.ObjectKind.topic)||1===h.length&&x(h[0],r.base.ObjectKind.topic))&&q.createMenuItem({kind:g.MenuItemKind.context,enabled:!0,onClick:()=>{f||(this.uiRoot.setState({shapeSidebarOpen:!0}),this.uiRoot.sidebar.open("topic-shape"))},weight:66,id:"subtopic-layout-context-menu-item",title:p.I18n.ts("Change topic shape")});q.createMenuItem({kind:g.MenuItemKind.dropdown,parent:g.MenuId.Debug,id:"remove-topic-shape-roles",title:"Remove topic shapes roles",enabled:!0,weight:6,onClick:(a)=>{const b=k.EditorCommander.createTopicShapeRolesManager();
this.session.document.executeLegacyCommand(a,b.cleanTopicShapeRolesCmd_internal())}})});a.onCurrentTopicChange((a)=>{const b=this.getCoverLayoutId(),c=this.session.document.read((b)=>b.lookup.base(a).ref);this.uiRoot.setState({coverLayoutId:b,currentTopicRef:c})});a.onDocumentChange(()=>{const a=this.getCoverLayoutId(),b=this.getColorPalette();this.uiRoot.setState({coverLayoutId:a,colorPalette:b})});a.onSelectionChange((a)=>{this.uiRoot.setState({selection:a.allObjects})})}getColorPalette(){const a=
k.EditorCommander.createColorMixCommander();return this.session.document.read((b)=>a.paletteFromPrezi(b.styleSheet))}getCoverLayoutId(){const a=this.uiRoot.getState().currentTopicRef;if(null==a)return null;const b=k.EditorCommander.createLayoutQuery();return this.session.document.read((c)=>b.getMostCommonLayout(c,null===a||void 0===a?void 0:a.id,(a)=>a.coverLayoutId))}updateLayoutInfos(a){this.uiRoot.setState({coverLayoutInfo:a.getTopicShapeLayoutInfos().filter((a)=>4!==a.category)})}}h.TopicShapePlugin=
B;e={};Object.defineProperty(e,"__esModule",{value:!0});e.lazyModule={createPlugin(){return new h.TopicShapePlugin}};return e});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_topic_shape",["require","prezi.geometry","prezi_cet_model_editor","prezi_editor_commander","prezi_editor_commander_common","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_service_data","prezi_styleschemeprovider","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_topic_shape.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.geometry"),require("prezi_cet_model_editor"),require("prezi_editor_commander"),require("prezi_editor_commander_common"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_service_data"),require("prezi_styleschemeprovider"),require("prezi_utils"));}else{this["prezi_topic_shape"]=__factory(this["prezi.geometry"],this["prezi_cet_model_editor"],this["prezi_editor_commander"],this["prezi_editor_commander_common"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_service_data"],this["prezi_styleschemeprovider"],this["prezi_utils"]);}}).call(this);