;(function(){var baseUrl;var __factory=function(){var jqueryUi=arguments[0];var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_editor_init";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.engine.dom":dependencies[1],"prezi.text.model":dependencies[2],"prezi_app_utils":dependencies[3],"prezi_bacon":dependencies[4],"prezi_canvas_listener":dependencies[5],"prezi_cet":dependencies[6],"prezi_cet_model":dependencies[7],"prezi_cet_model_editor":dependencies[8],"prezi_cet_renderer":dependencies[9],"prezi_client_player":dependencies[10],"prezi_coeditui":dependencies[11],"prezi_editor_controller":dependencies[12],"prezi_editor_error":dependencies[13],"prezi_editor_store_common":dependencies[14],"prezi_editor_store_mode":dependencies[15],"prezi_editor_store_ui":dependencies[16],"prezi_editor_ui":dependencies[17],"prezi_error_page":dependencies[18],"prezi_externalserviceprovider":dependencies[19],"prezi_featureswitcher":dependencies[20],"prezi_i18n":dependencies[21],"prezi_insights":dependencies[22],"prezi_logger":dependencies[23],"prezi_meeting":dependencies[24],"prezi_nativeapitypes":dependencies[25],"prezi_pdf_export":dependencies[26],"prezi_playback":dependencies[27],"prezi_plugin_api":dependencies[28],"prezi_plugin_meta":dependencies[29],"prezi_service_data":dependencies[30],"prezi_service_media":dependencies[31],"prezi_sound_playback":dependencies[32],"prezi_spotlight":dependencies[33],"prezi_support":dependencies[34],"prezi_templateservice":dependencies[35],"prezi_thumbnail_render":dependencies[36],"prezi_uaparser":dependencies[37],"prezi_utils":dependencies[38],"prezi_ppt_preload":dependencies[39],"prezi_test_preload":dependencies[40]}};})(),jqueryUi);};})(arguments);var moduleImpl=(function(){return module(function(k){var da=k.dependencies["prezi.engine.dom"],q=k.dependencies.prezi_bacon,ja=k.dependencies.prezi_canvas_listener,h=k.dependencies.prezi_cet,m=k.dependencies.prezi_cet_model,G=k.dependencies.prezi_cet_renderer,ea=k.dependencies.prezi_client_player,ka=k.dependencies.prezi_coeditui,U=k.dependencies.prezi_editor_controller,r=k.dependencies.prezi_editor_error,la=k.dependencies.prezi_editor_store_common,u=k.dependencies.prezi_editor_store_mode,R=k.dependencies.prezi_editor_ui,fa=k.dependencies.prezi_error_page,
A=k.dependencies.prezi_externalserviceprovider,B=k.dependencies.prezi_featureswitcher,P=k.dependencies.prezi_i18n,W=k.dependencies.prezi_insights,f=k.dependencies.prezi_logger,S=k.dependencies.prezi_meeting,M=k.dependencies.prezi_nativeapitypes,ma=k.dependencies.prezi_pdf_export,na=k.dependencies.prezi_playback,N=k.dependencies.prezi_plugin_api,ha=k.dependencies.prezi_plugin_meta,d=k.dependencies.prezi_service_data,oa=k.dependencies.prezi_service_media,pa=k.dependencies.prezi_sound_playback,qa=k.dependencies.prezi_spotlight,
ra=k.dependencies.prezi_support,sa=k.dependencies.prezi_templateservice,ta=k.dependencies.prezi_thumbnail_render,ia=k.dependencies.prezi_uaparser,X=k.dependencies.prezi_utils,ua=k.dependencies.prezi_ppt_preload,va=k.dependencies.prezi_test_preload,H=k.dependencies.prezi_cet_model_editor,n=k.dependencies.prezi_app_utils,y={};Object.defineProperty(y,"__esModule",{value:!0});y.Ja={appVersion:"unknown",featureList:"",width:600,height:400,fixedSize:!1,appSource:n.AppSource.PREZI_PAGE,language:"en",showSpinnerOnStartup:!0,
isNewPreziFranklin:!1,createNew:!1,isLoggedIn:!1,isPrezipage:!1,showFileMenuShowInfo:!1,showNavigationOnboarding:!1,abtestVariants:{}};y.Ia={userCanEdit:!0,userCanComment:!0,navbarHeight:0,hasEndScreen:!1,onLoad:()=>{},lockToPath:!1,internal:!0,startFromStep:0,startFromAction:0,autoplay:!1,logAllFrames:!1,loggerCategory:n.LoggerCategory.JS_EDITOR};var x={};Object.defineProperty(x,"__esModule",{value:!0});x.nb=class{Jb(a,b,c){new x.ta(a,window,b,c)}Gb(a,b,c){new wa(a,window,b,c)}};x.da=class{constructor(a,
b,c,e){this.Cb=a;this.Ya=b;this.store=e;this.handle=null;this.hb=q.Bacon.newBus();this.Sa=x.da.Ga;this.Xa().onValue((a)=>{this.isOffline=a});this.Fa();c.onValue(()=>{this.isOffline||this.Fa()});a=e.getBoolModeStream(n.EditorMode.edit);q.Bacon.combineWith((a,b)=>({nc:a,saveAvailabilityStatus:b}),a,e.getSaveAvailabilityStatusStream()).onValue((a)=>this.mc=a.nc&&a.saveAvailabilityStatus===u.SaveAvailabilityStatus.enabled);this.store.addSaveTypeStream(this.hb)}Sb(a,b){return a===u.CoeditStatus.connectionClosed||
a===u.CoeditStatus.connectionLost||2===b}Xa(){return q.Bacon.combineWith((a,b)=>({coeditStatus:a,networkStatus:b}),this.store.getCoeditStatusStream(),this.store.getNetworkStatusStream()).map((a)=>{const {coeditStatus:b,networkStatus:c}=a;return this.Sb(b,c)}).skipDuplicates()}Fa(){this.Qb();this.handle=this.Ya.setInterval(()=>{this.mc&&(this.hb.push("AUTO"),this.Cb.save())},this.Sa)}Qb(){null!==this.handle&&this.Ya.clearInterval(this.handle);this.handle=null}};x.da.Ga=12E4;class wa extends x.da{constructor(a,
b,c,e){super(a,b,c,e)}}x.ta=class extends x.da{constructor(a,b,c,e){super(a,b,c,e);this.Xa().onValue((a)=>{this.Sa=a?x.ta.vb:x.da.Ga;this.Fa()})}};x.ta.vb=3E4;var V={};Object.defineProperty(V,"__esModule",{value:!0});V.Ka=class{constructor(){this.logger=null}dc(){this.logger=f.LoggerModule.getLoggerManager().createLogger("prezi_editor_init.ExternalServiceLogHelper")}logSaveWithRevision(a){null!=this.logger&&this.logger.info({action:"save_with_revision",object:"document",trigger:"machine",payload:{Oc:a}})}logUploadPreviewImages(){null!=
this.logger&&this.logger.info({action:"upload",object:"preview_images",trigger:"xml_save"})}logSaveError(a,b,c){null!=this.logger&&this.logger.error({action:"save_error",object:"document",trigger:"machine",payload:{error_message:a,error_data:c,revision:b}})}logSaveSuccess(a){null!=this.logger&&this.logger.info({action:"save_success",object:"document",trigger:"machine",payload:{revision:a}})}logTemplateFallbackToStatic(a,b){null!=this.logger&&(b={action:"templateservice_fallback_to_static_public",
object:"template",trigger:"machine",payload:{error_message:a,url:b,_type:"debug"}},"timeout"===a?this.logger.warn(b):this.logger.error(b))}};var w={};Object.defineProperty(w,"__esModule",{value:!0});var p=H.base.ObjectKind;w.aa=class{static Mc(){return{action:"created",object:"new_prezi",trigger:"machine"}}static Nc(){return{action:"loaded",object:"new_prezi",trigger:"machine"}}static Bc(a){return{action:"step_count_available",object:"new_prezi",trigger:"machine",track_insights:{event:W.InsighstEvent.LOADED,
path_step_count:a}}}static getLogParentType(a,b){return null==a?null:"parent"in a?a.parent.is(p.overview)?"OVERVIEW":"TOPIC":null==h.Cet.createHierarchyQuery(b).getParentId(a)?"OVERVIEW":"TOPIC"}static getObjectType(a,b){return null==a?null:"kind"in a?w.aa.Tb(a):w.aa.Ub(a,b)}static Ub(a,b){if(null==a)return null;switch(a.getDef()){case m.CetModel.ID.Z_LINE:return"LINE";case m.CetModel.ID.Z_ARROW:return"ARROW";case m.CetModel.ID.Z_BRACKET_FRAME:return"BRACKETFRAME";case m.CetModel.ID.Z_CIRCLE_FRAME:case m.CetModel.ID.Z_INVISIBLE_FRAME:case m.CetModel.ID.Z_RECTANGLE_FRAME:case m.CetModel.ID.Z_TOPIC_CONTAINER:return a=
h.Cet.createHierarchyQuery(b).getParentId(a),null==a||a===b.getPreziW().getOverview().getId()?"TOPIC":"SUBTOPIC";case m.CetModel.ID.Z_IMAGE:return"IMAGE";case m.CetModel.ID.Z_VIDEO:return"VIDEO";case m.CetModel.ID.Z_TEXT:return b=a.getWrapper(m.CetModel.ID.Z_TEXT.W).getText(),b=null==b?"":b.getRawText(),0<h.Cet.getUrlsInString(b).length?"URL":"TEXT";case m.CetModel.ID.Z_PDF:return a=a.getWrapper(m.CetModel.ID.Z_PDF.W),b=a.getOnlineAssetUrl(),a=a.getAssetSourceFilename()?a.getAssetSourceFilename().toLowerCase():
"",this.Wa(b,a);case m.CetModel.ID.Z_SHAPE:return"SHAPE";case m.CetModel.ID.Z_CHART_PDF:return"CHART";case m.CetModel.ID.OVERVIEW:return"BACKGROUND";case m.CetModel.ID.FADE_IN_OBJECT:case m.CetModel.ID.FADE_IN_OBJECTS:case m.CetModel.ID.FADE_OUT_OBJECT:case m.CetModel.ID.FADE_OUT_OBJECTS:case m.CetModel.ID.ZOOM_TO_OBJECT:case m.CetModel.ID.FADE_IN_OBJECT_EP:case m.CetModel.ID.FADE_IN_OBJECTS_EP:case m.CetModel.ID.FADE_OUT_OBJECT_EP:case m.CetModel.ID.FADE_OUT_OBJECTS_EP:case m.CetModel.ID.ZOOM_TO_OBJECT_EP:return"ANIMATION";
case m.CetModel.ID.Z_ZOOM_AREA:return"ZOOMAREA";default:return null}}static Tb(a){if(null==a)return null;if(a.is(p.page))return"PAGE";if(a.is(p.arc))switch(a.arcKind){case "arrow":return"ARROW";case "line":return"LINE";default:return null}else return a.is(p.topic)?a.parent.is(p.overview)?"TOPIC":"SUBTOPIC":a.is(p.image)?"IMAGE":a.is(p.video)?"VIDEO":a.is(p.text)?0<h.Cet.getUrlsInString(a.getText()).length?"URL":"TEXT":a.is(p.pdf)?(a=a.pdfAsset,null==a?null:this.Wa(a.url,a.assetSourceFilename?a.assetSourceFilename.toLowerCase():
"")):a.is(p.shape)?"SHAPE":a.is(p.chart)?"CHART":a.is(p.overview)?"BACKGROUND":a.is(p.zoomArea)?"ZOOMAREA":a.is(p.bracketFrame)?"BRACKETFRAME":null}static Wa(a,b){if(b.endsWith(".ppt")||b.endsWith(".pptx"))return"PPT";a=a&&-1<a.indexOf("templateadmin-pdf-symbol");b=-1<b.indexOf("img.icons8.com");return a||b?"SYMBOL":"PDF"}static Wb(a){return null==a?null:"parent"in a?w.aa.Xb(a):w.aa.Yb(a)}static Yb(a){if(null!=h.Cet.getReferer(a,m.CetModel.ID.VISUAL))return"VISUAL";if(null!=h.Cet.getReferer(a,m.CetModel.ID.COVER))return"COVER";
if(null!=h.Cet.getReferer(a,m.CetModel.ID.CONTENT))return"CONTENT";if(null!=h.Cet.getReferer(a,m.CetModel.ID.SURFACE))return"SURFACE";if(null!=h.Cet.getReferer(a,m.CetModel.ID.MASTER))return"MASTER";a=a.get(m.CetModel.ID.HAS_CHILDREN_DEPRECATED.MANUAL_COVERS_PARENT);return null!=a&&0<a.length?"COVER":"CONTENT"}static Xb(a){try{switch(a.parent.kind){case p.overview:case p.page:case p.planetTopic:case p.stackTopic:return"CONTENT";case p.cover:return"COVER";case p.visual:return"VISUAL";case p.master:return"MASTER";
case p.surface:return"SURFACE";default:return X.Utils.assertNever(a.parent)}}catch(b){return"UNKNOWN"}}};var C={};Object.defineProperty(C,"__esModule",{value:!0});C.ea=class{constructor(a,b,c){this.na=a;this.f=b;this.yc=c;this.ab=[];a=this.na.filter((a)=>a.type===h.CetNetworkEventType.SessionReady).map(()=>this.cb(this.getPeerKeyValueStores()));b=this.na.filter((a)=>a.type===h.CetNetworkEventType.PeerKeyValueStoreChanged).map(()=>this.getPeerKeyValueStores().popChanges());c=this.na.filter((a)=>a.type===
h.CetNetworkEventType.KeyValueStoresReset).map(()=>this.cb(this.getPeerKeyValueStores()));this.Fb=b.merge(a).merge(c);this.Jc()}getPeerKeyValueStores(){return this.f.getPeerKeyValueStores()}getOwnKeyValueStore(){return this.f.getOwnKeyValueStore()}cb(a){let b=a.getPeerClientUuids().map((b)=>{let c=a.getKeyValueStore(b);return c.getKeys().map((a)=>({key:a,value:c.getValue(a)})).map((a)=>({peerClientUuid:b,keyValueStoreChange:a}))});return b.length?b.reduce((a,b)=>a.concat(b)):[]}Jc(){this.zc=this.Fb.map((a)=>
a.filter((a)=>a.keyValueStoreChange.key===C.ea.ua).map((a)=>{let b=JSON.parse(a.keyValueStoreChange.value);return{clientUuid:a.peerClientUuid,selectedEntityIds:b}})).flatMap(q.Bacon.fromArray);this.yc.onValue((a)=>{(a=a.allEntityIds)&&this.getOwnKeyValueStore()&&(this.ab=a,this.getOwnKeyValueStore().setValue(C.ea.ua,JSON.stringify(a)))});this.na.filter((a)=>a.type===h.CetNetworkEventType.KeyValueStoresReset).onValue(()=>{this.getOwnKeyValueStore().setValue(C.ea.ua,JSON.stringify(this.ab))})}};C.ea.ua=
"SELECTION_CHANGE";var Y={};Object.defineProperty(Y,"__esModule",{value:!0});Y.PreziLoadingProgressMonitor=class{constructor(a){this.qc=a;this.za=q.Bacon.newBus();this.Aa=this.za.toProperty();this.cc()}ga(){this.qa(d.PreziLoaderEventType.PreziXMLLoadError,100)}cc(){const a=this.qc.map((a)=>{switch(a.type){case d.PreziLoaderEventType.StartLoading:return this.ha(a.type,20);case d.PreziLoaderEventType.MetaDataLoaded:return this.ha(a.type,40);case d.PreziLoaderEventType.NewPrezi:case d.PreziLoaderEventType.CetSessionCreated:return this.ha(a.type,
80);case d.PreziLoaderEventType.MetaDataLoadError:case d.PreziLoaderEventType.PreziXMLLoadError:case d.PreziLoaderEventType.PreziConversionNotAllowedError:case d.PreziLoaderEventType.PreziCreationError:case d.PreziLoaderEventType.AllAssetsLoaded:return this.ha(a.type,100)}return null}).filter((a)=>null!==a);this.za.plug(a);this.Aa.onValue(()=>null)}qa(a,b){this.za.push(this.ha(a,b))}ha(a,b){switch(a){case d.PreziLoaderEventType.MetaDataLoadError:case d.PreziLoaderEventType.PreziXMLLoadError:case d.PreziLoaderEventType.AssetLoadError:case d.PreziLoaderEventType.PreziCreationError:case d.PreziLoaderEventType.PreziConversionNotAllowedError:case d.PreziLoaderEventType.PdomSessionCreationError:a=
4;break;case d.PreziLoaderEventType.TemplateChooserLoaded:case d.PreziLoaderEventType.EditorStartEventForPrezipage:a=2;break;case d.PreziLoaderEventType.AllAssetsLoaded:a=3;break;case d.PreziLoaderEventType.EditorInit:a=5;break;default:a=1}return{eventType:a,progress:b}}};var Z={};Object.defineProperty(Z,"__esModule",{value:!0});Z.xb=class{constructor(){this.logger=f.LoggerModule.getLoggerManager().createLogger("SaveStatLogger")}sc(a,b){a=h.Cet.createPreziDOMStatCollector(a).collectBasicStats();this.logger.info({action:"save",
object:"document",trigger:"machine",payload:a});f.avro.Avro.createDefaultLogger().logSavedPresentationStats({save_type:b,num_youtube_videos:a.num_youtube_videos,num_vimeo_videos:a.num_vimeo_videos,num_videos:a.num_videos,num_texts:a.num_texts,num_swfs:a.num_swfs,num_shapes:a.num_shapes,num_real_texts:a.num_real_texts,num_placeholders:a.num_placeholders,num_placeholder_texts:a.num_placeholder_texts,num_pdfs:a.num_pdfs,num_pages:a.num_pages,num_objects:a.num_objects,num_lines:a.num_lines,num_images:a.num_images,
num_groups:a.num_groups,num_arrows:a.num_arrows,num_characters:a.num_characters,num_pixel_count:a.num_pixel_count,num_steps:a.num_steps,num_animations:a.num_animations,num_audios:a.num_audios,num_topics:a.num_topics,num_planet_topics:a.num_planet_topics,num_stack_topics:a.num_stack_topics,num_charts:a.num_charts})}};var aa={};Object.defineProperty(aa,"__esModule",{value:!0});aa.yb=class{constructor(a,b,c,e){this.Lc=a;let l,g=[];this.logger=f.LoggerModule.getLoggerManager().createLogger("prezi_editor_init.SlackNotifier");
b.onValue((a)=>{l=a.oid});c.filter((a)=>a===M.SaveState.dirty).take(1).onValue(()=>{c.filter((a)=>a===M.SaveState.saved).take(1).onValue(()=>{l&&this.Lc.sendSlackSaveNotification(l,g,this.onError.bind(this))})});e.onValue((a)=>{g=a.filter((a)=>!a.isDisconnected()).map((a)=>""+a.getUserId()).filter((a,b,c)=>c.indexOf(a)===b)})}onError(a){this.logger.error({action:"error",object:"boxfish.Slacknotifier",trigger:"machine",category:"slackservice_structured",payload:{error_message:a}})}};var T={};Object.defineProperty(T,
"__esModule",{value:!0});T.wb=class{constructor(a){this.hostName=a}check(){return fetch(`//${this.hostName}/online-check/`)}};T.ub=class{constructor(a){this.xc=a}ac(a,b,c){const e=f.LoggerModule.createLogRecordFormatter(Object.assign(Object.assign({},c),{category:"jseditor_structured_fallback"}));b=b.scan(null,(a,b)=>({fb:null==a?null:a.ba,ba:b})).filter((a)=>null!=a).filter((a)=>null!=a).flatMap((a)=>{if(a.ba.isOnline)return null!=a.fb&&a.fb.isOnline?q.Bacon.once({w:!0,isOnline:a.ba.isOnline,response:a.ba.response}):
q.Bacon.once({w:!0,isOnline:!0,response:a.ba.response});{const b=q.Bacon.newBus();this.xc.check().then(()=>b.push({w:!0,isOnline:!1,response:a.ba.response})).catch(()=>b.push({w:!1,isOnline:!1,response:a.ba.response}));return b}});b.skipDuplicates((a,b)=>a.w===b.w&&a.isOnline===b.isOnline).onValue((b)=>{a.log(e.createLogRecord("fallback",f.Level.INFO,{action:"connection_change",object:"fallback",trigger:"machine",payload:{healthCheck:b.w,isOnline:b.isOnline}}))});return b.skipDuplicates((a,b)=>a.w===
b.w)}};var ba={};Object.defineProperty(ba,"__esModule",{value:!0});var I;(function(a){a[a.Na=0]="Save";a[a.La=1]="ForceSaveAndGetStorageProperties"})(I||(I={}));ba.sb=class{constructor(a,b,c){this.elementId=a;this.cetSessionFactory=b;this.ca=c;this.wa=q.Bacon.newBus();this.$a=f.LoggerModule.now();this.Za=!1;this.ia=q.Bacon.newBus();this.Ua=()=>({triggerSave:()=>{},triggerForceSaveAndGetStorageProperties:()=>{},isClosing:()=>{},preziOid:"",startPdfExport:()=>{},cancelPdfExport:()=>{},getNavigationProvider:()=>
this.Ca,mobileClickerStatusStream:q.Bacon.newBus(),createFromTemplateId:()=>{},getEditorUIController:()=>this.ya});this.Ba=f.LoggerModule.createLogHelper();this.Va=q.Bacon.newBus()}Ra(){return{triggerSave:()=>{this.logger.info({action:"triggerSave",object:"desktopExternalServiceProvider",trigger:"machine"});this.wa.push(I.Na)},triggerForceSaveAndGetStorageProperties:()=>{this.logger.info({action:"triggerForcedSaveAndGetStorageProperties",object:"desktopExternalServiceProvider",trigger:"machine"});
this.wa.push(I.La)},isClosing:(a)=>{this.logger.info({action:"isClosing",object:"desktopExternalServiceProvider",trigger:"machine",payload:{closing:a}});a?this.f.forwardRemoteEditingEvents(!1):this.f.forwardRemoteEditingEvents(!0)},preziOid:this.options.preziId,startPdfExport:()=>{this.Da.startPdfExport()},cancelPdfExport:()=>{this.Da.cancelPdfExport()},getNavigationProvider:()=>this.Ca,mobileClickerStatusStream:this.mobileClickerStatusStream,createFromTemplateId:(a)=>{const b=B.isActive("js-prezi-video")?
P.I18n.ts("(For Prezi Video) Untitled presentation"):null;this.startEditing({templateId:a,title:b})},getEditorUIController:()=>this.ya}}Oa(a){var b=document.createElement("style");b.textContent=a.assetLoaderProvider.getUiFontCss();window.document.body.appendChild(b);a=window.document.getElementById(this.elementId);a.innerHTML="";b=window.document.createElement("div");b.setAttribute("id","js-player");a.appendChild(b)}Vb(){if("desktop"===this.options.externalServiceType){const a=ia.PreziUAParser.createUAParser().os.name.toLowerCase();
return-1<a.indexOf("mac")?"mac":-1<a.indexOf("win")?"windows":"unknown"}return"website"}getAppSource(){return"desktop"===this.options.externalServiceType?"desktop":this.options.appSource}initLoggers(a,b){this.ca.initLoggers(this.getConfig(),a,{getLogTopicRelationship:(a)=>w.aa.Wb(a),getLogObjectType:(a)=>w.aa.getObjectType(a,b()),getLogParentType:(a)=>w.aa.getLogParentType(a,b())});this.va=n.AppUtilsModule.createActivityLogger();n.AppUtilsModule.createLogHelperUtils();n.AppUtilsModule.createAppInitUtils().logUserInfo(this.options);
this.Zb()}Zb(){const a=f.LoggerModule.getLoggerManager().createLogger("prezi.util.Utils.ActorSystem");X.Utils.ActorSystem().setLogger({info(b,c,e,l){a.info({action:e,object:b,trigger:c,payload:l})},warn(b,c,e,l){a.warn({action:e,object:b,trigger:c,payload:l})},error(b,c,e,l,g){g?f.LoggerModule.logException(a,b,e,g,l):a.error({action:e,object:b,trigger:c,payload:l})},debug(b,c,e,l){a.debug({action:e,object:b,trigger:c,payload:l})}})}loadTimerStart(a,b){this.Ba.loadTimerStart(this.logger,a,b)}loadTimerEnd(a,
b,c){this.Ba.loadTimerEnd(this.logger,a,n.EditorMode[b.kind],G.RendererKind[G.RendererKind.WebGl],c)}logResourceAttributes(){this.Ba.logResourceAttributes(this.logger)}createCetSession(a){a=this.cetSessionFactory().createCetSession(a,n.AppUtilsModule.getLogHelperUtils(),a.getCoeditOptions());!this.options.userCanEdit&&this.options.userCanComment&&a.setSessionMode(A.CetSessionMode.FallbackReadOnly);this.options.useFallbackStorageServices&&a.setSessionMode(A.CetSessionMode.FallbackLocalSave);return a}Hb(a,
b){const c="landing_page"===this.options.appSource?t.j.tb:t.j.qb,e=G.RendererKind.WebGl,l=h.Cet.createAssetManager(a.assetLoaderProvider);a=h.Cet.createCetApplication({headless:!1,speedMeasurementOptions:{measureSpeed:!0,speedMeasurementMode:c},rendererKind:e,tryRetainMainCanvas:!1,highDPICanvas:e===G.RendererKind.WebGl,isDesktop:a.isDesktop()},b,l,{updateList:[]});a.getMainStage().setVideoControlVisibility(!this.options.isFollower);a.getSpeedMeter().setLogAllFrames(this.options.logAllFrames);return a}$b(a,
b,c){h.Cet.setupPdomLogging(f.Level.ALL);b.Aa.onValue((a)=>{c.reportProgress(a.eventType,a.progress)});n.AppUtilsModule.setLogHelperUtilsCurrentTopicStream(a.getCurrentTopicStream())}loadPreziMetaData(a){return a.getPreziLoader().getLoaderStream().map((a)=>a.type===d.PreziLoaderEventType.MetaDataLoaded?a:null).filter((a)=>null!=a)}loadPrezi(a,b){b.getPreziLoader().loadPrezi(this.o,a)}createFollowerController(a,b){return this.options.isFollower?S.MeetingModule.createFollowerController(this.options,
a,()=>this.loadPreziMetaData(b),(a)=>this.loadPrezi(a,b)):null}createPresenterController(a,b,c){return!this.options.isFollower&&this.options.isLoggedIn?S.MeetingModule.createPresenterController(this.options,a,b,c):null}createEditorOnboardingController(a,b){const c=d.DataServiceModule.createUserSettingsStore(b);return ra.SupportModule.createEditorOnboardingController(a,c,b,this.options)}createCoeditUIController(a,b,c){b=new C.ea(this.getNetworkEventStream(a),a,b.getSelectionStream());let e=this.getNetworkEventStream(a).filter((a)=>
a.type===h.CetNetworkEventType.RoomInfoChanged).map(()=>a.getNetworkUserList());return ka.CoeditUIModule.createCoeditUIController(e,b.zc,c.openPopup)}createEditorUI(a,b,c,e,l,g,v,h,k,xa,D,E,m,n,q,p,t,r){const O=oa.MediaServiceModule.createMediaService(a.mediaUploadProvider,a.assetLoaderProvider,a),z=d.DataServiceModule.createUserSettingsStore(a);return R.EditorUIModule.createEditorUI(b,this.va,c,O,k,z,a,e,l,g,v,h,this.ca.getGlobalExceptionStream().merge(f.LoggerModule.getLoggerManager().getErrorStreamOnLocal().map((a)=>
`${a}`)),xa,D,E,m,n,q,p,t,r)}lb(a,b){return q.Bacon.combineWith((a)=>a.kind===n.EditorMode.playback?null:{errorCase:r.EditorErrorCase.EXTERNAL_EDIT_DETECTED,unclosable:!0},b.getModeStream(),a).filter((a)=>null!=a)}wc(a,b){this.ia.push(a);b.updateMetadata(a)}bb(a,b){const c=f.LoggerModule.getLoggerManager();null==a.oid?c.setPreziId(a.desktopId):c.setPreziId(a.oid);c.setSchemaVersion(a.schema_version);c.setOwnerId(a.owner_id);this.ia.push(a);b.setMetadata(a)}sa(a,b,c){b&&b.getEditmode()&&b.getEditmode().getAnimationScene()?
b.getEditmode().getAnimationScene().update():b&&b.getEditScene()&&b.getEditScene().update();c&&c.getPlayback()&&c.getPlayback().getScene()&&c.getPlayback().getScene().update();a.getBaseScene()&&a.getBaseScene().update()}Eb(){const a=[];for(let b=0;b<window.localStorage.length;++b){const c=window.localStorage.key(b);c.startsWith("presenterview.")&&a.push(c)}a.forEach((a)=>window.localStorage.removeItem(a))}startEditor(a,b,c,e,l,g){this.Za=!0;const v=this.la(this.Ra(),this.options);this.logger.info({action:"loaded",
object:"new_prezi",trigger:"machine"});this.Eb();l.startEditor(a,b);b=e.getPathNavigator().getPath().getStepCount();this.logger.info(w.aa.Bc(b));this.loadTimerEnd(f.LoadEvent.Editor,a);e.addAllAssetsLoadedHandler(()=>{f.avro.Avro.createDefaultLogger().logLoadedEditor({workflow_mode:"STANDARD"});this.loadTimerEnd(f.LoadEvent.Assets,a);a.kind!==n.EditorMode.templateChooser&&a.kind!==n.EditorMode.edit||d.DataServiceModule.createUserSettingsStore(v).setBoolean(d.UserSettingBooleanKeys.EDITOR_SEEN,!0);
this.options.isFollower&&this.loadTimerEnd(f.LoadEvent.LivePrezi,a);c.qa(d.PreziLoaderEventType.AllAssetsLoaded,100)});this.options.isPrezipage&&this.loadTimerEnd(f.LoadEvent.PreziPage,a);c.qa(d.PreziLoaderEventType.EditorStartEventForPrezipage,85);b=e.getAutoPlayer().getEventStream().filter((a)=>a.getType()===h.AutoPlayEventType.STOP||a.getType()===h.AutoPlayEventType.START).map((a)=>a.getType()===h.AutoPlayEventType.START?a.getAutoPlayer().getInterval()/1E3:0);n.AppUtilsModule.setLogHelperUtilsAutoPlayDelayChangeStream(b);
n.AppUtilsModule.setLogHelperUtilsZoomingStream(e.getCet().getMainStage().getCamera().getZoomingStream());this.jc(e,this.o,g);l.handleDeeplinks()}Gc(a,b){a.getEditScene().hasAnyUncommitedChange()&&(this.logger.info({action:"saveDocumentAfterLoadIfFixedBySystems",object:"prezi",trigger:"machine"}),b.save())}hc(a,b,c){this.wa.onValue((b)=>{switch(b){case I.Na:a.save();break;case I.La:a.forceSaveAndGetStorageProperties((a)=>{c.forceSaveWithStoragePropertiesFinished(a)})}});this.Gc(b,a)}vc(a,b,c,e,l,
g,d,h,k){this.loadTimerEnd(f.LoadEvent.Document,this.editorMode);this.logger.info({action:"open",object:"document",trigger:"machine",payload:{topicType:b.getDocument().getTopicType()}});this.loadTimerStart(f.LoadEvent.Editor);if(this.Za)this.sa(b,l,e),l.restartEditor(),l.setDocument(a),e.reset(this.options),"function"===typeof this.options.onLoad&&setTimeout(this.options.onLoad,0);else g.getStateStream().take(1).onValue((a)=>{this.startEditor(a.mode,a.userHasEditRights,c,e,l,g);this.loadTimerStart(f.LoadEvent.Assets);
this.loadTimerStart(f.LoadEvent.FirstValidFrame)});e.isEditingEnabled()&&(this.hc(h,l,k),b.getSceneHierarchy().setAutoCommitScene(l.getEditScene()));g.getIsFollowerStream().filter((a)=>!a&&this.options.isLoggedIn).onValue(()=>{d.attachSaveDependency(()=>h.save())})}Dc(a,b,c,e,l,g,v,h,k,f){const D=a.getPreziLoader().getLoaderStream().filter((a)=>a.type===d.PreziLoaderEventType.FeaturePreviewModeWithSaveDisabled||a.type===d.PreziLoaderEventType.PdomSessionCreated).map((a)=>a.type===d.PreziLoaderEventType.FeaturePreviewModeWithSaveDisabled);
v.addFeaturePreviewModeWithSaveDisabledStream(D);a.getPreziLoader().getLoaderStream().onValue((a)=>{a.type===d.PreziLoaderEventType.FeaturePreviewModeWithSaveDisabled&&b.push({errorCase:r.EditorErrorCase.FEATURE_PREVIEW_MODE_SAVE_DISABLED,customDialogContent:f.getCustomErrorDialog(r.EditorErrorCase.FEATURE_PREVIEW_MODE_SAVE_DISABLED,!0)})});a.getPreziLoader().getLoaderStream().onValue((a)=>{switch(a.type){case d.PreziLoaderEventType.MetaDataLoadError:b.push(a.payload);break;case d.PreziLoaderEventType.PreziXMLLoadError:b.push({errorCase:r.EditorErrorCase.PREZI_XML_LOAD_ERROR,
unclosable:!0});break;case d.PreziLoaderEventType.PreziConversionNotAllowedError:b.push({errorCase:r.EditorErrorCase.PREZI_CONVERSION_NOT_ALLOWED,unclosable:!0});break;case d.PreziLoaderEventType.PreziConversionFailedError:null!=a.payload?b.push({errorCase:r.EditorErrorCase.ASSET_LOAD_ERROR_DURING_PREZI_CONVERSION,unclosable:!0}):b.push({errorCase:r.EditorErrorCase.PREZI_CONVERSION_FAILED,unclosable:!0});break;case d.PreziLoaderEventType.MetaDataLoaded:this.bb(a.payload,c);break;case d.PreziLoaderEventType.MetaDataUpdated:this.wc(a.payload,
c);break;case d.PreziLoaderEventType.CetSessionCreated:this.sa(e,c,g);break;case d.PreziLoaderEventType.PreziLoaded:this.vc(a.payload,e,l,g,c,v,h,k,f)}})}ra(){const a=this.la(this.Ua(),this.options);null==document.querySelector("#error-ui")&&fa.showCoeditErrorPage({rootElementId:this.elementId,isDesktop:"desktop"===this.options.externalServiceType,hostName:this.options.hostName,userId:this.options.userId}).then(()=>{a.reportProgress(4,100);this.logger.info({action:"success",object:"coedit_error_page",
trigger:"editor_init",payload:{_type:"debug"}})}).catch(()=>{this.logger.info({action:"failure",object:"coedit_error_page",trigger:"editor_init",payload:{_type:"debug"}})})}getNetworkEventStream(a){return a.getPreziLoader().getNetworkEventStream().merge(this.Va)}Ec(a,b,c,e,l,g,d){const v=this.getNetworkEventStream(a),k=(a)=>v.filter((b)=>b.type===a).map((a)=>a),f=(a,b)=>{k(a).onValue((a)=>b(a))};b.plug(this.lb(v.filter((a)=>a.type===h.CetNetworkEventType.MultiUserLockError),e));f(h.CetNetworkEventType.MultiUserLockError,
()=>{c.ga()});this.kc(l,e.getSaveStateStream(),v);f(h.CetNetworkEventType.HardResetedPreziIsAvailable,(a)=>g.handleHardReset(a.preziId,a.preziXml,a.sessionState));((a)=>{let b=!1;f(h.CetNetworkEventType.Finished,(a)=>{g.handleConnectionClosed(a.preziId);d.coeditFinishedAndWaitingForGoOnline()});f(h.CetNetworkEventType.OfflineTimerTriggered,()=>{g.handleOfflineTimerTriggered()});f(h.CetNetworkEventType.Reconnected,(c)=>{b&&(b=!1,g.handleReconnectAfterConnectionLost(c.preziId,!S.MeetingModule.isRemotePresentationInProgress(a.getPresenterState())),
d.coeditReconnected())});f(h.CetNetworkEventType.ConnectionLost,(a)=>{b||(b=!0,g.handleConnectionLost(a.preziId),d.connectionLost())})})(e);f(h.CetNetworkEventType.InvalidDocumentStateError,()=>b.push({errorCase:r.EditorErrorCase.INVALID_PREZI_STATE,unclosable:!0}));f(h.CetNetworkEventType.AccessDeniedError,()=>{b.push({errorCase:r.EditorErrorCase.DOCUMENT_ACCESS_DENIED_FOR_USER,unclosable:!0});c.ga();this.ra()});f(h.CetNetworkEventType.IllegalStateError,()=>{b.push({errorCase:r.EditorErrorCase.CONNECTING_TO_PREZI_DOCUMENT_SERVER_FAILED,
unclosable:!0});c.ga();this.ra()});f(h.CetNetworkEventType.TransportError,()=>{b.push({errorCase:r.EditorErrorCase.CONNECTING_TO_PREZI_DOCUMENT_SERVER_FAILED,unclosable:!0});c.ga();this.ra()});f(h.CetNetworkEventType.InitialConnectionFailure,(a)=>{g.handleInitialConnectionFailure(a.preziId);d.coeditInitialConnectionFailure();b.push({errorCase:r.EditorErrorCase.CONNECTING_TO_PREZI_DOCUMENT_SERVER_FAILED,unclosable:!0});c.ga();this.ra()})}Mb(a){const b=q.Bacon.newBus();a.onSaveAvailabilityUpdate((a)=>
{a?b.push(u.SaveAvailabilityStatus.enabled):b.push(u.SaveAvailabilityStatus.disabled)});return b.toProperty(u.SaveAvailabilityStatus.enabled)}Lb(a,b){const c=q.Bacon.newBus();a.onNetworkOnlineStatusUpdate((a)=>{a?c.push(1):c.push(2)});return c.toProperty(b?2:1)}Ib(a){return this.getNetworkEventStream(a).map((a)=>{switch(a.type){case h.CetNetworkEventType.ConnectionLost:return u.CoeditStatus.connectionLost;case h.CetNetworkEventType.ReconnectingFromFinished:return u.CoeditStatus.connectionLost;case h.CetNetworkEventType.Finished:return u.CoeditStatus.connectionClosed;
case h.CetNetworkEventType.Reconnected:return u.CoeditStatus.connected;case h.CetNetworkEventType.OfflineTimerTriggered:return u.CoeditStatus.offlineTimerTriggered;case h.CetNetworkEventType.SessionReady:return u.CoeditStatus.connected;default:return null}}).filter((a)=>null!=a).toProperty(u.CoeditStatus.uninitialized)}bc(a,b,c,e,l,g,d,h,f,k,m,n){var v=a.getSaveStateStream().filter((a)=>a===M.SaveState.errorExternalEdit);v=this.lb(v,a);b.plug(v);this.Dc(c,b,e,h,l,f,a,k,m,n);this.Ec(c,b,l,a,e,g,d)}setDocument(a,
b){b.updateWithIPrezi(a)}ec(a,b){B.isActive("js-disable-save-confirmation")||(b.getSaveStateStream().map((a)=>a===M.SaveState.saved||a===M.SaveState.errorExternalEdit).skipDuplicates().toProperty().onValue((b)=>{a.setHasUnsavedChanges(!b)}),b.getSaveStateStream().skipDuplicates().toProperty().onValue((b)=>{a.setSaveState(b)}))}lc(a,b,c,e,l,g,d,h){n.AppUtilsModule.setLogHelperUtilsFullScreenChangeStream(g.getFullScreenChangeStream());d.getEditorStore().addChangeModeActionStream(l);d.registerSetInfoLayerModeCallback(this.options.setInfoLayerMode);
d.addErrorValueStream(e);d.setXmlLoaderCallback((b)=>this.setDocument(da.DOM.loadXml(b),a));this.options.userCanEdit&&(this.ec(b,c),c.addSaveStateActionStream(h))}ic(a,b,c){let e=a.getPreziLoader().getLoaderStream().map((a)=>a.type===d.PreziLoaderEventType.MetaDataLoaded?a.payload:null).filter((a)=>null!=a);c=c.getSaveStateStream();let l=this.getNetworkEventStream(a).filter((a)=>a.type===h.CetNetworkEventType.RoomInfoChanged).map(()=>a.getNetworkUserList());new aa.yb(b,e,c,l)}isDesktop(){return"desktop"===
this.options.externalServiceType}pc(){try{const a={alpha:!0,depth:!0,stencil:!0},b=document.createElement("canvas");return null!=(b.getContext("webgl",a)||b.getContext("experimental-webgl",a))}catch(a){return!1}}oc(){try{if("object"===typeof WebAssembly&&"function"===typeof WebAssembly.instantiate){const a=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(a instanceof WebAssembly.Module)return new WebAssembly.Instance(a)instanceof WebAssembly.Instance}}catch(a){}return!1}Db(){const a=
!B.isActive("js-check-webassembly")||this.oc(),b=this.pc();if(!a)throw Error("Webassembly is not available");if(!b)throw Error("WebGl is not supported");}uc(a,b){this.options=a;const c=this.la(this.Ua(),this.options);this.initLoggers(c,()=>this.o.getBaseScene());a=f.LoggerModule.getLoggerManager().createLogger("prezi_editor_init.EditorInitImpl");this.Oa(c);a.info({action:"show",object:"webgl_context_error_page",trigger:"editor_init",payload:{_type:"debug",reason:b}});fa.showWebglContextErrorPage({rootElementId:this.elementId,
isDesktop:"desktop"===this.options.externalServiceType,hostName:this.options.hostName,userId:this.options.userId}).then(()=>{c.reportProgress(6,100);this.logger.info({action:"success",object:"webgl_context_error_page",trigger:"editor_init",payload:{_type:"debug"}})}).catch(()=>{this.logger.info({action:"failure",object:"webgl_context_error_page",trigger:"editor_init",payload:{_type:"debug"}})})}getConfig(){const a=this.getAppSource(),b=this.Vb(),c=n.AppUtilsModule.createAppInitUtils().isStaffOrTestUser(this.options.email);
return{appVersion:this.options.appVersion,preziId:this.options.preziId,organizationId:this.options.organizationId,category:this.options.loggerCategory,appSource:a,userId:this.options.userId,ownerId:this.options.ownerId,schemaVersion:this.options.schemaVersion,putmaId:this.options.putmaId,platform:b,isStaffUser:c,canEdit:this.options.userCanEdit,isNewPrezi:this.options.createNew,sessionId:f.LoggerModule.getSessionId()}}Kb(a){this.options=a;this.Ta=this.Ra();a=this.la(this.Ta,this.options);this.initLoggers(a,
()=>this.o.getBaseScene());return a}init(a,b,c,e,l,g,v,k,m){this.startEditing=e;this.mobileClickerStatusStream=q.Bacon.newBus();var p=new V.Ka,D=this.isDesktop()?null:(new T.ub(new T.wb(this.options.hostName))).ac(f.LoggerModule.createFallbackLoggerProvider(),g.getLoggerConnectionStream(),this.getConfig());this.logger=e=f.LoggerModule.getLoggerManager().createLogger("prezi_editor_init.EditorInitImpl");b.getModeStream().onValue((a)=>{this.editorMode=a});this.va.setEditorModeStream(b.getModeStream().map((a)=>
a.kind));this.f=this.createCetSession(g);const t=(a)=>{a=b.getIsFullscreenStream().combineAndSample((a,b)=>({isFullscreen:a,Pa:b}),a).filter((a)=>!a.isFullscreen||a.Pa.newMode!==n.EditorMode.edit).map((a)=>a.Pa);b.addChangeModeActionStream(a)};var O=U.EditorControllerModule.createConnectivityController((a)=>t(a),(a)=>b.addUserHasEditRightsStream(a),this.f,this.o);const r=this.isDesktop()?A.ExternalServiceProviderModule.getDesktopCoeditEventHandler(O):A.ExternalServiceProviderModule.getBrowserCoeditEventHandler(O);
D=this.isDesktop()?A.ExternalServiceProviderModule.getDesktopOnlineStatusProvider(r):A.ExternalServiceProviderModule.getBrowserOnlineStatusProvider(r,this.options.hostName,D.map((a)=>a.w).skipDuplicates());const u=this.isDesktop()?h.Cet.createCoeditOfflineOnlineSwitchHandler(this.options.useFallbackStorageServices,a.kind===n.EditorMode.playback):h.Cet.createDummyCoeditOfflineOnlineSwitchHandler();this.f.afterSync((a)=>u.tell().cetSyncFinished(a));D.onDesktopNetworkOnlineStatusUpdate((a)=>{u.tell().desktopNetworkOnlineStatusUpdate(a)});
b.getModeStream().onValue((a)=>u.tell().editorModeChanged(a.kind===n.EditorMode.playback));A.ExternalServiceProviderModule.initNativeToJsApi(this.Ta,r,g,{mediaAssetSyncSuccess:(a,b)=>{u.tell().mediaAssetSyncSuccess(a,b)},mediaAssetSyncNonRetryableFailure:(a,b)=>{u.tell().mediaAssetSyncNonRetryableFailure(a,b)},mediaAssetSyncRetryableFailure:(a,b)=>{u.tell().mediaAssetSyncRetryableFailure(a,b)}});this.Oa(g);W.PreziInsights.init(f.LoggerModule.getLoggerManager().getConfig().sessionId);p.dc();this.options.isPrezipage&&
this.loadTimerStart(f.LoadEvent.PreziPage,this.options.applicationStartTime);this.options.isFollower&&this.loadTimerStart(f.LoadEvent.LivePrezi,this.options.applicationStartTime);null!=this.options.applicationStartTime&&(this.loadTimerStart(f.LoadEvent.Js,this.options.applicationStartTime),this.loadTimerEnd(f.LoadEvent.Js,this.editorMode,this.$a));this.loadTimerStart(f.LoadEvent.AppInit,this.$a);this.logResourceAttributes();p=q.Bacon.newBus();O=q.Bacon.newBus();const z=this.Hb(g,this.f);this.o=z;
const w=q.Bacon.newBus();b.addCoeditOfflineOnlineSwitchStream(w);u.tell().actionsWired({getIMediaAssets:()=>this.f.getIMediaAssets(),reloadEditor(){r.reloadEditor()},enableOnlineMediaInsert(){r.enableOnlineMediaInsert()},disableOnlineMediaInsert(){r.disableOnlineMediaInsert()},syncMediaAsset(a){r.syncMediaAsset(a)},addMediaAssetPatch:(a)=>{this.o.getMediaAssetPatcher().addOfflineOnlinePatch(a)},coeditGoOnline:()=>{this.f.goOnline()},setSwitchingUiStateToNoSyncInProgress(){w.push({kind:"NoSyncInProgress"})},
setSwitchingUiStateToOfflineMediaInserted(){w.push({kind:"OfflineMediaInserted"})},setSwitchingUiStateToSyncing(a,b){w.push({kind:"MediaSync",offlineMediaAssetSyncMaxCount:a,offlineMediaAssetSyncCurrentCount:b})}});const y=new Y.PreziLoadingProgressMonitor(this.f.getPreziLoader().getLoaderStream());this.$b(b,y,g);const C=this.createCoeditUIController(this.f,b,c),B=this.createFollowerController(g,this.f),I=this.createEditorOnboardingController(b,g),N=f.LoggerModule.getLoggerManager(),H=d.DataServiceModule.createUserLicenseStore(g);
b.addUserLicenseInformationStream(q.Bacon.fromPromise(H.loadLicense()));b.getDeferredUserLicenseInformationStream().onValue((a)=>N.setLicenseTypeOid(a.licenseTypeOid));b.addLogoStream(this.ia.filter((a)=>null!=a.logo_type).map((a)=>{var b;return{type:a.logo_type,editable:this.options.userId===(null===(b=a.owner_id)||void 0===b?void 0:b.toString())}}));const J=ea.PlayerUIModule.createPlayerUI("js-player",this.options,this.ia,z,g,g,this.mobileClickerStatusStream,b.getDeferredUserLicenseInformationStream(),
b.getLogoStream().map((a)=>a.type).toProperty(),this.va),F=this.createPresenterController(b,J,g);this.options.isFollower?B.attachInitDependencies(b,J):this.options.isLoggedIn&&F.attachInitDependencies();var K=this.options.userCanEdit?ta.ThumbnailRenderModule.createPreviewGenerator():null;const G=this.options.userCanEdit?new ya:null;K=this.f.getPreziSaver(z.getCetSessionEditStream(),K,G);const Q=this.f.getMetadataSaver();let L;const P=U.EditorControllerModule.createBasicEditController(()=>L.getEditScene(),
K);L=this.createEditorUI(g,J,b,B,F,C,I,P,z,a,H,c,K,l,v,k,m,Q);null!=G&&G.Bb(L);this.Va.plug(L.getExternalCetNetworkEvenStreamForTest());a=new x.nb;this.isDesktop()?a.Jb(K,this.f.getSyncTriggeredStream(),b):a.Gb(K,this.f.getSyncTriggeredStream(),b);this.bc(b,p,this.f,L,y,r,u.tell(),z,J,F,P,g);b.addCoeditStatusStream(this.Ib(this.f));b.addNetworkStatusStream(this.Lb(D,this.options.useFallbackStorageServices));b.addSaveAvailabilityStatusStream(this.Mb(D));const S=new Z.xb;b.getSaveTypeStream().sampledBy(K.getSaveStateStream().filter((a)=>
M.SaveState.saving===a)).onValue((a)=>S.sc(this.f.getIPrezi(),a));this.lc(z,g,b,p,O,J,L,K.getSaveStateStream());this.ic(this.f,g,b);this.options.useFallbackStorageServices&&r.handleStartInOfflineMode();b.addNavigationEventStream(z.getMainStage().getPathNavigator().getPathNavigationStream());this.Da=ma.PdfExportModule.createPdfExport({pdfProvider:g,playerUI:J});this.options.startInPdfExportMode&&this.Da.loadPdfModule();this.Ca=ea.PlayerUIModule.createDesktopNavigationConnector();this.Ca.init(J,g);
this.ya=R.EditorUIModule.createDesktopEditorUIController();this.ya.init(L);return{o:z,f:this.f,fa:O,i:L,v:g,Qa:r,ma:y,playerUI:J,Ea:p,logger:e}}integration_test_overrideAudioPlayer(a){this.jb.integration_test_overrideAudioPlayer(a)}jc(a,b,c){this.jb=pa.SoundPlaybackModule.createSoundPlayback(a.getPathNavigator().getPathNavigationStream(),b.getSoundDownloadedObservable(),c.getModeStream().map((a)=>a.kind));a.setMuteController(this.jb)}la(a,b){return this.isDesktop()?A.ExternalServiceProviderModule.desktopExternalServiceProvider(a):
A.ExternalServiceProviderModule.browserExternalServiceProvider(b,new V.Ka)}kc(a,b,c){let e=()=>{if(null!=a&&null!=a.getEditScene()){const b=a.getEditScene(),c=b.getUncommitedChanges();c.length?this.logger.warn({action:"RequestSync-UncommitedChanges",object:"prezi",trigger:"machine",payload:c}):b.triggerSync()}};c.filter((a)=>a.type===h.CetNetworkEventType.Reconnected).onValue(()=>e());c.filter((a)=>a.type===h.CetNetworkEventType.RequestSync).onValue(()=>e());let d=!1,g=!1;b.onValue((a)=>{d=a===M.SaveState.saving;
!d&&g&&(g=!1,e())});c.filter((a)=>a.type===h.CetNetworkEventType.RemoteChangesAvailable).onValue(()=>{d?g=!0:e()})}};class ya{Bb(a){this.i=a}forceCommitEvenIfBreaksUndoHistoryAndSceneConsistency(){this.i.getEditScene().rc_DONT_USE_THIS_METHOD_DISCUSS_WITH_API_TEAM({message:"forceCommitEvenIfBreaksUndoHistoryAndSceneConsistency",snapshotBefore:{reset:()=>{}},snapshotAfter:{reset:()=>{}}});this.i.getEditScene().update()}updateEditSceneEvenIfNotActive(){this.i.getEditScene().update()}}var F={},za=this&&
F.Ab||function(a,b,c,e){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,l){function g(a){try{f(e.next(a))}catch(E){l(E)}}function h(a){try{f(e["throw"](a))}catch(E){l(E)}}function f(a){a.done?c(a.value):d(a.value).then(g,h)}f((e=e.apply(a,b||[])).next())})};Object.defineProperty(F,"__esModule",{value:!0});F.Ma=class{static gb(a){return za(this,void 0,void 0,function*(){yield Promise.all([a.registerPreloadedPlugin(ha.testPreloaded,va),a.registerPreloadedPlugin(ha.pptPreload,
ua)])})}};var t={},ca=this&&t.Ab||function(a,b,c,e){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,l){function g(a){try{f(e.next(a))}catch(E){l(E)}}function h(a){try{f(e["throw"](a))}catch(E){l(E)}}function f(a){a.done?c(a.value):d(a.value).then(g,h)}f((e=e.apply(a,b||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});t.j=class{constructor(a,b){this.elementId=a;this.cetSessionFactory=b;this.ca=n.AppUtilsModule.createAppInitUtils();
this.pa=q.Bacon.newBus();this.eb=!1;this.mb=q.Bacon.newBus();this.xa=q.Bacon.newBus();this.tc=N.createMessageHandler();this.options=this.ca.shallowExtend(y.Ja,y.Ia);this.u=new ba.sb(this.elementId,this.cetSessionFactory,this.ca);this.ib=!1;this.xa.plug(this.u.ia.map((a)=>Object.assign({kind:N.DocumentEventKind.Metadata},U.EditorControllerModule.pluginMetaDataFromNativeMetadata(a))))}extendWithOptions(a,b){this.Ob();this.options=this.ca.shallowExtend(this.options,a);this.oa=b}gc(a,b,c,e,d){if(!this.eb){this.eb=
!0;const g=this.mb.toProperty();g.onValue(()=>{});const l=this.xa.toProperty();l.onValue(()=>{});const f="desktop"===this.options.externalServiceType;c=R.createDialogController(b,this.v,c,f);this.ka=N.createPluginSession(a,b,b,e.controller,this.v,this.v,b,c,c,()=>{null!=this.i&&this.i.uiChanged()},this.v,f,d.filter((a)=>0<=a.actions.indexOf(ja.ShortcutAction.CUSTOM)).map((a)=>a.event),R.createKeyboardEventMatcher(ia.PreziUAParser.isMac()),this.tc,this.options.userId,g,l,{hostName:this.options.hostName,
isProduction:X.Utils.isPreziComRequest(this.options.hostName)});F.Ma.gb(this.ka.applicationController);b=document.createElement("div");document.body.appendChild(b);N.initPreloadedUI(b,this.ka.applicationController,a,e)}}Fc(){this.ka.applicationController.resetPreloadedPlugins();this.Ac=F.Ma.gb(this.ka.applicationController)}integration_test_preloadedPluginsRegistered(){return this.Ac}integration_test_overrideAudioPlayer(a){this.u.integration_test_overrideAudioPlayer(a)}Pb(a,b){a=a||"";b.pptCreation&&
(a=a.concat(",prezioption-pptcreate"));return a}Rb(a){return a.userCanEdit||a.userCanComment?a.startInPresentMode||!a.userCanEdit?{kind:n.EditorMode.playback,showTopmenu:!0,linkClickedFlow:!1,presenterNotesFlow:!1}:{kind:n.EditorMode.edit}:{kind:n.EditorMode.view}}initEditor(){var a=this.Pb(this.options.featureList,this.options);B.initFeatureSwitcher(this.options.abtestVariants,a,(new URL(window.location.href)).searchParams.get("feature_preview")||"");P.I18n.init(this.options.language||"en");a=this.Rb(this.options);
const b=la.EditorStoreModule.createEditorStore(a,this.options.userCanEdit,this.options.userCanComment,this.options.userCanPresent),c=R.createVisibleElementsController(b);try{this.u.Db()}catch(v){this.ib=!0;this.u.uc(this.options,v.message);return}this.v=this.u.Kb(this.options);const e=q.Bacon.newBus(),d=q.Bacon.newBus(),g=qa.createSpotlight();this.gc(b,c,e,g,d);a=this.u.init(a,b,c,(a)=>{this.Hc(a)},this.ka,this.v,g,e,d);this.o=a.o;this.f=a.f;this.fa=a.fa;this.i=a.i;this.fc(this.v);this.Qa=a.Qa;this.ma=
a.ma;this.playerUI=a.playerUI;this.Ea=a.Ea;this.logger=a.logger}Hc(a){this.i.startEditing(a)}kb(a){if(a){this.logger.info({action:"create",object:"new_prezi_from_template",trigger:"machine",payload:{templateId:a}});var b=sa.TemplateServiceModule.createTemplateService(this.v);H.CetModelEditor.loadTemplateData(b,{templateId:a,themeId:null}).then((b)=>{b=this.updateTemplateInfo(b,a);this.createPrezi(b).onValue((b)=>{this.logger.info({action:"created",object:"new_prezi_from_template",trigger:"machine",
payload:{_type:"debug",templateId:a,success:b}})})})}else this.logger.info({action:"missing_template_or_theme",object:"new_prezi_from_template",trigger:"machine",payload:{_type:"debug",templateId:a}})}updateTemplateInfo(a,b){a=da.DOM.createLocalSessionWithCorrection(a,()=>{}).getPrezi();let c=a.getTypedTemplateInfo();c.updateBaseId(b);c.updateThemeId("not-used");return a.freeze()}startApplication(){return ca(this,void 0,void 0,function*(){this.ib||(this.u.loadTimerEnd(f.LoadEvent.AppInit,this.u.editorMode),
this.u.loadTimerStart(f.LoadEvent.RendererInit),yield this.o.getSceneRender().getRenderer().getIsReady(),this.u.loadTimerEnd(f.LoadEvent.RendererInit,this.u.editorMode),this.options.isFollower?this.i.startMeeting():this.options.createNew?this.options.fromTemplate?this.kb(this.options.fromTemplate.templateId):this.options.pptCreation?this.kb("ppt_20_min_w48"):(null!=this.oa&&(this.oa.setTemplatePreviewCetController(this.i.getTemplatePreviewCetController()),this.oa.setStartEditingController(this.i.getStartEditingController()),
this.oa.setPushNotificationController(U.EditorControllerModule.createPushNotificationController(d.DataServiceModule.createUserSettingsStore(this.v)))),this.Kc()):null!=this.options.preziId&&(this.u.loadTimerStart(f.LoadEvent.Document),this.f.getPreziLoader().loadPrezi(this.o,this.options.preziId)),this.ma.qa(d.PreziLoaderEventType.EditorInit,40))})}getSelectTemplateStream(){return this.pa}createPrezi(a,b,c=!0){const e=q.Bacon.newBus(),d=b&&b.title||P.I18n.ts("Untitled presentation");b=b&&b["private"];
this.xa.push({kind:N.DocumentEventKind.Create,templateInfo:H.CetModelEditor.readTemplateInfo(a)});this.f.getPreziCreator().createPrezi(this.o,d,"",a,this.getSchemaVersion(),b).onValue((a)=>{a.success?(this.u.loadTimerStart(f.LoadEvent.Assets),this.v.updatePreziIdInUrl(a.metadata.oid),this.u.bb(a.metadata,this.i),this.i.getBasicEditController().forceSaveAndGetStorageProperties(),c&&this.activateEditMode()):this.Ea.push({errorCase:r.EditorErrorCase.PREZI_CREATION_FAILED,unclosable:!1});e.push(a.success)});
return e}Kc(){this.pa=q.Bacon.newBus();this.logger.info({action:"created",object:"new_prezi",trigger:"machine"});this.i.startTemplateChooser((a,b)=>{this.pa.plug(this.createPrezi(a,b));return this.pa})}getSchemaVersion(){return t.j.rb}getPlayer(){return this.playerUI}getEditor(){return this.i}getLoadingProgress(){return this.ma.Aa}getStepCount(){return this.getPlayer().getPlayback()?this.getPlayer().getPlayback().getStepCount():-1}resetToEditorForTest(){return ca(this,void 0,void 0,function*(){this.o.getMainStage().resetForTest();
const a=this.i.getEditScene();null!=a&&(a.requestCommitForTest(),this.u.sa(this.o,this.i,this.playerUI));this.Fc();yield this.getEditor().reset();yield this.load();this.u.sa(this.o,this.i,this.playerUI)})}load(){this.f.getPreziLoader().loadPrezi(this.o,this.options.preziId);return new Promise((a)=>{this.f.getPreziLoader().getLoaderStream().filter((a)=>a.type===d.PreziLoaderEventType.PreziLoaded).onValue(()=>a())})}resetToTemplateChooserForTest(){this.getEditor().reset({kind:n.EditorMode.templateChooser})}getTemplatePreviewHelper(){return this.i.getTemplatePreviewCetController().getTestHelper()}integration_test_getTextEntityText(a){return this.i.getEditScene().getEntityById(a).getWrapper(m.CetModel.ID.Z_TEXT.W).getText().getRawText()}integration_test_setTextEntityText(a,
b){this.i.integration_test_getZObjectEditor().executeApiCommand({name:"setTextForTestCmd",run:(c)=>{c=c.lookup.text(a);c.wrapWidth=400;c.setText(b)}})}getPreziDataClientForTest(){return this.v}activateEditMode(){this.fa.push({newMode:n.EditorMode.edit,trigger:"prezipage"})}activatePresentMode(){this.fa.push(this.options.userCanEdit||this.options.userCanComment?{newMode:n.EditorMode.playback,trigger:"prezipage",shouldGoFullscreen:!1,shouldSeekPathToStart:!1,showTopmenu:!0,linkClickedFlow:!1,presenterNotesFlow:!1}:
{newMode:n.EditorMode.view,trigger:"prezipage"});this.playerUI.getPlayback().initPosition(!1);this.rc()}activateInfoMode(){this.fa.push({newMode:n.EditorMode.info,trigger:"prezipage"})}printHierarchy(a,b){B.isActive("js-developer-features")&&this.i.printHierarchy(a,b)}getSteps(){const a=this.getPlayer().getPathNavigator().getPath(),b=a.getStartPoint();return a.getAllPathPositions().filter((a)=>!a.isBefore(b))}getThumbnailForTest(a,b){return ca(this,void 0,void 0,function*(){if(!B.isActive("js-developer-features"))throw"";
const c=this.getSteps();for(let g=0;g<c.length;g++){const l=(new Date).getTime();var e=c[g],d=this.playerUI.getPlayback().getScene();const m=this.playerUI.getPathNavigator().getPath();var f=na.PlaybackModule.createVisibilityFilter(d,m.getTargetForStep(e.getStep()),!0,e),k=this.o.getMainStage();e=m.getTargetForPathPosition(e);d=h.Cet.getViewportWorldIfFocusedOnEntity(d.getEntityById(e),d,this.playerUI.getCamera());k=(yield k.createSnapshotCanvas(d,{width:a,height:9*a/16},!0,f,!0,()=>!0)).canvas;f=
(new Date).getTime();d=`0000${g}`;yield this.Ic(k,`${b}/${d.substr(d.length-4)}.png`);k=(new Date).getTime();console.error(`Time ${g}: thumbnail: ${f-l}ms + send: ${k-f}ms = ${k-l}ms`)}})}Ic(a,b){return new Promise((c)=>{const d=a.toDataURL();a.width=0;const f=new XMLHttpRequest;f.onreadystatechange=function(){4===f.readyState&&200===f.status&&c()};f.open("POST","/save_data_url/",!0);f.setRequestHeader("Content-Type","application/x-www-form-urlencoded");f.send("data="+encodeURIComponent(d)+"&path="+
encodeURIComponent(b))})}rc(){this.logger.info({action:"activated",object:"present_mode",trigger:"prezipage",track_insights:{event:W.InsighstEvent.STARTED,current_step_number:0}})}Ob(){this.options.startInPresentMode=this.options.startInPresentMode||/^#present$/.test(window.location.hash);this.options.deepLinkRoute=this.options.deepLinkRoute||window.parent.location.hash.substr(1);this.Cc()}Cc(){window.history.pushState("",this.Nb(),window.location.pathname+window.location.search)}Nb(){return document.title.replace(/&/g,
"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}fc(a){a=d.DataServiceModule.createUserSettingsStore(a);this.mb.plug(a.getAllUserSettingsStream().map((a)=>({JS_PATH_STEP_ANIMATION_ONBOARDING_SHOWN:a.boolean_settings[d.UserSettingBooleanKeys.JS_PATH_STEP_ANIMATION_ONBOARDING_SHOWN],REMOTE_PRESENTATION_ONBOARDING_SHOWN:a.boolean_settings[d.UserSettingBooleanKeys.REMOTE_PRESENTATION_ONBOARDING_SHOWN],CONCEPT_ONBOARDING_SHOWN:a.boolean_settings[d.UserSettingBooleanKeys.CONCEPT_ONBOARDING_SHOWN],
MULTI_PRODUCT_FORCE_SHOW_PITCH_ONBOARDING:a.boolean_settings[d.UserSettingBooleanKeys.MULTI_PRODUCT_FORCE_SHOW_PITCH_ONBOARDING],MULTI_PRODUCT_PITCH_ONBOARDING_SHOWN:a.boolean_settings[d.UserSettingBooleanKeys.MULTI_PRODUCT_PITCH_ONBOARDING_SHOWN],AUDIO_ONBOARDING_UPLOAD_SHOWN:a.boolean_settings[d.UserSettingBooleanKeys.AUDIO_ONBOARDING_UPLOAD_SHOWN],AUDIO_ONBOARDING_PLAY_SHOWN:a.boolean_settings[d.UserSettingBooleanKeys.AUDIO_ONBOARDING_PLAY_SHOWN],AUDIO_ONBOARDING_MUTE_SHOWN:a.boolean_settings[d.UserSettingBooleanKeys.AUDIO_ONBOARDING_MUTE_SHOWN],
AUDIO_ONBOARDING_PRESENT_SHOWN:a.boolean_settings[d.UserSettingBooleanKeys.AUDIO_ONBOARDING_PRESENT_SHOWN],EDITOR_SEEN:a.boolean_settings[d.UserSettingBooleanKeys.EDITOR_SEEN],BROWSER_NOTIFICATION_PERMISSION_DENIED:a.boolean_settings[d.UserSettingBooleanKeys.BROWSER_NOTIFICATION_PERMISSION_DENIED],JS_EDITOR_PPT_ONBOARDING:a.boolean_settings[d.UserSettingBooleanKeys.JS_EDITOR_PPT_ONBOARDING],STORYBLOCKS_TOPIC_ONBOARDING_SHOWN:a.boolean_settings[d.UserSettingBooleanKeys.STORYBLOCKS_TOPIC_ONBOARDING_SHOWN],
MY_LIBRARY_FAVORITES_ONBOARDING_SHOWN:a.boolean_settings[d.UserSettingBooleanKeys.MY_LIBRARY_FAVORITES_ONBOARDING_SHOWN],registration_date:a.registration_date,desktop_full:a.desktop_full})))}};t.j.tb="landing_page";t.j.qb="edit";t.j.rb="2";t.j.ob="/p/create-prezi/";t.j.Ha="//prezi.com";t.j.zb={appSource:n.AppSource.LANDING_PAGE,userCanEdit:!1,userCanComment:!1,createPreziUrl:t.j.ob,hostName:t.j.Ha,useFallbackStorageServices:!0,enableOfflineEditing:!1};t.j.pb={appSource:n.AppSource.EDIT_PAGE,hostName:t.j.Ha};
var Q={};Object.defineProperty(Q,"__esModule",{value:!0});(function(a){a.createEditorInit=function(a,c){return new t.j(a,c)};a.main=function(a,c){window.preziEditorInitVersion=k.getModuleVersion();let b;$("#prezi-viewer").length?(b=new t.j("prezi-viewer",()=>H.CetModelEditor.cetSessionFactory()),b.extendWithOptions(t.j.zb)):(b=new t.j("prezi-player",()=>H.CetModelEditor.cetSessionFactory()),b.extendWithOptions(t.j.pb));b.extendWithOptions(a,c);b.initEditor();window.preziPlayerJS=b;b.startApplication()};
a.getDefaultPreziOptions=function(){return y.Ja};a.getDefaultPlayerOptions=function(){return y.Ia}})(Q.EditorInitModule||(Q.EditorInitModule={}));return Q});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_editor_init",["require","jqueryUi","prezi.engine.dom","prezi.text.model","prezi_app_utils","prezi_bacon","prezi_canvas_listener","prezi_cet","prezi_cet_model","prezi_cet_model_editor","prezi_cet_renderer","prezi_client_player","prezi_coeditui","prezi_editor_controller","prezi_editor_error","prezi_editor_store_common","prezi_editor_store_mode","prezi_editor_store_ui","prezi_editor_ui","prezi_error_page","prezi_externalserviceprovider","prezi_featureswitcher","prezi_i18n","prezi_insights","prezi_logger","prezi_meeting","prezi_nativeapitypes","prezi_pdf_export","prezi_playback","prezi_plugin_api","prezi_plugin_meta","prezi_service_data","prezi_service_media","prezi_sound_playback","prezi_spotlight","prezi_support","prezi_templateservice","prezi_thumbnail_render","prezi_uaparser","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_editor_init.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1).concat([function(){return new Promise(function(resolve,reject){require(["prezi_ppt_preload"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_test_preload"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});}]));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("jqueryUi"),require("prezi.engine.dom"),require("prezi.text.model"),require("prezi_app_utils"),require("prezi_bacon"),require("prezi_canvas_listener"),require("prezi_cet"),require("prezi_cet_model"),require("prezi_cet_model_editor"),require("prezi_cet_renderer"),require("prezi_client_player"),require("prezi_coeditui"),require("prezi_editor_controller"),require("prezi_editor_error"),require("prezi_editor_store_common"),require("prezi_editor_store_mode"),require("prezi_editor_store_ui"),require("prezi_editor_ui"),require("prezi_error_page"),require("prezi_externalserviceprovider"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_insights"),require("prezi_logger"),require("prezi_meeting"),require("prezi_nativeapitypes"),require("prezi_pdf_export"),require("prezi_playback"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_service_data"),require("prezi_service_media"),require("prezi_sound_playback"),require("prezi_spotlight"),require("prezi_support"),require("prezi_templateservice"),require("prezi_thumbnail_render"),require("prezi_uaparser"),require("prezi_utils"),function(){return Promise.resolve(require("prezi_ppt_preload").lazyModule);},function(){return Promise.resolve(require("prezi_test_preload").lazyModule);});}else{this["prezi_editor_init"]=__factory(jqueryUi,this["prezi.engine.dom"],this["prezi.text.model"],this["prezi_app_utils"],this["prezi_bacon"],this["prezi_canvas_listener"],this["prezi_cet"],this["prezi_cet_model"],this["prezi_cet_model_editor"],this["prezi_cet_renderer"],this["prezi_client_player"],this["prezi_coeditui"],this["prezi_editor_controller"],this["prezi_editor_error"],this["prezi_editor_store_common"],this["prezi_editor_store_mode"],this["prezi_editor_store_ui"],this["prezi_editor_ui"],this["prezi_error_page"],this["prezi_externalserviceprovider"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_insights"],this["prezi_logger"],this["prezi_meeting"],this["prezi_nativeapitypes"],this["prezi_pdf_export"],this["prezi_playback"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_service_data"],this["prezi_service_media"],this["prezi_sound_playback"],this["prezi_spotlight"],this["prezi_support"],this["prezi_templateservice"],this["prezi_thumbnail_render"],this["prezi_uaparser"],this["prezi_utils"],function(){return Promise.resolve(this["prezi_ppt_preload"].lazyModule);},function(){return Promise.resolve(this["prezi_test_preload"].lazyModule);});}}).call(this);