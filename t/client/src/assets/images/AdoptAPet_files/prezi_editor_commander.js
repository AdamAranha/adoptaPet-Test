;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_editor_commander";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.engine.dom":dependencies[0],"prezi.engine.dom.converter.xpdom2":dependencies[1],"prezi.geometry":dependencies[2],"prezi.text":dependencies[3],"prezi.text.model":dependencies[4],"prezi_app_utils":dependencies[5],"prezi_bacon":dependencies[6],"prezi_cet":dependencies[7],"prezi_cet_model":dependencies[8],"prezi_cet_model_editor":dependencies[9],"prezi_cet_renderer":dependencies[10],"prezi_editor_commander_common":dependencies[11],"prezi_editor_store_mode":dependencies[12],"prezi_editor_store_object":dependencies[13],"prezi_externalserviceprovider":dependencies[14],"prezi_featureswitcher":dependencies[15],"prezi_i18n":dependencies[16],"prezi_logger":dependencies[17],"prezi_plugin_api":dependencies[18],"prezi_ppt_service":dependencies[19],"prezi_service_fontcatalogue":dependencies[20],"prezi_service_media":dependencies[21],"prezi_styleschemeprovider":dependencies[22],"prezi_templateservice":dependencies[23],"prezi_textstyleprovider":dependencies[24],"prezi_utils":dependencies[25],"prezi_widgets":dependencies[26]}};})());};})(arguments);var moduleImpl=(function(){return module(function(l){function Z(a){return null!=a&&u.isFromEnum(a,f.base.ShapelikeFilterStyle)}function lb(a,b){return.2>=n.Geometry.colorFromRGBA(a.r/255,a.g/255,a.b/255,b).getContrastWith(yb)}var zb=null,Ab=l.dependencies["prezi.engine.dom"],aa=l.dependencies.prezi_app_utils,Ba=l.dependencies.prezi_bacon,A=l.dependencies.prezi_editor_commander_common,ka=l.dependencies.prezi_featureswitcher,mb=l.dependencies.prezi_i18n,q=l.dependencies.prezi_logger,I=l.dependencies.prezi_plugin_api,n=l.dependencies["prezi.geometry"],
w=l.dependencies.prezi_cet_model,f=l.dependencies.prezi_cet_model_editor,p=l.dependencies.prezi_styleschemeprovider,u=l.dependencies.prezi_utils,Bb=l.dependencies.prezi_service_fontcatalogue,la={};Object.defineProperty(la,"__esModule",{value:!0});la.TextStyleCommanderImpl=class{getFontScheme(a){const b=(b)=>a.styleSheets.find((a)=>a.className===b);return{title:this.getFontProperties(b("title")),subtitle:this.getFontProperties(b("subtitle")),subtitle2:this.getFontProperties(b("subtitle_2")),body:this.getFontProperties(b("body")),
body2:this.getFontProperties(b("body_2"))}}getFontProperties(a){if(a){const b={fontFamily:a.styleBlock.text.font.description.fontFamily,hasBackground:a.styleBlock.text.background.display,hasBold:a.styleBlock.text.font.weight===f.base.FontWeight.Bold,hasItalic:a.styleBlock.text.font.style===f.base.FontStyle.Italic,isCustom:!1};return Bb.isBuiltinFont(a.styleBlock.text.font.description.fontFamily)?b:Object.assign(Object.assign({},b),{isCustom:!0,customKegProperties:{normalKeg:a.styleBlock.text.font.description.normalKeg,
italicKeg:a.styleBlock.text.font.description.italicKeg,boldKeg:a.styleBlock.text.font.description.boldKeg,boldItalicKeg:a.styleBlock.text.font.description.boldItalicKeg}})}return{fontFamily:"",hasBackground:!1,hasBold:!1,hasItalic:!1,isCustom:!1}}applyFontSchemeCmd(a,b){return{name:"applyTextStyleCmd",run:(c)=>{const d=this.getUpdatedFontStyleDeclarations(a,c,b);c.styleSheet.update([...d.values()])}}}getUpdatedFontStyleDeclarations(a,b,c){const d=["title","subtitle","subtitle_2","body","body_2"],
e=new Map;b.styleSheet.styleSheets.forEach((a)=>{-1<d.indexOf(a.className)&&e.set(a.className,a)});this.updateFontStyleBlock(a,b,e,"title",c.title);this.updateFontStyleBlock(a,b,e,"subtitle",c.subtitle);this.updateFontStyleBlock(a,b,e,"subtitle_2",c.subtitle2);this.updateFontStyleBlock(a,b,e,"body",c.body);this.updateFontStyleBlock(a,b,e,"body_2",c.body2);return e}updateFontStyleBlock(a,b,c,d,e){b=c.get(d)||{className:d,typeName:null,styleBlock:b.styleSheet.createEmptyStyleBlock()};c.set(d,Object.assign(Object.assign({},
b),{styleBlock:this.getStyleBlockUpdatedWithFonts(a,b.styleBlock,e)}))}getStyleBlockUpdatedWithFonts(a,b,c){const d=a.getFontDescription(c.fontFamily);return Object.assign(Object.assign({},b),{text:Object.assign(Object.assign({},b.text),{font:{description:d||a.createFontDescription(c.fontFamily,c.customKegProperties.normalKeg,c.customKegProperties.boldKeg,c.customKegProperties.italicKeg,c.customKegProperties.boldItalicKeg),style:c.hasItalic?f.base.FontStyle.Italic:f.base.FontStyle.Normal,weight:c.hasBold?
f.base.FontWeight.Bold:f.base.FontWeight.Normal}})})}};var ma={};Object.defineProperty(ma,"__esModule",{value:!0});var V=f.base.ObjectKind,na=f.base.ColorFilterKind,da=f.base.FillKind,J=f.base.ObjectKind,Cb=f.base.CoverLayoutRole,Db=f.base.BackgroundFilterStyle;ma.ColorMixCommanderImpl=class{constructor(){if(null==H){H={};Ca={};nb={};Da={};Ea={};ob={};Fa={};pb={};var a={};a[f.base.ShapeStyle.Poly1]=p.PaletteColorType.BackgroundColor;a[f.base.ShapeStyle.Poly2]=p.PaletteColorType.TopicAColor;a[f.base.ShapeStyle.Poly3]=
p.PaletteColorType.TopicBColor;a[f.base.ShapeStyle.Poly4]=p.PaletteColorType.BorderColor;a[f.base.ShapeStyle.Poly5]=p.PaletteColorType.ExtraColor;R(a,Ea);a={};a[f.base.ArcStyle.Line1]=p.PaletteColorType.BackgroundColor;a[f.base.ArcStyle.Line2]=p.PaletteColorType.TopicAColor;a[f.base.ArcStyle.Line3]=p.PaletteColorType.TopicBColor;a[f.base.ArcStyle.Line4]=p.PaletteColorType.BorderColor;a[f.base.ArcStyle.Line5]=p.PaletteColorType.ExtraColor;a[f.base.ArcStyle.Chainlink]=p.PaletteColorType.BorderColor;
a[f.base.ArcStyle.ChainlinkCamelCase]=p.PaletteColorType.BorderColor;R(a,Fa);a={};a.color1=p.PaletteColorType.BackgroundColor;a.color2=p.PaletteColorType.TopicAColor;a.color3=p.PaletteColorType.TopicBColor;a.color4=p.PaletteColorType.BorderColor;a.color5=p.PaletteColorType.ExtraColor;R(a,Da);a={};a[f.base.ShapelikeFilterStyle.Filter1]=p.PaletteColorType.BackgroundColor;a[f.base.ShapelikeFilterStyle.Filter2]=p.PaletteColorType.TopicAColor;a[f.base.ShapelikeFilterStyle.Filter3]=p.PaletteColorType.TopicBColor;
a[f.base.ShapelikeFilterStyle.Filter4]=p.PaletteColorType.BorderColor;a[f.base.ShapelikeFilterStyle.Filter5]=p.PaletteColorType.ExtraColor;R(a,Ca);a={};a[f.base.FullBlendShapelikeFilterStyle.Filter1]=p.PaletteColorType.BackgroundColor;a[f.base.FullBlendShapelikeFilterStyle.Filter2]=p.PaletteColorType.TopicAColor;a[f.base.FullBlendShapelikeFilterStyle.Filter3]=p.PaletteColorType.TopicBColor;a[f.base.FullBlendShapelikeFilterStyle.Filter4]=p.PaletteColorType.BorderColor;a[f.base.FullBlendShapelikeFilterStyle.Filter5]=
p.PaletteColorType.ExtraColor;R(a,nb);a={};a[f.base.ImageLikeFilterStyle.Filter1]=p.PaletteColorType.BackgroundColor;a[f.base.ImageLikeFilterStyle.Filter2]=p.PaletteColorType.TopicAColor;a[f.base.ImageLikeFilterStyle.Filter3]=p.PaletteColorType.TopicBColor;a[f.base.ImageLikeFilterStyle.Filter4]=p.PaletteColorType.BorderColor;a[f.base.ImageLikeFilterStyle.Filter5]=p.PaletteColorType.ExtraColor;R(a,ob);a={};a[f.base.BackgroundFilterStyle.Filter1]=p.PaletteColorType.BackgroundColor;a[f.base.BackgroundFilterStyle.Filter2]=
p.PaletteColorType.TopicAColor;a[f.base.BackgroundFilterStyle.Filter3]=p.PaletteColorType.TopicBColor;a[f.base.BackgroundFilterStyle.Filter4]=p.PaletteColorType.BorderColor;a[f.base.BackgroundFilterStyle.Filter5]=p.PaletteColorType.ExtraColor;R(a,Eb);a={};a.title=p.PaletteColorType.PrimaryTextColor;a.subtitle=p.PaletteColorType.PrimaryTextColor;a.body=p.PaletteColorType.PrimaryTextColor;a.subtitle_2=p.PaletteColorType.SecondaryTextColor;a.body_2=p.PaletteColorType.SecondaryTextColor;R(a,pb)}}styleBlockWithColor(a,
b,c=b){b=f.CetModelEditor.colorToStyleColor(b);c=f.CetModelEditor.colorToStyleColor(c);b=Object.assign(Object.assign({},a.fill),{color:b,gradientStartColor:b,gradientEndColor:b,gradientStartAlpha:1,gradientEndAlpha:0});c=Object.assign(Object.assign({},a.border),{color:c});return Object.assign(Object.assign({},a),{fill:b,border:c})}styleBlockWithTextColor(a,b,c){b=f.CetModelEditor.colorToStyleColor(b);b=Object.assign(Object.assign({},a.fill),{color:b,fillKind:da.solid});const d=f.CetModelEditor.colorToStyleColor(c);
c=c.getAlpha();c=Object.assign(Object.assign({},a.text),{background:Object.assign(Object.assign({},a.text.background),{color:d,alpha:c})});return Object.assign(Object.assign({},a),{fill:b,text:c})}styleBlockWithColorFilter(a,b,c){b=f.CetModelEditor.colorToStyleColor(b);c={kind:na.solidColorBlend,color:Object.assign(Object.assign({},b),{a:c})};return Object.assign(Object.assign({},a),{colorFilter:c})}shouldUpdateWithColors(a,b){return a.fill.fillKind!==b.fill.fillKind||!this.styleColorEquals(a.fill.color,
b.fill.color)||!this.styleColorEquals(a.fill.gradientStartColor,b.fill.gradientStartColor)||!this.styleColorEquals(a.fill.gradientEndColor,b.fill.gradientEndColor)||a.fill.alpha!==a.fill.alpha||a.fill.gradientStartAlpha!==a.fill.gradientStartAlpha||a.fill.gradientEndAlpha!==a.fill.gradientEndAlpha||!this.styleColorEquals(a.border.color,b.border.color)||a.border.alpha!==b.border.alpha||!this.colorFilterEquals(a.colorFilter,b.colorFilter)||!this.styleColorEquals(a.text.background.color,b.text.background.color)||
a.text.background.alpha!==b.text.background.alpha}colorFilterEquals(a,b){return null==a&&null==b||null!=a&&null!=b&&a.kind===na.solidColorBlend&&b.kind===na.solidColorBlend&&this.styleColorEquals(a.color,b.color)&&a.color.a===b.color.a}styleColorEquals(a,b){return null==a&&null==b||null!=a&&null!=b&&a.r===b.r&&a.g===b.g&&a.b===b.b}themeColorEquals(a,b){return null==a&&null==b||null!=a&&null!=b&&this.styleColorEquals(a.color1,b.color1)&&this.styleColorEquals(a.color2,b.color2)&&this.styleColorEquals(a.color3,
b.color3)&&this.styleColorEquals(a.color4,b.color4)&&this.styleColorEquals(a.color5,b.color5)}applyShapeStyles(a){return{name:"applyPaletteCmd",run:(b)=>{const c=new Map;b.styleSheet.styleSheets.forEach((a)=>{c.set(a.className,a)});const d=this.getUpdatedShapeStyles(b,a,c);b.styleSheet.update([...d.values()])}}}getUpdatedShapeStyles(a,b,c){const d=new Map,e=(b,e)=>{const g=d.has(b)?d.get(b):c.has(b)?c.get(b):e?{className:b,typeName:null,styleBlock:a.styleSheet.createEmptyStyleBlock()}:null;return null!=
g?{styleBlock:g.styleBlock,update:(a)=>{d.set(b,Object.assign(Object.assign({},g),{styleBlock:a}))}}:null};b.shapeStyleColors.forEach((a)=>{const b=e(a.shapeStyle,!1);null!=b&&(a=this.styleBlockWithColor(b.styleBlock,a.paletteColor.color,a.borderColor.color),this.shouldUpdateWithColors(b.styleBlock,a)&&b.update(a))});b.visualStyleColors.forEach((a)=>{const c=e(a.visualBlendStyle,!0);a=this.styleBlockWithColorFilter(c.styleBlock,a.paletteColor.color,b.visualBlendAlpha);this.shouldUpdateWithColors(c.styleBlock,
a)&&c.update(a)});b.fullBlendVisualStyleColors.forEach((a)=>{const c=e(a.visualBlendStyle,!0);a=this.styleBlockWithColorFilter(c.styleBlock,a.paletteColor.color,b.fullVisualBlendAlpha);this.shouldUpdateWithColors(c.styleBlock,a)&&c.update(a)});b.imageStyleColors.forEach((a)=>{const c=e(a.imageBlendStyle,!0);a=this.styleBlockWithColorFilter(c.styleBlock,a.paletteColor.color,b.imageBlendAlpha);this.shouldUpdateWithColors(c.styleBlock,a)&&c.update(a)});return d}applyPaletteCmd(a,b,c,d){return{name:"applyPaletteCmd",
run:(e)=>{const g=new Map;e.styleSheet.styleSheets.forEach((a)=>{g.set(a.className,a)});let k=new Map;var v=this.getUpdatedShapeStyles(e,b,g);const B=(a,b)=>{const c=k.has(a)?k.get(a):g.has(a)?g.get(a):b?{className:a,typeName:null,styleBlock:e.styleSheet.createEmptyStyleBlock()}:null;return null!=c?{styleBlock:c.styleBlock,update:(b)=>{k.set(a,Object.assign(Object.assign({},c),{styleBlock:b}))}}:null};b.arcStyleColors.forEach((a)=>{const b=B(a.arcStyle,!1);null!=b&&(a=this.styleBlockWithColor(b.styleBlock,
a.paletteColor.color),this.shouldUpdateWithColors(b.styleBlock,a)&&b.update(a))});b.backgroundStyleColors.forEach((a)=>{const b=B(a.bgFilterStyle,!0);a=this.styleBlockWithColorFilter(b.styleBlock,a.paletteColor.color,0);this.shouldUpdateWithColors(b.styleBlock,a)&&b.update(a)});if(d){const b=(new la.TextStyleCommanderImpl).getUpdatedFontStyleDeclarations(a,e,d);k=new Map([...k,...b])}b.textStyleColors.forEach((a)=>{const b=B(a.textStyle,!1);null!=b&&(a=this.styleBlockWithTextColor(b.styleBlock,a.paletteColor.color,
a.backgroundColor.color),this.shouldUpdateWithColors(b.styleBlock,a)&&b.update(a))});e.styleSheet.update([...k.values(),...v.values()]);let h={};b.themeStyleColors.forEach((a)=>{const b=f.CetModelEditor.colorToStyleColor(a.paletteColor.color);switch(a.themeStyle){case "color1":h=Object.assign(Object.assign({},h),{color1:b});break;case "color2":h=Object.assign(Object.assign({},h),{color2:b});break;case "color3":h=Object.assign(Object.assign({},h),{color3:b});break;case "color4":h=Object.assign(Object.assign({},
h),{color4:b});break;case "color5":h=Object.assign(Object.assign({},h),{color5:b})}});v=Object.assign(Object.assign({},e.styleSheet.themeColors),h);this.themeColorEquals(e.styleSheet.themeColors,v)||(e.styleSheet.themeColors=v);v=b.backgroundStyleColors.find((a)=>a.bgFilterStyle===Db.Filter1).paletteColor.color;e.background.fill.fillKind===da.solid&&this.styleColorEquals(e.background.fill.color,v.getRGBData())&&1===e.background.fill.color.a||(e.background.fill={fillKind:da.solid,color:Object.assign(Object.assign({},
e.styleSheet.themeColors.color1),{a:1})});e.styleSheet.colorPaletteId=c}}}isContainer(a,b){return b.is(J.overview)||b.is(J.topic)||b.is(J.page)}isCover(a){return a.parent.is(J.cover)}isCoverIcon(a){return this.isCover(a)&&a.coverLayoutRole===Cb.coverIcon}getColorReferenceObjects(a,b){let c=[];switch(a.kind){case V.cover:c=a.parent.simpleChildren(f.base.ChildVisibilityKind.outside).filter((a)=>!this.isCoverIcon(a));break;case V.visual:case V.surface:c=a.parent.simpleChildren(f.base.ChildVisibilityKind.outsideAndInside);
break;case V.master:c=a.contentChildren;break;case V.planetTopic:c=a.simpleChildren(f.base.ChildVisibilityKind.outsideAndInside);break;case V.page:c=a.parent.simpleChildren(f.base.ChildVisibilityKind.inside);break;case V.overview:c=[b.background];break;default:throw u.Utils.assertNever(a);}return c.filter((a)=>!(a.kind===J.text||a.kind===J.arc))}updateTextColor(a,b,c,d=null){b=a.lookup.text(b);const e=a.lookup.base(c);if(!this.isContainer(a,e))throw`${c} is not a container object (overview/topic/page)`;
c=this.getColorReferenceObjects(b.parent,a);null==d&&(d=this.getAutoColorsForText(a));a=this.getAutoColorForText(c,b.background,d);this.setTextColor(b,a);return a}getAutoColorsForText(a){a=this.paletteFromPrezi(a.styleSheet);return[a.getColor(p.PaletteColorType.PrimaryTextColor).color,a.getColor(p.PaletteColorType.SecondaryTextColor).color]}getAutoColorForText(a,b,c){let d={a:.01,r:255,g:255,b:255};a.forEach((a)=>{let b;switch(a.kind){case J.shape:b=this.colorFromColorFilter(a.colorFilter);null==
b&&(b=this.colorFromShapeFill(a.fill));break;case J.arc:b=this.colorFromColorFilter(a.colorFilter);null==b&&(b=a.fill);break;case J.image:case J.pdf:case J.swf:b=this.colorFromColorFilter(a.colorFilter);null==b&&(b={a:.1,r:255,g:255,b:255});break;case J.background:b=this.colorFromColorFilter(a.getColorFilter(0));if(null==b||0===b.a)b=a.fill.fillKind===da.solid?a.fill.color:a.fill.startColor;null==b&&(b={a:.1,r:255,g:255,b:255});break;default:b={a:.1,r:255,g:255,b:255}}0!==b.a&&(a=d.a+b.a,d={r:(d.a*
d.r+b.a*b.r)/a,g:(d.a*d.g+b.a*b.g)/a,b:(d.a*d.b+b.a*b.b)/a,a:d.a+b.a})});null!=b&&(d={r:b.r*b.a+(1-b.a)*d.r,g:b.g*b.a+(1-b.a)*d.g,b:b.b*b.a+(1-b.a)*d.b,a:b.a+(1-b.a)*d.a});let e=this.getContrastBetweenColors(c[0].getRGBData(),d),g=c[0];c.slice(1).forEach((a)=>{const b=this.getContrastBetweenColors(a.getRGBData(),d);b>e&&(e=b,g=a)});return g.getRGBData()}lum(a,b,c){a=[a,b,c].map(function(a){a/=255;return.03928>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)});return.2126*a[0]+.7152*a[1]+.0722*a[2]}getContrastBetweenColors(a,
b){a=this.lum(a.r,a.g,a.b)+.05;b=this.lum(b.r,b.g,b.b)+.05;return Math.max(a,b)/Math.min(a,b)}setTextColor(a,b){a.getCharacterProps().every((a)=>a.color.b===b.b&&a.color.g===b.g&&a.color.r===b.r)||a.setAllCharacterProps({color:b})}colorFromColorFilter(a){return a.kind===na.noColorFilter?null:a.color}colorFromShapeFill(a){return a.fillKind===da.solid?a.color:a.startColor}paletteFromPrezi(a){if(null==a)return null;var b=a.styleSheets.find((a)=>"subtitle"===a.className);b=null!=b&&null!=b.styleBlock.fill.color?
b.styleBlock.fill.color:{r:0,g:0,b:0};var c=a.styleSheets.find((a)=>"subtitle_2"===a.className);c=null!=c&&null!=c.styleBlock.fill.color?c.styleBlock.fill.color:{r:255,g:255,b:255};return p.StyleSchemeProviderModule.createColorPalette(a.colorPaletteId,{backgroundColor:this.styleColorToColor(a.themeColors.color1),topicAColor:this.styleColorToColor(a.themeColors.color2),topicBColor:this.styleColorToColor(a.themeColors.color3),borderColor:this.styleColorToColor(a.themeColors.color4),extraColor:this.styleColorToColor(a.themeColors.color5),
primaryTextColor:this.styleColorToColor(b),secondaryTextColor:this.styleColorToColor(c)})}schemeFromPrezi(a){if(null==a)return null;const b=this.paletteFromPrezi(a),{thumbnailUrl:c}=b,d=a.colorPaletteId;a=h.EditorCommander.createTextStyleCommander().getFontScheme(a);return{id:d,title:"",isCustom:!0,colorScheme:{backgroundColor:b.getColor(p.PaletteColorType.BackgroundColor).color,topicAColor:b.getColor(p.PaletteColorType.TopicAColor).color,topicBColor:b.getColor(p.PaletteColorType.TopicBColor).color,
borderColor:b.getColor(p.PaletteColorType.BorderColor).color,extraColor:b.getColor(p.PaletteColorType.ExtraColor).color,primaryTextColor:b.getColor(p.PaletteColorType.PrimaryTextColor).color,secondaryTextColor:b.getColor(p.PaletteColorType.SecondaryTextColor).color},fontScheme:a,thumbnailUrl:c}}styleColorToColor(a){return n.Geometry.colorFromRGB(a.r/255,a.g/255,a.b/255)}getPaletteColorForEntity(a,b){a=a.getEntityById(b);let c=null;null!=a&&a.getComponent(w.CetModel.ID.STYLED.STYLE_CLASSES).items().forEach((a)=>
{null!=H[a]&&(c=H[a])});return c}getShapefilterStyle(a){return Ca[a]}getShapeStyle(a){return Ea[a]}getArcStyle(a){return Fa[a]}getThemeStyle(a){return Da[a]}createMapping(a){var b=[f.base.ArcStyle.Line1,f.base.ArcStyle.Line2,f.base.ArcStyle.Line3,f.base.ArcStyle.Line4,f.base.ArcStyle.Line5,f.base.ArcStyle.Chainlink,f.base.ArcStyle.ChainlinkCamelCase],c=[f.base.ShapelikeFilterStyle.Filter1,f.base.ShapelikeFilterStyle.Filter2,f.base.ShapelikeFilterStyle.Filter3,f.base.ShapelikeFilterStyle.Filter4,f.base.ShapelikeFilterStyle.Filter5],
d=[f.base.FullBlendShapelikeFilterStyle.Filter1,f.base.FullBlendShapelikeFilterStyle.Filter2,f.base.FullBlendShapelikeFilterStyle.Filter3,f.base.FullBlendShapelikeFilterStyle.Filter4,f.base.FullBlendShapelikeFilterStyle.Filter5],e=[f.base.ImageLikeFilterStyle.Filter1,f.base.ImageLikeFilterStyle.Filter2,f.base.ImageLikeFilterStyle.Filter3,f.base.ImageLikeFilterStyle.Filter4,f.base.ImageLikeFilterStyle.Filter5],g=[f.base.BackgroundFilterStyle.Filter1,f.base.BackgroundFilterStyle.Filter2,f.base.BackgroundFilterStyle.Filter3,
f.base.BackgroundFilterStyle.Filter4,f.base.BackgroundFilterStyle.Filter5];const k=[f.base.ShapeStyle.Poly1,f.base.ShapeStyle.Poly2,f.base.ShapeStyle.Poly3,f.base.ShapeStyle.Poly4,f.base.ShapeStyle.Poly5].map((b)=>{const c=a.getColor(H[b]);return{shapeStyle:b,paletteColor:c,borderColor:a.getColor(p.PaletteColorType.BorderColor)}});b=b.map((b)=>{const c=a.getColor(H[b]);return{arcStyle:b,paletteColor:c}});c=c.map((b)=>{const c=a.getColor(H[b]);return{visualBlendStyle:b,paletteColor:c}});d=d.map((b)=>
{const c=a.getColor(H[b]);return{visualBlendStyle:b,paletteColor:c}});e=e.map((b)=>{const c=a.getColor(H[b]);return{imageBlendStyle:b,paletteColor:c}});const v=["color1","color2","color3","color4","color5"].map((b)=>{const c=a.getColor(H[b]);return{themeStyle:b,paletteColor:c}});g=g.map((b)=>{const c=a.getColor(H[b]);return{bgFilterStyle:b,paletteColor:c}});const B=["title","subtitle","body","subtitle_2","body_2"].map((b)=>{const c=a.getColor(H[b]),d=a.getColor(Fb(b));return{textStyle:b,paletteColor:c,
backgroundColor:d}});return{arcStyleColors:b,visualStyleColors:c,fullBlendVisualStyleColors:d,imageStyleColors:e,shapeStyleColors:k,themeStyleColors:v,backgroundStyleColors:g,textStyleColors:B,overviewTitleBlendAlpha:1,topicTitleBlendAlpha:1,slideBlendAlpha:.2,visualBlendAlpha:.8,fullVisualBlendAlpha:1,imageBlendAlpha:.8}}};const Fb=(a)=>{switch(a){case "title":case "subtitle":case "body":return p.PaletteColorType.BorderColor;case "body_2":case "subtitle_2":return p.PaletteColorType.ExtraColor}};
let H,Ca={},nb={},Da={},Ea={},ob={},Fa={},Eb={},pb={};const R=(a,b)=>{Object.keys(a).forEach((c)=>{H[c]=a[c];b[a[c]]=c})};var Ga={};Object.defineProperty(Ga,"__esModule",{value:!0});var ba=f.base.ObjectKind,qb=f.base.ContentLayoutRole,rb=f.base.CoverLayoutRole;Ga.CounterpartUpdaterImpl=class{constructor(a){this.api=a}getCounterpartText(a){a=this.api.lookup.text(a);let b;this.isCoverObject(a)&&a.coverLayoutRole===rb.coverTitle?a.parent.is(ba.cover)&&a.parent.parent.is(ba.planetTopic)&&(b=a.parent.parent.contentChildren.find((a)=>
a.contentLayoutRole===qb.contentTitle)):this.isPlanetContentObject(a)&&a.contentLayoutRole===qb.contentTitle&&a.parent.is(ba.planetTopic)&&(b=a.parent.cover.contentChildren.find((a)=>a.coverLayoutRole===rb.coverTitle));return null!=b?b.id:null}updateCounterpartTexts(a,b){var c=this.getCounterpartText(a);null!=c&&(c=this.api.toDecorator(this.api.lookup.text(c)),a=this.api.toDecorator(this.api.lookup.text(a)),null!=c&&c.is(ba.text)&&(b===h.UpdateOrigin.current?this.copyRawTextToOtherText(a,c):this.copyRawTextToOtherText(c,
a)))}isCoverObject(a){return a.parent.is(ba.cover)}isPlanetContentObject(a){return a.parent.is(ba.planetTopic)}copyRawTextToOtherText(a,b){const c=a.getTextWithStyle().text;b.setTextWithStyle({text:c,characterPropss:this.createTextStyleWithLength(b,c.length)});b.isPlaceholder=a.isPlaceholder}createTextStyleWithLength(a,b){a=a.getCharacterProps();return b>a.length?[...a,...Array(b-a.length).fill(a[a.length-1])]:a.slice(0,b)}};var m={};Object.defineProperty(m,"__esModule",{value:!0});m.layoutWaterlily=
{id:"CoverLayoutWaterlily",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutWaterlily.json")};m.layoutLabel={id:"CoverLayoutLabel",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutLabel.json")};m.layoutCircleBrush={id:"CoverLayoutCircleBrush",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutCircleBrush.json")};m.layoutShadow={id:"CoverLayoutShadow",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutShadow.json")};m.layoutPolygon={id:"CoverLayoutPolygon",category:1,complexity:0,
url:l.getResourceUrl("CoverLayoutPolygon.json")};m.layoutBlurred={id:"CoverLayoutBlurred",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutBlurred.json")};m.layoutBrush={id:"CoverLayoutBrush",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutBrush.json")};m.layoutBrush2={id:"CoverLayoutBrush2",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutBrush2.json")};m.layoutPoint={id:"CoverLayoutPoint",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutPoint.json")};m.layoutPotato=
{id:"CoverLayoutPotato",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutPotato.json")};m.layoutSquare={id:"CoverLayoutSquare",category:4,complexity:0,url:l.getResourceUrl("CoverLayoutSquare.json")};m.layoutSquareShape={id:"CoverLayoutSquareShape",category:1,complexity:0,url:l.getResourceUrl("CoverLayoutSquareShape.json")};m.layoutCube={id:"CoverLayoutCube",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutCube.json")};m.layoutCircle={id:"CoverLayoutCircle",category:4,complexity:0,
url:l.getResourceUrl("CoverLayoutCircle.json")};m.layoutCircleShape={id:"CoverLayoutCircleShape",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutCircleShape.json")};m.layoutCircleBorder={id:"CoverLayoutCircleBorder",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutCircleBorder.json")};m.layoutHex={id:"CoverLayoutHex",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutHex.json")};m.layoutCloud={id:"CoverLayoutCloud",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutCloud.json")};
m.layoutPicFrame={id:"CoverLayoutPicFrame",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutPicFrame.json")};m.layoutSpeechBubble={id:"CoverLayoutSpeechBubble",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutSpeechBubble.json")};m.layoutPin={id:"CoverLayoutPin",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutPin.json")};m.layoutGem={id:"CoverLayoutGem",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutGem.json")};m.layoutPostit={id:"CoverLayoutPostit",category:1,complexity:0,
url:l.getResourceUrl("CoverLayoutPostit.json")};m.layoutRotatedSquare={id:"CoverLayoutRotatedSquare",category:1,complexity:0,url:l.getResourceUrl("CoverLayoutRotatedSquare.json")};m.layoutTexturedCircle={id:"CoverLayoutTexturedCircle",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutTexturedCircle.json")};m.layoutTexturedSquare={id:"CoverLayoutTexturedSquare",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutTexturedSquare.json")};m.layoutSphere={id:"CoverLayoutSphere",category:0,complexity:0,
url:l.getResourceUrl("CoverLayoutSphere.json")};m.layoutCloudSimple={id:"CoverLayoutCloudSimple",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutCloudSimple.json")};m.layoutFlower={id:"CoverLayoutFlower",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutFlower.json")};m.layoutSticky={id:"CoverLayoutSticky",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutSticky.json")};m.layoutJellies={id:"CoverLayoutJellies",category:1,complexity:0,url:l.getResourceUrl("CoverLayoutJellies.json")};
m.layoutCirclesIntersected={id:"CoverLayoutCirclesIntersected",category:0,complexity:0,url:l.getResourceUrl("CoverLayoutCirclesIntersected.json")};m.layoutCircleDotted={id:"CoverLayoutCircleDotted",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutCircleDotted.json")};m.layoutRectLine={id:"CoverLayoutRectLine",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutRectLine.json")};m.layoutRectIntersect={id:"CoverLayoutRectIntersect",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutRectIntersect.json")};
m.layoutDiamond={id:"CoverLayoutDiamond",category:1,complexity:1,url:l.getResourceUrl("CoverLayoutDiamond.json")};m.layoutCircleTintedBorder={id:"CoverLayoutCircleTintedBorder",category:0,complexity:1,url:l.getResourceUrl("CoverLayoutCircleTintedBorder.json")};m.coverLayoutDefinitions=[m.layoutSquare,m.layoutSquareShape,m.layoutCircle,m.layoutCircleShape,m.layoutPotato,m.layoutHex,m.layoutJellies,m.layoutCirclesIntersected,m.layoutRectLine,m.layoutRectIntersect,m.layoutCircleBorder,m.layoutCircleDotted,
m.layoutDiamond,m.layoutCloudSimple,m.layoutPicFrame,m.layoutCircleTintedBorder,m.layoutCube,m.layoutCloud,m.layoutSpeechBubble,m.layoutPin,m.layoutTexturedCircle,m.layoutTexturedSquare,m.layoutWaterlily,m.layoutLabel,m.layoutCircleBrush,m.layoutShadow,m.layoutPolygon,m.layoutBlurred,m.layoutBrush,m.layoutBrush2,m.layoutPoint,m.layoutGem,m.layoutPostit,m.layoutRotatedSquare,m.layoutFlower,m.layoutSphere,m.layoutSticky];var r={};Object.defineProperty(r,"__esModule",{value:!0});r.layoutArDefault={id:"OverviewLayoutArDefault",
category:2,url:l.getResourceUrl("OverviewLayoutArDefault.json")};r.layoutArRight={id:"OverviewLayoutArRight",category:2,url:l.getResourceUrl("OverviewLayoutArRight.json")};r.layoutArZigzag={id:"OverviewLayoutArZigzag",category:2,url:l.getResourceUrl("OverviewLayoutArZigzag.json")};r.layoutArSpeakerCenter={id:"OverviewLayoutArSpeakerCenter",category:2,url:l.getResourceUrl("OverviewLayoutArSpeakerCenter.json")};r.layoutArObjectHalfCut={id:"OverviewLayoutArObjectHalfCut",category:2,url:l.getResourceUrl("OverviewLayoutArObjectHalfCut.json")};
r.layoutArBottomRight={id:"OverviewLayoutArBottomRight",category:2,url:l.getResourceUrl("OverviewLayoutArBottomRight.json")};r.layoutLineToRight={id:"OverviewLayout1",category:1,url:l.getResourceUrl("OverviewLayout1.json")};r.layoutGrid={id:"OverviewLayout2",category:1,url:l.getResourceUrl("OverviewLayout2.json")};r.layoutMarchUp={id:"OverviewLayout4",category:1,url:l.getResourceUrl("OverviewLayout4.json")};r.layoutStraightBottom={id:"OverviewLayout7",category:1,url:l.getResourceUrl("OverviewLayout7.json")};
r.layoutSnakeBottom={id:"OverviewLayout8",category:4,url:l.getResourceUrl("OverviewLayout8.json")};r.layoutIrregularGrid={id:"OverviewLayout9",category:1,url:l.getResourceUrl("OverviewLayout9.json")};r.layoutIkeaFrames={id:"OverviewLayout11",category:4,url:l.getResourceUrl("OverviewLayout11.json")};r.layoutManhattan={id:"OverviewLayout12",category:4,url:l.getResourceUrl("OverviewLayout12.json")};r.layoutSaturn={id:"OverviewLayout13",category:4,url:l.getResourceUrl("OverviewLayout13.json")};r.layoutBeehive=
{id:"OverviewLayout14",category:4,url:l.getResourceUrl("OverviewLayout14.json")};r.layoutClouds={id:"OverviewLayout15",category:4,url:l.getResourceUrl("OverviewLayout15.json")};r.layoutArc={id:"OverviewLayoutArc",category:0,url:l.getResourceUrl("OverviewLayout16.json")};r.layoutLeftCircleCut={id:"OverviewLayoutLeftCircleCut",category:0,url:l.getResourceUrl("OverviewLayoutLeftCircleCut.json")};r.layoutRightCircleCut={id:"OverviewLayoutRightCircleCut",category:0,url:l.getResourceUrl("OverviewLayoutRightCircleCut.json")};
r.layoutFocusIn={id:"OverviewLayoutFocusIn",category:4,url:l.getResourceUrl("OverviewLayoutFocusIn.json")};r.planetLayoutDefinitions=[r.layoutRightCircleCut,r.layoutGrid,r.layoutArc,r.layoutLeftCircleCut,r.layoutLineToRight,r.layoutIrregularGrid,r.layoutMarchUp,r.layoutStraightBottom,r.layoutFocusIn,r.layoutManhattan,r.layoutSaturn,r.layoutBeehive,r.layoutIkeaFrames,r.layoutSnakeBottom,r.layoutClouds,r.layoutArDefault,r.layoutArRight,r.layoutArZigzag,r.layoutArSpeakerCenter,r.layoutArObjectHalfCut,
r.layoutArBottomRight];var pa={};Object.defineProperty(pa,"__esModule",{value:!0});pa.contentLayoutDefinitions="ContentLayout_1by1_v1_01 ContentLayout_1by1_v1_02 ContentLayout_1by1_v1_03 ContentLayout_1by1_v1_03b ContentLayout_1by1_v1_04b ContentLayout_1by1_v1_05 ContentLayout_1by1_v1b_02 ContentLayout_1by1_v1b_03 ContentLayout_1by1_v1b_04b ContentLayout_1by1_v1b_05 ContentLayout_1by1_v2_01 ContentLayout_1by1_v2_02 ContentLayout_1by1_v2_03 ContentLayout_1by1_v2_03b ContentLayout_1by1_v2_04b ContentLayout_1by1_v2_05 ContentLayout_1by1_v2b_02 ContentLayout_1by1_v2b_03 ContentLayout_1by1_v2b_04b ContentLayout_1by1_v2b_05 ContentLayout_1by1_v3_01 ContentLayout_1by1_v3_02 ContentLayout_1by1_v3_03 ContentLayout_1by1_v3_04 ContentLayout_1by1_v3_05 ContentLayout_1by1_v4_01 ContentLayout_1by1_v4_02 ContentLayout_1by1_v4_03 ContentLayout_1by1_v4_04 ContentLayout_1by1_v4_05 ContentLayout_16by9_v1_02 ContentLayout_16by9_v1_02b ContentLayout_16by9_v1_03 ContentLayout_16by9_v1_03b ContentLayout_16by9_v1_04 ContentLayout_16by9_v1_05 ContentLayout_16by9_v1b_01b ContentLayout_16by9_v1b_02 ContentLayout_16by9_v1b_03 ContentLayout_16by9_v1b_04 ContentLayout_16by9_v1b_05 ContentLayout_16by9_v2_02 ContentLayout_16by9_v2_02b ContentLayout_16by9_v2_03 ContentLayout_16by9_v2_03b ContentLayout_16by9_v2_04 ContentLayout_16by9_v2_05 ContentLayout_16by9_v2b_01b ContentLayout_16by9_v2b_02 ContentLayout_16by9_v2b_03 ContentLayout_16by9_v2b_04 ContentLayout_16by9_v2b_05 ContentLayout_16by9_v3_01 ContentLayout_16by9_v3_02 ContentLayout_16by9_v3_03 ContentLayout_16by9_v3_04 ContentLayout_16by9_v3_05 ContentLayout_16by9_v4_02 ContentLayout_16by9_v4_03 ContentLayout_16by9_v4_04".split(" ").map((a)=>
({id:a,category:0,complexity:-1===a.indexOf("v1")?1:0,url:l.getResourceUrl(a+".json")}));var Ha={};Object.defineProperty(Ha,"__esModule",{value:!0});Ha.overviewLayoutDefinitions="RealOverviewLayout01 RealOverviewLayout02 RealOverviewLayout03 RealOverviewLayout04 RealOverviewLayout05 RealOverviewLayout06".split(" ").map((a)=>({id:a,category:0,url:l.getResourceUrl(a+".json")})).concat("RealOverviewLayoutVideo01 RealOverviewLayoutVideo02 RealOverviewLayoutVideo03 RealOverviewLayoutVideo04 RealOverviewLayoutVideo05 RealOverviewLayoutVideo06".split(" ").map((a)=>
({id:a,category:2,url:l.getResourceUrl(a+".json")})));var Ia={};Object.defineProperty(Ia,"__esModule",{value:!0});Ia.LayoutRepositoryImpl=class{constructor(){this.downloadedListeners=[];this.topicShapeLayouts=new Map;this.topicPlanetLayouts=new Map;this.topicContentLayouts=new Map;this.overviewLayouts=new Map;this.logger=q.LoggerModule.getLoggerManager().createLogger("prezi_editor_commander.Layout")}subscribe(a){this.downloadedListeners.push(a)}notifyDownloadedListeners(){this.downloadedListeners.forEach((a)=>
a())}getFocusedToContentLayoutId(){return this.focusedToContentId}loadPlanetLayouts(a){for(let b of r.planetLayoutDefinitions){const c=b.id===r.layoutFocusIn.id,d=a(b.id,c);this.fetchLayout(b,(a)=>this.loadPlanetLayout(b,a,d,c))}}loadCoverLayouts(a){for(let b of m.coverLayoutDefinitions){const c=a(b.id);this.fetchLayout(b,(a)=>this.loadTopicShapeLayout(b,a,c))}}loadContentLayouts(a){for(let b of pa.contentLayoutDefinitions){const c=a(b.id);this.fetchLayout(b,(a)=>this.loadContentLayout(b,a,c))}}loadOverviewLayouts(a){for(let b of Ha.overviewLayoutDefinitions){const c=
a(b.id);this.fetchLayout(b,(a)=>this.loadOverviewLayout(b,a,c))}}fetchLayout(a,b){null!=a.jsonStr?b(a.jsonStr):null!=a.url&&fetch(a.url).then((a)=>a.text(),(b)=>this.logger.info({action:"fetchingLayout",object:a.id,trigger:JSON.stringify(b)})).then((a)=>a?b(a):{}).catch(()=>this.logger.info({action:"fetchingLayout",object:a.id,trigger:""}))}rewriteUrl(a){return null!=a?a.replace("http://0103.static.prezi.com.s3.amazonaws.com/media","https://s3.amazonaws.com/0103.static.prezi.com/media"):null}loadTopicShapeLayout(a,
b,c){b=JSON.parse(b);b={thumbnailUrl:this.rewriteUrl(b.thumbnailUrl),complexity:a.complexity,variants:b.variants.map((a)=>({defaultContentAreaType:a.defaultContentAreaType,contentArea1by1:A.relBoxFromJSON(a.contentArea1by1),contentArea16by9:A.relBoxFromJSON(a.contentArea16by9),objects:a.objects.map((a)=>Object.assign(Object.assign({},a),{layoutBox:A.relBoxFromJSON(a.layoutBox)}))}))};a.id===m.layoutSquare.id&&(this.defaultTopicShapeLayoutId=c);this.topicShapeLayouts.set(a.id,{data:b,info:{id:a.id,
thumbnail:b.thumbnailUrl,category:a.category}});this.notifyDownloadedListeners()}loadContentLayout(a,b,c){b=JSON.parse(b);b={thumbnailUrl:this.rewriteUrl(b.thumbnailUrl),type:b.type,complexity:a.complexity,contentArea:A.relBoxFromJSON(b.contentArea),title:b.title?Object.assign(Object.assign({},b.title),{area:A.relBoxFromJSON(b.title.area),kind:A.ContentLayoutElementKind.titleText}):null,texts:b.texts.map((a)=>Object.assign(Object.assign({},a),{area:A.relBoxFromJSON(a.area),kind:A.ContentLayoutElementKind.bodyText})),
images:b.images.map((a)=>Object.assign(Object.assign({},a),{area:A.relBoxFromJSON(a.area),kind:A.ContentLayoutElementKind.image}))};a.id===pa.contentLayoutDefinitions[0].id&&(this.defaultTopicContentLayoutId=c);this.topicContentLayouts.set(c,{data:b,info:{id:c,thumbnail:b.thumbnailUrl,category:a.category}});this.notifyDownloadedListeners()}loadPlanetLayout(a,b,c,d){b=JSON.parse(b);b={thumbnailUrl:this.rewriteUrl(b.thumbnailUrl),variants:b.variants.map((a)=>({anchorLayoutBox:A.relBoxFromJSON(a.anchorLayoutBox),
subtopicLayoutBoxes:a.subtopicLayoutBoxes.map((a)=>A.relBoxFromJSON(a))}))};d&&(this.focusedToContentId=c);a.id===r.layoutArc.id&&(this.defaultPlanetLayoutId=c);this.topicPlanetLayouts.set(c,{data:b,info:{id:c,thumbnail:b.thumbnailUrl,category:a.category}});this.notifyDownloadedListeners()}loadOverviewLayout(a,b,c){b=JSON.parse(b);b={thumbnailUrl:this.rewriteUrl(b.thumbnailUrl),variants:b.variants.map((a)=>({anchorLayoutBox:A.relBoxFromJSON(a.anchorLayoutBox),subtopicLayoutBoxes:a.subtopicLayoutBoxes.map((a)=>
A.relBoxFromJSON(a)),titles:a.titles.map((a)=>Object.assign(Object.assign({},a),{area:A.relBoxFromJSON(a.area)}))}))};this.overviewLayouts.set(c,{data:b,info:{id:c,thumbnail:b.thumbnailUrl,category:a.category}});this.notifyDownloadedListeners()}hasPlanetLayout(a){return this.topicPlanetLayouts.has(a)}hasTopicShapeLayout(a){return this.topicShapeLayouts.has(a)}hasTopicContentLayout(a){return this.topicContentLayouts.has(a)}hasOverviewLayout(a){return this.overviewLayouts.has(a)}getTopicShapeLayout(a){return Object.assign({id:a},
this.topicShapeLayouts.get(a).data)}getPlanetLayout(a){return Object.assign({id:a},this.topicPlanetLayouts.get(a).data)}getTopicContentLayout(a){return Object.assign({id:a},this.topicContentLayouts.get(a).data)}getOverviewLayout(a){return Object.assign({id:a},this.overviewLayouts.get(a).data)}setTopicShapeLayoutFromXml(a,b){b=JSON.stringify(A.convertTopicShapeXmlToJson(b,a));this.loadTopicShapeLayout({id:a,category:1,jsonStr:b},b,a)}setPlanetLayoutFromXml(a,b){b=JSON.stringify(A.convertTopicOverviewXmlToJson(b));
this.loadPlanetLayout({id:a,category:1,jsonStr:b},b,a,!1)}getTopicShapeLayoutInfos(){return[...this.topicShapeLayouts.values()].map((a)=>a.info)}getTopicContentLayoutInfos(){return[...this.topicContentLayouts.values()].map((a)=>a.info)}getPlanetLayoutInfos(){return[...this.topicPlanetLayouts.values()].map((a)=>a.info)}getOverviewLayoutInfos(){return[...this.overviewLayouts.values()].map((a)=>a.info)}getDefaultTopicShapeLayoutInfo(){var a;return null===(a=this.topicShapeLayouts.get(this.defaultTopicShapeLayoutId))||
void 0===a?void 0:a.info}getDefaultPlanetLayoutInfo(){var a;return null===(a=this.topicPlanetLayouts.get(this.defaultPlanetLayoutId))||void 0===a?void 0:a.info}getDefaultTopicContentLayoutInfo(){var a;return null===(a=this.topicContentLayouts.get(this.defaultTopicContentLayoutId))||void 0===a?void 0:a.info}getDefaultOverviewLayoutInfo(){var a;return null===(a=this.overviewLayouts.get(this.defaultOverviewLayoutId))||void 0===a?void 0:a.info}};var Ja={};Object.defineProperty(Ja,"__esModule",{value:!0});
Ja.LayoutHelper=class{applyOnTopicZoomArea(a,b,c,d){b=b.withReferenceFrame(a.parent.referenceFrame);c=c.withReferenceFrame(a.parent.referenceFrame);c=a.zoomLayoutBox.withReferenceFrame(a.parent.referenceFrame).align(b.topLeft,b.topRight,c.topLeft,c.topRight);return d(a,c)}unionLayoutBoxAABB(a){return a.map((a)=>a.layoutBox.aabb).reduce((a,c)=>a.union(c))}fitZoomArea(a,b,c){c.fitZoomArea(a,b);return!0}intersectLayoutBoxes(a,b){var c=a.aabb;const d=b.withReferenceFrame(a.referenceFrame).aabb;var e=
a.referenceFrame;b=e.point({x:Math.max(c.topLeft.x,d.topLeft.x),y:Math.max(c.topLeft.y,d.topLeft.y)});c=e.point({x:Math.min(c.bottomRight.x,d.bottomRight.x),y:Math.min(c.bottomRight.y,d.bottomRight.y)});e=e.point({x:(b.x+c.x)/2,y:(b.y+c.y)/2});return a.referenceFrame.layoutBox(e,{width:c.x-b.x,height:c.y-b.y})}areLayoutBoxesClose(a,b,c){return this.closeTo(a.center.x,b.center.x,c)&&this.closeTo(a.center.y,b.center.y,c)&&(this.closeTo(a.size.height,b.size.height,c)||this.closeTo(a.size.width,b.size.width,
c))}closeTo(a,b,c){return Math.abs(a-b)<c}forEachSubtopicWithSrcLayoutBoxes(a,b,c,d){if(c.length>b.subtopicLayoutBoxes.length)throw Error("Wrong layout snippet is used. Number of subtopics mismatch");const e=a.zoomLayoutBox.referenceFrame,g=b.anchorLayoutBox.withReferenceFrame(e);a=a.simpleChildren(f.base.ChildVisibilityKind.inside);a=(0<a.length?this.unionLayoutBoxAABB(a):g).extendToSquare();let k=!0;for(let h=0;h<c.length;++h){const oa=c[h];var v=oa.simpleChildren(f.base.ChildVisibilityKind.outside),
B=b.subtopicLayoutBoxes[h].withReferenceFrame(e).extendToSquare().align(g.topLeft,g.topRight,a.topLeft,a.topRight);0<v.length?(v=this.unionLayoutBoxAABB(v).extendToSquare(),B=oa.layoutBox.align(v.topLeft,v.topRight,B.topLeft,B.topRight),k=k&&d(oa,B)):k=k&&d(oa,B)}return k}applyFunctionOnTopicZoomAreaWithVariant(a,b,c){b=b.anchorLayoutBox.withReferenceFrame(a.zoomLayoutBox.referenceFrame);var d=a.simpleChildren(f.base.ChildVisibilityKind.inside);d=(0<d.length?this.unionLayoutBoxAABB(d):b).extendToSquare();
return this.applyOnTopicZoomArea(a,b,d,c)}};var Ka={};Object.defineProperty(Ka,"__esModule",{value:!0});var S=f.base.ObjectKind;Ka.VariantAndAreaHelper=class{constructor(a){this.helper=a}getContentArea(a,b){var c=a.coverLayoutId;return b.hasTopicShapeLayout(c)&&(b=b.getTopicShapeLayout(c),c=this.getVariantIndex(a,b),-1<c)?this.getAABBContentAreaFromVariant(b.variants[c],a).extendToSquare():this.getAABBAnchorBoxOfTopic(a).scale(.6979)}getAABBContentAreaFromVariant(a,b){const c=A.defaultContentArea(a),
d=b.zoomLayoutBox.asReferenceFrame;a=this.getAABBAnchorBoxFromTopicShapeDescriptors(a,d).aabb;b=this.getAABBAnchorBoxOfTopic(b);return c.withReferenceFrame(d).aabb.align(a.topLeft,a.topRight,b.topLeft,b.topRight)}getAABBAnchorBoxFromTopicShapeDescriptors(a,b){return a.objects.map((a)=>a.layoutBox).map((a)=>a.withReferenceFrame(b)).reduce((a,b)=>a.union(b.aabb)).extendToSquare()}getAABBAnchorBoxOfTopicMaybe(a){const b=h.EditorCommander.createLayoutQuery();a=[...a.visual.contentChildren,...a.is(S.planetTopic)?
a.surface.contentChildren:[]].filter((a)=>b.isTopicShapeObject(a));return 0<a.length?this.helper.unionLayoutBoxAABB(a):null}getAABBAnchorBoxOfTopic(a){const b=this.getAABBAnchorBoxOfTopicMaybe(a);return(null!==b&&void 0!==b?b:a.layoutBox).extendToSquare()}getVariantIndex(a,b){const c=h.EditorCommander.createLayoutQuery(),d=[...a.visual.contentChildren,...a.is(S.planetTopic)?a.surface.contentChildren:[]].filter((a)=>c.isTopicShapeObject(a)).map((a)=>a.is(S.pdf)?a.pdfAsset.url:a.is(S.image)?a.imageAsset.url:
a.is(S.shape)?"zShape":null).filter((a)=>null!=a);return b.variants.findIndex((a)=>a.objects.some((a)=>a.objectKind===S.pdf?-1<d.indexOf(a.pdfAsset.url):a.objectKind===S.image?-1<d.indexOf(a.imageAsset.url):a.objectKind===S.shape?-1<d.indexOf("zShape"):!1))}};var qa={};Object.defineProperty(qa,"__esModule",{value:!0});qa.TextLayouter=class{constructor(a,b,c,d,e,g,k){this.fitSelectionBoxInto=a;this.getSelectionBox=b;this.setWrapWidth=c;this.wrap=d;this.fitInto=e;this.setBackground=g;this.removeBackground=
k}styleText(a,b){switch(b.kind){case "background":this.setBackground(a,b.cornerRadius);break;case "noBackground":this.removeBackground(a);break;default:throw u.Utils.assertNever(b);}}positionTextElement(a,b,c,d){var e=c.layoutBox;const g=()=>{this.setWrapWidth(c,d.size.width);this.setWrapWidth(c,c.wrapWidth-(c.textBox.size.width-c.wrapWidth))};g();c.layoutBox.size.height>d.size.height&&(this.wrap(c,d.size.width/d.size.height,!0),this.fitSelectionBoxInto(c,c.layoutBox.withSize(d.size)),g());e=c.layoutBox.move(c.layoutBox.center,
e.center);this.fitInto(c,e);this.alignToAnchor(a,b,c,d)}alignToAnchor(a,b,c,d){var e=c.layoutBox;const g=e.withRotationRad(b);d=d.point(a);e=this.getSelectionBox(c).align(e.topLeft,e.topRight,g.topLeft,g.topRight).point(a);a=d.x-e.x;d=d.y-e.y;this.fitInto(c,c.layoutBox.withRotationRad(b).translate({x:a,y:d}))}};var La={};Object.defineProperty(La,"__esModule",{value:!0});La.ContentLayoutCommander=class{constructor(a,b,c){this.layoutRepository=a;this.variantAndAreaHelper=b;this.layoutHelper=c;this.imageMaskingCommander=
h.EditorCommander.createImageMaskingCommander()}isContentLayoutValid(a,b){var c=[...a.contentChildren];a.is(f.base.ObjectKind.planetTopic)&&(c=c.concat(a.master.contentChildren));let d=this.calculateContentArea(a).referenceArea;c=this.categorizeContentChildren(c);const e=[...b.title?[b.title]:[],...b.texts,...b.images],g=this.findMatchingContent(c,e),k=b.contentArea.withReferenceFrame(a.zoomLayoutBox.asReferenceFrame);b=Array.from(g.matches.keys()).every((b)=>{var c=g.matches.get(b);c=this.calculateTargetLayoutBox(c,
a,k,d);return this.layoutHelper.areLayoutBoxesClose(c.union(b.layoutBox),c,1E-5)});for(let a in g.unmatchedTemplate.values())if(0<a.length)return!1;return b}createTextLayouter(a){return new qa.TextLayouter((b,c)=>{a.toDecorator(a.lookup.text(b.id)).fitSelectionBoxInto(c)},(b)=>a.toDecorator(a.lookup.text(b.id)).selectionBox,(b,c)=>{a.lookup.text(b.id).wrapWidth=c},(b,c,d)=>{a.lookup.text(b.id).wrap(c,d)},(b,c)=>{a.animate(a.lookup.text(b.id)).fitInto(c)},(b,c)=>{b=a.lookup.text(b.id);const d=b.layoutBox;
b.toggleBackground(!0);b.backgroundCornerRadius=Math.min(d.size.height/2,d.size.width/2,c)},(b)=>{a.lookup.text(b.id).toggleBackground(!1)})}changeContentLayout(a,b,c){var d=[...b.contentChildren];b.is(f.base.ObjectKind.planetTopic)&&(d=d.concat(b.master.contentChildren));const e=this.calculateContentArea(b).referenceArea;d=this.categorizeContentChildren(d);const g=[...c.title?[c.title]:[],...c.texts,...c.images];d=this.findMatchingContent(d,g);const k=c.contentArea.withReferenceFrame(b.zoomLayoutBox.asReferenceFrame),
v=[];d.matches.forEach((c,d)=>{this.styleElement(a,c,d);const g=this.calculateTargetLayoutBox(c,b,k,e);this.positionElement(c,d,g,a);v.push([c,d])});d.unmatchedTemplate.forEach((c)=>{const d=this.insertPlaceholderElement(c,b,k,e,a);v.push([c,d])});1<v.length&&v.sort((a,b)=>a[0].zIndex>b[0].zIndex?1:-1).map(([,a])=>a).reduce((a,b)=>{b.moveAbove(a);return b});d.unmatchedOriginal.forEach((a)=>{a.forEach((a)=>{(a.is(f.base.ObjectKind.text)||a.is(f.base.ObjectKind.image))&&a.isPlaceholder&&a.delete()})});
return v.map(([,a])=>a)}calculateContentArea(a){var b,c;let d;if(a.is(f.base.ObjectKind.planetTopic)){var e=a.coverLayoutId;if(this.layoutRepository.hasTopicShapeLayout(e)){e=this.layoutRepository.getTopicShapeLayout(e);const b=this.variantAndAreaHelper.getVariantIndex(a,e);-1!==b&&(d=this.variantAndAreaHelper.getAABBContentAreaFromVariant(e.variants[b],a))}}null==d&&(a.is(f.base.ObjectKind.planetTopic)?d=null===(b=this.variantAndAreaHelper.getAABBAnchorBoxOfTopicMaybe(a))||void 0===b?void 0:b.scale(.7):
a.is(f.base.ObjectKind.page)&&(d=null===(c=this.variantAndAreaHelper.getAABBAnchorBoxOfTopicMaybe(a.parent))||void 0===c?void 0:c.scale(.8)));null==d&&(d=a.zoomLayoutBox.scale(.7));d=d.withReferenceFrame(a.zoomLayoutBox.asReferenceFrame);b=a.zoomLayoutBox.scale(.98);c=a.zoomLayoutBox.scale(.97);e=d;d=d.intersects(c)?a.is(f.base.ObjectKind.planetTopic)?this.layoutHelper.intersectLayoutBoxes(d,b):this.layoutHelper.intersectLayoutBoxes(d,a.zoomLayoutBox.scale(.8)):a.zoomLayoutBox.scale(.7);return{referenceArea:d,
scaledDown:.99>d.size.height*d.size.width/(e.size.height*e.size.width)}}calculateTargetLayoutBox(a,b,c,d){d=c.fitIntoOther(d);return a.area.withReferenceFrame(b.zoomLayoutBox.asReferenceFrame).align(c.topCenter,c.bottomCenter,d.topCenter,d.bottomCenter)}insertPlaceholderElement(a,b,c,d,e){let g;c=this.calculateTargetLayoutBox(a,b,c,d);switch(a.kind){case A.ContentLayoutElementKind.image:g=b.add.image({kind:f.base.AssetKind.image,assetSourceFilename:"gray-square.png",offlineAssetId:"0.6b4f4b8552624",
onlineAssetId:"316251209",url:"http://0103.static.prezi.com.s3.amazonaws.com/media/3/6/2/5/c/ceb034e464485a7cbdeb7889e0f.png",width:711,height:711});g.isPlaceholder=!0;this.styleElement(e,a,g);g.fitInto(c);break;case A.ContentLayoutElementKind.titleText:g=this.createPlaceholderText(b,"subtitle",e,mb.I18n.ts("Click to edit title"),a,c);break;case A.ContentLayoutElementKind.bodyText:g=this.createPlaceholderText(b,"body",e,mb.I18n.ts("Click to edit text"),a,c);break;default:u.Utils.assertNever(a)}e.animate(g).dropIn();
return g}createPlaceholderText(a,b,c,d,e,g){a=a.add.text(b);a.setText(d);a.textStyle=e.style;this.styleElement(c,e,a);a.scale(e.fontSize/a.getFontSizes()[0]);a.isPlaceholder=!0;this.positionElement(e,a,g,c);return a}styleElement(a,b,c){!c.is(f.base.ObjectKind.text)||b.kind!==A.ContentLayoutElementKind.titleText&&b.kind!==A.ContentLayoutElementKind.bodyText?c.is(f.base.ObjectKind.image)&&(null==c.mask?(a=b.area.withReferenceFrame(c.layoutBox.asReferenceFrame).fitIntoOther(c.layoutBox),a=this.imageMaskingCommander.imageMaskForLayoutBox(a,
c.imageAsset),c.mask=a):.01<Math.abs(c.mask.height/c.mask.width-b.area.size.height/b.area.size.width)&&this.adjustMask(b,c)):this.createTextLayouter(a).styleText(c,b.hasBackground?{kind:"background",cornerRadius:b.backgroundCornerRadius}:{kind:"noBackground"})}adjustMask(a,b){var c=a.area.size.height/a.area.size.width;const d=b.mask;a=b.imageAsset;const e=d.height/d.width;let g=Object.assign({},{x:d.x+d.width/2,y:d.y+d.height/2});if(c<e){var k=d.height*c/e;g=Object.assign(Object.assign({},g),{height:k,
width:d.width});c=Math.min(a.width/d.width,Math.sqrt(e/c))}else k=d.width*e/c,g=Object.assign(Object.assign({},g),{height:d.height,width:k}),c=Math.min(a.height/d.height,Math.sqrt(c/e));g=Object.assign(Object.assign({},g),{height:Math.min(c*g.height,a.height-.01),width:Math.min(c*g.width,a.width-.01)});g=Object.assign(Object.assign({},g),{x:Math.max(Math.min(g.x,a.width-g.width/2-.01),g.width/2+.01),y:Math.max(Math.min(g.y,a.height-g.height/2-.01),g.height/2+.01)});b.mask={width:g.width,height:g.height,
x:g.x-g.width/2,y:g.y-g.height/2}}positionElement(a,b,c,d){!b.is(f.base.ObjectKind.text)||a.kind!==A.ContentLayoutElementKind.titleText&&a.kind!==A.ContentLayoutElementKind.bodyText?d.animate(b).fitInto(c):this.createTextLayouter(d).positionTextElement(a.anchor,a.area.rotation,b,c)}categorizeContentChildren(a){const b=new Map(Object.keys(A.ContentLayoutElementKind).map((a)=>[a,[]])),c=a.filter((a)=>a.is(f.base.ObjectKind.text)).map((a)=>a),d=["title","subtitle","subtitle_2"];c.sort(u.Utils.compareBoolean().inverted().on((a)=>
-1!==d.indexOf(a.textStyle)).then(u.Utils.compareNumberWithTolerance(1E-5).inverted().on((a)=>a.getFontSizes().reduceRight((a,b)=>Math.max(a,b),0))).then(u.Utils.compareNumber().on((a)=>a.length)).then(u.Utils.compareNumber().on((a)=>a.layoutBox.center.y)).compare);0<c.length&&(b.get(A.ContentLayoutElementKind.titleText).push(c[0]),c.slice(1).map((a)=>a).sort(u.Utils.compareBoolean().on((a)=>a.isPlaceholder).compare).forEach((a)=>b.get(A.ContentLayoutElementKind.bodyText).push(a)));a.filter((a)=>
a.is(f.base.ObjectKind.image)).map((a)=>a).sort(u.Utils.compareBoolean().on((a)=>a.isPlaceholder).compare).forEach((a)=>b.get(A.ContentLayoutElementKind.image).push(a));return b}findMatchingContent(a,b){const c=new Map(a),d=new Map;let e=[...b];b.forEach((a)=>{const b=c.get(a.kind);if(b&&0<b.length){const g=b.shift();d.set(g,a);e=e.filter((b)=>b!==a);c.set(a.kind,c.get(a.kind).filter((a)=>a!==g))}});return{unmatchedOriginal:c,matches:d,unmatchedTemplate:e}}};var Ma={};Object.defineProperty(Ma,"__esModule",
{value:!0});Ma.PlanetLayoutCommander=class{constructor(a,b,c){this.layoutRepository=a;this.positionFinder=b;this.helper=c}handlePlanetLayoutEvent(a,b,c){switch(c.kind){case f.base.TopicLayoutEventKind.reset:this.applyLayout(a,b,c.parent,c.parent.topicChildren);break;case f.base.TopicLayoutEventKind.adjust:this.areSubtopicsInLayoutPosition(c.parent,c.topics.map((a)=>a.id))&&this.applyLayout(a,b,c.parent,c.parent.topicChildren);break;case f.base.TopicLayoutEventKind.remove:if(this.areSubtopicsInLayoutPosition(c.parent,
[])){const d=c.parent.topicChildren.filter((a)=>0>c.toBeRemoved.indexOf(a));this.applyLayout(a,b,c.parent,d)}break;default:throw u.Utils.assertNever(c);}}areSubtopicsInLayoutPosition(a,b){var c=a.layout.id;if(this.layoutRepository.hasPlanetLayout(c)){c=this.layoutRepository.getPlanetLayout(c);var d=a.topicChildren.filter((a)=>0>b.indexOf(a.id));const e=Math.min(d.length,c.variants.length-1);if(d.length>e)return!1;c=c.variants.find((a)=>a.subtopicLayoutBoxes.length===e);d=d.slice(0,e);const g=(a,b)=>
this.helper.areLayoutBoxesClose(a.layoutBox,b,1E-5);return this.helper.applyFunctionOnTopicZoomAreaWithVariant(a,c,(a,b)=>{a=a.zoomLayoutBox.withReferenceFrame(a.parent.referenceFrame);return this.helper.areLayoutBoxesClose(a,b,1E-5)})&&this.helper.forEachSubtopicWithSrcLayoutBoxes(a,c,d,g)}return!1}getMostCommonSubtopicLayoutId(a,b){const c=h.EditorCommander.createLayoutQuery(),d=this.layoutRepository.getPlanetLayoutInfos().map((a)=>a.id);a=c.getMostCommonLayout(a,b,(a)=>a.layout.id,(a)=>a.is(f.base.ObjectKind.planetTopic)&&
-1!==d.indexOf(a.layout.id));null==a&&(a=this.layoutRepository.getDefaultPlanetLayoutInfo().id);return a}applyLayout(a,b,c,d){const e=Math.min(d.length,a.variants.length-1);a=a.variants.find((a)=>a.subtopicLayoutBoxes.length===e);const g=d.slice(0,e);d=d.slice(e);this.applyVariant(c,g,a,b);for(let a of d)b.fitInto(a,this.positionFinder.findTopicPosition(a,g)),g.push(a)}applyVariant(a,b,c,d){this.helper.applyFunctionOnTopicZoomAreaWithVariant(a,c,(a,b)=>this.helper.fitZoomArea(a,b,d));this.helper.forEachSubtopicWithSrcLayoutBoxes(a,
c,b,(a,b)=>{d.fitInto(a,b);return!0})}};var Na={};Object.defineProperty(Na,"__esModule",{value:!0});Na.TopicColorManager=class{updateColorOnTopic(a,b,c,d){const e=h.EditorCommander.createLayoutQuery(),g=h.EditorCommander.createColorGroup(a,[]);a=g.helper.getColorableVisualObjects(b).filter((a)=>e.isTopicShapeObject(a));g.addObjects(a);if(0<d.length){const c=g.helper.getColorFromStyleDeclaration(d[0].styleClass);var k=g.helper.getColorsForStyle(f.base.ArcStyle),v=g.helper.getColorsForStyle(f.base.ShapeStyle),
B=g.helper.getColorsForStyle(f.base.ShapelikeFilterStyle);a=g.helper.getColorsForStyle(f.base.FullBlendShapelikeFilterStyle);b=null;b=k.find((a)=>g.helper.colorEquals(a.color,c));null!=b?b=b.styes.arcStyle:(b=d.find((a)=>a.styleEnum===f.base.ArcStyle),b=null!=b?b.styleClass:null);k=null;k=v.find((a)=>g.helper.colorEquals(a.color,c));null!=k?k=k.styes.shapeStyle:(k=d.find((a)=>a.styleEnum===f.base.ShapeStyle),k=null!=k?k.styleClass:null);v=null;B=B.find((a)=>g.helper.colorEquals(a.color,c));null!=
B?v=B.styes.filterStyle:(B=d.find((a)=>a.styleEnum===f.base.ShapelikeFilterStyle),v=null!=B?B.styleClass:null);B=null;a=a.find((a)=>g.helper.colorEquals(a.color,c));null!=a?B=a.styes.fullBlendFilterStyle:(d=d.find((a)=>a.styleEnum===f.base.FullBlendShapelikeFilterStyle),B=null!=d?d.styleClass:null);g.setPresets({arcStyle:b,shapeStyle:k,filterStyle:v,fullBlendFilterStyle:B})}g.applyColor(c[0],!1)}};var Oa={};Object.defineProperty(Oa,"__esModule",{value:!0});var D=f.base.ObjectKind;Oa.CoverLayoutApplicator=
class{constructor(a,b,c){this.layoutRepository=a;this.variantAndAreaHelper=b;this.helper=c;this.topicColorManager=new Na.TopicColorManager}applyCoverLayout(a,b,c){const d=h.EditorCommander.createLayoutQuery();var e=h.EditorCommander.createColorGroup(c,[]);e.addObjects(e.helper.getColorableVisualObjects(a).filter((a)=>d.isTopicShapeObject(a)));const g=e.getMainColors().filter((a)=>null!=a);e=e.getPresets().filter((a)=>null!=a&&null!=a.styleEnum&&null!=a.styleClass);const k=a.layoutBox.extendToSquare(),
v=this.variantAndAreaHelper.getContentArea(a,this.layoutRepository),B=this.variantAndAreaHelper.getAABBContentAreaFromVariant(b,a).extendToSquare(),m=this.variantAndAreaHelper.getAABBAnchorBoxOfTopic(a);var l=a.visual.contentChildren.filter((a)=>d.isTopicShapeObject(a));const n=a.is(D.planetTopic)?a.surface.contentChildren.filter((a)=>d.isTopicShapeObject(a)):[],{firstAboveShape:p,firstBelowShape:r}=this.getEditorsAboveAndBelowTopicShapes(a),q=this.findMatchingObject([...l,...n],b.objects),u=a.zoomLayoutBox.asReferenceFrame,
t=[],w=this.variantAndAreaHelper.getAABBAnchorBoxFromTopicShapeDescriptors(b,a.zoomLayoutBox.asReferenceFrame);q.matches.forEach((a,b)=>{this.updateShapeObject(b,a);this.positionObject(b,a.layoutBox.withReferenceFrame(u),w,m)});const x=a.is(D.planetTopic)&&n.length>l.length?a.surface:a.visual,y=q.descToEditor;q.toCreate.forEach((a)=>{const b=this.createShapeObject(x,a);this.updateShapeObject(b,a);this.positionObject(b,a.layoutBox.withReferenceFrame(u),w,m);y.set(a,b);t.push(b)});0<t.length&&(l=c.lookup.findAll(f.base.ObjectKind.arc),
b=l.filter((a)=>null!=a.connectorEnd&&a.connectorEnd.is(f.base.ObjectKind.simpleObject)&&q.toDelete.has(a.connectorEnd)),l=l.filter((a)=>null!=a.connectorStart&&a.connectorStart.is(f.base.ObjectKind.simpleObject)&&q.toDelete.has(a.connectorStart)),b.forEach((a)=>a.connectorEnd=t[0]),l.forEach((a)=>a.connectorStart=t[0]));this.ensureZOrder(t,p,r);this.positionNonTopicShapeObjects(a,v,B);a.is(D.planetTopic)&&(this.helper.applyOnTopicZoomArea(a,v,B,(a,b)=>this.helper.fitZoomArea(a,b,this.createFitter(c))),
a.topicChildren.forEach((a)=>{a.fitInto(a.layoutBox.align(v.topLeft,v.topRight,B.topLeft,B.topRight))}));0<g.length&&this.topicColorManager.updateColorOnTopic(c,a,g,e);a.fitInto(k);return Array.from(q.toDelete).filter((a)=>!a.is(D.slide))}getEditorsAboveAndBelowTopicShapes(a){const b=h.EditorCommander.createLayoutQuery();var c=[...a.simpleChildren(f.base.ChildVisibilityKind.all)];a.is(f.base.ObjectKind.stackTopic)&&(c=c.concat(u.Utils.flatten(a.pageChildren.map((a)=>a.simpleChildren(f.base.ChildVisibilityKind.all)))));
a=c.sort((a,b)=>a.isAbove(b)?-1:1);c=a.findIndex((a)=>!b.isTopicShapeObject(a));const d=a.findIndex((a)=>b.isTopicShapeObject(a)),e=a.slice(d).findIndex((a)=>!b.isTopicShapeObject(a))+d;return{firstAboveShape:c<d?a[d-1]:null,firstBelowShape:e<a.length?a[e]:null}}positionNonTopicShapeObjects(a,b,c){const d=h.EditorCommander.createLayoutQuery();a.is(D.planetTopic)&&a.simpleChildren(f.base.ChildVisibilityKind.all).filter((a)=>!d.isTopicShapeObject(a)).forEach((a)=>{const d=a.layoutBox.align(b.topLeft,
b.topRight,c.topLeft,c.topRight);a.fitInto(d)})}positionObject(a,b,c,d){b=b.align(c.topLeft,c.topRight,d.topLeft,d.topRight);a.is(D.text)&&a.wrap(b.size.width/b.size.height,!1);a.fitInto(b)}createShapeObject(a,b){let c;switch(b.objectKind){case D.pdf:c=a.add.pdf(b.pdfAsset);break;case D.image:c=a.add.image(b.imageAsset);break;case D.shape:c=a.add.shape(b.shapeKind,b.shapeStyle);c.height=b.layoutBox.size.height;c.width=b.layoutBox.size.width;break;case D.text:c=a.add.text(),c.setText(b.text),c.isPlaceholder=
b.isPlaceholder}this.isVisual(c)?c.visualLayoutRole=f.base.VisualLayoutRole.topicShape:this.isSurface(c)&&(c.surfaceLayoutRole=f.base.SurfaceLayoutRole.surfaceTopicShape);return c}updateShapeObject(a,b){switch(b.objectKind){case D.pdf:a.pdfAsset=b.pdfAsset;a.filterStyle!==b.filterStyle&&(a.filterStyle=b.filterStyle);a.applyPresetStyle();null!=b.colorFilter&&(a.colorFilter=b.colorFilter);break;case D.image:a.imageAsset=b.imageAsset;a.filterStyle!==b.filterStyle&&(a.filterStyle=b.filterStyle);a.applyPresetStyle();
null!=b.colorFilter&&(a.colorFilter=b.colorFilter);break;case D.shape:a.shapeStyle!==b.shapeStyle&&(a.shapeStyle=b.shapeStyle);a.applyPresetStyle();null!=b.border&&(a.border=b.border);null!=b.colorFilter&&(a.colorFilter=b.colorFilter);null!=b.fill&&(a.fill=b.fill);break;case D.text:this.updateTextObject(a,b)}this.isVisual(a)?a.visualLayoutRole=f.base.VisualLayoutRole.topicShape:this.isSurface(a)&&(a.surfaceLayoutRole=f.base.SurfaceLayoutRole.surfaceTopicShape)}updateTextObject(a,b){a.applyPresetStyle();
a.setAllCharacterProps(b.characterProps);a.setAllParagraphProps(b.paragraphProps);null!=a.background&&(a.background=b.background)}findMatchingObject(a,b){const c=new Set(a),d=new Map,e=[],g=new Map;b.forEach((a)=>{let b=!1;const k=this.findMatchable(c,a);null!=k&&(d.set(k,a),g.set(a,k),c.delete(k),b=!0);b||e.push(a)});return{toDelete:c,matches:d,toCreate:e,descToEditor:g}}findMatchable(a,b){for(const c of a.values())if(this.isMatchable(c,b))return c;return null}isMatchable(a,b){return b.objectKind===
D.shape?a.is(D.shape)&&a.shapeKind===b.shapeKind:a.is(b.objectKind)}ensureZOrder(a,b,c){if(null!=b){let c=b;a.forEach((a)=>{a.moveBehind(c);c=a})}else null!=c&&a.forEach((a)=>a.moveAbove(c))}isVisual(a){return a.parent.is(D.visual)}isSurface(a){return a.parent.is(D.surface)}createFitter(){return new class{fitInto(a,b){a.fitInto(b)}fitZoomArea(a,b){a.fitZoomAreaIntoLayoutBox(b)}}}};var Pa={};Object.defineProperty(Pa,"__esModule",{value:!0});var Gb=f.base.editorIs;Pa.CoverLayoutCommander=class{constructor(a,
b,c,d){this.layoutRepository=a;this.colorMixCommander=b;this.variantAndAreaHelper=c;this.helper=d;this.coverLayoutApplicator=new Oa.CoverLayoutApplicator(a,this.variantAndAreaHelper,this.helper)}changeTopicCoverOnAllTopicsCmd(a){return{name:"changeTopicCoverOnAllTopics",run:(b)=>{if(null==b.styleSheet.colorPaletteId&&ka.isActive("js-disable-filterstyle-conversion")){const a=this.colorMixCommander.createMapping(this.colorMixCommander.paletteFromPrezi(b.styleSheet));this.colorMixCommander.applyShapeStyles(a).run(b)}this.changeTopicCover(b.overview.id,
a,"all",b);for(let c of b.lookup.findAll(f.base.ObjectKind.planetTopic))this.changeTopicCover(c.id,a,"all",b)}}}changeTopicCover(a,b,c,d){var e=this.ensurePlanetOrOverview(a,d);a=[e,...e.topicChildren].filter(Gb(f.base.ObjectKind.topicParent)).filter((a)=>a.layout.isValid());e=e.topicChildren.map((a,b)=>({editor:a,idx:b,layoutBox:a.layoutBox}));e="all"===c?e:e.filter((a)=>0<=c.indexOf(a.editor.id));const g=h.EditorCommander.createLayoutQuery();e=e.filter((a)=>g.hasTopicShapeObject(a.editor));let k=
[];for(let a=0;a<e.length;++a){const c=e[a].editor;g.hasTopicShapeObject(c)&&(k=[...k,...this.coverLayoutApplicator.applyCoverLayout(c,b.variants[e[a].idx%b.variants.length],d)],c.coverLayoutId=b.id)}this.removeEditors(k);a.forEach((a)=>a.layout.reset())}getCoverLayoutId(a,b,c){a=b.lookup.base(a);return(a.is(f.base.ObjectKind.planetTopic)||a.is(f.base.ObjectKind.overview))&&0<a.topicChildren.length?a.topicChildren[0].coverLayoutId:a.is(f.base.ObjectKind.planetTopic)?a.coverLayoutId:c?(c=this.layoutRepository.getDefaultTopicShapeLayoutInfo(),
null!=c?c.id:null):null}removeEditors(a){0<a.length&&a[0].createLayoutGroupWith(a.slice(1)).delete()}ensurePlanetOrOverview(a,b){b=b.lookup.base(a);if(!b.is(f.base.ObjectKind.overview)&&!b.is(f.base.ObjectKind.planetTopic))throw Error("Not a planet or overview editor: "+a);return b}};var Qa={};Object.defineProperty(Qa,"__esModule",{value:!0});Qa.OverviewLayoutCommander=class{constructor(a,b,c){this.layoutRepository=a;this.positionFinder=b;this.helper=c}overviewLayoutIsValid(a,b){return a!==b.layout.id?
!1:this.areElementsInLayoutPosition(b,[])}handleOverviewLayoutEvent(a,b,c){switch(c.kind){case f.base.TopicLayoutEventKind.reset:this.applyLayout(a,b,c.parent,c.parent.topicChildren);break;case f.base.TopicLayoutEventKind.adjust:this.areElementsInLayoutPosition(c.parent,c.topics.map((a)=>a.id))&&this.applyLayout(a,b,c.parent,c.parent.topicChildren);break;case f.base.TopicLayoutEventKind.remove:if(this.areElementsInLayoutPosition(c.parent,[])){const d=c.parent.topicChildren.filter((a)=>0>c.toBeRemoved.indexOf(a));
this.applyLayout(a,b,c.parent,d)}break;default:throw u.Utils.assertNever(c);}}areElementsInLayoutPosition(a,b){var c=a.layout.id;if(this.layoutRepository.hasOverviewLayout(c)){c=this.layoutRepository.getOverviewLayout(c);var d=a.topicChildren.filter((a)=>0>b.indexOf(a.id));const e=Math.min(d.length,c.variants.length-1);c=c.variants.find((a)=>a.subtopicLayoutBoxes.length===e);const g=d.slice(0,e);d=a.zoomLayoutBox;const k=c.anchorLayoutBox.withReferenceFrame(d.referenceFrame),v=c.subtopicLayoutBoxes.every((b,
c)=>{c=g[c];b=b.withReferenceFrame(a.zoomLayoutBox.referenceFrame).align(k.topLeft,k.topRight,a.zoomLayoutBox.topLeft,a.zoomLayoutBox.topRight);return this.helper.areLayoutBoxesClose(c.layoutBox,b,1E-5)}),h=a.contentChildren.find((a)=>a.is(f.base.ObjectKind.text)&&"title"===a.textStyle),l=a.contentChildren.find((a)=>a.is(f.base.ObjectKind.text)&&("subtitle"===a.textStyle||"subtitle_2"===a.textStyle)),m=c.titles.find((a)=>"title"===a.style);c=c.titles.find((a)=>"subtitle"===a.style||"subtitle_2"===
a.style);return v&&this.checkTextPos(h,m,d,k)&&this.checkTextPos(l,c,d,k)}return!1}checkTextPos(a,b,c,d){if(null==a)return!0;b=b.area.withReferenceFrame(c.referenceFrame).align(d.topLeft,d.topRight,c.topLeft,c.topRight);return this.helper.areLayoutBoxesClose(a.layoutBox.union(b),b,1E-5)}applyLayout(a,b,c,d){b.fitMinimumZoomAreaInto(c.zoomLayoutBox);const e=Math.min(d.length,a.variants.length-1);a=a.variants.find((a)=>a.subtopicLayoutBoxes.length===e);const g=d.slice(0,e);d=d.slice(e);this.applyVariant(c,
g,a,b);for(let a of d)b.fitInto(a,this.positionFinder.findTopicPosition(a,g)),g.push(a)}applyVariant(a,b,c,d){const e=a.zoomLayoutBox,g=c.anchorLayoutBox.withReferenceFrame(e.referenceFrame);c.subtopicLayoutBoxes.forEach((a,c)=>{c=b[c];a=a.withReferenceFrame(e.referenceFrame).align(g.topLeft,g.topRight,e.topLeft,e.topRight);d.fitInto(c,a)});const k=a.contentChildren.find((a)=>a.is(f.base.ObjectKind.text)&&"title"===a.textStyle);a=a.contentChildren.find((a)=>a.is(f.base.ObjectKind.text)&&("subtitle"===
a.textStyle||"subtitle_2"===a.textStyle));const v=c.titles.find((a)=>"title"===a.style);c=c.titles.find((a)=>"subtitle"===a.style||"subtitle_2"===a.style);this.applyTitle(k,v,d,e,g);this.applyTitle(a,c,d,e,g)}applyTitle(a,b,c,d,e){var g;if(null!=a&&a.is(f.base.ObjectKind.text)){var k=new qa.TextLayouter((a,b)=>c.fitSelectionBoxInto(a,b),(a)=>c.getSelectionBox(a),(a,b)=>c.setWrapWidth(a,b),(a,b,d)=>c.wrap(a,b,d),(a,b)=>c.fitInto(a,b),(a,b)=>c.setBackground(a,b),(a)=>c.removeBackground(a));k.styleText(a,
b.hasBackground?{kind:"background",cornerRadius:null!==(g=b.backgroundCornerRadius)&&void 0!==g?g:0}:{kind:"noBackground"});d=b.area.withReferenceFrame(d.referenceFrame).align(e.topLeft,e.topRight,d.topLeft,d.topRight);k.positionTextElement(b.anchor,b.area.rotation,a,d)}}};var Ra={};Object.defineProperty(Ra,"__esModule",{value:!0});Ra.LayoutCommanderImpl=class{constructor(a,b,c){this.layoutRepository=b;this.logger=q.LoggerModule.getLoggerManager().createLogger("prezi_cet_model_editor.LayoutCommanderImpl");
this.helper=new Ja.LayoutHelper;this.variantAndAreaHelper=new Ka.VariantAndAreaHelper(this.helper);this.contentLayoutCommander=new La.ContentLayoutCommander(b,this.variantAndAreaHelper,this.helper);this.planetLayoutCommander=new Ma.PlanetLayoutCommander(b,c,this.helper);this.overviewLayoutCommander=new Qa.OverviewLayoutCommander(b,c,this.helper);this.coverLayoutCommander=new Pa.CoverLayoutCommander(b,a,this.variantAndAreaHelper,this.helper)}handlePlanetLayoutEvent(a,b,c){this.planetLayoutCommander.handlePlanetLayoutEvent(a,
b,c)}isValid(a,b){return this.planetLayoutCommander.areSubtopicsInLayoutPosition(b,[])}areSubtopicsInLayoutPosition(a,b){return this.planetLayoutCommander.areSubtopicsInLayoutPosition(a,b)}changeTopicCoverOnAllTopicsCmd(a){return this.coverLayoutCommander.changeTopicCoverOnAllTopicsCmd(a)}handleTopicThemeApplication(a,b,c){this.coverLayoutCommander.changeTopicCover(b.parent.id,c,[b.id],a)}changeContentLayout(a,b,c){return this.contentLayoutCommander.changeContentLayout(a,b,c)}categorizeContentChildren(a){return this.contentLayoutCommander.categorizeContentChildren(a)}calculateContentArea(a){return this.contentLayoutCommander.calculateContentArea(a)}isContentLayoutValid(a,
b){return this.contentLayoutCommander.isContentLayoutValid(a,b)}overviewLayoutIsValid(a,b){return this.overviewLayoutCommander.overviewLayoutIsValid(a,b)}handleOverviewLayoutEvent(a,b,c){this.overviewLayoutCommander.handleOverviewLayoutEvent(a,b,c)}wrapIntoNewTopicCmd(a){return{name:"wrapIntoNewTopicCmd",run:(b)=>{var c=b.lookup.planetTopic(a);const d=this.planetLayoutCommander.getMostCommonSubtopicLayoutId(b,c.parent.id),e=c.layoutBox,g=c.parent;var k=g.topicChildren.indexOf(c)+1;k=g.add.planet(k,
c.theme);c.parent=k;k.applyLayout(d);k.fitInto(e);c=this.coverLayoutCommander.getCoverLayoutId(g.id,b,!0);this.layoutRepository.hasTopicShapeLayout(c)&&(c=this.layoutRepository.getTopicShapeLayout(c),this.coverLayoutCommander.changeTopicCover(g.id,c,"all",b));return k.id}}}};var ra={};Object.defineProperty(ra,"__esModule",{value:!0});var K=f.base.ObjectKind,sb=f.base.CoverLayoutRole,Sa=f.base.VisualLayoutRole,tb=f.base.ContentLayoutRole;ra.LayoutQueryImpl=class{constructor(){}getLayoutRole_SceneApi(a,
b){b=a.getEntityById(b);if(null==b)return w.CetModel.nilDef();b=b.get(w.CetModel.ID.TOPIC_CHILD.CHILD_PARENT);if(null==b||0===b.length)return w.CetModel.nilDef();a=a.getEntityById(b[0]);if(null==a)return w.CetModel.nilDef();a=a.getWrapper(w.CetModel.ID.TOPIC_CHILD.W).getBehaviour();return a.is(w.CetModel.ID.COVER)||a.is(w.CetModel.ID.VISUAL)||a.is(w.CetModel.ID.CONTENT)?(a=a.getLayoutRole(),null!=a?a.getEntity().getDef():w.CetModel.nilDef()):w.CetModel.nilDef()}getLayoutRole(a,b){a=a.lookup.simpleObject(b).parent;
if(a.is(K.cover))switch(a.contentChildren.find((a)=>a.id===b).coverLayoutRole){case sb.coverIcon:return w.CetModel.ID.COVER_ICON;case sb.coverTitle:return w.CetModel.ID.COVER_TITLE}else if(a.is(K.visual))switch(a.contentChildren.find((a)=>a.id===b).visualLayoutRole){case Sa.visualAnchor:return w.CetModel.ID.VISUAL_ANCHOR;case Sa.slideAnchor_16_9:return w.CetModel.ID.SLIDE_ANCHOR_16_9;case Sa.slideAnchor_4_3:return w.CetModel.ID.SLIDE_ANCHOR_4_3}else if(a.is(K.planetTopic))switch(a.contentChildren.find((a)=>
a.id===b).contentLayoutRole){case tb.contentTitle:return w.CetModel.ID.CONTENT_TITLE;case tb.contentIcon:return w.CetModel.ID.CONTENT_ICON}return w.CetModel.nilDef()}hasTopicShapeObject(a){return[...a.visual.contentChildren,...a.is(K.planetTopic)?a.surface.contentChildren:[]].some((a)=>this.isTopicShapeObject(a))}isTopicShapeObject(a){return f.CetModelEditor.isTopicShapeObjectKILLME(a)}getMostCommonLayout(a,b,c,d=null){a=a.lookup.base(b);if(null==a||!a.is(K.topic)&&!a.is(K.overview))return null;b=
[];a.is(K.topic)&&b.push(a);(a.is(K.planetTopic)||a.is(K.overview))&&b.push(...a.topicChildren);b=b.filter((a)=>this.hasTopicShapeObject(a));if(0===b.length)return null;let e=-Infinity;const g=new Map;let k;b.forEach((a)=>{var b;if(null==d||d(a))a=c(a),null!=a&&(g.set(a,(null!==(b=g.get(a))&&void 0!==b?b:0)+1),g.get(a)>e&&(e=g.get(a),k=a))});return k}isSortedBySlideIdx(a){let b=-1;return a.topicChildren.every((a)=>{a=this.getSlideTopicIndex(a);if(-1===a||a<b)return!1;b=a;return!0})}getSlideTopicIndex(a){return a.is(K.planetTopic)?
(a=[...a.visual.contentChildren.filter((a)=>a.is(K.slide)),...a.contentChildren.filter((a)=>a.is(K.slide))],0<a.length?a[0].slideAsset.sourcePageNumber:-1):-1}findPositionBySlideIndex(a,b){b=b.topicChildren;for(let c=0;c<b.length;++c){const d=this.getSlideTopicIndex(b[c]);if(a<d)return c}return b.length}};var Ta={};Object.defineProperty(Ta,"__esModule",{value:!0});var x=f.base.ObjectKind,sa=f.base.FillKind,ea=f.base.ColorFilterKind;Ta.ColorGroupImpl=class{constructor(a,b){this.items=b;this.helper=
new Hb(a)}size(){return this.items.length}editorIds(){return this.items.map((a)=>a.id)}addObjects(a){this.items=this.items.concat(a)}getMainColors(){const a=[];this.items.forEach((b)=>{const c=this.getMainColorOfObject(b);null==c||a.some((a)=>this.helper.colorEquals(a,c.color))||a.push(c.color)});return a}getPresets(){const a=[];this.items.forEach((b)=>{b=this.getMainColorOfObject(b);null!=b&&a.push({styleEnum:b.styleEnum,styleClass:b.styleClass})});return a}applyColor(a,b){this.items.forEach((c)=>
{switch(c.kind){case x.arc:null==c.arcStyle||null==a||!b&&this.helper.colorEquals(c.fill,a)||(c.fill=a);break;case x.shape:if(null!=c.shapeStyle&&null!=a){var d=this.getMainColorFromFillData(c.fill);if(b||!this.helper.colorEquals(d,a))c.fill=this.setMainColorOnFillData(c.fill,a)}break;case x.chart:case x.image:null!=c.filterStyle&&null!=a&&(d=this.getMainColorFromFilter(c.colorFilter),b||!this.helper.colorEquals(d,a))&&(c.colorFilter=this.setMainColorOnFilter(c.colorFilter,a));break;case x.pdf:case x.swf:if(d=
this.getMainColorFromFilter(c.colorFilter),b||!this.helper.colorEquals(d,a))c.colorFilter=null==a?{kind:ea.noColorFilter}:{kind:ea.solidColorBlend,color:a}}})}setPresets(a){this.items.forEach((b)=>{switch(b.kind){case x.arc:null!=b.arcStyle&&null!=a.arcStyle&&(b.arcStyle=a.arcStyle);break;case x.shape:null!=b.shapeStyle&&null!=a.shapeStyle&&(b.shapeStyle=a.shapeStyle);break;case x.chart:case x.image:Z(b.filterStyle)&&null!=a.filterStyle&&(b.filterStyle=a.filterStyle);break;case x.pdf:case x.swf:null!=
b.filterStyle&&u.isFromEnum(b.filterStyle,f.base.FullBlendShapelikeFilterStyle)&&null!=a.fullBlendFilterStyle?b.filterStyle=a.fullBlendFilterStyle:b.filterStyle=a.filterStyle}})}applyPresets(){this.items.forEach((a)=>{switch(a.kind){case x.arc:null!=a.arcStyle&&a.applyPresetStyle();break;case x.shape:null!=a.shapeStyle&&a.applyPresetStyle();break;case x.chart:case x.image:Z(a.filterStyle)&&a.applyPresetStyle();break;case x.pdf:case x.swf:a.applyPresetStyle()}})}getMainColorOfObject(a){switch(a.kind){case x.arc:return null!=
a.arcStyle?{color:a.fill,styleEnum:f.base.ArcStyle,styleClass:a.arcStyle}:null;case x.shape:return null!=a.shapeStyle?{color:this.getMainColorFromFillData(a.fill),styleEnum:f.base.ShapeStyle,styleClass:a.shapeStyle}:null;case x.chart:case x.image:return Z(a.filterStyle)?{color:this.getMainColorFromFilter(a.colorFilter),styleEnum:f.base.ShapelikeFilterStyle,styleClass:a.filterStyle}:null;case x.pdf:case x.swf:return Z(a.filterStyle)?{color:this.getMainColorFromFilter(a.colorFilter),styleEnum:f.base.ShapelikeFilterStyle,
styleClass:Z(a.filterStyle)?a.filterStyle:null}:null!=a.filterStyle&&u.isFromEnum(a.filterStyle,f.base.FullBlendShapelikeFilterStyle)?{color:this.getMainColorFromFilter(a.colorFilter),styleEnum:f.base.FullBlendShapelikeFilterStyle,styleClass:a.filterStyle}:{color:this.getMainColorFromFilter(a.colorFilter),styleEnum:f.base.ShapelikeFilterStyle,styleClass:null};default:return null}}getMainColorFromFillData(a){return a.fillKind===sa.linear?a.startColor:a.color}getMainColorFromFilter(a){return a.kind===
ea.solidColorBlend?a.color:null}setMainColorOnFillData(a,b){return a.fillKind===sa.linear?Object.assign(Object.assign({},a),{startColor:Object.assign(Object.assign({},a.startColor),b)}):Object.assign(Object.assign({},a),{color:Object.assign(Object.assign({},a.color),b)})}setMainColorOnFilter(a,b){return a.kind===ea.solidColorBlend?Object.assign(Object.assign({},a),{color:Object.assign(Object.assign({},a.color),b)}):a}};class Hb{constructor(a){this.api=a;this.styleSheetsCache=null}colorEquals(a,b){return null==
a&&null==b||null!=a&&null!=b&&a.r===b.r&&a.g===b.g&&a.b===b.b}getColorableVisualObjects(a){let b=[];a.simpleChildren(f.base.ChildVisibilityKind.outsideAndInside).forEach((a)=>{switch(a.kind){case x.arc:null!=a.arcStyle&&b.push(a);break;case x.shape:if(this.isVisual(a)&&a.visualLayoutRole===f.base.VisualLayoutRole.visualAnchor&&this.isShapeTransparent(a.fill))break;null!=a.shapeStyle&&b.push(a);break;case x.chart:case x.image:Z(a.filterStyle)&&b.push(a);break;case x.pdf:case x.swf:b.push(a)}});return b}isVisual(a){return a.parent.is(x.visual)}getColorsForStyle(a){this.cacheStyleSheetsIfNeeded();
let b=null;switch(a){case f.base.ArcStyle:return b=(a)=>({color:this.getColorFromStyleDeclaration(a),styes:{arcStyle:a}}),[b(f.base.ArcStyle.Line1),b(f.base.ArcStyle.Line2),b(f.base.ArcStyle.Line3),b(f.base.ArcStyle.Line4),b(f.base.ArcStyle.Line5)];case f.base.ShapeStyle:return b=(a)=>({color:this.getColorFromStyleDeclaration(a),styes:{shapeStyle:a}}),[b(f.base.ShapeStyle.Poly1),b(f.base.ShapeStyle.Poly2),b(f.base.ShapeStyle.Poly3),b(f.base.ShapeStyle.Poly4),b(f.base.ShapeStyle.Poly5)];case f.base.ShapelikeFilterStyle:return b=
(a)=>({color:this.getColorFromStyleDeclaration(a),styes:{filterStyle:a}}),[b(f.base.ShapelikeFilterStyle.Filter1),b(f.base.ShapelikeFilterStyle.Filter2),b(f.base.ShapelikeFilterStyle.Filter3),b(f.base.ShapelikeFilterStyle.Filter4),b(f.base.ShapelikeFilterStyle.Filter5)];case f.base.FullBlendShapelikeFilterStyle:return b=(a)=>({color:this.getColorFromStyleDeclaration(a),styes:{fullBlendFilterStyle:a}}),[b(f.base.FullBlendShapelikeFilterStyle.Filter1),b(f.base.FullBlendShapelikeFilterStyle.Filter2),
b(f.base.FullBlendShapelikeFilterStyle.Filter3),b(f.base.FullBlendShapelikeFilterStyle.Filter4),b(f.base.FullBlendShapelikeFilterStyle.Filter5)];default:return[]}}getColorFromStyleDeclaration(a){this.cacheStyleSheetsIfNeeded();a=this.styleSheetsCache.get(a);if(null==a)return null;const b=a.styleBlock.fill;return null!=a.styleBlock.colorFilter&&a.styleBlock.colorFilter.kind===ea.solidColorBlend?a.styleBlock.colorFilter.color:null==b?null:b.fillKind===sa.solid?Object.assign(Object.assign({},b.color),
{a:b.alpha}):Object.assign(Object.assign({},b.gradientStartColor),{a:b.gradientStartAlpha})}cacheStyleSheetsIfNeeded(){null==this.styleSheetsCache&&(this.styleSheetsCache=new Map,this.api.styleSheet.styleSheets.forEach((a)=>{this.styleSheetsCache.set(a.className,a)}))}isShapeTransparent(a){return a.fillKind===sa.solid?0===a.color.a:0===a.startColor.a&&0===a.endColor.a}}var Ua={};Object.defineProperty(Ua,"__esModule",{value:!0});var ta=f.base.ObjectKind;Ua.TemplateCommanderImpl=class{setTemplateDataCmd(a){return{name:"Set template data",
run:(b)=>{b.meta.templateInfo={templateId:a}}}}removeIdStyleClassesFromCoversCmd(){return{name:"Remove id",run:(a)=>{a.lookup.findAll(ta.styled).forEach((a)=>{a.is(ta.simpleObject)&&a.parent.is(ta.cover)&&a.applyPresetStyle()})}}}updateTextPlaceholdersCmd(a){return{name:"Update text placeholders",run:(b)=>{b.lookup.findAll(ta.text).forEach((c)=>{c.isPlaceholder&&(c.setText(a),b.toDecorator(c).updateFontToSupportCurrentLanguage())})}}}updateThemeIdsAndMergeCmd(a,b,c){return{name:"updateThemeIdsAndMergeCmd",
runLegacy:(d)=>{q.avro.Avro.createDefaultLogger().logNewObject({object_type:"BACKGROUND",topic_relationship:"CONTENT",parent_type:"OVERVIEW",object_id:d.mscene.getPreziW().getBackground().getId()});this.setTemplateDataCmd(a).run(d.api);d.documentMerge(b,c)}}}};var Va={};Object.defineProperty(Va,"__esModule",{value:!0});Va.TemplateChooserAppEditorImpl=class{constructor(a){this.runner=a}get template(){null==this._template&&(this._template=new Ua.TemplateCommanderImpl);return this._template}get scene(){return this.runner.scene}beginAsyncApiCommand(a,
b){return this.runner.beginAsyncApiCommand(a,b)}executeApiCommand(a,b){return this.runner.executeApiCommand(a,b)}executeLegacyCommand(a,b){return this.runner.executeLegacyCommand(a,b)}read(a){return this.runner.read(a)}};var E={};Object.defineProperty(E,"__esModule",{value:!0});var P=f.base.ChildVisibilityKind,y=f.base.ObjectKind,fa;(function(a){a[a.generalEntitySnap=0]="generalEntitySnap";a[a.fontSizeSnap=1]="fontSizeSnap";a[a.topicZoomAreaSnap=2]="topicZoomAreaSnap"})(fa=E.SnapIntentionKind||(E.SnapIntentionKind=
{}));class Ib{constructor(a,b,c){this.cameraAccess=a;this.api=b;this.coverEditApi=c}calculateReferenceEditors(a,b){switch(b){case fa.generalEntitySnap:a=this.calculateReferenceEditorsGeneralEntity(a);break;case fa.topicZoomAreaSnap:a=this.calculateReferenceEditorsForTopicZoomArea(a);break;case fa.fontSizeSnap:a=this.calculateReferenceEditorsForFontSize(a);break;default:throw u.Utils.assertNever(b);}b=[];for(let c of a)if(this.isVisibleOnScreen(c.layoutBox)&&b.push(c),42<b.length)return[];return b}calculateReferenceZoomLayoutBoxes(a,
b){return this.isZoomAreaVisible()&&b===fa.generalEntitySnap?this.calculateReferenceZoomLayoutBoxesGeneralEntity(a).filter((a)=>this.isVisibleOnScreen(a)):[]}calculateReferenceEditorsForTopicZoomArea(a){if(1!==a.length)return null;const b=this.api.lookup.base(a[0]);let c;b.is(y.topic)&&(c=b.simpleChildren(this.getChildVisibility()));this.getChildVisibility()===P.inside&&(b.is(y.page)?c=[...c,...b.parent.simpleChildren(P.inside)]:b.is(y.planetTopic)&&(c=[...c,...b.topicChildren]));return c.filter((b)=>
-1===a.indexOf(b.id))}calculateReferenceEditorsGeneralEntity(a){var b=a.map((a)=>this.api.lookup.transformedObject(a));if(0===b.length)return null;b=b[0].parent;let c=[];b.is(y.topicParent)&&c.push(...b.topicChildren);switch(b.kind){case y.planetTopic:c.push(...b.simpleChildren(P.inside),b);break;case y.page:c.push(...b.simpleChildren(P.inside),...b.parent.simpleChildren(P.inside));break;case y.cover:case y.master:c.push(...b.parent.simpleChildren(this.getChildVisibility()));break;case y.surface:case y.visual:c.push(...b.parent.simpleChildren(this.getChildVisibility()));
this.getChildVisibility()===P.inside&&b.parent.is(y.planetTopic)&&c.push(...b.parent.topicChildren);break;case y.overview:c.push(...b.simpleChildren(P.inside));break;default:throw u.Utils.assertNever(b);}return c.filter((b)=>-1===a.indexOf(b.id))}calculateReferenceEditorsForFontSize(a){if(1!==a.length)return null;var b=this.api.lookup.transformedObject(a[0]);if(!b.is(f.base.ObjectKind.text))return null;a=this.calculateReferenceEditorsGeneralEntity(a).filter((a)=>a.is(f.base.ObjectKind.text));b=this.getNeighborTopicCoverTexts(b);
return[...a,...b]}getNeighborTopicCoverTexts(a){let b=[];a=a.parent;switch(a.kind){case y.cover:case y.surface:case y.visual:const c=a.parent;a=c.parent;a.kind!==y.planetTopic&&a.kind!==y.overview||b.push(...a.contentChildren);c.parent.topicChildren.filter((a)=>a.id!==c.id).forEach((a)=>{b.push(...a.cover.contentChildren,...a.visual.contentChildren);a.is(y.planetTopic)&&b.push(...a.surface.contentChildren)});break;case y.overview:case y.planetTopic:a.topicChildren.forEach((a)=>{b.push(...a.cover.contentChildren,
...a.visual.contentChildren);a.is(y.planetTopic)&&b.push(...a.surface.contentChildren)});break;case y.page:case y.master:break;default:throw u.Utils.assertNever(a);}return b.filter((a)=>a.is(f.base.ObjectKind.text))}calculateReferenceZoomLayoutBoxesGeneralEntity(a){a=a.map((a)=>this.api.lookup.transformedObject(a));if(0===a.length)return[];a=a[0].parent;switch(a.kind){case y.cover:case y.master:case y.surface:case y.visual:case y.page:return[a.parent.zoomLayoutBox];case y.planetTopic:return[a.zoomLayoutBox];
case y.overview:return[];default:throw u.Utils.assertNever(a);}}isVisibleOnScreen(a){const b=this.cameraAccess.getScreenLayoutBox();return a.intersects(b)}getChildVisibility(){const a=this.coverEditApi.getMode(this.api);switch(a.kind){case I.CoverEditModeKind.None:return null;case I.CoverEditModeKind.Advanced:case I.CoverEditModeKind.Title:return P.outside;case I.CoverEditModeKind.InsideAdvanced:return P.inside;default:return u.Utils.assertNever(a)}}isZoomAreaVisible(){const a=this.coverEditApi.getMode(this.api);
switch(a.kind){case I.CoverEditModeKind.Advanced:case I.CoverEditModeKind.InsideAdvanced:case I.CoverEditModeKind.None:return!0;case I.CoverEditModeKind.Title:return!1;default:return u.Utils.assertNever(a)}}}E.SnapFilter=Ib;var t={};Object.defineProperty(t,"__esModule",{value:!0});var M=f.base.AnchorPoint,Q;(function(a){a.topOnly="topOnly";a.bottomOnly="bottomOnly";a.topAndBottom="topAndBottom";a.all="all"})(Q=t.BaselineSegmentStrategy||(t.BaselineSegmentStrategy={}));class Jb{static isTwoLinesParallel(a,
b,c,d){return.01>Math.abs((b.y-a.y)*(c.x-d.x)-(d.y-c.y)*(a.x-b.x))}static getIntersectionOfTwoLines(a,b,c,d){const e=b.y-a.y;b=a.x-b.x;a=e*a.x+b*a.y;const g=d.y-c.y;d=c.x-d.x;c=g*c.x+d*c.y;const k=e*d-g*b;return Math.abs(k)<Number.EPSILON?null:{x:(d*a-b*c)/k,y:(e*c-g*a)/k}}static getTranslationVector(a,b){const c=n.Geometry.fromPoint(a.P).sub(n.Geometry.fromPoint(a.Q)).perpendicular();b=this.getIntersectionOfTwoLines(a.P,n.Geometry.fromPoint(a.P).add(c).toPoint(),b.P,b.Q);return null==b?null:n.Geometry.fromPoint(a.P).sub(n.Geometry.fromPoint(b))}static isSegmentVisibleOnScreen(a,
b){a=a.getStageAreaLayoutBox();const c=a.referenceFrame.point(b.P),d=a.referenceFrame.point(b.Q);return a.contains(c)||a.contains(d)||this.doSegmentIntersectLayoutBox(b,a)}static doSegmentIntersectLayoutBox(a,b){return null!=n.Geometry.intersection().lineIntersection(a.P,a.Q,b.topLeft,b.topRight,!0)||null!=n.Geometry.intersection().lineIntersection(a.P,a.Q,b.topLeft,b.bottomLeft,!0)||null!=n.Geometry.intersection().lineIntersection(a.P,a.Q,b.bottomLeft,b.bottomRight,!0)||null!=n.Geometry.intersection().lineIntersection(a.P,
a.Q,b.bottomRight,b.topRight,!0)}static getScaleToReferenceLine(a,b,c){c=this.getIntersectionOfTwoLines(a,b,c.P,c.Q);if(null==c)return 1;c=n.Geometry.distance(b,c);a=n.Geometry.distance(b,a);return a<Number.EPSILON?1:c/a}static scaleLayoutBoxWithAnchorPoint(a,b,c){switch(b){case M.center:case M.bottomLeft:case M.topLeft:case M.bottomRight:case M.topRight:return a.scale(c);case M.centerLeft:case M.centerRight:return a.withSize({width:a.size.width*c,height:a.size.height});case M.topCenter:case M.bottomCenter:return a.withSize({width:a.size.width,
height:a.size.height*c});default:return a.scale(c)}}static calculateAngle(a,b){a=Math.abs(a-b);return a<Math.PI?a:Math.abs(a-2*Math.PI)}static referenceDistance(a,b,c){return n.Geometry.distance(b.point({x:0,y:0}).withReferenceFrame(c),b.point({x:0,y:a}).withReferenceFrame(c))}static calculateFontSizeInScreen(a,b,c){a=b.withReferenceFrame(a.getScreenLayoutBox().referenceFrame).size.height/b.size.height;return c*a}}t.SnapHelper=Jb;class Kb{static getFixPoint(a,b){return b?M.center:{rx:-a.rx,ry:-a.ry}}static getHorizontalSegments(a){return[{P:a.topLeft,
Q:a.topRight},{P:a.centerLeft,Q:a.centerRight},{P:a.bottomLeft,Q:a.bottomRight}]}static getVerticalSegments(a){return[{P:a.topLeft,Q:a.bottomLeft},{P:a.topCenter,Q:a.bottomCenter},{P:a.topRight,Q:a.bottomRight}]}static getSegments(a){return[...this.getHorizontalSegments(a),...this.getVerticalSegments(a)]}static getSegmentsForText(a,b){return[...this.getMiddleAndTextBaselineSegments(a,b,Q.topAndBottom),...this.getVerticalSegments(b)]}static getMiddleAndTextBaselineSegments(a,b,c){return[...this.getTextBaselineSegments(a,
b,c),{P:b.centerLeft,Q:b.centerRight}]}static getTextBaselineSegments(a,b,c){const d=b.size.width/a.layoutBox.size.width,e=[];c!==Q.topOnly&&c!==Q.topAndBottom&&c!==Q.all||e.push({P:b.topLeft,Q:b.topRight});let g,k;null!=a.background?(g=(a.layoutBox.size.height-a.glyphBox.size.height)/2,k=a.lineCount):(g=0,k=a.lineCount-1);for(let f=0;f<k;f++){const k=a.getLineMetrics(f);c===Q.all&&e.push({P:{x:b.topLeft.x,y:b.topLeft.y+(g+k.ascent)*d},Q:{x:b.topRight.x,y:b.topRight.y+(g+k.ascent)*d}});g+=k.height}if(c===
Q.bottomOnly||c===Q.topAndBottom||c===Q.all)null!=a.background?e.push({P:b.bottomLeft,Q:b.bottomRight}):(a=a.getLineMetrics(a.lineCount-1),e.push({P:{x:b.topLeft.x,y:b.topLeft.y+(g+a.ascent)*d},Q:{x:b.topRight.x,y:b.topRight.y+(g+a.ascent)*d}}));return e}static getSegmentsForAnchorPointHorizontal(a,b,c){return c?[{P:a.topLeft,Q:a.topRight},{P:a.bottomLeft,Q:a.bottomRight}]:0>b.ry?[{P:a.topLeft,Q:a.topRight}]:0<b.ry?[{P:a.bottomLeft,Q:a.bottomRight}]:[]}static getSegmentsForAnchorPointVertical(a,b,
c){return c?[{P:a.topLeft,Q:a.bottomLeft},{P:a.topRight,Q:a.bottomRight}]:0>b.rx?[{P:a.topLeft,Q:a.bottomLeft}]:0<b.rx?[{P:a.topRight,Q:a.bottomRight}]:[]}}t.SegmentCalculator=Kb;var F={};Object.defineProperty(F,"__esModule",{value:!0});var N=f.base.AnchorPoint,Lb=f.base.editorIs,W;(function(a){a.horizontal="horizontal";a.vertical="vertical"})(W||(W={}));F.RotationSnapInfo=class{constructor(){this.info=new Map;Mb.forEach((a)=>{this.info.set(a,[])})}add(a,b){for(;a<-Math.PI;)a+=2*Math.PI;for(;a>Math.PI;)a-=
2*Math.PI;for(const c of this.info.keys())if(.001>Math.abs(c-a)){this.info.get(c).push(b);return}a in this.info||this.info.set(a,[]);this.info.get(a).push(b)}keys(){return[...this.info.keys()]}getEntitiesWithRotation(a){var b;return null!==(b=this.info.get(a))&&void 0!==b?b:[]}};const Nb=(a,b)=>(c)=>a(c)||b(c),Mb=[0,Math.PI/4,Math.PI/2,3*Math.PI/4,Math.PI,5*Math.PI/4,3*Math.PI/2,7*Math.PI/4];F.Snapper=class{constructor(a,b){this.cameraAccess=a;this.coverEditApi=b;this.ARC_ROTATION_THRESHOLD=5;this.ROTATION_THRESHOLD=
15;this.MOVE_THRESHOLD=5;this.OBJECT_SIZE_DIFF_TOLERANCE=.05;this.ARC_LENGTH_THRESHOLD=10;this.ARC_POINT_DISTANCE_THRESHOLD=15;this.universeLimitHelper=new F.UniverseLimitHelper(a)}setNoSnapAsDefault(a){this.snapAction={subjectIds:a,results:[]}}applySnapDecorator(a){a.documentDecorator.set(z.EditorCommanderInternal.getSnapComponentKey(),this.snapAction)}calculateMoveSnap(a,b,c,d){if(!b.snapEnabled)return c;var e=c.withReferenceFrame(this.cameraAccess.getScreenLayoutBox().referenceFrame);null==b.referenceSegments&&
(b.referenceSegments=this.getReferenceSegments(a,b.originalEditorIds,e.rotationRad,d));if(0===b.referenceSegments.length)return c;a=1===b.originalEditorIds.length&&a.lookup.transformedObject(b.originalEditorIds[0]).is(f.base.ObjectKind.text)?t.SegmentCalculator.getMiddleAndTextBaselineSegments(a.lookup.text(b.originalEditorIds[0]),e,t.BaselineSegmentStrategy.topAndBottom):t.SegmentCalculator.getHorizontalSegments(e);c=t.SegmentCalculator.getVerticalSegments(e);a=this.getDragAlignSnapResultsOnAxis(a,
b.referenceSegments);c=this.getDragAlignSnapResultsOnAxis(c,b.referenceSegments);d=a.translationVector.add(c.translationVector);e=e.translate(d.toPoint());b.kind!==h.ActionKind.Finish&&(this.snapAction={subjectIds:b.originalEditorIds,results:[...a.snapResults,...c.snapResults]});return e}getReferenceSegments(a,b,c,d){a=new E.SnapFilter(this.cameraAccess,a,this.coverEditApi);var e=a.calculateReferenceEditors(b,d);e=this.filterByRotation(e,c);e=this.getReferenceSegmentsFromEditor(e);b=a.calculateReferenceZoomLayoutBoxes(b,
d);c=this.filterByRotationLayoutBoxes(b,c);e.push(...this.getReferenceSegmentsFromLayoutBox(c));return e}getAlignSnapTextScale(a,b,c,d,e,g,k){var f=a.lookup.text(b.originalEditorIds[0]),h=this.cameraAccess.getScreenLayoutBox().referenceFrame;const l=c.withReferenceFrame(h);h=d.withReferenceFrame(h);null==b.referenceSegments&&(b.referenceSegments=this.getReferenceSegments(a,b.originalEditorIds,c.rotationRad,g));a=d.withReferenceFrame(this.cameraAccess.getScreenLayoutBox().referenceFrame).point(k);
f=[this.getResizeAlignSnapResult(W.vertical,b.isCenterResize,b.resizeAnchor,l,b.referenceSegments,a),this.getResizeAlignSnapResultForTextBaseline(b,f,l,b.referenceSegments,a)];var {scaleFactor:m,similar:n}=this.calculateResizeAlignSnapScale(f);return this.isResizedLayoutBoxInsideThreshold(h,b.resizeAnchor,m,e)?(this.applySnapResult(b.kind,b.originalEditorIds,n),m):1}getAlignSnapScale(a,b,c,d,e,g){c=c.withReferenceFrame(this.cameraAccess.getScreenLayoutBox().referenceFrame);null==b.referenceSegments&&
(b.referenceSegments=this.getReferenceSegments(a,b.originalEditorIds,c.rotationRad,e));a=c.point(g);a=[this.getResizeAlignSnapResult(W.horizontal,b.isCenterResize,b.resizeAnchor,c,b.referenceSegments,a),this.getResizeAlignSnapResult(W.vertical,b.isCenterResize,b.resizeAnchor,c,b.referenceSegments,a)];var {scaleFactor:k,similar:f}=this.calculateResizeAlignSnapScale(a);return this.isResizedLayoutBoxInsideThreshold(c,b.resizeAnchor,k,d)?(this.applySnapResult(b.kind,b.originalEditorIds,f),k):1}calculateResizeAlignSnapScale(a){a=
a.filter((a)=>null!=a).filter((a)=>a.translationVector.length()<this.MOVE_THRESHOLD);if(0===a.length)return{scaleFactor:1,similar:[]};const b=a.reduce((a,b)=>Math.abs(b.scale-1)<Math.abs(a.scale-1)?b:a);a=a.filter((a)=>.001>Math.abs(a.scale-b.scale));return{scaleFactor:b.scale,similar:a}}applySnapResult(a,b,c){a!==h.ActionKind.Finish&&(this.snapAction={subjectIds:b,results:u.Utils.flatten(c.map((a)=>a.snapResults))})}calculateResizeSnap(a,b,c,d,e,g){const k=t.SegmentCalculator.getFixPoint(b.resizeAnchor,
b.isCenterResize);if(ka.isActive("js-zoom-limits")){const e=this.universeLimitHelper.getScaleToLimit(b,a,d),g=0===b.resizeAnchor.rx?c.size.height/d.size.height:c.size.width/d.size.width;if(1>=e&&e>g)return a=t.SnapHelper.scaleLayoutBoxWithAnchorPoint(d,b.resizeAnchor,e).move(k,d.point(k)),this.setUniverseLimitSnapActionOrLog(b.kind,b.originalEditorIds),a;if(1<e&&1>g)return this.setUniverseLimitSnapActionOrLog(b.kind,b.originalEditorIds),d}if(!b.snapEnabled)return c;e=this.getAlignSnapScale(a,b,c,
e,g,k);1===e&&(e=this.getSizeSnapScale(a,b,c));return 1===e?c:t.SnapHelper.scaleLayoutBoxWithAnchorPoint(c,b.resizeAnchor,e).move(k,d.point(k))}calculateTextResizeSnap(a,b,c,d,e,g){const k=t.SegmentCalculator.getFixPoint(b.resizeAnchor,b.isCenterResize);if(ka.isActive("js-zoom-limits")){const e=this.universeLimitHelper.getScaleToLimit(b,a,b.dragGroup.originalDragLayoutBox),g=c.size.width/b.dragGroup.originalDragLayoutBox.size.width;if(1>=e&&e>g)return this.setUniverseLimitSnapActionOrLog(b.kind,b.originalEditorIds),
a=t.SnapHelper.scaleLayoutBoxWithAnchorPoint(b.originalSelectionBox,b.resizeAnchor,e).move(k,b.originalSelectionBox.point(k)),c.align(d.topLeft,d.topRight,a.topLeft,a.topRight);if(1<e&&1>g)return this.setUniverseLimitSnapActionOrLog(b.kind,b.originalEditorIds),b.dragGroup.originalDragLayoutBox}if(!b.snapEnabled||""===a.lookup.text(b.originalEditorIds[0]).getText())return c;e=this.getAlignSnapTextScale(a,b,c,d,e,g,k);1===e&&(e=this.getSizeSnapScale(a,b,c));if(1===e)return c;a=t.SnapHelper.scaleLayoutBoxWithAnchorPoint(d,
b.resizeAnchor,e).move(k,d.point(k));return c.align(d.topLeft,d.topRight,a.topLeft,a.topRight)}isResizedLayoutBoxInsideThreshold(a,b,c,d){const e=t.SnapHelper.scaleLayoutBoxWithAnchorPoint(a,b,c);return n.Geometry.distance(a.point(b),e.point(b))<this.MOVE_THRESHOLD&&c>d}getResizeAlignSnapResult(a,b,c,d,e,g){let k;switch(a){case W.horizontal:k=t.SegmentCalculator.getSegmentsForAnchorPointHorizontal(d,c,b);var f=d.point({rx:c.rx,ry:-1});var h=d.point({rx:c.rx,ry:1});!0;break;case W.vertical:k=t.SegmentCalculator.getSegmentsForAnchorPointVertical(d,
c,b);f=d.point({rx:-1,ry:c.ry});h=d.point({rx:1,ry:c.ry});!0;break;default:u.Utils.assertNever(a)}a=this.getAllAlignSnapResultsOnAxis(k,e);return 0<a.snapResults.length?(g=t.SnapHelper.getScaleToReferenceLine(t.SnapHelper.getIntersectionOfTwoLines(f,h,a.snapResults[0].originalSubjectSegment.P,a.snapResults[0].originalSubjectSegment.Q),g,a.snapResults[0].referenceSegment),{snapResults:a.snapResults,translationVector:a.translationVector,scale:g}):null}getResizeAlignSnapResultForTextBaseline(a,b,c,d,
e){const g=a.resizeAnchor;a=t.SegmentCalculator.getMiddleAndTextBaselineSegments(b,c,a.isCenterResize?t.BaselineSegmentStrategy.topAndBottom:-1===g.ry?t.BaselineSegmentStrategy.topOnly:t.BaselineSegmentStrategy.bottomOnly);d=this.getAllAlignSnapResultsOnAxis(a,d);return 0<d.snapResults.length?(c=t.SnapHelper.getScaleToReferenceLine(t.SnapHelper.getIntersectionOfTwoLines(c.point({rx:g.rx,ry:1}),c.point({rx:g.rx,ry:-1}),d.snapResults[0].originalSubjectSegment.P,d.snapResults[0].originalSubjectSegment.Q),
e,d.snapResults[0].referenceSegment),{snapResults:d.snapResults,translationVector:d.translationVector,scale:c}):null}calculateRotateSnap(a,b,c,d,e){if(b.snapEnabled){let c=(d.rotationRad+e)%(2*Math.PI);0>c&&(c+=2*Math.PI);null==b.rotationSnapInfo&&(b.rotationSnapInfo=this.getSiblingsRotationsWithMirroredAngles(a,b.originalEditorIds));a=b.rotationSnapInfo;const f=a.keys().reduce((a,b)=>t.SnapHelper.calculateAngle(a,c)<t.SnapHelper.calculateAngle(b,c)?a:b);e=Math.abs(c-f);var g=this.cameraAccess.getScreenLayoutBox().referenceFrame;
g=d.withReferenceFrame(g).size;if(Math.abs(Math.sqrt(g.width*g.width+g.height*g.height)/2*Math.sin(e))<this.ROTATION_THRESHOLD)return e=f-d.rotationRad,this.setRotationSnapAction(b.kind,a,b.originalEditorIds[0],f),d.rotateRad(e)}return c}calculateArcSnap(a,b,c,d,e){d=d?b.end:b.start;const g=n.Geometry.fromPoint(c).sub(n.Geometry.fromPoint(d));if(ka.isActive("js-zoom-limits")){var k=this.universeLimitHelper.getScaleArcToLimit(n.Geometry.fromPoint(d).add(n.Geometry.fromPoint(c)).mul(.5).toPoint(),g.length());
if(1<k)return this.setUniverseLimitSnapActionOrLog(e.currentActionKind,[b.id]),g.setLength(g.length()*k).add(n.Geometry.fromPoint(d)).toPoint()}null==e.arcSnapInfos&&(e.arcSnapInfos=this.getArcSnapInfos(a,[e.entityId]));k=e.arcSnapInfos;const f=this.calculateArcPointsSnap(b,k,c);if(null!=f)return f;a=this.calculateArcRotateSnap(a,e.entityId,b,g,d,c,e.currentActionKind,e);c=n.Geometry.fromPoint(a).sub(n.Geometry.fromPoint(d));return this.calculateArcLengthSnap(b,e.entityId,k,c,d,a)}calculateArcPointsSnap(a,
b,c){const d=this.cameraAccess.getScreenLayoutBox().referenceFrame;b=[...b.map((a)=>a.start),...b.map((a)=>a.end)].filter((b)=>{b=n.Geometry.distance(c,b);return t.SnapHelper.referenceDistance(b,a.layoutBox.referenceFrame,d)<this.ARC_POINT_DISTANCE_THRESHOLD});return 0<b.length?b.reduce((a,b)=>n.Geometry.distance(c,a)<n.Geometry.distance(c,b)?a:b):null}calculateArcLengthSnap(a,b,c,d,e,g){const k=this.cameraAccess.getScreenLayoutBox().referenceFrame,f=d.length();c=c.filter((b)=>t.SnapHelper.referenceDistance(Math.abs(b.length-
f),a.layoutBox.referenceFrame,k)<this.ARC_LENGTH_THRESHOLD);if(0<c.length){const a=c.map((a)=>a.length).reduce((a,b)=>Math.abs(a-f)<Math.abs(b-f)?a:b);g=c.filter((b)=>.1>Math.abs(b.length-a));this.snapAction={subjectIds:[b],results:g.map((a)=>({kind:h.SnapResultKind.Highlight,referenceId:a.ref.id}))};return d.setLength(a/f*f).add(n.Geometry.fromPoint(e)).toPoint()}return g}calculateArcRotateSnap(a,b,c,d,e,g,k,f){let h=d.getAngle()%(2*Math.PI);0>h&&(h+=2*Math.PI);null==f.rotationSnapInfo&&(f.rotationSnapInfo=
this.getSiblingsRotationsWithMirroredAngles(a,[b]));a=f.rotationSnapInfo;d=a.keys().reduce((a,b)=>t.SnapHelper.calculateAngle(a,h)<t.SnapHelper.calculateAngle(b,h)?a:b);f=Math.abs(h-d);const v=n.Geometry.distance(g,e),l=this.cameraAccess.getScreenLayoutBox().referenceFrame;c=t.SnapHelper.referenceDistance(v,c.layoutBox.referenceFrame,l);return Math.abs(Math.sin(f)*c)<this.ARC_ROTATION_THRESHOLD?(this.setRotationSnapAction(k,a,b,d),n.Geometry.fromPoint({x:v,y:0}).rotate(d).add(n.Geometry.fromPoint(e)).toPoint()):
g}createNoSnapResults(){return{translationVector:n.Geometry.fromPoint({x:0,y:0}),snapResults:[]}}getDragAlignSnapResultsOnAxis(a,b){a=this.getAllAlignSnapResultsOnAxis(a,b);return a.translationVector.length()<this.MOVE_THRESHOLD?a:this.createNoSnapResults()}getAllAlignSnapResultsOnAxis(a,b){if(0===a.length)return this.createNoSnapResults();b=b.filter((b)=>t.SnapHelper.isTwoLinesParallel(b.P,b.Q,a[0].P,a[0].Q));if(0===b.length)return this.createNoSnapResults();b=b.map((b)=>{const c=a.map((a)=>{const c=
t.SnapHelper.getTranslationVector(b,a);return{referenceSegment:b,subjectSegment:a,translationVector:c}}).filter((a)=>null!=a.translationVector);return 0===c.length?null:c.reduce((a,b)=>a.translationVector.length()<b.translationVector.length()?a:b)}).filter((a)=>null!=a).sort((a,b)=>a.translationVector.length()-b.translationVector.length());const c=b[0];b=b.filter((a)=>.001>Math.abs(a.translationVector.getX()-c.translationVector.getX())&&.001>Math.abs(a.translationVector.getY()-c.translationVector.getY())).map((a)=>
({kind:h.SnapResultKind.Align,referenceSegment:a.referenceSegment,subjectSegment:{P:n.Geometry.fromPoint(a.subjectSegment.P).add(a.translationVector).toPoint(),Q:n.Geometry.fromPoint(a.subjectSegment.Q).add(a.translationVector).toPoint()},originalSubjectSegment:a.subjectSegment}));return{translationVector:c.translationVector,snapResults:b}}setRotationSnapAction(a,b,c,d){b=b.getEntitiesWithRotation(d);a!==h.ActionKind.Finish&&0<b.length&&(this.snapAction={subjectIds:[c],results:b.map((a)=>({kind:h.SnapResultKind.Highlight,
referenceId:a.id}))})}setUniverseLimitSnapActionOrLog(a,b){a!==h.ActionKind.Finish?this.snapAction={subjectIds:b,results:[{kind:h.SnapResultKind.UniverseLimit}]}:q.avro.Avro.createDefaultLogger().logTriggeredUniversalLimit({universal_limit_event:"INSERT_ERROR"})}filterByRotation(a,b){return a.filter((a)=>{const c=Math.PI/2;a=(a.layoutBox.withReferenceFrame(this.cameraAccess.getScreenLayoutBox().referenceFrame).rotationRad%c+c)%c;const e=(b%c+c)%c;return.01>Math.abs(a-e)||Math.abs(a-e)>c-.01})}filterByRotationLayoutBoxes(a,
b){return a.filter((a)=>{const c=Math.PI/2;a=(a.withReferenceFrame(this.cameraAccess.getScreenLayoutBox().referenceFrame).rotationRad%c+c)%c;const e=(b%c+c)%c;return.01>Math.abs(a-e)||Math.abs(a-e)>c-.01})}getReferenceSegmentsFromEditor(a){const b=[];a.forEach((a)=>{const c=a.layoutBox.withReferenceFrame(this.cameraAccess.getScreenLayoutBox().referenceFrame);a=(a.is(f.base.ObjectKind.text)?t.SegmentCalculator.getSegmentsForText(a,c):t.SegmentCalculator.getSegments(c)).filter((a)=>t.SnapHelper.isSegmentVisibleOnScreen(this.cameraAccess,
a));b.push(...a)});return b}getReferenceSegmentsFromLayoutBox(a){const b=[];a.forEach((a)=>{a=t.SegmentCalculator.getSegments(a.withReferenceFrame(this.cameraAccess.getScreenLayoutBox().referenceFrame)).filter((a)=>t.SnapHelper.isSegmentVisibleOnScreen(this.cameraAccess,a));b.push(...a)});return b}filterObjectsForSizeSnap(a,b){const c=[f.base.ObjectKind.shape,f.base.ObjectKind.image,f.base.ObjectKind.pdf,f.base.ObjectKind.topic,f.base.ObjectKind.chart,f.base.ObjectKind.slide,f.base.ObjectKind.swf,
f.base.ObjectKind.text].find((b)=>a.is(b));return null!=c?b.filter((a)=>a.is(c)):[]}getSiblingsForIntention(a,b,c){return(new E.SnapFilter(this.cameraAccess,a,this.coverEditApi)).calculateReferenceEditors(b,c)}getSiblingsRotationsWithMirroredAngles(a,b){a=this.getSiblingsForIntention(a,b,E.SnapIntentionKind.generalEntitySnap);const c=new F.RotationSnapInfo;a.forEach((a)=>{c.add(a.rotationRad,a.ref);c.add(-a.rotationRad,a.ref);c.add(a.rotationRad-Math.PI,a.ref);c.add(-a.rotationRad+Math.PI,a.ref)});
return c}getArcSnapInfos(a,b){return this.getSiblingsForIntention(a,b,E.SnapIntentionKind.generalEntitySnap).filter(Lb(f.base.ObjectKind.arc)).map((a)=>({start:a.start,end:a.end,ref:a.ref,length:a.layoutBox.size.width}))}getSizeSnapScale(a,b,c){if(1===b.originalEditorIds.length){const d=a.lookup.transformedObject(b.originalEditorIds[0]);if(d.is(f.base.ObjectKind.text)&&b.resizeAnchor!==N.centerLeft&&b.resizeAnchor!==N.centerRight){if(d.getFontSizes().every((a,b,c)=>a===c[0]))return this.calculateFontSizeSnapScale(a,
b,c,d)}else{const e=()=>{const b=this.getSiblingsForIntention(a,[d.id],E.SnapIntentionKind.generalEntitySnap);return this.filterObjectsForSizeSnap(d,b)},g=c.withReferenceFrame(this.cameraAccess.getScreenLayoutBox().referenceFrame);if(b.resizeAnchor===N.centerLeft||b.resizeAnchor===N.centerRight)return this.calculateObjectSizeSnapScale(b,e,(a)=>Math.abs(a.size.width/g.size.width-1)<=this.OBJECT_SIZE_DIFF_TOLERANCE,(a)=>a.size.width-g.size.width,(a)=>a.size.width/g.size.width);if(b.resizeAnchor===N.topCenter||
b.resizeAnchor===N.bottomCenter)return this.calculateObjectSizeSnapScale(b,e,(a)=>Math.abs(a.size.height/g.size.height-1)<=this.OBJECT_SIZE_DIFF_TOLERANCE,(a)=>a.size.height-g.size.height,(a)=>a.size.height/g.size.height);if(b.resizeAnchor===N.bottomLeft||b.resizeAnchor===N.bottomRight||b.resizeAnchor===N.topLeft||b.resizeAnchor===N.topRight)return this.calculateObjectSizeSnapScale(b,e,Nb((a)=>Math.abs(a.size.width/g.size.width-1)<=this.OBJECT_SIZE_DIFF_TOLERANCE,(a)=>Math.abs(a.size.height/g.size.height-
1)<=this.OBJECT_SIZE_DIFF_TOLERANCE),(a)=>Math.min(a.size.width-g.size.width,a.size.height-g.size.height),(a)=>Math.abs(a.size.width/g.size.width-1)<=this.OBJECT_SIZE_DIFF_TOLERANCE?a.size.width/g.size.width:a.size.height/g.size.height)}}return 1}calculateFontSizeSnapScale(a,b,c,d){if(null==b.fontSnapInfos){var e=this.getSiblingsForIntention(a,[d.id],E.SnapIntentionKind.fontSizeSnap);a=[];for(const b of e)e=b,a.push({ref:e.ref,fontSizesInScreen:e.getFontSizes().map((a)=>t.SnapHelper.calculateFontSizeInScreen(this.cameraAccess,
b.layoutBox,a))});b.fontSnapInfos=a}if(0===b.fontSnapInfos.length)return 1;d.fitInto(c);const g=t.SnapHelper.calculateFontSizeInScreen(this.cameraAccess,d.layoutBox,d.getFontSizes()[0]);let f=[];for(const a of b.fontSnapInfos)a.fontSizesInScreen.forEach((b)=>{Math.abs(b/g-1)<=this.OBJECT_SIZE_DIFF_TOLERANCE&&f.push({id:a.ref.id,fontSize:b})});if(0===f.length)return 1;b.kind!==h.ActionKind.Finish&&(this.snapAction={subjectIds:[d.id],results:f.map(({id:a})=>({kind:h.SnapResultKind.Highlight,referenceId:a}))});
return f[0].fontSize/g}calculateObjectSizeSnapScale(a,b,c,d,e){null==a.resizeSnapInfos&&(a.resizeSnapInfos=b().map((a)=>({ref:a.ref,layoutBoxInScreen:a.layoutBox.withReferenceFrame(this.cameraAccess.getScreenLayoutBox().referenceFrame)})));b=a.resizeSnapInfos;if(0===b.length)return 1;b=b.filter((a)=>c(a.layoutBoxInScreen)).sort((a,b)=>Math.abs(d(a.layoutBoxInScreen))-Math.abs(d(b.layoutBoxInScreen)));if(0===b.length)return 1;const g=b[0];b=b.filter((a)=>.001>Math.abs(d(a.layoutBoxInScreen)-d(g.layoutBoxInScreen)));
a.kind!==h.ActionKind.Finish&&(this.snapAction={subjectIds:a.originalEditorIds,results:b.map((a)=>({kind:h.SnapResultKind.Highlight,referenceId:a.ref.id}))});return e(g.layoutBoxInScreen)}};F.UniverseLimitHelper=class{constructor(a){this.cameraAccess=a}getScaleToLimit(a,b,c){var d=a.originalEditorIds.map((a)=>b.toDecorator(b.lookup.transformedObject(a)));if("coTransformedEditorIds"in a&&null!=a.coTransformedEditorIds&&(d[0].kind===f.base.ObjectKind.planetTopic||d[0].kind===f.base.ObjectKind.stackTopic))return this.getDraggedZoomAreaScaleToLimit(b,
d[0],a.coTransformedEditorIds,a.resizeAnchor,c);const e=this.cameraAccess.getWorldReferenceFrame(),g=1===d.length?d[0].layoutBox:d.map((a)=>a.selectionBox.aabb).reduce((a,b)=>a.union(b)),k=0===a.resizeAnchor.rx?g.withReferenceFrame(e).size.height/c.withReferenceFrame(e).size.height:g.withReferenceFrame(e).size.width/c.withReferenceFrame(e).size.width;c=u.Utils.flatten(d.map((a)=>this.getAllTopicChildren(a)));d=d.map((b)=>this.getScaleBasedOnEditorKind(b,a.resizeAnchor)*k);c=c.map((b)=>this.getScaleBasedOnEditorKind(b,
a.resizeAnchor));return Math.max(...d,...c)}getScaleBasedOnEditorKind(a,b){return a.kind===f.base.ObjectKind.arc?this.getScaleArcLayoutboxToLimit(a.layoutBox):a.kind===f.base.ObjectKind.planetTopic||a.kind===f.base.ObjectKind.stackTopic?Math.max(this.getScaleLayoutboxToLimit(a.layoutBox,b),this.getScaleLayoutboxToLimit(a.zoomLayoutBox,b)*F.UniverseLimitHelper.SCALE_TO_CAMERA_ZOOM_IN_LIMIT):this.getScaleLayoutboxToLimit(a.layoutBox,b)}getDraggedZoomAreaScaleToLimit(a,b,c,d,e){b=b.zoomLayoutBox;const g=
this.cameraAccess.getWorldReferenceFrame(),f=0===d.rx?b.withReferenceFrame(g).size.height/e.withReferenceFrame(g).size.height:b.withReferenceFrame(g).size.width/e.withReferenceFrame(g).size.width;c=c.map((b)=>a.lookup.simpleObject(b));e=this.getScaleLayoutboxToLimit(e,d)*F.UniverseLimitHelper.SCALE_TO_CAMERA_ZOOM_IN_LIMIT;c=c.map((a)=>this.getScaleBasedOnEditorKind(a,d)*f);return Math.max(e,...c)}getAllTopicChildren(a){return a.kind===f.base.ObjectKind.stackTopic?[...a.simpleChildren(f.base.ChildVisibilityKind.all),
...u.Utils.flatten(a.pageChildren.map((a)=>a.simpleChildren(f.base.ChildVisibilityKind.all)))]:a.kind===f.base.ObjectKind.planetTopic?[...a.simpleChildren(f.base.ChildVisibilityKind.all),...a.topicChildren,...u.Utils.flatten(a.topicChildren.map((a)=>this.getAllTopicChildren(a)))]:[]}getScaleLayoutboxToLimit(a,b){const {x:c,y:d,width:e,height:g}=this.getLayoutBoxPositionAndSizeInWorld(a);return this.roundToTenthousandth(Math.max(Math.abs(c),Math.abs(d))/Math.min(...0===b.rx?[g]:0===b.ry?[e]:[g,e])/
1E3)}getScaleArcLayoutboxToLimit(a){const {x:b,y:c,width:d}=this.getLayoutBoxPositionAndSizeInWorld(a);return this.roundToTenthousandth(Math.max(Math.abs(b),Math.abs(c))/d/1E3)}getScaleArcToLimit(a,b){return this.roundToTenthousandth(Math.max(Math.abs(a.x),Math.abs(a.y))/b/1E3)}getLayoutBoxPositionAndSizeInWorld(a){const b=this.cameraAccess.getWorldReferenceFrame();a=a.withReferenceFrame(b);return{x:a.center.x,y:a.center.y,width:a.size.width,height:a.size.height}}roundToTenthousandth(a){return 1E-4*
Math.round(a/1E-4)}};F.UniverseLimitHelper.SCALE_TO_CAMERA_ZOOM_IN_LIMIT=10;var Wa={};Object.defineProperty(Wa,"__esModule",{value:!0});var O=f.base.ObjectKind,Ob=f.basePlugin.EditorsUnderPointStrategy;Wa.DragArcCommander=class{constructor(a,b){this.cameraAccess=a;this.logger=q.LoggerModule.getLoggerManager().createLogger("DragArcCommander");this.logHelper=aa.AppUtilsModule.getLogHelperUtils();this.snapHelper=new F.Snapper(a,b)}do(a,b,c){c=this.updateState(b,c);b=null;const d=a.lookup.arc(c.entityId);
if(null!=d&&c.currentActionKind!==h.ActionKind.Finish){const e=d.connectorStart,g=d.connectorEnd;b=this.move(a,d,c);e!==d.connectorStart&&this.connectorAction(d,!0,e,d.connectorStart);g!==d.connectorEnd&&this.connectorAction(d,!1,g,d.connectorEnd)}c.currentActionKind===h.ActionKind.Finish&&(0===c.arcAnchor.rx?q.avro.Avro.createDefaultLogger().logModifiedObject({object_type:d,modify_action:"BEND",topic_relationship:d,object_id:d.id}):q.avro.Avro.createDefaultLogger().logModifiedObject({object_type:d,
modify_action:"RESIZE",topic_relationship:d,object_id:d.id}));this.snapHelper.applySnapDecorator(a);return{state:c,snapDestinationId:b}}connectorAction(a,b,c,d){c=null==c?"":c.id;d=null==d?"":d.id;c=null!=d?d:null!=c?c:"";this.logger.info({action:null!=d?"connect":"disconnect",object:q.LoggerModule.getAvroLoggerHelper().getLogObjectType(a),trigger:"control_point",payload:{head_connect_id:b?c:"",tail_connect_id:b?"":c}})}updateState(a,b){switch(a.kind){case h.ActionKind.Start:return b=this.cameraAccess.getScreenLayoutBox().referenceFrame,
{_DragArcState_:void 0,currentActionKind:a.kind,entityId:a.target.entityId,dragStartStagePosition:b.point(a.originalMouseStagePosition),mouseStagePosition:b.point(a.mouseStagePosition),snapEnabled:!1,arcAnchor:a.dragArcAnchor,lineBendLogger:this.logHelper.createLineBendLogger(this.logger),lineResizeLogger:this.logHelper.createLineResizeLogger(this.logger),rotationSnapInfo:null,arcSnapInfos:null};case h.ActionKind.Step:return Object.assign(Object.assign({},b),{currentActionKind:a.kind,mouseStagePosition:this.cameraAccess.getScreenLayoutBox().referenceFrame.point(a.stagePosition),
snapEnabled:!a.isSnapDisableKeyPressed});case h.ActionKind.Finish:return Object.assign(Object.assign({},b),{currentActionKind:a.kind});default:throw u.Utils.assertNever(a);}}move(a,b,c){var d=n.Geometry.distance(b.start,b.end),e=b.rotationRad,g=b.arcHeight;if(0===c.arcAnchor.rx&&0===c.arcAnchor.ry)return d=b.parent.zoomLayoutBox.rotateRad(b.rotationRad).asReferenceFrame,e=b.layoutBox.referenceFrame.point(b.middle).withReferenceFrame(d),d=c.mouseStagePosition.withReferenceFrame(d).y-e.y,b.arcHeight+=
d,c.lineBendLogger.add([{action:"modify",object:q.LoggerModule.getAvroLoggerHelper().getLogObjectType(b),trigger:"control_point",payload:{old_arc_height:g,new_arc_height:b.arcHeight,active_container:"overview",object_id:b.id,multiselect_id:q.LoggerModule.getLoggerManager().generateUniqueId(),prezi_mode:"editor",modified_value:"bend",is_smart_structure:!1,is_topic_customization:b.parent.is(O.visual)||b.parent.is(O.cover)}}]),null;{g=-1===c.arcAnchor.rx;const f=c.mouseStagePosition.withReferenceFrame(b.layoutBox.referenceFrame);
let h=null;if(c.snapEnabled){const d=this.getSnapToCandidate(a,b,c);null!=d?(g?b.connectorStart=d:b.connectorEnd=d,h=d.id):(a=this.snapHelper.calculateArcSnap(a,b,f,g,c),g?b.start=a:b.end=a)}else g?b.start=f:b.end=f;c.lineResizeLogger.add([{action:"modify",object:q.LoggerModule.getAvroLoggerHelper().getLogObjectType(b),trigger:"control_point",payload:{old_size:d,new_size:n.Geometry.distance(b.start,b.end),old_rotation:e,new_rotation:b.rotationRad,active_container:"overview",object_id:b.id,multiselect_id:q.LoggerModule.getLoggerManager().generateUniqueId(),
prezi_mode:"editor",modified_value:"resize",is_smart_structure:!1,is_topic_customization:b.parent.is(O.visual)||b.parent.is(O.cover)}}]);return h}}getSnapToCandidate(a,b,c){a=a.editorsUnderPoint(c.mouseStagePosition,[Ob.ifCloseToBorder]).map((a)=>{if(!a.is(O.simpleObject)||a.is(O.arc)||b.connectorEnd===a&&-1===c.arcAnchor.rx||b.connectorStart===a&&1===c.arcAnchor.rx)return null;if(a.parent===b.parent)return a;if(a.parent.is(O.cover)||a.parent.is(O.visual))if(b.parent.is(O.cover)||b.parent.is(O.visual)){if(a.parent.parent===
b.parent.parent)return a}else if(a.parent.parent===b.parent||a.parent.parent.parent===b.parent)return a;return null}).filter((a)=>null!=a);return 0<a.length?a.reduce((a,b)=>a.isAbove(b)?a:b):null}};var T={};Object.defineProperty(T,"__esModule",{value:!0});T.SingleTextDragGroupImpl=class{constructor(a){this.originalDragLayoutBox=a.layoutBox;this.editorId=a.id}getOriginalDragLayoutBoxForEditor(a){return a.id===this.editorId?this.originalDragLayoutBox:null}fitSelectionBoxInto(a,b){a=a.lookup.text(this.editorId);
null!=a&&a.is(f.base.ObjectKind.text)&&a.fitInto(b)}};T.BaseDragCommander=class{constructor(a){this.cameraAccess=a}getEditors(a,b){return b.map((b)=>{b=a.lookup.transformedObject(b);return a.toDecorator(b)}).filter((a)=>null!=a)}createBaseDragState(a,b,c){const d=this.getEditors(a,b.target.entityIds),e=this.getEditors(a,b.entitiesToTransformInSync),g=1===d.length&&d[0].is(f.base.ObjectKind.text);return{baseState:{kind:b.kind,originalZoomLayoutBox:0<d.length?d[0].parent.zoomLayoutBox:null,originalEditorIds:d.map((a)=>
a.id),movedInSyncEditorIds:e.map((a)=>a.id),mouseStagePosition:c.point(b.mouseStagePosition),snapEnabled:!1,referenceSegments:null,dragGroup:g?new T.SingleTextDragGroupImpl(a.toDecorator(d[0])):a.createDragGroup(d,e),logInfos:d.map((a)=>{const b=a.layoutBox,c=b.center;return{editorId:a.id,old_x:c.x,old_y:c.y,old_rotation:b.rotationRad,old_scale:b.size.width}})},editors:d}}};var ua={};Object.defineProperty(ua,"__esModule",{value:!0});var va=f.base.ObjectKind;ua.DragMoveCommander=class extends T.BaseDragCommander{constructor(a,
b,c,d){super(a);this.layoutCommander=b;this.positionFinder=c;this.coverEditApi=d;this.logger=q.LoggerModule.getLoggerManager().createLogger("DragMoveCommander");this.logHelper=aa.AppUtilsModule.getLogHelperUtils();this.snapHelper=new F.Snapper(a,d)}dragMove(a,b,c,d=!1){c=this.updateDragMoveState(a,b,c);this.snapHelper.setNoSnapAsDefault(c.originalEditorIds);this.dragMoveWithState(a,c,b.kind===h.ActionKind.Finish||d);this.snapHelper.applySnapDecorator(a);c.kind===h.ActionKind.Finish&&this.logMoveFinish(a,
c);return{dragState:c}}dragMoveWithState(a,b,c){const d=this.calculateMove(a,b);b.dragGroup.fitSelectionBoxInto(a,d,c)}logMoveFinish(a,b){const c=q.LoggerModule.getLoggerManager().generateUniqueId();b.logInfos.forEach((b)=>{const d=a.lookup.transformedObject(b.editorId);this.logger.info({action:"modify",object:q.LoggerModule.getAvroLoggerHelper().getLogObjectType(d),trigger:"drag",payload:{object_id:d.id,active_container:"overview",multiselect_id:c,old_x:b.old_x,old_y:b.old_y,new_x:d.layoutBox.center.x,
new_y:d.layoutBox.center.y,prezi_mode:"editor",modified_value:"position",is_smart_structure:!1,is_topic_customization:d.parent.is(va.visual)||d.parent.is(va.cover)}});q.avro.Avro.createDefaultLogger().logDragObject({object_type:d,topic_relationship:d,object_id:d.id})})}calculateMove(a,b){var c=a.lookup.transformedObject(b.originalEditorIds[0]).parent.referenceFrame,d=b.dragGroup.originalDragLayoutBox;c=c.layoutBox(d.center,d.size).rotateRad(d.rotationRad);var e=c.referenceFrame;d=b.mouseStagePosition.withReferenceFrame(e);
e=b.moveStartStagePosition.withReferenceFrame(e);d=n.Geometry.fromPoint(d).sub(n.Geometry.fromPoint(e)).toPoint();c=c.translate(d);return this.snapHelper.calculateMoveSnap(a,b,c,E.SnapIntentionKind.generalEntitySnap)}updateDragMoveState(a,b,c){switch(b.kind){case h.ActionKind.Start:c=this.cameraAccess.getScreenLayoutBox().referenceFrame;var d=!1;if(0<b.target.entityIds.length){const c=a.lookup.base(b.target.entityIds[0]);c.is(va.transformedObject)&&(d=c.parent,d=d.is(va.planetTopic)&&d.layout.isValid())}return Object.assign(Object.assign({_DragMoveState_:void 0},
this.createBaseDragState(a,b,c).baseState),{moveStartStagePosition:c.point(b.originalMouseStagePosition),isParentLayouted:d,proximitySnapParent:null});case h.ActionKind.Step:return a=this.cameraAccess.getScreenLayoutBox().referenceFrame,c=Object.assign(Object.assign({},c),{kind:b.kind,snapEnabled:!b.isSnapDisableKeyPressed,mouseStagePosition:a.point(b.stagePosition),moveStartStagePosition:a.point(c.moveStartStagePosition)});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});
default:throw u.Utils.assertNever(b);}}};var U={};Object.defineProperty(U,"__esModule",{value:!0});var ha=f.base.AnchorPoint,L=f.base.ObjectKind;U.DragNonProportionalResizeCommander=class{constructor(a,b){this.cameraAccess=a;this.logger=q.LoggerModule.getLoggerManager().createLogger("DragNonProportionalResizeCommander");this.logHelper=aa.AppUtilsModule.getLogHelperUtils();this.snapHelper=new F.Snapper(a,b)}do(a,b,c){c=this.updateState(a,b,c);this.snapHelper.setNoSnapAsDefault(c.originalEditorIds);
b=a.toDecorator(a.lookup.transformedObject(c.originalEditorIds[0]));if(null!=b)if(c.kind!==h.ActionKind.Finish){let k=b.position,h=0===c.resizeAnchor.ry;if(b.is(L.text)&&c.original.kind===L.text){var d=this.calculateLayoutBox(a,b,c);var e=c.original.wrapWidth+d.size.width-c.original.selectionBox.size.width;d=b.wrapWidth;if(e>=b.minWrapWidth)var g=b.wrapWidth=e;e=U.DragNonProportionalResizeCommander.getFixPoint(c.resizeAnchor,c.isCenterResize,!0);b.fitSelectionBoxInto(b.selectionBox.move(e,c.original.selectionBox.point(e)))}else if(b.is(L.shape)||
b.is(L.zoomArea)){g=b.is(L.shape)&&null!=b.border.thickness?b.border.thickness:0;const k=this.calculateLayoutBox(a,b,c,g+.1);e=k.size.width-g;var f=k.size.height-g;d=h?b.width:b.height;g=h?e:f;b.width=e;b.height=f;b.fitInto(b.layoutBox.move(b.layoutBox.center,k.center))}e=b.position;c.heightWidthResizeLogger.add([{action:h?"modify_width":"modify_height",object:q.LoggerModule.getAvroLoggerHelper().getLogObjectType(b),trigger:"control_point",payload:{old_value:d,new_value:g,old_x:k.x,new_x:e.x,old_y:k.y,
new_y:e.y,active_container:"overview",object_id:b.id,multiselect_id:q.LoggerModule.getLoggerManager().generateUniqueId(),prezi_mode:"editor",modified_value:h?"width":"height",version:h&&b.is(L.text)?1:0,is_topic_customization:b.parent.is(L.visual)||b.parent.is(L.cover)}}])}else c.heightWidthResizeLogger.commit(),q.avro.Avro.createDefaultLogger().logModifiedObject({object_type:b,modify_action:"RESIZE",topic_relationship:b,object_id:b.id});this.snapHelper.applySnapDecorator(a);return{state:c}}updateState(a,
b,c){switch(b.kind){case h.ActionKind.Start:a=a.toDecorator(a.lookup.transformedObject(b.target.entityId));c=this.cameraAccess.getScreenLayoutBox().referenceFrame;var d=a.layoutBox.asReferenceFrame,e=c.point(b.originalMouseStagePosition).withReferenceFrame(d);c=a.selectionBox;d=c.withReferenceFrame(d);d=b.isWidthResize?n.Geometry.distance(d.centerLeft,e)<n.Geometry.distance(d.centerRight,e)?ha.centerLeft:ha.centerRight:n.Geometry.distance(d.topCenter,e)<n.Geometry.distance(d.bottomCenter,e)?ha.topCenter:
ha.bottomCenter;c=a.is(L.text)?{kind:L.text,wrapWidth:0===a.wrapWidth?a.textBox.size.width:a.wrapWidth,selectionBox:c}:{kind:L.shape,selectionBox:c};e=this.cameraAccess.getScreenLayoutBox().referenceFrame;return{_NonProportionalResizeState_:void 0,kind:b.kind,stagePosition:e.point(b.mouseStagePosition),resizeAnchor:d,resizeStartStagePosition:e.point(b.originalMouseStagePosition),isCenterResize:b.isCenterResize,original:c,heightWidthResizeLogger:q.LoggerModule.createBatchActionLogger(this.logger,(a,
b)=>{const c=a.payload;b=b.payload;return{action:a.action,object:a.object,trigger:a.trigger,payload:{old_value:c.old_value,new_value:b.new_value,old_x:c.old_x,new_x:b.new_x,old_y:c.old_y,new_y:b.new_y,active_container:c.active_container,object_id:c.object_id,multiselect_id:c.multiselect_id,prezi_mode:c.prezi_mode,modified_value:c.modified_value,version:c.version}}}),snapEnabled:!0,referenceSegments:null,resizeSnapInfos:null,originalEditorIds:[a.id]};case h.ActionKind.Step:return Object.assign(Object.assign({},
c),{kind:b.kind,stagePosition:this.cameraAccess.getScreenLayoutBox().referenceFrame.point(b.stagePosition),isCenterResize:b.isCenterResizeKeyPressed,snapEnabled:!b.isSnapDisableKeyPressed});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});default:throw u.Utils.assertNever(b);}}calculateLayoutBox(a,b,c,d=0){const e=this.cameraAccess.getScreenLayoutBox().referenceFrame,g=b.layoutBox.asReferenceFrame;var f=c.original.selectionBox.withReferenceFrame(g),h=c.stagePosition.withReferenceFrame(g);
const l=c.resizeStartStagePosition.withReferenceFrame(g),m=U.DragNonProportionalResizeCommander.getFixPoint(c.resizeAnchor,c.isCenterResize);h={width:f.size.width+(h.x-l.x)*c.resizeAnchor.rx*(c.isCenterResize?2:1),height:f.size.height+(h.y-l.y)*c.resizeAnchor.ry*(c.isCenterResize?2:1)};d=Math.max(U.DragNonProportionalResizeCommander.calculateDistance(U.DragNonProportionalResizeCommander.MINIMUM_SHAPE_SIZE,e,g),d);h.width<d&&(h.width=d);h.height<d&&(h.height=d);b=d/b.layoutBox.withReferenceFrame(g).size.width;
f=f.withSize(h).move(m,f.point(m));return this.snapHelper.calculateResizeSnap(a,c,f.withReferenceFrame(c.original.selectionBox.referenceFrame),c.original.selectionBox,b,E.SnapIntentionKind.generalEntitySnap)}static getFixPoint(a,b,c=!1){return b?ha.center:c?{rx:-a.rx,ry:-1}:{rx:-a.rx,ry:-a.ry}}static calculateDistance(a,b,c){const d=b.point({x:0,y:0});a=b.point({x:a,y:0});return n.Geometry.distance(d.withReferenceFrame(c),a.withReferenceFrame(c))}};U.DragNonProportionalResizeCommander.MINIMUM_SHAPE_SIZE=
10;var ia={};Object.defineProperty(ia,"__esModule",{value:!0});var Xa=f.base.AnchorPoint,ub=f.base.ObjectKind;class ja extends T.BaseDragCommander{constructor(a,b){super(a);this.logger=q.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.ResizeCommander");this.snapHelper=new F.Snapper(a,b)}doCommon(a,b){this.snapHelper.setNoSnapAsDefault(b.originalEditorIds);const c=this.calculateResize(a,b);b.dragGroup.fitSelectionBoxInto(a,c,b.kind===h.ActionKind.Finish);b.kind===h.ActionKind.Finish&&
this.logResizeFinish(a,b);this.snapHelper.applySnapDecorator(a)}updateState(a,b,c){switch(b.kind){case h.ActionKind.Start:c=this.cameraAccess.getScreenLayoutBox().referenceFrame;var {baseState:a}=this.createBaseDragState(a,b,c);return Object.assign(Object.assign({},a),{resizeAnchor:b.resizeAnchor,resizeStartStagePosition:c.point(b.originalMouseStagePosition),isCenterResize:b.isCenterResize,resizeSnapInfos:null});case h.ActionKind.Step:return Object.assign(Object.assign({},c),{kind:b.kind,mouseStagePosition:this.cameraAccess.getScreenLayoutBox().referenceFrame.point(b.stagePosition),
isCenterResize:b.isCenterResizeKeyPressed,snapEnabled:!b.isSnapDisableKeyPressed});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});default:throw u.Utils.assertNever(b);}}getFixPoint(a,b){return b?Xa.center:{rx:-a.rx,ry:-a.ry}}logResizeFinish(a,b){const c=q.LoggerModule.getLoggerManager().generateUniqueId();b.logInfos.forEach((b)=>{const d=a.lookup.transformedObject(b.editorId);this.logger.info({action:"modify",object:q.LoggerModule.getAvroLoggerHelper().getLogObjectType(d),
trigger:"control_point",payload:{old_scale:b.old_scale,new_scale:d.layoutBox.size.width,old_x:b.old_x,new_x:d.layoutBox.center.x,old_y:b.old_y,new_y:d.layoutBox.center.y,active_container:"overview",object_id:d.id,multiselect_id:c,prezi_mode:"editor",modified_value:"scale",is_topic_customization:d.parent.is(ub.visual)||d.parent.is(ub.cover)}});q.avro.Avro.createDefaultLogger().logModifiedObject({object_type:d,modify_action:"RESIZE",topic_relationship:d,object_id:d.id})})}}ja.MIN_SIZE_IN_SCREEN=10;
ia.DragResizeSingleTextCommander=class extends ja{constructor(a,b){super(a,b)}do(a,b,c){c=this.updateState(a,b,c);this.doCommon(a,c);return{resizeState:c}}updateState(a,b,c){if(b.kind===h.ActionKind.Start){const d=a.lookup.text(b.target.entityIds[0]);return Object.assign(Object.assign({_ResizeSingleTextState_:void 0,originalSelectionBox:a.toDecorator(d).selectionBox},super.updateState(a,b,c)),{fontSnapInfos:null})}return Object.assign(Object.assign({},c),super.updateState(a,b,c))}calculateResize(a,
b){var c=this.cameraAccess.getScreenLayoutBox().referenceFrame,d=b.originalSelectionBox,e=d.asReferenceFrame,g=b.mouseStagePosition.withReferenceFrame(e);const f=b.resizeStartStagePosition.withReferenceFrame(e);var h=d.point(b.resizeAnchor).withReferenceFrame(e);const l=d.point(Xa.center).withReferenceFrame(e);g=n.Geometry.fromCoordinates(l.x-h.x,l.y-h.y).normalize().dot(n.Geometry.fromCoordinates(f.x-g.x,f.y-g.y));h=n.Geometry.distance(l,h);b.isCenterResize||(g/=2);c=n.Geometry.distance(c.point({x:0,
y:0}).withReferenceFrame(e),c.point({x:0,y:ja.MIN_SIZE_IN_SCREEN}).withReferenceFrame(e))/b.dragGroup.originalDragLayoutBox.withReferenceFrame(e).size.width;e=Math.max(c,(h+g)/h);h=this.getFixPoint(b.resizeAnchor,b.isCenterResize);e=d.scale(e).move(h,d.point(h));d=b.dragGroup.originalDragLayoutBox.align(d.topLeft,d.topRight,e.topLeft,e.topRight);return this.snapHelper.calculateTextResizeSnap(a,b,d,e,c,E.SnapIntentionKind.generalEntitySnap)}};ia.DragResizeCommander=class extends ja{constructor(a,b){super(a,
b)}do(a,b,c){c=this.updateState(a,b,c);this.doCommon(a,c);return{resizeState:c}}updateState(a,b,c){a=super.updateState(a,b,c);return Object.assign({_ResizeState_:void 0},a)}calculateResize(a,b){var c=this.cameraAccess.getScreenLayoutBox().referenceFrame,d=b.dragGroup.originalDragLayoutBox.asReferenceFrame,e=b.mouseStagePosition.withReferenceFrame(d);const g=b.resizeStartStagePosition.withReferenceFrame(d);var f=b.dragGroup.originalDragLayoutBox.point(b.resizeAnchor).withReferenceFrame(d);const h=
b.dragGroup.originalDragLayoutBox.point(Xa.center).withReferenceFrame(d);e=n.Geometry.fromCoordinates(h.x-f.x,h.y-f.y).normalize().dot(n.Geometry.fromCoordinates(g.x-e.x,g.y-e.y));f=n.Geometry.distance(h,f);b.isCenterResize||(e/=2);c=n.Geometry.distance(c.point({x:0,y:0}).withReferenceFrame(d),c.point({x:0,y:ja.MIN_SIZE_IN_SCREEN}).withReferenceFrame(d))/b.dragGroup.originalDragLayoutBox.withReferenceFrame(d).size.width;d=Math.max(c,(f+e)/f);f=this.getFixPoint(b.resizeAnchor,b.isCenterResize);d=b.dragGroup.originalDragLayoutBox.scale(d).move(f,
b.dragGroup.originalDragLayoutBox.point(f));return this.snapHelper.calculateResizeSnap(a,b,d,b.dragGroup.originalDragLayoutBox,c,E.SnapIntentionKind.generalEntitySnap)}};var wa={};Object.defineProperty(wa,"__esModule",{value:!0});var Pb=f.base.AnchorPoint,vb=f.base.ObjectKind;wa.DragRotateCommander=class extends T.BaseDragCommander{constructor(a,b){super(a);this.logger=q.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.RotateCommander");this.logHelper=aa.AppUtilsModule.getLogHelperUtils();
this.snapHelper=new F.Snapper(a,b)}do(a,b,c){c=this.updateState(a,b,c);const d=this.calculateRotate(a,c);c.dragGroup.fitSelectionBoxInto(a,d,c.kind===h.ActionKind.Finish);c.kind===h.ActionKind.Finish&&this.logRotateFinish(a,c);this.snapHelper.applySnapDecorator(a);1<c.originalEditorIds.length&&(b.kind!==h.ActionKind.Finish?a.documentDecorator.set(z.EditorCommanderInternal.getMultiselectDecoratorComponentKey(),d):a.documentDecorator.discardOwnComponent(z.EditorCommanderInternal.getMultiselectDecoratorComponentKey()));
return{rotateState:c}}updateState(a,b,c){switch(b.kind){case h.ActionKind.Start:c=this.cameraAccess.getScreenLayoutBox().referenceFrame;var {baseState:a}=this.createBaseDragState(a,b,c);return Object.assign(Object.assign({},a),{_RotateState_:void 0,rotateStartStagePosition:c.point(b.originalMouseStagePosition),snapEnabled:!1,rotationSnapInfo:null});case h.ActionKind.Step:return Object.assign(Object.assign({},c),{kind:b.kind,mouseStagePosition:this.cameraAccess.getScreenLayoutBox().referenceFrame.point(b.stagePosition),
snapEnabled:!b.isSnapDisableKeyPressed});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});default:throw u.Utils.assertNever(b);}}calcRotationDelta(a){const b=a.dragGroup.originalDragLayoutBox.asReferenceFrame,c=a.mouseStagePosition.withReferenceFrame(b),d=a.rotateStartStagePosition.withReferenceFrame(b);a=a.dragGroup.originalDragLayoutBox.point(Pb.center).withReferenceFrame(b);return wa.DragRotateCommander.calcRad(c,d,a)}calculateRotate(a,b){const c=this.calcRotationDelta(b),
d=b.dragGroup.originalDragLayoutBox.rotateRad(c);return this.snapHelper.calculateRotateSnap(a,b,d,b.dragGroup.originalDragLayoutBox,c)}logRotateFinish(a,b){const c=q.LoggerModule.getLoggerManager().generateUniqueId();b.logInfos.forEach((b)=>{const d=a.lookup.transformedObject(b.editorId);this.logger.info({action:"modify",object:q.LoggerModule.getAvroLoggerHelper().getLogObjectType(d),trigger:"control_point",payload:{old_rotation:b.old_rotation,new_rotation:d.layoutBox.rotationRad,old_x:b.old_x,old_y:b.old_y,
new_x:d.layoutBox.center.x,new_y:d.layoutBox.center.y,active_container:"overview",object_id:d.id,multiselect_id:c,prezi_mode:"editor",modified_value:"rotate",is_topic_customization:d.parent.is(vb.visual)||d.parent.is(vb.cover)}});q.avro.Avro.createDefaultLogger().logModifiedObject({object_type:d,modify_action:"ROTATE",topic_relationship:d,object_id:d.id})})}static calcRad(a,b,c){var d=n.Geometry.distance(a,b);const e=n.Geometry.distance(a,c),g=n.Geometry.distance(b,c);d=Math.acos((e*e+g*g-d*d)/(2*
e*g));c=n.Geometry.fromPoint(c);a=n.Geometry.fromPoint(a).sub(c);b=n.Geometry.fromPoint(b).sub(c);return 0<a.cross(b)?-d:d}};var G={};Object.defineProperty(G,"__esModule",{value:!0});var xa=f.base.ObjectKind;G.TopicZoomAreaInteraction=class{static calcBaseStartState(a,b,c){var d=c.lookup.transformedObject(a),e=c.toDecorator(d);d=e.cover.zoomLayoutBox;const g=b?G.TopicZoomAreaInteraction.getFirstLevelContent(e):[];e=this.getAllContent(e);return{kind:h.ActionKind.Start,coTransformedEditorIds:g,originalEditorIds:[a],
coTransformContent:b,coTransformContentAtStart:b,originalZoomLayout:d,dragGroup:0<e.length?c.createDragGroup(e,[]):null}}static getFirstLevelContent(a){return a.is(xa.planetTopic)?[...a.topicChildren.reduce((a,c)=>[...a,...c.simpleChildren(f.base.ChildVisibilityKind.outside)],[]),...a.contentChildren,...a.master.contentChildren].map((a)=>a.id):a.is(xa.stackTopic)?[...a.master.contentChildren,...0<a.pageChildren.length?a.pageChildren[0].contentChildren:[]].map((a)=>a.id):[]}static getAllContent(a){if(a.is(xa.planetTopic))return[...a.topicChildren,
...a.contentChildren,...a.master.contentChildren];if(a.is(xa.stackTopic)){const b=a.pageChildren.reduce((a,b)=>a.concat(b.contentChildren),[]);return[...a.master.contentChildren,...b]}return[]}static handleInteraction(a,b,c){b.kind===h.ActionKind.Start?G.TopicZoomAreaInteraction.start(b,c):b.kind===h.ActionKind.Step?G.TopicZoomAreaInteraction.step(a,b,c):b.kind===h.ActionKind.Finish&&G.TopicZoomAreaInteraction.finish(a,b,c)}static start(a,b){a.coTransformedEditorIds.map((c)=>b.toDecorator(b.lookup.transformedObject(c)).set(f.CetModelEditor.getShowContentKey(),
a.coTransformContentAtStart))}static step(a,b,c){G.TopicZoomAreaInteraction.move(a,b,c)}static finish(a,b,c){G.TopicZoomAreaInteraction.move(a,b,c);b.coTransformedEditorIds.map((a)=>c.toDecorator(c.lookup.transformedObject(a)).set(f.CetModelEditor.getShowContentKey(),!1))}static move(a,b,c){var d=c.lookup.transformedObject(b.originalEditorIds[0]);d=c.toDecorator(d);const e=b.originalZoomLayout.align(b.originalZoomLayout.topLeft,b.originalZoomLayout.topRight,a.topLeft,a.topRight);d.fitZoomAreaIntoLayoutBox(e);
null!=b.dragGroup&&b.dragGroup.fitSelectionBoxInto(c,b.coTransformContent?b.dragGroup.originalDragLayoutBox.align(b.originalZoomLayout.topLeft,b.originalZoomLayout.topRight,a.topLeft,a.topRight):b.dragGroup.originalDragLayoutBox,b.kind===h.ActionKind.Finish)}};var Ya={};Object.defineProperty(Ya,"__esModule",{value:!0});var wb=f.base.ObjectKind;Ya.DragTopicZoomAreaMoveCommander=class{constructor(a,b){this.cameraControl=a;this.coverEditApi=b;this.logger=q.LoggerModule.getLoggerManager().createLogger("DragTopicZoomAreaMoveCommander");
this.logHelper=aa.AppUtilsModule.getLogHelperUtils();this.snapHelper=new F.Snapper(a,b)}do(a,b,c){const d=this.cameraControl.getScreenLayoutBox();c=this.updateState(a,b,c);this.snapHelper.setNoSnapAsDefault(c.originalEditorIds);b=this.calculateMove(a,c);G.TopicZoomAreaInteraction.handleInteraction(b,c,a);c.kind===h.ActionKind.Finish&&this.logMoveFinish(a,c);this.snapHelper.applySnapDecorator(a);this.cameraControl.setScreenLayoutBox(d);return{dragTopicZoomAreaState:c}}logMoveFinish(a,b){const c=q.LoggerModule.getLoggerManager().generateUniqueId();
a=a.lookup.transformedObject(b.originalEditorIds[0]);this.logger.info({action:"modify",object:q.LoggerModule.getAvroLoggerHelper().getLogObjectType(a),trigger:"drag",payload:{object_id:a.id,active_container:"overview",multiselect_id:c,old_x:b.originalZoomLayout.center.x,old_y:b.originalZoomLayout.center.y,new_x:a.layoutBox.center.x,new_y:a.layoutBox.center.y,prezi_mode:"editor",modified_value:"position",is_smart_structure:!1,is_topic_customization:a.parent.is(wb.visual)||a.parent.is(wb.cover)}});
q.avro.Avro.createDefaultLogger().logDragObject({object_type:"TOPIC_ZOOM_AREA",topic_relationship:a,object_id:a.id})}updateState(a,b,c){switch(b.kind){case h.ActionKind.Start:return c=this.cameraControl.getScreenLayoutBox().referenceFrame,Object.assign(Object.assign({_DragTopicZoomAreaMoveState_:void 0},G.TopicZoomAreaInteraction.calcBaseStartState(b.target.entityId,b.coTransformContent,a)),{moveStartStagePosition:c.point(b.originalMouseStagePosition),stagePosition:c.point(b.mouseStagePosition),snapEnabled:!1,
referenceSegments:null});case h.ActionKind.Step:return a=this.cameraControl.getScreenLayoutBox().referenceFrame,c=Object.assign(Object.assign({},c),{kind:b.kind,snapEnabled:!b.isSnapDisableKeyPressed,stagePosition:a.point(b.stagePosition),coTransformContent:c.coTransformContentAtStart&&!b.isSnapDisableKeyPressed});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});default:throw u.Utils.assertNever(b);}}calculateMove(a,b){var c=this.cameraControl.getScreenLayoutBox().referenceFrame;
const d=b.originalZoomLayout.referenceFrame;var e=c.point(b.stagePosition).withReferenceFrame(d);c=c.point(b.moveStartStagePosition).withReferenceFrame(d);e=n.Geometry.fromPoint(e).sub(n.Geometry.fromPoint(c)).toPoint();e=b.originalZoomLayout.translate(e);return this.snapHelper.calculateMoveSnap(a,b,e,E.SnapIntentionKind.topicZoomAreaSnap)}};var ca={};Object.defineProperty(ca,"__esModule",{value:!0});var xb=f.base.AnchorPoint;ca.DragTopicZoomAreaResizeCommander=class{constructor(a,b){this.cameraControl=
a;this.snapHelper=new F.Snapper(a,b)}do(a,b,c){const d=this.cameraControl.getScreenLayoutBox();c=this.updateState(a,b,c);this.snapHelper.setNoSnapAsDefault(c.originalEditorIds);b=this.calculateResize(a,c);G.TopicZoomAreaInteraction.handleInteraction(b,c,a);this.snapHelper.applySnapDecorator(a);this.cameraControl.setScreenLayoutBox(d);return{resizeTopicZoomAreaState:c}}updateState(a,b,c){switch(b.kind){case h.ActionKind.Start:c=this.cameraControl.getScreenLayoutBox().referenceFrame;a=G.TopicZoomAreaInteraction.calcBaseStartState(b.target.entityId,
b.coTransformContent,a);const d=b.resizeAnchor;return Object.assign(Object.assign({_DragResizeTopicZoomAreaState_:void 0},a),{resizeAnchor:d,resizeStartStagePosition:c.point(b.originalMouseStagePosition),stagePosition:c.point(b.mouseStagePosition),isCenterResize:b.isCenterResize,snapEnabled:!1,referenceSegments:null,resizeSnapInfos:null});case h.ActionKind.Step:return Object.assign(Object.assign({},c),{kind:b.kind,stagePosition:this.cameraControl.getScreenLayoutBox().referenceFrame.point(b.stagePosition),
isCenterResize:b.isCenterResizeKeyPressed,snapEnabled:!b.isSnapDisableKeyPressed,coTransformContent:c.coTransformContentAtStart&&!b.isSnapDisableKeyPressed});case h.ActionKind.Finish:return q.avro.Avro.createDefaultLogger().logModifiedObject({object_type:"TOPIC_ZOOM_AREA",modify_action:"RESIZE",topic_relationship:"CONTENT",object_id:c.originalEditorIds[0]}),Object.assign(Object.assign({},c),{kind:b.kind});default:throw u.Utils.assertNever(b);}}calculateResize(a,b){var c=this.cameraControl.getScreenLayoutBox().referenceFrame,
d=b.originalZoomLayout.asReferenceFrame,e=b.stagePosition.withReferenceFrame(d);const g=b.resizeStartStagePosition.withReferenceFrame(d);var f=b.originalZoomLayout.point(b.resizeAnchor).withReferenceFrame(d);const h=b.originalZoomLayout.point(xb.center).withReferenceFrame(d);e=n.Geometry.fromCoordinates(h.x-f.x,h.y-f.y).normalize().dot(n.Geometry.fromCoordinates(g.x-e.x,g.y-e.y));f=n.Geometry.distance(h,f);b.isCenterResize||(e/=2);c=n.Geometry.distance(c.point({x:0,y:0}).withReferenceFrame(d),c.point({x:0,
y:ca.DragTopicZoomAreaResizeCommander.MIN_SIZE_IN_SCREEN}).withReferenceFrame(d))/b.originalZoomLayout.withReferenceFrame(d).size.width;d=Math.max(c,(f+e)/f);f=ca.DragTopicZoomAreaResizeCommander.getFixPoint(b.resizeAnchor,b.isCenterResize);d=b.originalZoomLayout.scale(d).move(f,b.originalZoomLayout.point(f));return this.snapHelper.calculateResizeSnap(a,b,d,b.originalZoomLayout,c,E.SnapIntentionKind.topicZoomAreaSnap)}static getFixPoint(a,b){return b?xb.center:{rx:-a.rx,ry:-a.ry}}};ca.DragTopicZoomAreaResizeCommander.MIN_SIZE_IN_SCREEN=
10;var ya={};Object.defineProperty(ya,"__esModule",{value:!0});ya.NudgeHelper=class{static calculateNudgeDelta(a,b){b=b?10:1;let c=0,d=0;switch(a){case h.NudgeDirection.Up:d=-b;break;case h.NudgeDirection.Down:d=b;break;case h.NudgeDirection.Left:c=-b;break;case h.NudgeDirection.Right:c=b}return{x:c,y:d}}};var Za={};Object.defineProperty(Za,"__esModule",{value:!0});var za=f.base.ObjectKind;Za.NudgeCommander=class{constructor(a){this.cameraAccess=a;this.logger=q.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.NudgeCommander")}do(a,
b,c){c=this.updateState(b,c,a);b=c.entityIds.map((b)=>a.lookup.transformedObject(b));if(c.kind!==h.ActionKind.Finish){var d=ya.NudgeHelper.calculateNudgeDelta(c.direction,c.isFast);const a=1===b.length?b[0]:b[0].createLayoutGroupWith(b.slice(1)),g=this.cameraAccess.getScreenLayoutBox();a.fitInto(a.layoutBox.withReferenceFrame(g.referenceFrame).translate(d));d=q.LoggerModule.getLoggerManager().generateUniqueId();this.logNudge(b,d)}return{nudgeState:c}}updateState(a,b,c){const d=(a.kind===h.ActionKind.Start?
a.target.entityIds:b.entityIds).filter((a)=>{a=c.lookup.object(a);return null!=a&&a.is(za.transformedObject)});switch(a.kind){case h.ActionKind.Start:return{_NudgeState_:void 0,kind:a.kind,entityIds:d,isFast:a.isFast,direction:a.direction};case h.ActionKind.Step:return Object.assign(Object.assign({},b),{kind:a.kind,entityIds:d,isFast:a.isFast});case h.ActionKind.Finish:return Object.assign(Object.assign({},b),{kind:a.kind,entityIds:d});default:throw u.Utils.assertNever(a);}}logNudge(a,b){for(const c of a){a=
c.is(za.simpleObject)&&(c.parent.is(za.cover)||c.parent.is(za.visual));const d=c.position;a={object_id:c.id,active_container:"overview",multiselect_id:b,old_x:0,old_y:0,new_x:d.x,new_y:d.y,prezi_mode:"editor",modified_value:"position",is_smart_structure:!1,is_topic_customization:a};this.logger.info({action:"modify",object:q.LoggerModule.getAvroLoggerHelper().getLogObjectType(c),trigger:"nudge",payload:a})}}};var $a={};Object.defineProperty($a,"__esModule",{value:!0});var Qb=f.base.ObjectKind;$a.TopicZoomAreaNudgeCommander=
class{constructor(a){this.cameraControl=a;this.logger=q.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.NudgeCommander")}do(a,b,c){const d=this.cameraControl.getScreenLayoutBox();c=this.updateState(b,c,a);b=a.lookup.topic(c.originalEditorIds[0]);var e=b.cover.zoomLayoutBox;if(c.kind===h.ActionKind.Start||c.kind===h.ActionKind.Step)e=ya.NudgeHelper.calculateNudgeDelta(c.direction,c.isFast),e=b.cover.zoomLayoutBox.withReferenceFrame(d.referenceFrame).translate(e);G.TopicZoomAreaInteraction.handleInteraction(e,
c,a);c.kind===h.ActionKind.Start&&(b=Object.assign(Object.assign({},c),{kind:h.ActionKind.Step}),G.TopicZoomAreaInteraction.handleInteraction(e,b,a));this.cameraControl.setScreenLayoutBox(d);return{nudgeTopicZoomAreaState:c}}updateState(a,b,c){switch(a.kind){case h.ActionKind.Start:b=c.lookup.object(a.target.entityId);if(null==b||!b.is(Qb.transformedObject))throw Error("invalid entity is being nudged");return Object.assign(Object.assign({_NudgeTopicZoomAreaState_:void 0},G.TopicZoomAreaInteraction.calcBaseStartState(a.target.entityId,
a.coTransformContent,c)),{kind:a.kind,originalEditorIds:[a.target.entityId],isFast:a.isFast,direction:a.direction});case h.ActionKind.Step:return Object.assign(Object.assign({},b),{kind:a.kind,coTransformContent:b.coTransformContentAtStart&&a.snapEnabled,isFast:a.isFast});case h.ActionKind.Finish:return Object.assign(Object.assign({},b),{kind:a.kind});default:throw u.Utils.assertNever(a);}}};var Aa={};Object.defineProperty(Aa,"__esModule",{value:!0});var C=f.base.ObjectKind;Aa.TopicNestingCommander=
class extends T.BaseDragCommander{constructor(a,b,c){super(a);this.layoutCommander=b;this.positionFinder=c;this.logger=q.LoggerModule.getLoggerManager().createLogger("TopicNestingCommander");this.logHelper=aa.AppUtilsModule.getLogHelperUtils()}topicNestingDragMove(a,b,c){c=this.updateState(a,b,c);b={subjectIds:c.originalEditorIds,results:[]};this.setAllowedSnapTargetKinds(a,c.originalEditorIds);var d=this.isOnTopicUnnestingZone(c);this.topicProximitySnap(a,c,b);if(d&&c.kind===h.ActionKind.Step&&c.topicNestingEnabled)return b.results.push({direction:h.TopicNestingDirection.Out,
factor:1,nestingThresholdReached:!0,targetTopicId:c.originalEditorIds[0]}),a.documentDecorator.set(z.EditorCommanderInternal.getTopicNestingComponentKey(),b),{dragState:c,draggedTopicIds:[],nestingTargetTopicId:null,nestingFromTopicId:null,nestingDirection:h.TopicNestingDirection.Out};if(c.kind===h.ActionKind.Finish&&c.topicNestingEnabled){a.documentDecorator.set(z.EditorCommanderInternal.getTopicNestingComponentKey(),b);d=d?h.TopicNestingDirection.Out:h.TopicNestingDirection.In;const e=this.handleTopicNesting(a,
c,d);if(e&&0<e.movedTopics.length)return{dragState:c,draggedTopicIds:e.movedTopics,nestingTargetTopicId:e.nestTargetId,nestingFromTopicId:e.nestFromId,nestingDirection:d}}a.documentDecorator.set(z.EditorCommanderInternal.getTopicNestingComponentKey(),b);return{dragState:c,draggedTopicIds:[],nestingTargetTopicId:null,nestingFromTopicId:null,nestingDirection:h.TopicNestingDirection.None}}updateTopicUnnestingDecorator(a,b,c){const d={subjectIds:b.originalEditorIds,results:[]};c&&this.isOnTopicUnnestingZone(b)&&
d.results.push({direction:h.TopicNestingDirection.Out,factor:1,nestingThresholdReached:!0,targetTopicId:b.originalEditorIds[0]});a.documentDecorator.set(z.EditorCommanderInternal.getTopicNestingComponentKey(),d)}isOnTopicUnnestingZone(a){if(!a.topicNestingEnabled)return!1;const b=this.cameraAccess.getMarginCorrectedStageArea().getTopLeft();return 30>=n.Geometry.distance(a.mouseStagePosition,b)}setAllowedSnapTargetKinds(a,b){b.map((b)=>a.lookup.base(b)).forEach((b)=>{if(b.is(C.transformedObject)){const c=
a.toDecorator(b),e=[h.SnapTargetKind.RegularPlanet,h.SnapTargetKind.SlideOnOverview,h.SnapTargetKind.SlideOnPlanet];b.is(C.stackTopic)?c.set(h.EditorCommander.getSnapDescriptionKey(),{allowedSnapTargetKinds:new Set([...e,h.SnapTargetKind.RegularStack])}):c.set(h.EditorCommander.getSnapDescriptionKey(),{allowedSnapTargetKinds:new Set(e)})}})}getAllowedSnapTargetKinds(a,b){let c=null;a.map((a)=>b.toDecorator(a)).forEach((a)=>{a=a.get(h.EditorCommander.getSnapDescriptionKey());a=null==a?new Set:a.allowedSnapTargetKinds;
c=null==c?new Set(a):new Set([...a].filter((a)=>c.has(a)))});return null==c?new Set:c}topicProximitySnap(a,b,c){var d=b.originalEditorIds.map((b)=>a.lookup.transformedObject(b)).filter((a)=>null!=a);if(0<d.length){const e=this.getAllowedSnapTargetKinds(d,a);if(0<e.size){const g=d.map((a)=>a.id),f=d[0].parent,l=[];if(f.is(C.topic)||f.is(C.overview))b.topicNestingEnabled&&b.kind!==h.ActionKind.Finish?this.calculateProximitySnap(d,f,b.mouseStagePosition).forEach((b)=>{var c=a.lookup.base(b.targetTopicId);
const d=c.is(C.planetTopic);c=c.is(C.stackTopic);let g=!1;f.is(C.overview)&&(g=e.has(h.SnapTargetKind.SlideOnOverview));f.is(C.planetTopic)&&(g=e.has(h.SnapTargetKind.SlideOnPlanet));d&&e.has(h.SnapTargetKind.RegularPlanet)&&(g=!0);c&&e.has(h.SnapTargetKind.RegularStack)&&(g=!0);g&&l.push(b)}):f.topicChildren.forEach((a)=>{0<=g.indexOf(a.id)||l.push({targetTopicId:a.id,factor:1,nestingThresholdReached:!1,direction:h.TopicNestingDirection.In})});d=l.find((a)=>a.nestingThresholdReached);b.kind!==h.ActionKind.Finish&&
(b.proximitySnapParent=null!=d?d.targetTopicId:null);null!=d?(c.subjectIds=g,c.results=l):c.results=c.results.concat(l)}}}calculateProximitySnap(a,b,c){const d=a.map((a)=>a.id);c=c.withReferenceFrame(b.referenceFrame);var {minDistance:e,topicWithMinDistance:g}=this.getTopicWithClosestDistance(c,b,d,.35,a);return b.topicChildren.filter((a)=>0>d.indexOf(a.id)).map((a)=>{const b=this.projectNumberToRange(a.id===g?e:1,.3,.35,1.3,1);return{nestingThresholdReached:1.05<b,factor:b,targetTopicId:a.id,direction:h.TopicNestingDirection.In}})}getTopicWithClosestDistance(a,
b,c,d,e){let g=Number.MAX_SAFE_INTEGER,f=null;b.topicChildren.forEach((b)=>{if(!(0<=c.indexOf(b.id)||b.is(C.stackTopic)&&e.some((a)=>a.is(C.planetTopic)))){var h=Math.max(Math.abs(a.x-b.layoutBox.center.x)/b.layoutBox.size.width,Math.abs(a.y-b.layoutBox.center.y)/b.layoutBox.size.height);h=Math.min(d,h);h<g&&(g=h,f=b.id)}});return{minDistance:g,topicWithMinDistance:f}}projectNumberToRange(a,b,c,d,e){const g=c-b;return a<b?d:a>c?e:(a-b)/g*e+(c-a)/g*d}updateState(a,b,c){switch(b.kind){case h.ActionKind.Start:return Object.assign(Object.assign({},
c),{kind:b.kind,topicNestingEnabled:!0});case h.ActionKind.Step:return a=this.cameraAccess.getScreenLayoutBox().referenceFrame,c=Object.assign(Object.assign({},c),{kind:b.kind,snapEnabled:!b.isSnapDisableKeyPressed,topicNestingEnabled:!b.isTopicNestingDisableKeyPressed,mouseStagePosition:a.point(b.stagePosition),dragGroup:c.dragGroup,isParentLayouted:c.isParentLayouted});case h.ActionKind.Finish:return Object.assign(Object.assign({},c),{kind:b.kind});default:throw u.Utils.assertNever(b);}}handleTopicNesting(a,
b,c){const d=b.originalEditorIds.map((b)=>a.lookup.base(b)).filter((a)=>a.is(C.transformedObject)).map((b)=>a.lookup.transformedObject(b.id));if(0===b.originalEditorIds.length||d.length!==b.originalEditorIds.length)return null;switch(c){case h.TopicNestingDirection.In:return this.nestEntitiesIfNeeded(a,b,d);case h.TopicNestingDirection.Out:return this.unnestEntitiesIfNeeded(b,d);case h.TopicNestingDirection.None:return null;default:throw u.Utils.assertNever(c);}}nestEntitiesIfNeeded(a,b,c){const d=
c[0].parent;if(!d.is(C.topic)&&!d.is(C.overview))return null;var e=this.calculateProximitySnap(c,d,b.mouseStagePosition).filter((a)=>a.nestingThresholdReached).sort((a,b)=>b.factor-a.factor);if(0===e.length)return null;a=a.lookup.topic(e[0].targetTopicId);e=c.filter((a)=>a.is(C.topic));c=c.filter((a)=>!a.is(C.topic));b=[...this.nestTopics(b,a,e,0<c.length),...this.nestSimpleObjects(b,a,c)];return 0<b.length?{movedTopics:b,nestTargetId:a.id,nestFromId:d.id}:null}nestTopics(a,b,c,d){return 0===c.length?
[]:b.is(C.planetTopic)?this.nestIntoPlanet(b,c,a,d):b.is(C.stackTopic)&&c.every((a)=>a.is(C.stackTopic))?this.nestIntoStack(b,c):[]}nestSimpleObjects(a,b,c){const d=b.is(C.stackTopic)?b.pageChildren[0]:b;a=this.reparentSimpleObjects(a,d,c);b.is(C.planetTopic)?this.ensureMovedObjectsAreAboveTargetChildren(c,[...d.simpleChildren(f.base.ChildVisibilityKind.inside)]):b.is(C.stackTopic)&&this.ensureMovedObjectsAreAboveTargetChildren(c,[...d.simpleChildren(f.base.ChildVisibilityKind.inside),...b.visual.contentChildren]);
return a}unnestEntitiesIfNeeded(a,b){const c=b[0].parent;if(c.is(C.overview))return null;const d=c.parent.is(C.stackTopic)?c.parent.parent:c.parent,e=b.filter((a)=>a.is(C.topic));b=b.filter((a)=>!a.is(C.topic));a=[...this.doUnnestTopics(a,d,e,0<b.length),...this.unnestSimpleObjects(a,d,b)];return 0<a.length?{movedTopics:a,nestTargetId:d.id,nestFromId:c.id}:null}doUnnestTopics(a,b,c,d){return 0===c.length?[]:b.is(C.planetTopic)?this.nestIntoPlanet(b,c,a,d):b.is(C.overview)?this.nestIntoOverview(b,
c,a,d):[]}unnestSimpleObjects(a,b,c){return this.reparentSimpleObjects(a,b,c)}nestIntoStack(a,b){const c=b.map((a)=>a.id);b.forEach((b)=>b.pageChildren.forEach((b)=>{b=a.add.inserter(b.copy());b.isValid()&&b.insert()}));b.forEach((a)=>a.delete());return c}nestIntoPlanet(a,b,c,d=!0){const e=new ra.LayoutQueryImpl,g=b[0].parent,h=a.layout.isValid();if(!d&&e.isSortedBySlideIdx(a)){const c=a.parent,d=[...a.topicChildren,...b];a.topicChildren.forEach((a)=>a.parent=c);(e.isSortedBySlideIdx(a)?d.slice().sort((a,
b)=>e.getSlideTopicIndex(a)-e.getSlideTopicIndex(b)):d).forEach((b)=>b.parent=a)}else b.forEach((b)=>{this.reparentTopics(c,b,a,d)});c.isParentLayouted&&g.layout.reset();!d&&h&&a.layout.reset();this.ensureMovedObjectsAreAboveTargetChildren(b,[...a.simpleChildren(f.base.ChildVisibilityKind.outsideAndInside)]);return b.map((a)=>a.id)}nestIntoOverview(a,b,c,d){const e=b[0].parent;b.forEach((b)=>{this.reparentTopics(c,b,a,d)});c.isParentLayouted&&e.layout.reset();return b.map((a)=>a.id)}reparentTopics(a,
b,c,d){d?this.reparentSimpleObjects(a,c,[b]):(b.parent=c,a=this.positionFinder.findTopicPosition(b,c.topicChildren),b.fitInto(a))}reparentSimpleObjects(a,b,c){if(0===c.length)return[];const d=c[0].createLayoutGroupWith(c.slice(1));let e=null;for(var g of c){const b=a.dragGroup.getOriginalDragLayoutBoxForEditor(g);e=null==e?b:e.union(b)}a=b.referenceFrame.layoutBox(a.originalZoomLayoutBox.center,a.originalZoomLayoutBox.size).withRotationRad(a.originalZoomLayoutBox.rotationRad);g=a.fitIntoOther(b.zoomLayoutBox);
d.tryToSetParent(b);b=b.referenceFrame.layoutBox(e.center,e.size).withRotationRad(e.rotationRad).align(a.topLeft,a.topRight,g.topLeft,g.topRight);d.fitInto(b);return c.map((a)=>a.id)}ensureMovedObjectsAreAboveTargetChildren(a,b){a=a.slice(0);a.sort((a,b)=>a.isAbove(b)?1:-1);b.sort((a,b)=>a.isAbove(b)?1:-1);b=b.pop();if(null!=b)for(let c=0;c<a.length;c++)0===c?a[0].moveAbove(b):a[c].moveAbove(a[c-1])}};var X={};Object.defineProperty(X,"__esModule",{value:!0});X.MaskDragCommander=class{constructor(a){this.cameraAccess=
a;this.logger=q.avro.Avro.createDefaultLogger()}resizeAreaNonProportional(a,b,c){const d=this.cameraAccess.getScreenLayoutBox().referenceFrame;switch(b.kind){case h.ActionKind.Start:a=a.lookup.image(b.target.entityId);c=this.upscaleLayoutBoxToFullImage(a);c={_MaskAreaNonProportionalResizeState_:void 0,resizeAnchor:b.resizeAnchor,originalLayoutBox:a.layoutBox,originalFullLayoutBox:c,originalMousePosition:d.point(b.originalMouseStagePosition),maxScale:this.calcMaxScale(a),originalMaskPoints:this.calcMaskPoints(a.mask),
entityId:b.target.entityId,originalMask:a.mask,isCenterResize:!1,isWidthResize:b.isWidthResize};break;case h.ActionKind.Step:c=Object.assign(Object.assign({},c),{isCenterResize:b.isCenterResizeKeyPressed});c.isWidthResize?this.doMaskAreaWidthResize(a,c,d.point(b.stagePosition)):this.doMaskAreaHeightResize(a,c,d.point(b.stagePosition));break;case h.ActionKind.Finish:this.logger.logResizeImageInMaskingMode({image_masking_size_change_source:"CANVAS",image_masking_mode:"CROPPING"});break;default:throw u.Utils.assertNever(b);
}return{state:c}}resizeArea(a,b,c){const d=this.cameraAccess.getScreenLayoutBox().referenceFrame;switch(b.kind){case h.ActionKind.Start:a=a.lookup.image(b.target.entityId);c=this.upscaleLayoutBoxToFullImage(a);c={_MaskAreaResizeState_:void 0,resizeAnchor:b.resizeAnchor,originalLayoutBox:a.layoutBox,originalFullLayoutBox:c,originalMousePosition:d.point(b.originalMouseStagePosition),maxScale:this.calcMaxScale(a),originalMaskPoints:this.calcMaskPoints(a.mask),entityId:b.target.entityId,originalMask:a.mask,
isCenterResize:!1};break;case h.ActionKind.Step:c=Object.assign(Object.assign({},c),{isCenterResize:b.isCenterResizeKeyPressed});this.doMaskAreaResize(a,c,d.point(b.stagePosition));break;case h.ActionKind.Finish:this.logger.logResizeImageInMaskingMode({image_masking_size_change_source:"CANVAS",image_masking_mode:"CROPPING"});break;default:throw u.Utils.assertNever(b);}return{state:c}}calcMaskPoints(a){return{topLeft:{x:a.x,y:a.y},topRight:{x:a.x+a.width,y:a.y},bottomLeft:{x:a.x,y:a.y+a.height},bottomRight:{x:a.x+
a.width,y:a.y+a.height},center:{x:a.x+a.width/2,y:a.y+a.height/2}}}calcMaxScale(a){const b=a.mask;a=a.imageAsset;return{left:(b.x+b.width)/b.width,right:(a.width-b.x)/b.width,top:(b.y+b.height)/b.height,bottom:(a.height-b.y)/b.height}}doMaskAreaHeightResize(a,b,c){this.doMaskAreaResizeI(a,b,c,[b.maxScale.top,b.maxScale.bottom],(a,b)=>({width:b.width,height:b.height*a}))}doMaskAreaWidthResize(a,b,c){this.doMaskAreaResizeI(a,b,c,[b.maxScale.left,b.maxScale.right],(a,b)=>({width:b.width*a,height:b.height}))}doMaskAreaResize(a,
b,c){this.doMaskAreaResizeI(a,b,c,[b.maxScale.left,b.maxScale.top,b.maxScale.right,b.maxScale.bottom],(a,b)=>({width:b.width*a,height:b.height*a}))}doMaskAreaResizeI(a,b,c,d,e){c=this.calculateScale(b.originalMousePosition,c,b.resizeAnchor,b.originalLayoutBox,b.originalLayoutBox.asReferenceFrame,b.isCenterResize);a=a.lookup.image(b.entityId);let g,f;b.isCenterResize?(g=e(Math.min(c,...d.map((a)=>1+2*(a-1))),b.originalMask),f={x:b.originalMaskPoints.center.x-g.width/2,y:b.originalMaskPoints.center.y-
g.height/2}):-1===b.resizeAnchor.rx&&-1===b.resizeAnchor.ry?(g=e(Math.min(c,b.maxScale.left,b.maxScale.top),b.originalMask),f={x:b.originalMaskPoints.bottomRight.x-g.width,y:b.originalMaskPoints.bottomRight.y-g.height}):-1===b.resizeAnchor.rx&&1===b.resizeAnchor.ry?(g=e(Math.min(c,b.maxScale.left,b.maxScale.bottom),b.originalMask),f={x:b.originalMaskPoints.topRight.x-g.width,y:b.originalMaskPoints.topRight.y}):1===b.resizeAnchor.rx&&-1===b.resizeAnchor.ry?(g=e(Math.min(c,b.maxScale.right,b.maxScale.top),
b.originalMask),f={x:b.originalMaskPoints.topLeft.x,y:b.originalMaskPoints.bottomLeft.y-g.height}):1===b.resizeAnchor.rx&&1===b.resizeAnchor.ry?(g=e(Math.min(c,b.maxScale.right,b.maxScale.bottom),b.originalMask),f=Object.assign({},b.originalMaskPoints.topLeft)):-1===b.resizeAnchor.rx&&0===b.resizeAnchor.ry?(g=e(Math.min(c,b.maxScale.left),b.originalMask),f={x:b.originalMaskPoints.topRight.x-g.width,y:b.originalMaskPoints.topLeft.y}):1===b.resizeAnchor.rx&&0===b.resizeAnchor.ry?(g=e(Math.min(c,b.maxScale.right),
b.originalMask),f=Object.assign({},b.originalMaskPoints.topLeft)):0===b.resizeAnchor.rx&&-1===b.resizeAnchor.ry?(g=e(Math.min(c,b.maxScale.top),b.originalMask),f={x:b.originalMaskPoints.topLeft.x,y:b.originalMaskPoints.bottomLeft.y-g.height}):0===b.resizeAnchor.rx&&1===b.resizeAnchor.ry&&(g=e(Math.min(c,b.maxScale.bottom),b.originalMask),f=Object.assign({},b.originalMaskPoints.topLeft));a.mask={x:Math.round(f.x),y:Math.round(f.y),width:Math.round(g.width),height:Math.round(g.height)};d=b.isCenterResize?
{rx:0,ry:0}:{rx:-b.resizeAnchor.rx,ry:-b.resizeAnchor.ry};a.fitInto(a.layoutBox.move(d,b.originalLayoutBox.point(d)))}resize(a,b,c){const d=this.cameraAccess.getScreenLayoutBox().referenceFrame;if(b.kind===h.ActionKind.Start){var e=a.lookup.image(b.target.entityId);a=this.upscaleLayoutBoxToFullImage(e);return{state:{_MaskImageResizeState_:void 0,resizeAnchor:b.resizeAnchor,originalLayoutBox:e.layoutBox,originalFullLayoutBox:a,originalMousePosition:d.point(b.originalMouseStagePosition),entityId:b.target.entityId,
originalMask:e.mask,isCenterResize:!1}}}if(b.kind===h.ActionKind.Finish)return this.logger.logResizeImageInMaskingMode({image_masking_size_change_source:"CANVAS",image_masking_mode:"MASKING"}),{state:{_MaskImageResizeState_:void 0,resizeAnchor:null,originalMousePosition:null,originalLayoutBox:null,originalFullLayoutBox:null,entityId:null,originalMask:null,isCenterResize:!1}};e=Object.assign(Object.assign({},c),{isCenterResize:b.isCenterResizeKeyPressed});a=a.lookup.image(e.entityId);b=this.calculateResize(c.originalMousePosition,
d.point(b.stagePosition),c.resizeAnchor,c.originalFullLayoutBox,c.originalFullLayoutBox.asReferenceFrame,c.isCenterResize);b=this.resizeImageMask(e,a,b,e.resizeAnchor);a.mask=b;a.fitInto(e.originalLayoutBox);return{state:e}}moveArea(a,b,c){b.kind===h.ActionKind.Start?(a=a.lookup.image(b.target.entityId),c=this.cameraAccess.getScreenLayoutBox().referenceFrame,c={_DragMaskAreaState_:void 0,originalLayoutBox:a.layoutBox,originalMousePosition:c.point(b.originalMouseStagePosition),entityId:b.target.entityId,
originalMask:a.mask}):b.kind===h.ActionKind.Finish?this.logger.logPanImageInMaskingMode({image_masking_mode:"CROPPING"}):this.doMoveArea(a,c,b.stagePosition);return{state:c}}doMoveArea(a,b,c){var d=this.cameraAccess.getScreenLayoutBox().referenceFrame;a=a.lookup.image(b.entityId);var e=b.originalLayoutBox.asReferenceFrame;d=this.calculateMoveDelta(b.originalMousePosition.withReferenceFrame(e),d.point(c).withReferenceFrame(e));c=b.originalLayoutBox.withReferenceFrame(e);b=b.originalMask;e=b.width/
c.size.width;const g=b.height/c.size.height;d={x:Math.max(0,Math.min(a.imageAsset.width-b.width,b.x+Math.round(d.x*e))),y:Math.max(0,Math.min(a.imageAsset.height-b.height,b.y+Math.round(d.y*g))),width:b.width,height:b.height};b={x:(d.x-b.x)/e,y:(d.y-b.y)/g};a.mask=d;a.fitInto(c.translate(b))}moveImage(a,b,c){if(b.kind===h.ActionKind.Start)return c=a.lookup.image(b.target.entityId),a=this.cameraAccess.getScreenLayoutBox().referenceFrame,{state:{_DragMaskImageState_:void 0,originalLayoutBox:c.layoutBox,
originalMousePosition:a.point(b.originalMouseStagePosition),entityId:b.target.entityId,originalMask:c.mask}};b.kind===h.ActionKind.Finish?this.logger.logPanImageInMaskingMode({image_masking_mode:"MASKING"}):(a=a.lookup.image(c.entityId),b=this.calculateMove(a,c,b),a.mask=this.calculateNewMaskArea(c,a,b));return{state:c}}upscaleLayoutBoxToFullImage(a){const b=a.layoutBox.size.width*a.imageAsset.width/a.mask.width,c=a.layoutBox.size.height*a.imageAsset.height/a.mask.height;return a.layoutBox.asReferenceFrame.layoutBox({x:a.layoutBox.topLeft.x-
a.mask.x/a.imageAsset.width*b+b/2,y:a.layoutBox.topLeft.y-a.mask.y/a.imageAsset.height*c+c/2},{height:c,width:b})}resizeImageMask(a,b,c,d){const e={width:a.originalMask.width/b.imageAsset.width*a.originalFullLayoutBox.size.width,height:a.originalMask.height/b.imageAsset.height*a.originalFullLayoutBox.size.height};var g=this.rotate({x:a.originalMask.x/b.imageAsset.width*a.originalFullLayoutBox.size.width,y:a.originalMask.y/b.imageAsset.height*a.originalFullLayoutBox.size.height},c.rotationRad);g={x:g.x+
a.originalFullLayoutBox.topLeft.x,y:g.y+a.originalFullLayoutBox.topLeft.y};c=this.calcMinLayoutBox(g,c,e,d,a.isCenterResize);const f=this.rotate({x:(g.x-c.topLeft.x)/c.size.width*b.imageAsset.width,y:(g.y-c.topLeft.y)/c.size.height*b.imageAsset.height},-c.rotationRad),{width:h,height:l}=a.originalMask,{rx:m,ry:n}=d,p=a.originalFullLayoutBox.size.width/c.size.width;b=(()=>{if(a.isCenterResize||-1===m&&-1===n)return{x:f.x,y:f.y,width:h*p,height:l*p};if(1===m&&1===n)return{x:a.originalMask.x*p,y:a.originalMask.y*
p,width:h*p,height:l*p};if(1===m&&-1===n)return{x:a.originalMask.x*p,y:f.y,width:h*p,height:l*p};if(-1===m&&1===n)return{x:f.x,y:a.originalMask.y*p,width:h*p,height:l*p};throw Error("Unrecognized resize anchor used");})();return{x:Math.round(b.x),y:Math.round(b.y),width:Math.round(b.width),height:Math.round(b.height)}}layoutBoxFromCorners(a,b,c){return a.layoutBox({x:(b.x+c.x)/2,y:(b.y+c.y)/2},{width:c.x-b.x,height:c.y-b.y})}lessWithDelta(a,b){return 1E-6>Math.abs(a-b)?!1:a<b}calcMinLayoutBox(a,b,
c,d,e){return e?this.calcMinLayoutBoxCenterResize(a,b,c):this.calcMinLayoutBoxGeneral(a,b,c,d)}calcMinLayoutBoxCenterResize(a,b,c){this.lessWithDelta(a.x,b.topLeft.x)&&(b=b.scaleToWidth(b.size.width+2*(b.topLeft.x-a.x)));this.lessWithDelta(a.y,b.topLeft.y)&&(b=b.scaleToHeight(b.size.height+2*(b.topLeft.y-a.y)));this.lessWithDelta(b.topRight.x,a.x+c.width)&&(b=b.scaleToWidth(b.size.width+2*(a.x+c.width-b.topRight.x)));this.lessWithDelta(b.bottomRight.y,a.y+c.height)&&(b=b.scaleToHeight(b.size.height+
2*(a.y+c.height-b.bottomRight.y)));return b}calcMinLayoutBoxGeneral(a,b,c,d){d={rx:-1*d.rx,ry:-1*d.ry};const e=b.point(d);if(this.lessWithDelta(a.x,b.topLeft.x)){var g=this.scaleSize(b.size,(b.size.width+(b.topLeft.x-a.x))/b.size.width);b=this.layoutBoxFromCorners(b.referenceFrame,{x:e.x-g.width,y:-1===d.ry?e.y:e.y-g.height},{x:e.x,y:-1===d.ry?e.y+g.height:e.y})}this.lessWithDelta(a.y,b.topLeft.y)&&(g=this.scaleSize(b.size,(b.size.height+(b.topLeft.y-a.y))/b.size.height),b=this.layoutBoxFromCorners(b.referenceFrame,
{x:-1===d.rx?e.x:e.x-g.width,y:e.y-g.height},{x:-1===d.rx?e.x+g.width:e.x,y:e.y}));this.lessWithDelta(b.topRight.x,a.x+c.width)&&(g=this.scaleSize(b.size,(b.size.width+(a.x+c.width-b.topRight.x))/b.size.width),b=this.layoutBoxFromCorners(b.referenceFrame,{x:e.x,y:-1===d.ry?e.y:e.y-g.height},{x:e.x+g.width,y:-1===d.ry?e.y+g.height:e.y}));this.lessWithDelta(b.bottomRight.y,a.y+c.height)&&(a=this.scaleSize(b.size,(b.size.height+(a.y+c.height-b.bottomRight.y))/b.size.height),b=this.layoutBoxFromCorners(b.referenceFrame,
{x:-1===d.rx?e.x:e.x-a.width,y:e.y},{x:-1===d.rx?e.x+a.width:e.x,y:e.y+a.height}));return b}scaleSize(a,b){return{width:a.width*b,height:a.height*b}}rotate(a,b){return{x:a.x*Math.cos(b)+a.y*Math.sin(b),y:-1*a.x*Math.sin(b)+a.y*Math.cos(b)}}calculateNewMaskArea(a,b,c){const d=a.originalLayoutBox,{x:e,y:g}=this.rotate({x:d.topLeft.x-c.topLeft.x,y:d.topLeft.y-c.topLeft.y},c.rotationRad),{width:f,height:h}=a.originalMask;return{x:Math.max(0,Math.min(a.originalMask.x+b.imageAsset.width/d.size.width*e,
Math.floor(b.imageAsset.width-f))),y:Math.max(0,Math.min(a.originalMask.y+b.imageAsset.height/d.size.height*g,Math.floor(b.imageAsset.height-h))),width:f,height:h}}calculateScale(a,b,c,d,e,g){const f=this.cameraAccess.getScreenLayoutBox().referenceFrame,h=d.center.withReferenceFrame(e);c=d.point(c).withReferenceFrame(e);a=a.withReferenceFrame(e);b=b.withReferenceFrame(e);b=n.Geometry.fromCoordinates(h.x-c.x,h.y-c.y).normalize().dot(n.Geometry.fromCoordinates(a.x-b.x,a.y-b.y));g||(b/=2);g=n.Geometry.distance(h,
c);d=n.Geometry.distance(f.point({x:0,y:0}).withReferenceFrame(e),f.point({x:0,y:10}).withReferenceFrame(e))/d.withReferenceFrame(e).size.width;return Math.max(d,(g+b)/g)}calculateResize(a,b,c,d,e,f){a=this.calculateScale(a,b,c,d,e,f);c=f?{rx:0,ry:0}:{rx:-c.rx,ry:-c.ry};return d.scale(a).move(c,d.point(c))}calculateMoveDelta(a,b){return n.Geometry.fromPoint(b).sub(n.Geometry.fromPoint(a)).toPoint()}calculateMove(a,b,c){const d=this.cameraAccess.getScreenLayoutBox().referenceFrame,e=a.parent.referenceFrame,
{x:f,y:h}=this.calculateMoveDelta(b.originalMousePosition.withReferenceFrame(e),d.point(c.stagePosition).withReferenceFrame(e));c=b.originalLayoutBox;return e.layoutBox(c.center,c.size).rotateRad(c.rotationRad).translate({x:b.originalMask.width/a.imageAsset.width*f,y:b.originalMask.height/a.imageAsset.height*h})}};var ab={};Object.defineProperty(ab,"__esModule",{value:!0});var bb=f.base.ObjectKind;ab.ActionCommanderImpl=class{constructor(a,b,c,d){this.cameraControl=a;this.layoutCommander=b;this.positionFinder=
c;this.coverEditApi=d;this.logger=q.LoggerModule.getLoggerManager().createLogger("prezi_cet_model_editor.ActionCommanderImpl")}arc(a,b,c){return(new Wa.DragArcCommander(this.cameraControl,this.coverEditApi)).do(a,b,c)}dragMove(a,b,c,d=!1){return(new ua.DragMoveCommander(this.cameraControl,this.layoutCommander,this.positionFinder,this.coverEditApi)).dragMove(a,b,c,d)}dragMoveWithState(a,b,c=!1){return(new ua.DragMoveCommander(this.cameraControl,this.layoutCommander,this.positionFinder,this.coverEditApi)).dragMoveWithState(a,
b,c)}topicNestingDragMove(a,b,c){return(new Aa.TopicNestingCommander(this.cameraControl,this.layoutCommander,this.positionFinder)).topicNestingDragMove(a,b,c)}updateTopicUnnestingDecorator(a,b,c){(new Aa.TopicNestingCommander(this.cameraControl,this.layoutCommander,this.positionFinder)).updateTopicUnnestingDecorator(a,b,c)}topicZoomAreaMove(a,b,c){return(new Ya.DragTopicZoomAreaMoveCommander(this.cameraControl,this.coverEditApi)).do(a,b,c)}rotate(a,b,c){return(new wa.DragRotateCommander(this.cameraControl,
this.coverEditApi)).do(a,b,c)}resize(a,b,c){return(new ia.DragResizeCommander(this.cameraControl,this.coverEditApi)).do(a,b,c)}resizeSingleText(a,b,c){return(new ia.DragResizeSingleTextCommander(this.cameraControl,this.coverEditApi)).do(a,b,c)}topicZoomAreaResize(a,b,c){return(new ca.DragTopicZoomAreaResizeCommander(this.cameraControl,this.coverEditApi)).do(a,b,c)}nonProportionalResize(a,b,c){return(new U.DragNonProportionalResizeCommander(this.cameraControl,this.coverEditApi)).do(a,b,c)}nudge(a,
b,c){return(new Za.NudgeCommander(this.cameraControl)).do(a,b,c)}nudgeTopicZoomArea(a,b,c){return(new $a.TopicZoomAreaNudgeCommander(this.cameraControl)).do(a,b,c)}maskResizeImage(a,b,c){return(new X.MaskDragCommander(this.cameraControl)).resize(a,b,c)}maskResizeArea(a,b,c){return(new X.MaskDragCommander(this.cameraControl)).resizeArea(a,b,c)}maskNonProportionalResizeArea(a,b,c){return(new X.MaskDragCommander(this.cameraControl)).resizeAreaNonProportional(a,b,c)}maskImageMove(a,b,c){return(new X.MaskDragCommander(this.cameraControl)).moveImage(a,
b,c)}maskAreaMove(a,b,c){return(new X.MaskDragCommander(this.cameraControl)).moveArea(a,b,c)}deleteObjectCmd(a,b){return{name:"delete object",run:(c)=>{if(0!==a.length){this.logObjectDelete(c,b,a);var d=new Map;for(var e of a){const a=c.lookup.object(e).parent;d.has(a.id)||d.set(a.id,new Set);d.get(a.id).add(e)}for(let a of d.keys())e=c.lookup.base(a),null!=e&&(e.is(f.base.ObjectKind.topicParent)?e.layout.delete([...d.get(a).values()].map((a)=>c.lookup.transformedObject(a))):d.get(a).forEach((a)=>
{c.lookup.object(a).delete()}))}}}}logObjectDelete(a,b,c){const d=q.LoggerModule.getLoggerManager().generateUniqueId(),e=a.lookup.object(c[0]),f=1<c.length?"MULTIPLE":e;q.avro.Avro.createDefaultLogger().logDeleteObject({object_type:f,topic_relationship:e,delete_type:b,object_id:"MULTIPLE"===f?null:e.id});c.forEach((e)=>{e=a.lookup.object(e);if(null!=e){const a={object_id:e.id,active_container:"overview",multiselect_id:d,prezi_mode:"editor"},f={action:"delete",object:q.LoggerModule.getAvroLoggerHelper().getLogObjectType(e),
trigger:b,payload:a};e.is(bb.chart)&&null!=e.chartAsset&&(a.chart_type=e.chartAsset.chartType,f.feature="chart");this.logger.info(f);e.is(bb.simpleObject)&&e.parent.is(bb.cover)&&-1===c.indexOf(e.parent.parent.id)&&this.logger.info({action:"delete",object:"coveritem",trigger:"machine",payload:{coveritem_id:e.id,topic_id:e.parent.parent.id}});q.avro.Avro.createDefaultLogger().logDeletedObject({object_type:e,topic_relationship:e,delete_type:b,object_id:e.id})}})}};var cb={};Object.defineProperty(cb,
"__esModule",{value:!0});var Y=f.base.ObjectKind;cb.CoverCommanderImpl=class{convertToTopicVisualCmd(a){return{name:"convertToTopicVisualCmd",run:(b)=>{a.forEach((a)=>{a=b.lookup.simpleObject(a);a.parent.is(Y.topic)?a.parent=a.parent.visual:a.parent.is(Y.cover)&&(a.parent=a.parent.parent.visual)})}}}convertToCoverItemCmd(a){return{name:"convertToCoverItemCmd",run:(b)=>{a.forEach((a)=>{a=b.lookup.simpleObject(a);a.parent.is(Y.topic)?a.parent=a.parent.cover:a.parent.is(Y.visual)&&(a.parent=a.parent.parent.cover)})}}}convertToContentItemCmd(a){return{name:"convertToContentItemCmd",
run:(b)=>{a.forEach((a)=>{a=b.lookup.simpleObject(a);(a.parent.is(Y.cover)||a.parent.is(Y.visual))&&a.parent.parent.is(Y.planetTopic)&&(a.parent=a.parent.parent)})}}}};var db={};Object.defineProperty(db,"__esModule",{value:!0});db.ZObjectEditorCommandsBase=class{constructor(a,b,c){this.cameraAccess=a;this.positionFinder=b;this.insertHierarchyDestination=c;this.logger=q.LoggerModule.getLoggerManager().createLogger("prezi_cet_model_editor.ZObjectEditorCommandsBase");this.insertedEntityIdsBus=Ba.Bacon.newBus()}simpleObjectParentEditor(a){const b=
this.insertHierarchyDestination.getCurrentKind();switch(b){case f.InsertHierarchyDestinationKind.CHILD:return a.lookup.simpleObjectParent(this.insertHierarchyDestination.getCurrentParentId());case f.InsertHierarchyDestinationKind.COVER:return a.lookup.topic(this.insertHierarchyDestination.getCurrentParentId()).cover;default:throw u.Utils.assertNever(b);}}getInsertedEntityIdsStream(){return this.insertedEntityIdsBus}getRGBString(a){return"#"+(16777216+(a.r<<16)+(a.g<<8)+a.b).toString(16).slice(1)}};
var eb={};Object.defineProperty(eb,"__esModule",{value:!0});var Rb=f.base.ObjectKind;eb.PreziDocCommanderImpl=class extends db.ZObjectEditorCommandsBase{constructor(a,b,c,d){super(b,c,d);this.scene=a}copyObjects(a){const b=this.scene.getPrezi().getComponent(w.CetModel.MODEL()).getPdomObject();return Ab.DOM.copyObjects(b,a)}insertCmd(a){return{name:"insertCmd",run:(b)=>{const c=f.CetModelEditor.createLegacyInserter().insertLegacy(b,a,this.positionFinder,this.cameraAccess);this.insertedEntityIdsBus.push({ids:c.ids,
dontSelect:0<c.pageIds.length||0<c.topLevelChapterIds.length,flyToId:this.calculateFlyToId(b,a.targetParentId,c.pageIds)});return{ids:c.ids}}}}calculateFlyToId(a,b,c){a=a.lookup.base(b);return 0<c.length&&null!=a&&a.is(Rb.page)?c[0]:null}};var fb={};Object.defineProperty(fb,"__esModule",{value:!0});fb.ZObjectEditorImpl=class{constructor(a,b,c,d,e,f,h){this.scene=a;this.runner=b;this.insertHierarchyDestination=c;this.mediaService=d;this.assetThumbnailAnnouncer=e;this.cameraControl=f;this.editorSession=
h;if(null==this.scene)throw Error("scene cannot be null");if(null==this.insertHierarchyDestination)throw Error("insertHierarchyDestination cannot be null");if(null==this.mediaService)throw Error("mediaService cannot be null");if(null==this.assetThumbnailAnnouncer)throw Error("assetThumbnailAnnouncer cannot be null");}beginAsyncApiCommand(a,b){return this.runner.beginAsyncApiCommand(a,b)}executeApiCommand(a,b){return this.runner.executeApiCommand(a,b)}executeLegacyCommand(a,b){return this.runner.executeLegacyCommand(a,
b)}get action(){null==this._action&&(this._action=new ab.ActionCommanderImpl(this.cameraControl,this.layout,this.editorSession.positionFinder,this.editorSession.coverEdit));return this._action}get doc(){null==this._doc&&(this._doc=new eb.PreziDocCommanderImpl(this.scene,this.cameraControl,this.editorSession.positionFinder,this.insertHierarchyDestination));return this._doc}get cover(){null==this._cover&&(this._cover=new cb.CoverCommanderImpl);return this._cover}get layout(){null==this._layout&&(this._layout=
h.EditorCommander.createLayoutCommander(h.EditorCommander.getLayoutRepository(),this.editorSession.positionFinder));return this._layout}get assetManager(){return this.editorSession.document.progressiveAssetManager}getInsertedEntityIdsStream(){return Ba.Bacon.mergeAll([this.doc.getInsertedEntityIdsStream()])}read(a){return this.runner.read(a)}};var gb={};Object.defineProperty(gb,"__esModule",{value:!0});gb.ImageMaskingApi_KILL_ME_HACKImpl=class{constructor(){this.maskingModeBus=Ba.Bacon.newBus()}setMaskingMode(a){this.maskingModeBus.push(a)}getMaskingMode(){return this.maskingModeBus}};
var hb={};Object.defineProperty(hb,"__esModule",{value:!0});hb.TopicShapeRolesManagerImpl=class{cleanTopicShapeRolesCmd_internal(){return{name:"Remove topic shapes roles and revert document generation (dev feature)",runLegacy:(a)=>{a.mscene.getPreziW().getMutableZObjects().forEachMutable((a)=>{a.is(w.CetModel.ID.Z_TOPIC_CONTAINER)&&(a=a.getMutableTopic().getEntity(),a.isDef(w.CetModel.ID.HAS_TOPIC_CHILDREN)&&a.getMutableWrapper(w.CetModel.ID.HAS_TOPIC_CHILDREN.W).getMutableTopicChildren().forEachMutable((a)=>
{a=a.getMutableBehaviour();a.is(w.CetModel.ID.VISUAL)&&null!=a.getLayoutRole()&&(a.getLayoutRole().is(w.CetModel.ID.TOPIC_SHAPE)||a.getLayoutRole().is(w.CetModel.ID.CONTENT_AREA))&&a.setLayoutRole(null)}))})}}}};var ib={};Object.defineProperty(ib,"__esModule",{value:!0});ib.ImageMaskingCommanderImpl=class{imageMaskForLayoutBox(a,b){const c=a.size.width/a.size.height;if(b.width<b.height){var d=b.width;a=d/c}else a=b.height,d=a*c;a={width:d,height:a,x:(b.width-d)/2,y:(b.height-a)/2};0>a.x?(d=a.width,
a.width+=2*a.x,a.x=0,a.height*=a.width/d,a.y=(b.height-a.height)/2):0>a.y&&(d=a.height,a.height+=2*a.y,a.y=0,a.width*=a.height/d,a.x=(b.width-a.width)/2);return a}updateMaskAspectRatio(a,b,c){switch(b){case h.MaskAspectRatio.custom:return a;case h.MaskAspectRatio.fix1By1:var d=1;break;case h.MaskAspectRatio.fix16By9:d=16/9;break;case h.MaskAspectRatio.fix4By3:d=4/3;break;default:u.Utils.assertNever(b)}a=Math.floor(c.height*d);if(a<=c.width)return{width:a,height:c.height,x:Math.floor((c.width-a)/2),
y:0};d=Math.floor(c.width/d);return{width:c.width,height:d,x:0,y:Math.floor((c.height-d)/2)}}getLayoutBoxForNewMask(a,b,c){const d=c.asReferenceFrame,e=a.width/c.size.width,f=a.height/c.size.height;a=d.point(this.getMaskCenter(a));const h=d.point(this.getMaskCenter(b));a={x:(h.x-a.x)/e,y:(h.y-a.y)/f};b={width:b.width/e,height:b.height/f};return c.withReferenceFrame(d).translate(a).withSize(b)}getMaskCenter(a){return{x:a.x+a.width/2,y:a.y+a.height/2}}};var jb={};Object.defineProperty(jb,"__esModule",
{value:!0});jb.OnboardingImpl=class{constructor(a,b,c,d){this.steps=a;this.uiRoot=b;this.userSettings=d;this.currentStepInd=-1;this.spotlightOpen=!1;"disable"===c||0===a.length||"force"!==c&&c.some((a)=>this.userSettings.getBoolean(a))||(this.setStepTo(0),this.refreshOnboarding())}declareUI(a){this.isActive()&&this.steps.forEach((b)=>{a.spotlight(Object.assign(Object.assign({overlay:null,highlights:null},b.visual),{id:this.spotlightId(b.id)}))})}get activeStep(){return this.currStep().id}refreshOnboarding(){var a,
b,c,d;if(this.currStep()){this.currStep().disableVisual&&this.currStep().disableVisual(this.uiRoot.getState())?this.switchSpotlightOff(this.currStep().id):this.switchSpotlightOn(this.currStep().id);for(var e=null===(a=this.currStep())||void 0===a?void 0:a.isDone;e&&e(this.uiRoot.getState());)this.setStepTo(this.currentStepInd+1),e=null===(b=this.currStep())||void 0===b?void 0:b.isDone;for(var f=null===(c=this.currStep())||void 0===c?void 0:c.fallback;f&&f.when(this.uiRoot.getState());){a=this.steps.findIndex((a)=>
a.id===f.to);if(a<this.currentStepInd)this.setStepTo(a);else throw Error(`Invalid fallback: from ${this.steps[this.currentStepInd].id} to ${f.to}`);f=null===(d=this.currStep())||void 0===d?void 0:d.fallback}}}isActive(){return!!this.currStep()}finishActiveStep(a){this.currStep()&&this.currStep().id===a&&this.setStepTo(this.currentStepInd+1);this.refreshOnboarding()}rewindTo(a){if(this.isActive()){const b=this.steps.findIndex((b)=>b.id===a);if(-1!==b&&b<=this.currentStepInd)this.setStepTo(b);else throw Error(`Invalid rewindTo: from ${this.steps[this.currentStepInd]?
this.steps[this.currentStepInd].id:"invalid"} to ${a}`);}}restartOnboarding(){0!==this.steps.length&&this.rewindTo(this.steps[0].id)}closeOnboarding(){this.steps.forEach((a)=>this.uiRoot.spotlight.close(this.spotlightId(a.id)));this.setStepTo(null)}setStepTo(a){const b=this.currentStepInd;if(b!==a){this.currentStepInd=a;var c=this.steps[b];if(c){this.switchSpotlightOff(c.id);if(c.onLeave)c.onLeave(this.uiRoot);if(c.onCompleted&&b<a)c.onCompleted(this.uiRoot.getState());c.setFlagsOnCompleted&&b<a&&
c.setFlagsOnCompleted.forEach((a)=>this.userSettings.setBoolean(a,!0))}if(a=this.steps[a])if(this.switchSpotlightOn(a.id),a.onEnter)a.onEnter(this.uiRoot)}}currStep(){return this.steps[this.currentStepInd]}spotlightId(a){return a+"_spotlight"}switchSpotlightOn(a){this.spotlightOpen||(this.uiRoot.spotlight.open(this.spotlightId(a)),this.spotlightOpen=!0)}switchSpotlightOff(a){this.spotlightOpen&&(this.uiRoot.spotlight.close(this.spotlightId(a)),this.spotlightOpen=!1)}};var z={};Object.defineProperty(z,
"__esModule",{value:!0});z.EditorCommanderImpl=class{createTemplateChooserAppEditor(a,b,c){a=f.CetModelEditor.createRunner(a,b,c);return new Va.TemplateChooserAppEditorImpl(a)}createZObjectEditor(a,b,c,d,e,g,h,l,m,n){a=f.CetModelEditor.createRunner(a,b,m,l,e);return new fb.ZObjectEditorImpl(b,a,c,d,g,h,n)}getMultiselectDecoratorComponentKey(){null==z.EditorCommanderImpl.multiselectDecoratorKey&&(z.EditorCommanderImpl.multiselectDecoratorKey=w.CetModel.createValueComponentKey("multiselect_rotation_rad",
!1,!0,!0));return z.EditorCommanderImpl.multiselectDecoratorKey}getSnapComponentKey(){null==z.EditorCommanderImpl.snapKey&&(z.EditorCommanderImpl.snapKey=w.CetModel.createValueComponentKey("snap_intentions",!1,!0,!0));return z.EditorCommanderImpl.snapKey}getTopicNestingComponentKey(){null==z.EditorCommanderImpl.topicNestingKey&&(z.EditorCommanderImpl.topicNestingKey=w.CetModel.createValueComponentKey("topic_nesting_intentions",!1,!0,!0));return z.EditorCommanderImpl.topicNestingKey}getSnapDescriptionKey(){null==
z.EditorCommanderImpl.snapDescriptionKey&&(z.EditorCommanderImpl.snapDescriptionKey=w.CetModel.createValueComponentKey("getSnapDescriptionKey",!1,!0,!0));return z.EditorCommanderImpl.snapDescriptionKey}createColorMixCommander(){return new ma.ColorMixCommanderImpl}createTextStyleCommander(){return new la.TextStyleCommanderImpl}createLayoutCommander(a,b){return new Ra.LayoutCommanderImpl(new ma.ColorMixCommanderImpl,a,b)}createImageMaskingCommander(){return new ib.ImageMaskingCommanderImpl}getLayoutRepository(){null==
z.EditorCommanderImpl.layoutRepository&&(z.EditorCommanderImpl.layoutRepository=new Ia.LayoutRepositoryImpl);return z.EditorCommanderImpl.layoutRepository}createLayoutQuery(){return new ra.LayoutQueryImpl}createCounterpartUpdater(a){return new Ga.CounterpartUpdaterImpl(a)}createTopicShapeRolesManager(){return new hb.TopicShapeRolesManagerImpl}createColorGroup(a,b){return new Ta.ColorGroupImpl(a,b)}getImageMaskingApi_KILL_ME_HACK(){null==z.EditorCommanderImpl.maskingModeThing&&(z.EditorCommanderImpl.maskingModeThing=
new gb.ImageMaskingApi_KILL_ME_HACKImpl);return z.EditorCommanderImpl.maskingModeThing}createOnboarding(a,b,c,d){return new jb.OnboardingImpl(a,b,c,d)}};z.EditorCommanderInternal=new z.EditorCommanderImpl;var kb={};Object.defineProperty(kb,"__esModule",{value:!0});kb.LongRunningExecutorImpl=class{constructor(a){this.session=a}update(a,b,c,d,e,f){null!=this.ctx&&this.ctx.isActive()&&this.currentChangeTag===a||(null!=this.ctx&&this.ctx.isActive()&&this.ctx.end(),this.currentChangeTag=a,this.ctx=this.session.document.beginLongRunningCommand(b,
{name:a},(a)=>{switch(a.reason){case I.FinishEventKind.AbortTransaction:case I.FinishEventKind.RollbackTransaction:break;case I.FinishEventKind.BeginOtherTransaction:case I.FinishEventKind.EndTransaction:null!=e&&e(a.api);break;default:u.Utils.assertNever(a)}this.ctx=null}),null!=f&&f());this.ctx.isActive()&&(this.ctx.execute(b,(a)=>d(a,c)),c.isFinal&&this.ctx.end())}close(a){null!=this.ctx&&this.ctx.isActive()&&this.currentChangeTag===a&&this.ctx.end()}};var h={};Object.defineProperty(h,"__esModule",
{value:!0});(function(a){a[a.RegularPlanet=0]="RegularPlanet";a[a.RegularStack=1]="RegularStack";a[a.SlideOnOverview=2]="SlideOnOverview";a[a.SlideOnPlanet=3]="SlideOnPlanet"})(h.SnapTargetKind||(h.SnapTargetKind={}));(function(a){a[a.current=0]="current";a[a.counterpart=1]="counterpart"})(h.UpdateOrigin||(h.UpdateOrigin={}));h.EditorCommander=z.EditorCommanderInternal;(function(a){a[a.single=0]="single";a[a.multiple=1]="multiple"})(h.ActionTargetMultiplicity||(h.ActionTargetMultiplicity={}));(function(a){a[a.object=
0]="object";a[a.topicZoomArea=1]="topicZoomArea"})(h.NudgeActionStartKind||(h.NudgeActionStartKind={}));(function(a){a[a.Left=0]="Left";a[a.Right=1]="Right";a[a.Up=2]="Up";a[a.Down=3]="Down"})(h.NudgeDirection||(h.NudgeDirection={}));(function(a){a.Align="align";a.Highlight="highlight";a.UniverseLimit="universeLimit"})(h.SnapResultKind||(h.SnapResultKind={}));(function(a){a[a.selfOnly=0]="selfOnly";a[a.nearest=1]="nearest";a[a.mostCommon=2]="mostCommon"})(h.LayoutFindStategy||(h.LayoutFindStategy=
{}));(function(a){a[a.fix1By1=0]="fix1By1";a[a.fix16By9=1]="fix16By9";a[a.fix4By3=2]="fix4By3";a[a.custom=3]="custom"})(h.MaskAspectRatio||(h.MaskAspectRatio={}));(function(a){a[a.ObjectMove=0]="ObjectMove";a[a.TopicZoomAreaMove=1]="TopicZoomAreaMove";a[a.Resize=2]="Resize";a[a.TopicZoomAreaResize=3]="TopicZoomAreaResize";a[a.NonProportionalResize=4]="NonProportionalResize";a[a.Rotate=5]="Rotate";a[a.ArcMove=6]="ArcMove";a[a.PlaceholderMove=7]="PlaceholderMove";a[a.MaskImageMove=8]="MaskImageMove";
a[a.MaskAreaMove=9]="MaskAreaMove";a[a.MaskImageResize=10]="MaskImageResize";a[a.MaskAreaResize=11]="MaskAreaResize";a[a.MaskAreaNonProportionalResize=12]="MaskAreaNonProportionalResize"})(h.DragActionStartKind||(h.DragActionStartKind={}));(function(a){a[a.Start=0]="Start";a[a.Step=1]="Step";a[a.Finish=2]="Finish"})(h.ActionKind||(h.ActionKind={}));(function(a){a[a.drop=0]="drop";a[a.cancelled=1]="cancelled"})(h.DragPlaceholderActionFinishKind||(h.DragPlaceholderActionFinishKind={}));(function(a){a[a.TOP_LEFT=
0]="TOP_LEFT";a[a.TOP_RIGHT=1]="TOP_RIGHT";a[a.BOTTOM_LEFT=2]="BOTTOM_LEFT";a[a.BOTTOM_RIGHT=3]="BOTTOM_RIGHT";a[a.MIDDLE_LEFT=4]="MIDDLE_LEFT";a[a.MIDDLE_RIGHT=5]="MIDDLE_RIGHT";a[a.MIDDLE_CENTER=6]="MIDDLE_CENTER";a[a.MIDDLE_TOP=7]="MIDDLE_TOP";a[a.MIDDLE_BOTTOM=8]="MIDDLE_BOTTOM"})(h.ControlPointPosition||(h.ControlPointPosition={}));(function(a){a[a.None=0]="None";a[a.In=1]="In";a[a.Out=2]="Out"})(h.TopicNestingDirection||(h.TopicNestingDirection={}));const yb=n.Geometry.colorFromRGB(1,1,1),Sb=
{r:255,g:255,b:255},Tb={r:146,g:154,b:163};h.getBgColor=function(a,b){return lb(a,b)?Tb:Sb};h.hasLightColor=lb;h.toCssColor=function(a){if(null==a)return"none";{const b=(a)=>("0"+Math.round(Number(a)).toString(16)).slice(-2).toUpperCase();return`#${b(a.r)}${b(a.g)}${b(a.b)}`}};h.DEFAULT_OVERLAY={opacity:.5,color:"black",holes:[]};h.createLongRunningExecutor=function(a){return new kb.LongRunningExecutorImpl(a)};return zb=h});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_editor_commander",["require","prezi.engine.dom","prezi.engine.dom.converter.xpdom2","prezi.geometry","prezi.text","prezi.text.model","prezi_app_utils","prezi_bacon","prezi_cet","prezi_cet_model","prezi_cet_model_editor","prezi_cet_renderer","prezi_editor_commander_common","prezi_editor_store_mode","prezi_editor_store_object","prezi_externalserviceprovider","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_ppt_service","prezi_service_fontcatalogue","prezi_service_media","prezi_styleschemeprovider","prezi_templateservice","prezi_textstyleprovider","prezi_utils","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_editor_commander.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.engine.dom"),require("prezi.engine.dom.converter.xpdom2"),require("prezi.geometry"),require("prezi.text"),require("prezi.text.model"),require("prezi_app_utils"),require("prezi_bacon"),require("prezi_cet"),require("prezi_cet_model"),require("prezi_cet_model_editor"),require("prezi_cet_renderer"),require("prezi_editor_commander_common"),require("prezi_editor_store_mode"),require("prezi_editor_store_object"),require("prezi_externalserviceprovider"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_ppt_service"),require("prezi_service_fontcatalogue"),require("prezi_service_media"),require("prezi_styleschemeprovider"),require("prezi_templateservice"),require("prezi_textstyleprovider"),require("prezi_utils"),require("prezi_widgets"));}else{this["prezi_editor_commander"]=__factory(this["prezi.engine.dom"],this["prezi.engine.dom.converter.xpdom2"],this["prezi.geometry"],this["prezi.text"],this["prezi.text.model"],this["prezi_app_utils"],this["prezi_bacon"],this["prezi_cet"],this["prezi_cet_model"],this["prezi_cet_model_editor"],this["prezi_cet_renderer"],this["prezi_editor_commander_common"],this["prezi_editor_store_mode"],this["prezi_editor_store_object"],this["prezi_externalserviceprovider"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_ppt_service"],this["prezi_service_fontcatalogue"],this["prezi_service_media"],this["prezi_styleschemeprovider"],this["prezi_templateservice"],this["prezi_textstyleprovider"],this["prezi_utils"],this["prezi_widgets"]);}}).call(this);