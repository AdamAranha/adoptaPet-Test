;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_storyblocks";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.geometry":dependencies[0],"prezi_cet_model_editor":dependencies[1],"prezi_editor_commander":dependencies[2],"prezi_featureswitcher":dependencies[3],"prezi_i18n":dependencies[4],"prezi_libraryprovider":dependencies[5],"prezi_logger":dependencies[6],"prezi_plugin_api":dependencies[7],"prezi_plugin_meta":dependencies[8],"prezi_select":dependencies[9],"prezi_service_data":dependencies[10],"prezi_utils":dependencies[11],"prezi_widgets":dependencies[12]}};})());};})(arguments);var moduleImpl=(function(){return module(function(m){function K(a,b,c,d){const e=C.EditorCommander.createLayoutQuery();b=a.layout.add.planet(b,null==d?void 0:d);b.simpleChildren(r.base.ChildVisibilityKind.all).filter((a)=>!e.isTopicShapeObject(a)).forEach((a)=>a.delete());d=b.cover.add.text("subtitle_2");d.setText(c.title);d.isPlaceholder=!1;d.wrap(.75,!1);d.setAllParagraphProps({alignment:r.base.TextAlignment.Center});var l=b.simpleChildren(r.base.ChildVisibilityKind.outsideAndInside).filter((a)=>e.isTopicShapeObject(a));0<l.length&&
(c=G(d.layoutBox,D.onCover),l=l[0].createLayoutGroupWith(l.slice(1)).layoutBox,d.fitInto(l.scale(c)));a.layout.adjust([b]);return b}function L(a,b){if(a.is(h.planetTopic)){const e=C.EditorCommander.createLayoutQuery();var c=a.simpleChildren(r.base.ChildVisibilityKind.outsideAndInside).filter((a)=>e.isTopicShapeObject(a));if(0<c.length){var d=G(b);c=c[0].createLayoutGroupWith(c.slice(1)).layoutBox;d=M(c,a.zoomLayoutBox).scale(d)}}null==d&&(d=a.zoomLayoutBox.scale(D.inZoom));d=d.rotateRad(b.rotationRad);
return b.fitIntoOther(d)}function G(a,b=D.inCircle){a=a.size;a=Math.max(a.height,a.width)/Math.min(a.height,a.width);return a/Math.sqrt(1+a*a)*b}function N(a){(a.is(h.planetTopic)||a.is(h.overview)||a.is(h.page))&&a.contentChildren.forEach((a)=>{(a.is(h.text)||a.is(h.image))&&a.isPlaceholder&&a.delete()})}function H(a,b){N(a);b=b.insert().simpleObjects;for(var c of b){const a=c.is(h.text)?c.textBox:c.layoutBox;var d=d?d.union(a):a}a=L(a,d);c=b[0].createLayoutGroupWith(b.slice(1));c.fitInto(c.layoutBox.align(d.topLeft,
d.topRight,a.topLeft,a.topRight));return b}function M(a,b){var c=b.union(a);if(c=c.size.width===b.size.width&&c.size.height===b.size.height)return a;if(a.intersects(b)){c=Math.max(b.topLeft.x,a.topLeft.x);var d=Math.max(a.topLeft.y,b.topLeft.y),e=Math.min(a.bottomRight.x,b.bottomRight.x),l=Math.min(a.bottomRight.y,b.bottomRight.y);b={width:Math.abs(e-c),height:Math.abs(l-d)};c=a.referenceFrame.point({x:c+(e-c)/2,y:d+(l-d)/2});return a.referenceFrame.layoutBox(c,b)}return b}function O(a,b,c,d){null==
d&&(d=a.getThemeIdForNewSubtopic(c,r.base.ObjectKind.planetTopic));const e=a.getLayoutIdForNewSubtopic(c);a=a.layout.add.inserter(b);return a.isValid()&&(c=a.insert(c).topics[0])?(c.is(h.planetTopic)&&(P(c)&&null!=d&&c.applyTheme(d),c.applyLayout(e)),c):null}function P(a){return[...a.visual.contentChildren,...a.is(h.planetTopic)?a.surface.contentChildren:[]].some((a)=>r.CetModelEditor.isTopicShapeObjectKILLME(a))}function Q(a,b){if(b.is(h.planetTopic)){const b=C.EditorCommander.createLayoutQuery();
a.visual.contentChildren.filter((a)=>b.isTopicShapeObject(a)).forEach((a)=>{a.is(h.shape)?a.shapeStyle===I.Poly2&&(a.shapeStyle=I.Poly3):(a.is(h.pdf)||a.is(h.image))&&a.filterStyle===r.base.ShapelikeFilterStyle.Filter2&&(a.filterStyle=r.base.ShapelikeFilterStyle.Filter3)})}}var E=m.dependencies.prezi_service_data,r=m.dependencies.prezi_cet_model_editor,C=m.dependencies.prezi_editor_commander,t=m.dependencies.prezi_featureswitcher,f=m.dependencies.prezi_i18n,u=m.dependencies.prezi_libraryprovider,
q=m.dependencies.prezi_logger,g=m.dependencies.prezi_plugin_api,J=m.dependencies.prezi_plugin_meta,R=m.dependencies.prezi_utils,v=m.dependencies.prezi_widgets,B={};Object.defineProperty(B,"__esModule",{value:!0});var S=t.FeatureSwitcher.isActive;B.RecentlyUsedStorage=class{constructor(a){this.cache=[];this.localStorageKey="recenttopics."+a;this.storage=S("js-force-session-storage-for-recently-used")?window.sessionStorage:window.localStorage;this.cache=this.getLocalStorageItem()}getStoryblockGuids(){return[...this.cache].reverse()}addStoryblockGuid(a){a&&
(this.cache=this.cache.filter((b)=>b!==a),this.cache.push(a),this.cache=this.cache.slice(this.cache.length-B.RecentlyUsedStorage.MAX_LENGTH),this.setLocalStorageItem(this.cache))}cleanStoryblockGuids(){this.cache=[];this.removeLocalStorageItem()}setLocalStorageItem(a){try{this.storage.setItem(this.localStorageKey,JSON.stringify(a))}catch(b){}}getLocalStorageItem(){try{return JSON.parse(this.storage.getItem(this.localStorageKey)||"[]")}catch(a){return[]}}removeLocalStorageItem(){this.storage.removeItem(this.localStorageKey)}};
B.RecentlyUsedStorage.MAX_LENGTH=10;var n={};Object.defineProperty(n,"__esModule",{value:!0});n.StoryblockOnboarding=class{static initUi(a,b){a.spotlight({id:"insert-topic-button-spotlight-id",overlay:null,highlights:[{around:{uiElementId:"add-topic-button-button"},shape:v.HoleShape.rounded,pulse:!0}]});a.spotlight({id:"default-topic-button-spotlight-id",overlay:null,highlights:[{around:{uiElementId:"storyblocks/snippet/Default"},shape:v.HoleShape.rect,pulse:!0,callout:{text:f.I18n.ts("Click here to insert a default topic into your presentation"),
onClose:()=>{n.StoryblockOnboarding.closeDefaultTopicSpotlight(b)}}}]});a.spotlight({id:"storyblock-insert-spotlight-id",overlay:null,highlights:[{around:{uiElementId:"selection-zoom-in-button"},shape:v.HoleShape.rounded,pulse:!0}]})}static initSpotlightState(a){const b=n.StoryblockOnboarding.isShowTopicSpotlightMode();a=b||a&&!a.getBoolean(E.UserSettingBooleanKeys.STORYBLOCKS_TOPIC_ONBOARDING_SHOWN);return{shouldSpotligthInsertTopicButton:b,shouldSpotligthDefaultTopicButton:b,shouldSpotligthInsertedTopic:a}}static isShowTopicSpotlightMode(){return t.isActive("js-topic-sidebar-onboarding-new-users")&&
t.isActive("js-editor-first-steps-onboarding")}static openInsertTopicButtonSpotlightIfActive(a){const {onboardingState:b}=a.getState();b.shouldSpotligthInsertTopicButton&&(a.setState({onboardingState:Object.assign(Object.assign({},b),{shouldSpotligthInsertTopicButton:!1})}),a.spotlight.open("insert-topic-button-spotlight-id"))}static openInsertedTopicSpotlightIfActive(a,b,c){const {onboardingState:d}=b.getState();d.shouldSpotligthInsertedTopic&&(b.setState({onboardingState:Object.assign(Object.assign({},
d),{shouldSpotligthInsertedTopic:!1}),insertedTopicSpotlightElementId:a}),c.setBoolean(E.UserSettingBooleanKeys.STORYBLOCKS_TOPIC_ONBOARDING_SHOWN,!0),b.spotlight.close("default-topic-button-spotlight-id"),b.spotlight.open("storyblock-insert-spotlight-id"))}static openDefaultTopicSpotlightIfActive(a,b){const {onboardingState:c}=a.getState();c.shouldSpotligthDefaultTopicButton&&(a.setState({onboardingState:Object.assign(Object.assign({},c),{shouldSpotligthDefaultTopicButton:!1})}),b.setBoolean(E.UserSettingBooleanKeys.STORYBLOCKS_TOPIC_ONBOARDING_SHOWN,
!0),a.spotlight.close("insert-topic-button-spotlight-id"),setTimeout(()=>a.spotlight.open("default-topic-button-spotlight-id"),500))}static closeDefaultTopicSpotlight(a){a.spotlight.close("default-topic-button-spotlight-id")}static closeInsertedTopicSpotlight(a){a.setState({insertedTopicSpotlightElementId:null});a.spotlight.close("storyblock-insert-spotlight-id")}};var A={},w=this&&A.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,
k){function l(a){try{f(d.next(a))}catch(F){k(F)}}function g(a){try{f(d["throw"](a))}catch(F){k(F)}}function f(a){a.done?c(a.value):e(a.value).then(l,g)}f((d=d.apply(a,b||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0});var h=r.base.ObjectKind,I=r.base.ShapeStyle,p;(function(a){a.Overview="overview";a.Planet="planet";a.Stack="stack"})(p=A.ParentType||(A.ParentType={}));var x;(function(a){a.Recommended="RECOMMENDED";a.Default="DEFAULT";a.Latest="LATEST"})(x||(x={}));var z;(function(a){a[a.Force=
0]="Force";a[a.OnlyIfError=1]="OnlyIfError"})(z||(z={}));class y{constructor(){this.toggleSidebar=()=>{const {isSidebarOpen:a,searchTerm:b}=this.uiRoot.getState();a?q.avro.Avro.createDefaultLogger().logCloseLibrarySidebar({library_sidebar_mode:null==b?"MAIN":"RESULTS"}):q.avro.Avro.createDefaultLogger().logInsertFromLibrary({library_sidebar_mode:null==b?"MAIN":"RESULTS",library_sidebar_trigger:"TOPMENU"});this.uiRoot.sidebar.toggle(y.SIDEBAR_ID)};this.logger=q.LoggerModule.getLoggerManager().createLogger("prezi_storyblocks.StoryblocksPlugin")}init(a){this.libraryProvider=
u.LibraryProviderModule.getLibraryProvider(a);this.recentlyUsedStorage=new B.RecentlyUsedStorage(this.userSettings.getUserId());a.onCurrentTopicChange((a)=>{switch(this.session.document.read((b)=>{b=b.lookup.base(a);return null!=b?b.kind:"overview"})){case "planetTopic":var b=p.Planet;break;case "page":b=p.Stack;break;case "overview":b=p.Overview;break;default:b=p.Overview}this.uiRoot.setState({parentType:b});var {insertedTopicSpotlightElementId:b}=this.uiRoot.getState();b&&n.StoryblockOnboarding.closeInsertedTopicSpotlight(this.uiRoot)});
this.uiRoot=a.declareUI({canUsePremium:!1,defaultStoryblocksDataState:{kind:"none"},foldersDataState:{kind:"none"},insertedTopicSpotlightElementId:null,isNetworkOffline:!1,isSidebarOpen:!1,onboardingState:n.StoryblockOnboarding.initSpotlightState(this.userSettings),parentType:p.Overview,recentlyUsedSnippets:[],recommendedStoryblocksDataState:{kind:"none"},resultSnippets:null,searchTerm:null,stackStoryblocksDataState:{kind:"none"},storyblocksDataState:{kind:"none"},storyblocksEnabled:!1,supportedGenerations:[],
supportedTypes:[u.SnippetType.Static,u.SnippetType.Animated]},(a,c)=>{n.StoryblockOnboarding.initUi(c,this.uiRoot);c.createMenuItem({id:"insertMenu/storyblocks",kind:g.MenuItemKind.largeButton,enabled:!a.isNetworkOffline,parent:g.TabMenuId.Insert,weight:1,title:f.I18n.ts("Story blocks"),icon:g.IconSmallId.Storyblocks,color:void 0,onClick:()=>{q.avro.Avro.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"STORY_BLOCKS"});this.toggleSidebar("TOP_MENU")}});c.createSidebar((b)=>this.createSidebarArgs(a,
b))});n.StoryblockOnboarding.openInsertTopicButtonSpotlightIfActive(this.uiRoot);a.onLicenseChange((a)=>{a=a.pitchExtraStoryblocks||t.isActive("js-storyblocks-plugin-force-premium");this.uiRoot.setState({canUsePremium:a})});a.onSelectionChange((a)=>{const {insertedTopicSpotlightElementId:b}=this.uiRoot.getState();!b||1===a.allObjects.length&&b===a.allObjects[0].id||n.StoryblockOnboarding.closeInsertedTopicSpotlight(this.uiRoot)});a.onNetworkStatusChange((a)=>{this.uiRoot.setState({isNetworkOffline:a===
g.NetworkStatus.Offline});this.loadAllData(z.OnlyIfError)})}createSidebarArgs(a,b){const {isNetworkOffline:c}=this.uiRoot.getState();return c?null:{id:y.SIDEBAR_ID,root:this.createRootPage(a,b),pages:this.createPages(a,b),onOpen:()=>{const a=this.session.document.read((a)=>a.meta.getSupportedGenerations());this.uiRoot.setState({isSidebarOpen:!0,supportedGenerations:a});this.loadAllData(z.Force);n.StoryblockOnboarding.openDefaultTopicSpotlightIfActive(this.uiRoot,this.userSettings)},onClose:()=>{this.uiRoot.setState({isSidebarOpen:!1})},
onCloseButtonClicked:()=>{q.avro.Avro.createDefaultLogger().logCloseLibrarySidebar({library_sidebar_mode:null==this.uiRoot.getState().searchTerm?"MAIN":"RESULTS"})},onPageBack:()=>{q.avro.Avro.createDefaultLogger().logBackFromLibraryResults()}}}loadAllData(a){const {isNetworkOffline:b}=this.uiRoot.getState();b||(this.loadFolders(a),this.loadStoryblocks(a),this.loadRecommendedStoryblocks(a));this.loadDefaultStoryblocks(a);this.loadStackStoryblocks(a)}createRootPage(a,b){return{title:f.I18n.ts("Story blocks"),
header:this.createHeaderContent(a,b),content:this.createRootPageContent(a,b)}}createHeaderContent(a,b){return n.StoryblockOnboarding.isShowTopicSpotlightMode()&&"stack"!==a.parentType?[this.createSearchField(b),...this.createDefaultStoryblockSection(a,b)]:[]}createLibrarySection(a){return[a.sectionHeader({content:f.I18n.ts("My Library")}),a.button(g.ButtonSize.Large,g.ButtonAlign.Start,(a)=>[a.button({id:"open-my-library-button",color:g.ButtonColor.Blue,content:{text:f.I18n.ts("Add from my library")},
onClick:()=>{this.pluginAccess.send(J.favorites,J.createOpenFavoritesFromAnotherSidebarMessage("storyblocks"))}})]),a.separator()]}createRootPageContent(a,b){return a.parentType===p.Stack?this.createStackRootPageContent(a,b):this.createStandardRootPageContent(a,b)}createStandardRootPageContent(a,b){const c=a.defaultStoryblocksDataState;return"loading"===a.foldersDataState.kind&&"loading"===c.kind?[b.spinner(g.SpinnerColor.neutral,v.SpinnerSize.l)]:n.StoryblockOnboarding.isShowTopicSpotlightMode()?
[...this.createMainAndRecommendationSection(a,b)]:[...this.createLibrarySection(b),this.createSearchField(b),...this.createDefaultStoryblockSection(a,b),...this.createMainAndRecommendationSection(a,b)]}createStackRootPageContent(a,b){return t.isActive("js-show-2-pages-in-stack-section")?"loading"===a.stackStoryblocksDataState.kind?[b.spinner(g.SpinnerColor.neutral,v.SpinnerSize.l)]:[...[b.label(f.I18n.ts("There are a wide variety of topic types available in addition to \u201cstack\u201d topic structures.")),
b.button(g.ButtonSize.Small,g.ButtonAlign.Start,(a)=>[a.button({id:"stack-learn-more-button",color:g.ButtonColor.Gray,content:{text:f.I18n.ts("Learn more")},onClick:()=>{q.avro.Avro.createDefaultLogger().logStackLearnMoreClicked();window.open("https://prez.is/9pbst46/","_blank")}})])],...this.createSectionWithSeparator(this.createRootPageStoryblockList(a.stackStoryblocksDataState,b,x.Default,"storyblocks/stack"),b)]:this.createStandardRootPageContent(a,b)}createMainAndRecommendationSection(a,b){switch(a.foldersDataState.kind){case "loading":return[b.spinner(g.SpinnerColor.neutral,
v.SpinnerSize.m)];case "success":return[...this.createRootMainResults(a,b),...this.createRootRecommendation(b)];case "error":return[b.illustration(f.I18n.ts("Something went wrong"),g.IllustrationLargeLightId.Error)];default:return[]}}createDefaultStoryblockSection(a,b){const c=a.parentType===p.Stack?a.stackStoryblocksDataState:a.defaultStoryblocksDataState;return null!=a.resultSnippets?[]:n.StoryblockOnboarding.isShowTopicSpotlightMode()?this.createRootPageStoryblockList(c,b,x.Default):this.createSectionWithSeparator(this.createRootPageStoryblockList(c,
b,x.Default),b)}createRootPageStoryblockList(a,b,c,d){switch(a.kind){case "loading":return[b.spinner(g.SpinnerColor.neutral,v.SpinnerSize.m)];case "success":return[...this.createStoryblockList(b,a.data,c,d)];case "error":return[b.illustration(f.I18n.ts("Something went wrong"),g.IllustrationLargeLightId.Error)];default:return[]}}createRootMainResults(a,b){return null!=a.resultSnippets?this.createSectionWithSeparator(this.createSnippetResultsBlock(b,a.resultSnippets),b):[...this.createRootRecentlyUsed(b),
...this.createSectionWithSeparator(this.createFolderList(b,this.getFolders()),b)]}createRootRecommendation(a){const b=this.getRecommendedStoryblocks();return this.createSnippetResultsBlock(a,b,f.I18n.ts("Recommended"),x.Recommended,"storyblocks/recommended",!0)}createRootRecentlyUsed(a){const {recentlyUsedSnippets:b}=this.uiRoot.getState();return this.createSectionWithSeparator(this.createSnippetResultsBlock(a,b,f.I18n.ts("Recently used"),x.Latest,"storyblocks/recentlyused",!0),a)}createPages(a,b){const c=
{};this.getFolders().forEach((d)=>{c[d.key]=this.createPage(a,b,d.key)});return c}createPage(a,b,c){const d=this.getFolders().find((a)=>a.key===c);return null==d?{title:"",content:null}:{title:d.title,content:this.createPageContent(a,b,d)}}createPageContent(a,b,c){switch(a.storyblocksDataState.kind){case "loading":return[b.spinner(g.SpinnerColor.neutral,v.SpinnerSize.l)];case "error":return[b.illustration(f.I18n.ts("Something went wrong"),g.IllustrationLargeLightId.Error)];case "success":return null==
a.resultSnippets?this.createPageWithAllResults(b,c):this.createPageWithSearchResults(a,b,c);default:return null}}createPageWithAllResults(a,b){const {parentType:c}=this.uiRoot.getState();let d=this.getStoryblocks().filter((a)=>a.folderKey===b.key);c===p.Stack&&(d=d.filter((a)=>a.snippetType!==u.SnippetType.Animated));this.uiRoot.getState().canUsePremium||(d=d.sort(this.compareFreeItemFirst));return b?0<d.length?[this.createSearchField(a),...this.createStoryblockList(a,d)]:[a.illustration(c===p.Stack?
f.I18n.ts("This category of storyblocks is only available on the overview and within planet topic types."):f.I18n.ts("No story blocks in this folder"),g.IllustrationLargeLightId.NoResults)]:null}createSectionWithSeparator(a,b){return a&&0!==a.length?[...a,b.separator()]:[]}createPageWithSearchResults(a,b,c){const d=[],e=[];if(a.resultSnippets)for(const b of a.resultSnippets)b.folderKey===c.key?d.push(b):e.push(b);a=[this.createSearchField(b)];a=a.concat(this.createSnippetResultsBlock(b,d,f.I18n.tsFormatKeys("In {title}",
{title:c.title})));0<e.length?a=a.concat(this.createSnippetResultsBlock(b,e,f.I18n.ts("In other folders"))):(c=this.getRecommendedStoryblocks(),0<c.length&&(a=a.concat(this.createSnippetResultsBlock(b,c,f.I18n.ts("Recommended"),x.Recommended,"storyblocks/recommended",!0))));return a}createSnippetResultsBlock(a,b,c,d,e,l=!1){let k=[];const h=this.uiRoot.getState().storyblocksDataState.kind;c&&(l&&"loading"!==h&&"error"!==h&&0===b.length||(k=k.concat(a.sectionHeader({content:c}))));if(0===b.length)switch(h){case "loading":k=
k.concat(a.spinner(g.SpinnerColor.neutral,v.SpinnerSize.l));break;case "success":l||(k=k.concat(a.illustration(f.I18n.tsFormatKeys("No results for {search_term}",{search_term:this.uiRoot.getState().searchTerm}),g.IllustrationLargeLightId.NoResults)));break;case "error":k=k.concat(a.illustration(f.I18n.ts("Something went wrong"),g.IllustrationLargeLightId.Error))}else k=k.concat(this.createStoryblockList(a,b,d,e,l));return k}processMessage(a){return w(this,void 0,void 0,function*(){switch(a.kind){case "openStoryblocksSidebar":this.uiRoot.sidebar.open(y.SIDEBAR_ID);
this.search(a.searchTerm,!1);q.avro.Avro.createDefaultLogger().logInsertFromLibrary({library_sidebar_mode:a.searchTerm?"RESULTS":"MAIN",library_sidebar_trigger:"DEEPLINK"});break;default:R.Utils.assertNever(a.kind)}})}createFolderList(a,b){const c=[];c.push(a.sectionHeader({content:f.I18n.ts("Explore")}));const d=b.filter((a)=>"basic-layout"!==a.key);0<d.length?(a=a.simpleList((a)=>({items:d.map((b)=>a.folder({src:{url:b.thumbnail},title:b.title,onClick:()=>{this.uiRoot.sidebar.open(y.SIDEBAR_ID,
b.key);n.StoryblockOnboarding.closeDefaultTopicSpotlight(this.uiRoot);q.avro.Avro.createDefaultLogger().logSelectLibraryCategory({library_category_id:b.key})},dataLookup:`storyblocks/folder/${b.key}`})),itemType:g.ListItemType.large,itemLayout:g.ListItemLayout.dynamic,showTitle:!0,id:"storyblocks/folderlist"})),c.push(a)):c.push(a.illustration(f.I18n.ts("No results"),g.IllustrationLargeLightId.NoResults));return c}createStoryblockList(a,b,c,d="storyblocks/snippetlist",e=!1){const {canUsePremium:l,
parentType:k}=this.uiRoot.getState();let h=b;k===p.Stack&&(h=h.filter((a)=>a.snippetType!==u.SnippetType.Animated));return 0<h.length?(b=[],b.push(a.simpleList((a)=>({items:h.map((b)=>this.createStoryblockItem(a,b,l,c)),itemType:g.ListItemType.full,itemLayout:g.ListItemLayout.dynamic,showTitle:!0,id:d}))),b):e?[]:[a.illustration(f.I18n.ts("No results"),g.IllustrationLargeLightId.NoResults)]}createStoryblockItem(a,b,c,d){if(b.isPremium&&!c)return a.lock({src:{url:b.thumbnail},title:b.title,tooltipText:f.I18n.ts("Unlock"),
dataLookup:"storyblocks/snippet",onClick:()=>this.openPaywallModal()});c=b.thumbnail;null!=c&&(b.thumbnail=c);c={src:{url:c},onDrop:(a,c)=>{this.insertSnippet(a,b,c.dropKind,d)},title:b.title,dataLookup:`storyblocks/snippet/${b.title}`,disabled:this.uiRoot.getState().parentType===p.Stack&&b.snippetType===u.SnippetType.Animated};null!=b.video&&(c.hoverContent={type:g.HoverContentType.video,url:b.video});return a.droppableImage(c)}openPaywallModal(){this.uiRoot.dialog.showBuiltIn(g.BuiltinDialog.upgradeLicenseStoryblocks)}withCopyData(a){return w(this,
void 0,void 0,function*(){let b=null;b="url"===a.content.kind?yield fetch(a.content.dataUrl).then((a)=>a.text()):a.content.data;return Object.assign(Object.assign({},a),{copyData:yield this.session.document.parseCopyDataAsync(b)})})}insertSnippet(a,b,c){a.doAsync(this.withCopyData(b),(a,b)=>{a.isValid()&&this.session.document.executeApiCommand(a,{name:"insertSnippet",run:(d)=>{let e=this.session.insertTarget.getSimpleObjectParent(d),f=!1;e.is(h.planetTopic)||e.is(h.overview)?f=this.insertPlanetTopicSnippet(a,
d,e,b):e.is(h.page)&&(e=e.parent.add.page(e.index+1),e.simpleChildren(r.base.ChildVisibilityKind.all).forEach((a)=>a.delete()),this.session.navigation.focusTo(a,e),f=this.insertStackTopicSnippet(a,d,e,b));d=this.getLoggerTopicType(e);f&&null!=d&&q.avro.Avro.createDefaultLogger().logInsertLibraryStoryblock({insert_method:c===g.DropKind.drag?"DRAG":"SINGLE_CLICK",library_storyblock_id:`${b.folderKey}.${b.title}`,target_object_id:e.id,topic_type:d});f&&this.updateRecentlyUsedStoryblocks(b.guid)}})})}updateRecentlyUsedStoryblocks(a){a&&
this.recentlyUsedStorage.addStoryblockGuid(a);a=this.processRecentlyUsedStoryblocks();this.uiRoot.setState({recentlyUsedSnippets:a})}processRecentlyUsedStoryblocks(){var a=this.recentlyUsedStorage.getStoryblockGuids(),b=this.getStoryblocks(),c=this.getDefaultStoryblocks();const d=this.getRecommendedStoryblocks();b=[...b,...c,...d];c=[];for(let d of a)if((a=b.find((a)=>a.guid===d))&&c.push(a),c.length>=y.RECENTLY_USED_MAX_LENGHT)break;return c}insertPlanetTopicSnippet(a,b,c,d){let e=null,f=!1;b=(b=
this.session.selection.getSelectionInfo(b).allObjects.find((a)=>a.is(h.topic)))?b.index+1:c.topicChildren.length;d.snippetType===u.SnippetType.Static?(e=K(c,b,d,null),d=e.add.inserter(d.copyData),d.isValid()&&(H(e,d),f=!0)):d.snippetType===u.SnippetType.Animated&&c.is(h.topicParent)&&(e=O(c,d.copyData,b,null),f=null!=e);f&&e&&(Q(e,c),this.session.selection.setSelection(a,[e]),n.StoryblockOnboarding.openInsertedTopicSpotlightIfActive(e.id,this.uiRoot,this.userSettings));return f}insertStackTopicSnippet(a,
b,c,d){return d.snippetType===u.SnippetType.Static&&(b=c.add.inserter(d.copyData),b.isValid())?(c=H(c,b),this.session.selection.setSelection(a,c),!0):!1}createSearchField(a){const b=()=>{const a=this.uiRoot.getState().searchTerm;this.search(a,!0)};return a.searchField({id:"search-input-field",onSearchButtonClick:b,onEnter:b,onValueChange:(a,b)=>{""===b?(q.avro.Avro.createDefaultLogger().logBackFromTopicResults({topic_search_cleared_trigger:"FIELDCLEARED"}),this.uiRoot.setState({resultSnippets:null,
searchTerm:null})):this.uiRoot.setState({searchTerm:b})},value:this.uiRoot.getState().searchTerm,placeholderText:f.I18n.ts("Search"),autofocus:!0})}search(a,b){if(null!=a&&""!==a){const c=this.getSearchResults(a,this.getStoryblocks());this.uiRoot.setState({resultSnippets:c,searchTerm:a});b&&q.avro.Avro.createDefaultLogger().logSearchInLibrary({search_term:a})}}getRecommendedStoryblocks(){const {recommendedStoryblocksDataState:a,parentType:b}=this.uiRoot.getState();let c=[];"success"===a.kind&&(c=
a.data.filter((a)=>!(b===p.Stack&&a.snippetType===u.SnippetType.Animated)));return c}normalizeSearchTerm(a){return a.toLowerCase().trim()}getSearchResults(a,b){if(null==b)return[];const c=this.normalizeSearchTerm(a),d=(a)=>a.find((a)=>0<=a.indexOf(c));a=b.filter((a)=>0<=a.title.toLowerCase().indexOf(c)||d(a.keywords));this.uiRoot.getState().canUsePremium||(a=a.sort(this.compareFreeItemFirst));return a}compareFreeItemFirst(a,b){return a.isPremium===b.isPremium?0:a.isPremium?1:-1}getLoggerTopicType(a){switch(a.kind){case h.overview:return"TOPIC_PLANET";
case h.planetTopic:switch(a.parent.kind){case h.overview:return"TOPIC_PLANET";default:return"SUBTOPIC_PLANET"}case h.page:return"SUBTOPIC_PAGE";default:return null}}loadFolders(a){return w(this,void 0,void 0,function*(){const {foldersDataState:b}=this.uiRoot.getState();if(a!==z.OnlyIfError||"success"!==b.kind){this.uiRoot.setState({foldersDataState:{kind:"loading"}});try{const a=(yield this.libraryProvider.getFolders()).map((a)=>({key:a.key,thumbnail:a.thumbnailUrl,title:a.title}));this.uiRoot.setState({foldersDataState:{kind:"success",
folderData:a}})}catch(c){this.uiRoot.setState({foldersDataState:{kind:"error"}}),t.isActive("js-library-mock-throw-exception")||this.logger.error({action:"error",object:"storyblocks-load",trigger:"machine",payload:{error:`${c}`}})}}})}loadStoryblocks(a){return w(this,void 0,void 0,function*(){var {storyblocksDataState:b}=this.uiRoot.getState();if(a!==z.OnlyIfError||"success"!==b.kind){this.uiRoot.setState({storyblocksDataState:{kind:"loading"}});var {supportedGenerations:b,supportedTypes:c}=this.uiRoot.getState();
try{const a=t.isActive("js-storyblocks-use-v2")?(yield this.libraryProvider.getStoryblocksV2(b,c)).map(this.convertSnippetApiModelV2ToSnippetData):(yield this.libraryProvider.getStoryblocks(b,c)).map(this.convertSnippetApiModelToSnippetData);this.uiRoot.setState({storyblocksDataState:{kind:"success",data:a}});this.updateRecentlyUsedStoryblocks();const {searchTerm:e}=this.uiRoot.getState();this.search(e,!1)}catch(d){this.uiRoot.setState({storyblocksDataState:{kind:"error"}}),t.isActive("js-library-mock-throw-exception")||
this.logger.error({action:"error",object:"storyblocks-load",trigger:"machine",payload:{error:`${d}`}})}}})}loadDefaultStoryblocks(a){return w(this,void 0,void 0,function*(){this.loadStoryblocksWithStatus(()=>this.libraryProvider.getDefaultTopics(),"defaultStoryblocksDataState","default",!1,a)})}loadRecommendedStoryblocks(a){return w(this,void 0,void 0,function*(){const {canUsePremium:b,supportedGenerations:c,supportedTypes:d}=this.uiRoot.getState();this.loadStoryblocksWithStatus(()=>t.isActive("js-storyblocks-use-v2")?
this.libraryProvider.getRecommendedTopicsV2(c,d):this.libraryProvider.getRecommendedTopics(c,d),"recommendedStoryblocksDataState","recommended",!b,a)})}loadStackStoryblocks(a){return w(this,void 0,void 0,function*(){this.loadStoryblocksWithStatus(()=>this.libraryProvider.getStackTopics(),"stackStoryblocksDataState","stack",!1,a)})}loadStoryblocksWithStatus(a,b,c,d=!1,e){return w(this,void 0,void 0,function*(){const f=this.uiRoot.getState()[b].kind;if(e!==z.OnlyIfError||"success"!==f){this.uiRoot.setState({[b]:{kind:"loading"}});
try{const c=(yield a()).map((a)=>a.data.dataUrl?this.convertSnippetApiModelV2ToSnippetData(a):this.convertSnippetApiModelToSnippetData(a));this.uiRoot.setState({[b]:{kind:"success",data:d?c.sort(this.compareFreeItemFirst):c}})}catch(k){this.uiRoot.setState({[b]:{kind:"error"}}),t.isActive("js-library-mock-throw-exception")||this.logger.error({action:"error",object:`${c}-storyblocks-load`,trigger:"machine",payload:{error:`${k}`}})}}})}getDefaultStoryblocks(){const a=this.uiRoot.getState().defaultStoryblocksDataState;
return"success"===a.kind?a.data:[]}getStoryblocks(){const a=this.uiRoot.getState().storyblocksDataState;return"success"===a.kind?a.data:[]}getFolders(){const a=this.uiRoot.getState().foldersDataState;return"success"===a.kind?a.folderData:[]}convertSnippetApiModelToSnippetData(a){return{guid:a.guid,content:{kind:"serialized",data:a.data.data},thumbnail:a.data.thumbnailUrl,keywords:a.keywords,title:a.title,folderKey:0<a.folderKey.length?a.folderKey[0]:null,isPremium:!a.isFree,video:a.data.videoThumbnailUrl,
snippetType:a.snippetType}}convertSnippetApiModelV2ToSnippetData(a){return{guid:a.guid,content:{kind:"url",dataUrl:a.data.dataUrl},thumbnail:a.data.thumbnailUrl,keywords:a.keywords,title:a.title,folderKey:0<a.folderKey.length?a.folderKey[0]:null,isPremium:!a.isFree,video:a.data.videoThumbnailUrl,snippetType:a.snippetType}}}A.StoryblocksPlugin=y;y.SIDEBAR_ID="storyblocks-sidebar";y.RECENTLY_USED_MAX_LENGHT=3;const D={inCircle:.9,inZoom:.8,onCover:.8};m={};Object.defineProperty(m,"__esModule",{value:!0});
m.lazyModule={createPlugin(){return new A.StoryblocksPlugin}};return m});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_storyblocks",["require","prezi.geometry","prezi_cet_model_editor","prezi_editor_commander","prezi_featureswitcher","prezi_i18n","prezi_libraryprovider","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_select","prezi_service_data","prezi_utils","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_storyblocks.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.geometry"),require("prezi_cet_model_editor"),require("prezi_editor_commander"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_libraryprovider"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_select"),require("prezi_service_data"),require("prezi_utils"),require("prezi_widgets"));}else{this["prezi_storyblocks"]=__factory(this["prezi.geometry"],this["prezi_cet_model_editor"],this["prezi_editor_commander"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_libraryprovider"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_select"],this["prezi_service_data"],this["prezi_utils"],this["prezi_widgets"]);}}).call(this);