;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_narrative_editor";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_cet_model_editor":dependencies[0],"prezi_featureswitcher":dependencies[1],"prezi_i18n":dependencies[2],"prezi_plugin_api":dependencies[3],"prezi_plugin_meta":dependencies[4],"prezi_thumbnail_render":dependencies[5],"prezi_utils":dependencies[6]}};})());};})(arguments);var moduleImpl=(function(){return module(function(d){var e=d.dependencies.prezi_plugin_api,k=d.dependencies.prezi_i18n,r=d.dependencies.prezi_cet_model_editor,n=d.dependencies.prezi_utils,p=d.dependencies.prezi_thumbnail_render,g={};Object.defineProperty(g,"__esModule",{value:!0});var m=r.base.ObjectKind,l;(function(a){a.sidebar="sidebar";a.paywall="paywall"})(l||(l={}));var h;(function(a){a.forward="forward";a.backward="backward"})(h||(h={}));const q=p.ThumbnailSize._224;g.i=class{init(a){this.f=a.declareUI({narrative:null,pathElementId:null,
w:null,fa:null,sidebarOpened:!1,ba:!1,ca:!1,da:!1,ea:null},(a,c)=>{this.createSidebar(c,a);this.ja(c,a)});a.onDocumentChange(()=>{const a=this.f.getState().pathElementId;null!=a&&this.aa(a)});a.onLicenseChange((a)=>{this.f.setState({da:a.presenterView})});a.onNavigation((a)=>{this.f.setState({ea:a.pathElementRef});this.f.getState().sidebarOpened&&this.ga(a.pathElementRef.id)});p.ThumbnailRenderModule.getThumbnailService().then((a)=>this.$=a)}createSidebar(a,b){a.createSidebar((a)=>({id:g.i.u,root:{title:k.I18n.ts("Presenter Notes"),
content:[a.simpleList((a)=>{var c;return{itemType:e.ListItemType.full,itemLayout:e.ListItemLayout.dynamic,showTitle:!0,items:[a.image({id:"narrative-thumbnail",src:{url:null!==(c=b.w)&&void 0!==c?c:""},title:b.fa})]}}),a.textarea({id:"narrative-text-area",placeholderText:k.I18n.ts("Click to add presenter notes"),value:b.narrative,onValueChange:(a,c)=>{this.updateNarrative(a,b.pathElementId,c)},rows:20,flexibleHeight:!0}),a.button(e.ButtonSize.Small,e.ButtonAlign.Center,(a)=>[a.button({id:"narration-navigate-back",
color:e.ButtonColor.Ghost,content:{icon:e.IconSmallId.ArrowLineLeft},disabled:!b.ca,onClick:(a)=>this.navigate(a,h.ia)}),a.button({id:"narration-navigate-next",color:e.ButtonColor.Blue,content:{text:k.I18n.ts("Next")},disabled:!b.ba,onClick:(a)=>this.navigate(a,h.forward)})])]},onClose:()=>{this.f.setState({narrative:null,pathElementId:null,sidebarOpened:!1});null!=this.o&&(this.o.cancel(),this.o=null)}}))}ja(a,b){const c=b.sidebarOpened?k.I18n.ts("Hide Presenter Notes"):k.I18n.ts("Show Presenter Notes");
a.createPropertyBarItem((a)=>a.button({id:"property-bar-open-narrative-editor",weight:201,parent:e.PropertyBarId.Right,enabled:!0,icon:e.IconSmallId.PresenterNotes,tooltip:c,onClick:()=>{const a=this.f.getState();a.sidebarOpened?this.closeSidebar():this.openSidebar(a.ea.id)}}))}updateNarrative(a,b,c){this.f.setState({narrative:c});null!=this.j?this.j(c):a.doAsync(new Promise((a)=>{let b;this.j=(c)=>{null!=b&&clearTimeout(b);b=setTimeout(()=>a(c),1E3)};this.j(c)}),(a,c)=>{this.j=null;let f=!1;a.isValid()&&
(f=this.session.document.executeApiCommand(a,{name:"update narrative",run:(a)=>{a=a.lookup.pathElement(b);if(null==a)return!1;a.narrative=c;return!0}}));f||this.f.sidebar.close(g.i.u)})}processMessage(a){switch(a.kind){case "openSidebar":const b=a.body;this.openSidebar(b)===l.sidebar&&this.session.document.read((c)=>{c=c.lookup.pathElement(b);a.aat.isValid()&&this.session.navigation.goToPathElement(a.aat,c)});break;default:throw n.Utils.assertNever(a.kind);}}ha(a){null!=this.$&&(null!=this.o&&this.o.cancel(),
this.o=this.$.monitorPath({size:q,needHighQuality:!0,includePathElement:(b)=>b.id===a}),this.o.getThumbnailStream().onValue((a)=>{this.f.setState({w:a.canvas.toDataURL()})}))}openSidebar(a){if(this.f.getState().da)return this.j=null,this.ga(a),this.f.sidebar.open(g.i.u),this.f.setState({sidebarOpened:!0}),l.sidebar;this.f.dialog.showBuiltIn(e.BuiltinDialog.upgradeLicensePresenterView);return l.ka}ga(a){this.aa(a);this.ha(a)}closeSidebar(){this.f.sidebar.close(g.i.u);this.f.setState({sidebarOpened:!1})}aa(a){const b=
this.session.document.read((c)=>{var b,e,f=c.lookup.pathElement(a);c=c.structuredPath.viewPathElementsInOrder;if(null==f)return null;const d=f.is(m.visitStack)?f.children[0]:f;if(null==c.find((a)=>a.id===d.id))return null;const g=c.findIndex((a)=>!this.v(a));let h=c.length-1;for(;this.v(c[h]);)--h;f=null===(b=this.$)||void 0===b?void 0:b.getCachedCanvasForPathElement(f,q);b=this.f.getState();return{pathElementId:d.id,narrative:b.pathElementId===d.id&&null!=this.j?b.narrative:d.narrative,fa:d.title,
ca:c[g].id!==a,ba:c[h].id!==a,w:null===(e=null===f||void 0===f?void 0:f.canvas)||void 0===e?void 0:e.toDataURL("image/png")}});null!=b?this.f.setState(Object.assign({},b)):this.closeSidebar()}navigate(a,b){let c;switch(b){case h.forward:c=1;break;case h.ia:c=-1;break;default:throw n.Utils.assertNever(b);}b=this.session.document.executeApiCommand(a,{name:"narration-navigate",run:(b)=>{b=b.structuredPath.viewPathElementsInOrder;let d=b.findIndex((a)=>a.id===this.f.getState().pathElementId)+c;for(;this.v(b[d]);)d+=
c;this.session.navigation.goToPathElement(a,b[d]);return b[d].id}});this.aa(b);this.ha(b)}v(a){return a.is(m.fadeIn)||a.is(m.fadeOut)}};g.i.u="narrative-sidebar";d={};Object.defineProperty(d,"__esModule",{value:!0});d.lazyModule={createPlugin(){return new g.i}};return d});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_narrative_editor",["require","prezi_cet_model_editor","prezi_featureswitcher","prezi_i18n","prezi_plugin_api","prezi_plugin_meta","prezi_thumbnail_render","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_narrative_editor.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_cet_model_editor"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_thumbnail_render"),require("prezi_utils"));}else{this["prezi_narrative_editor"]=__factory(this["prezi_cet_model_editor"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_thumbnail_render"],this["prezi_utils"]);}}).call(this);