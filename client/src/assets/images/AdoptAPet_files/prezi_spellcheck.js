;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_spellcheck";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.text.model":dependencies[0],"prezi_bacon":dependencies[1],"prezi_cet":dependencies[2],"prezi_cet_model":dependencies[3],"prezi_cet_model_editor":dependencies[4],"prezi_editor_store_ui":dependencies[5],"prezi_logger":dependencies[6],"prezi_utils":dependencies[7]}};})());};})(arguments);var moduleImpl=(function(){return module(function(e){var y=e.dependencies.prezi_bacon,m=e.dependencies.prezi_cet,v=e.dependencies.prezi_cet_model_editor,w=e.dependencies.prezi_logger,n=e.dependencies.prezi_cet_model,h={getSpellcheckComponentKey:function(){null==p&&(p=n.CetModel.createValueComponentKey("spelling-mistakes",!1,!1,!0));return p}};Object.defineProperty(h,"__esModule",{value:!0});let p;var f={},x=this&&f.za||function(a,b,c,k){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,
e){function h(a){try{g(k.next(a))}catch(l){e(l)}}function f(a){try{g(k["throw"](a))}catch(l){e(l)}}function g(a){a.done?c(a.value):d(a.value).then(h,f)}g((k=k.apply(a,b||[])).next())})};Object.defineProperty(f,"__esModule",{value:!0});f.v=class{constructor(a,b){this.u=a;this.Ka=b;this.ia=[];this.ka=[]}spell(a,b){this.ia.push(b);this.f.postMessage({action:"spell",word:a})}suggest(a,b){this.ka.push(b);this.f.postMessage({action:"suggest",word:a})}init(){return x(this,void 0,void 0,function*(){const [a,
b,c,k,d]=yield Promise.all([(yield fetch(e.getResourceUrl("hunspell-worker.js"))).blob(),(yield fetch(e.getResourceUrl("hunspell.js.mem"))).blob(),(yield fetch(e.getResourceUrl("hunspell.js"))).blob(),this.$(".aff"),this.$(".dic")]);return{workerURL:URL.createObjectURL(a),memURL:URL.createObjectURL(b),jsURL:URL.createObjectURL(c),affData:k,wordsData:d}})}initWorker(a){let b;this.f=new Worker(a.workerURL);this.f.postMessage({action:"start",memURL:a.memURL,jsURL:a.jsURL});this.f.onmessage=(c)=>{switch(c.data.action){case "ready":this.f.postMessage({action:"create",
aff:a.affData,dic:a.wordsData});break;case "create":this.Ka();break;case "spell":b=this.ia.shift();b(c.data.correct);break;case "suggest":b=this.ka.shift(),b(c.data.suggestions)}}}$(a,b=1){return x(this,void 0,void 0,function*(){try{return yield(yield fetch(`${f.v.pa}${this.u}/${this.u}${a}`)).arrayBuffer()}catch(c){return b<f.v.O?this.$(a,b+1):Promise.reject("ERROR: downloading dictionaries failed")}})}};f.v.pa="https://s3.amazonaws.com/prezi-spellcheck-assets/dictionaries/";f.v.O=3;var d={},z=this&&
d.za||function(a,b,c,k){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,e){function g(a){try{f(k.next(a))}catch(l){e(l)}}function h(a){try{f(k["throw"](a))}catch(l){e(l)}}function f(a){a.done?c(a.value):d(a.value).then(g,h)}f((k=k.apply(a,b||[])).next())})};Object.defineProperty(d,"__esModule",{value:!0});d.i=class{constructor(){this.ga=!1}init(){const a=Promise.all(d.i.qa.map((a)=>this.fa(a))),b=new Promise((a)=>{window.require([e.getResourceUrl("langdetect.js")],
(b)=>{a(b)})});return Promise.all([b,a]).then(([a,b])=>{this.U=a.createDetector(b);this.ga=!0})}fa(a,b=0){return z(this,void 0,void 0,function*(){try{return yield $.ajax({url:`${d.i.ua}${a}`,dataType:"text"})}catch(c){return b<d.i.O?this.fa(a,b+1):Promise.reject("ERROR: downloading language profile failed for: "+a)}})}profilesLoaded(){return this.ga}getDetectedLanguage(){return this.u}detect(a){if(null!=this.u)return 3;if(this.profilesLoaded()){if(null==this.U)return 4;const b=v.CetModelEditor.createTextHelper();
let c=0;a.getEntityList().forEach((a)=>{a.isDef(n.CetModel.ID.Z_TEXT)&&!b.isPlaceholder(a)&&(a=m.Cet.shapedText(a).getRawText(),c+=a.split(/[\s]+/).length,this.U.appendString(a))});if(c<d.i.ta)return 0;try{const a=this.U.getProbabilities();if(a[0].prob<d.i.sa)return 1;if(-1===d.i.va.indexOf(a[0].lang))return w.avro.Avro.createDefaultLogger().logDetectedLanguageAutomatically({dictionary_language:a[0].lang}),2;this.u=a[0].lang;w.avro.Avro.createDefaultLogger().logDetectedLanguageAutomatically({dictionary_language:this.u});
return 3}catch(k){return 1}}return 4}};d.i.ta=8;d.i.sa=.95;d.i.qa="af ar bg bn cs da de el en es et fa fi fr gu he hi hr hu id it ja kn ko lt lv mk ml mr ne nl no pa pl pt ro ru sk sl so sq sv sw ta te th tl tr uk ur vi zh-cn zh-tw".split(" ");d.i.va="en de es fr it hu pt".split(" ");d.i.ua="https://s3.amazonaws.com/prezi-spellcheck-assets/language_profiles/";d.i.O=3;var g={};Object.defineProperty(g,"__esModule",{value:!0});g.o=class{constructor(a,b){this.entity=a;this.f=b;this.ba=this.ea=this.oa=
0;this.J="spellchecking";this.jobId=g.o.Ja++;this.L=a.get(h.getSpellcheckComponentKey())||{}}getId(){return this.jobId.toString()}getEntity(){return this.entity}getText(){return m.Cet.shapedText(this.entity).getRawText()}isDone(){return"done"===this.J}executeSpellcheck(){switch(this.J){case "spellchecking":this.Da();break;case "waiting_suggestions":this.La()}}updateScene(a){null!=this.L?this.Aa(a):this.Ga(a)}Da(){if(!this.entity.isDisposed()){const a=m.Cet.shapedText(this.entity).getRawText().match(/(?:[a-zA-Z'\d\u00C0-\u02AF\uac00-\ud7a3])+/g);
null!=a&&(new Set(a)).forEach((a)=>{this.oa++;this.f.spell(a,(b)=>{b?this.ea++:(this.ba++,this.suggest(a))})});this.j("waiting_suggestions")}}La(){this.oa===this.ba+this.ea&&Object.keys(this.L).length===this.ba&&this.j("done")}suggest(a){null==this.L[a]&&this.f.suggest(a,(b)=>{this.L[a]=b.slice(0,g.o.ra)})}Aa(a){a=a.getEntityById(this.entity.getId());null!=a&&a.set(h.getSpellcheckComponentKey(),this.L)}Ga(a){this.entity.hasComponent(h.getSpellcheckComponentKey())&&(a=a.getEntityById(this.entity.getId()),
null!=a&&a.discardOwnComponent(h.getSpellcheckComponentKey()))}j(a){this.J=a}};g.o.Ja=0;g.o.ra=5;var q={};Object.defineProperty(q,"__esModule",{value:!0});q.ya=class{constructor(){this.la=y.Bacon.newBus()}aa(a){a.onValue((a)=>this.Ba(a))}Ba(a){for(let b of a)if(b.type===n.ChangeType.ModifyComponent&&null!=b.componentKey&&b.componentKey===m.Cet.getShapedTextKey()){a=null!=b.entities?b.entities:null!=b.entity?[b.entity]:[];for(const b of this.Ea(a))this.la.push({entity:b})}}Ea(a){const b=[];for(const c of a)c.isDef(n.CetModel.ID.Z_TEXT)&&
m.Cet.hasShapedText(c)&&b.push(c);return b}};var r={};Object.defineProperty(r,"__esModule",{value:!0});r.xa=class{constructor(a,b,c=""){this.scene=a;this.N=b;this.ha=c;this.w=!1;this.na=v.CetModelEditor.createTextHelper();this.init()}getName(){return"Spellchecker"+(null!=this.ha?"-"+this.ha:"")}getId(){return"SpellcheckerWorker"}update(){if(this.da)return-1;let a=200;switch(this.J){case 0:this.K.init().catch((a)=>{console.error(a);this.cancel()});this.j(1);a=0;break;case 1:this.K.profilesLoaded()&&
this.j(2);a=0;break;case 2:switch(this.K.detect(this.scene)){case 3:this.j(3);a=0;break;case 1:case 4:case 0:a=300;break;case 2:this.cancel()}break;case 3:const b=this.K.getDetectedLanguage()||"";""!==b&&null==this.f&&(this.N.push("ENABLED"),this.f=new f.v(b,()=>this.j(4)),this.f.init().then((a)=>this.f.initWorker(a)));break;case 4:this.Fa();this.j(5);a=0;break;case 5:this.Ha(),this.w&&(a=0)}return a}aa(a){this.ma.aa(a);this.ma.la.onValue((a)=>{this.M.push(a)})}cancel(){this.da=!0}reset(){this.init()}getLanguage(){return this.K.getDetectedLanguage()||
""}init(){this.K=new d.i;this.da=!1;this.M=[];this.w=!1;this.ma=new q.ya;this.m={};this.j(0)}Fa(){this.scene.getEntityList().forEach((a)=>{a.isDef(n.CetModel.ID.Z_TEXT)&&!this.na.isPlaceholder(a)&&(this.m[a.getId()]=new g.o(a,this.f))})}Ha(){if(this.w||0!==this.M.length){var a=(new Date).getTime()+16,b=this.M.slice();this.M=[];b.forEach((a)=>{a=a.entity;null==a||this.na.isPlaceholder(a)||(this.m[a.getId()]=new g.o(a,this.f))});var c=[];for(const b of Object.keys(this.m)){if((new Date).getTime()>a){this.w=
0<Object.keys(this.m).length;break}this.m[b].executeSpellcheck();this.m[b].isDone()&&(c.push(this.m[b]),delete this.m[b])}this.scene.requestNoDomBatchUpdate((a)=>{for(const b of c)b.updateScene(a)});this.w=0<Object.keys(this.m).length}}j(a){this.J=a}};var t={};Object.defineProperty(t,"__esModule",{value:!0});t.wa=class{constructor(a,b,c,d){this.Ca=b;this.N=d;this.ja="NOT_INITIALIZED";this.scene=c;this.N.onValue((a)=>this.ja=a);this.Ia(a)}Ia(a){this.ca=new r.xa(this.scene,this.N);a.addIdleWorker(this.ca,
500);this.ca.aa(this.Ca)}isWordCorrect(a,b){const c=h.getSpellcheckComponentKey();return b.hasComponent(c)?(b=b.get(c),!(a in b)):!0}getSuggestions(a,b){const c=h.getSpellcheckComponentKey();return b.hasComponent(c)&&(b=b.get(c),a in b)?b[a]:[]}getLanguage(){return this.ca.getLanguage()}isSpellcheckEnabled(){return"ENABLED"===this.ja}};var u={createSpellcheckerService:function(a,b,c,d){return new t.wa(a,b,c,d)}};Object.defineProperty(u,"__esModule",{value:!0});u.getSpellcheckComponentKey=h.getSpellcheckComponentKey;
return u});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_spellcheck",["require","prezi.text.model","prezi_bacon","prezi_cet","prezi_cet_model","prezi_cet_model_editor","prezi_editor_store_ui","prezi_logger","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_spellcheck.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.text.model"),require("prezi_bacon"),require("prezi_cet"),require("prezi_cet_model"),require("prezi_cet_model_editor"),require("prezi_editor_store_ui"),require("prezi_logger"),require("prezi_utils"));}else{this["prezi_spellcheck"]=__factory(this["prezi.text.model"],this["prezi_bacon"],this["prezi_cet"],this["prezi_cet_model"],this["prezi_cet_model_editor"],this["prezi_editor_store_ui"],this["prezi_logger"],this["prezi_utils"]);}}).call(this);