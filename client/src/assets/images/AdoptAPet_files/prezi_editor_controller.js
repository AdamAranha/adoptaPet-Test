;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_editor_controller";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.engine.dom":dependencies[0],"prezi.geometry":dependencies[1],"prezi.text":dependencies[2],"prezi.text.model":dependencies[3],"prezi_app_utils":dependencies[4],"prezi_bacon":dependencies[5],"prezi_canvas_listener":dependencies[6],"prezi_cet":dependencies[7],"prezi_cet_model":dependencies[8],"prezi_cet_model_editor":dependencies[9],"prezi_cet_renderer":dependencies[10],"prezi_editor_commander":dependencies[11],"prezi_editor_error":dependencies[12],"prezi_editor_store_common":dependencies[13],"prezi_editor_store_focus":dependencies[14],"prezi_editor_store_mode":dependencies[15],"prezi_editor_store_object":dependencies[16],"prezi_externalserviceprovider":dependencies[17],"prezi_featureswitcher":dependencies[18],"prezi_i18n":dependencies[19],"prezi_logger":dependencies[20],"prezi_nativeapitypes":dependencies[21],"prezi_playback":dependencies[22],"prezi_plugin_api":dependencies[23],"prezi_plugin_meta":dependencies[24],"prezi_select":dependencies[25],"prezi_service_browsernotification":dependencies[26],"prezi_service_data":dependencies[27],"prezi_service_media":dependencies[28],"prezi_templateservice":dependencies[29],"prezi_uaparser":dependencies[30],"prezi_utils":dependencies[31],"prezi_widgets":dependencies[32],"prezi_about_box":dependencies[33],"prezi_alignment_tools":dependencies[34],"prezi_ar_convert":dependencies[35],"prezi_ar_video_template_tools":dependencies[36],"prezi_background_image":dependencies[37],"prezi_bracket_frame":dependencies[38],"prezi_brand_colors":dependencies[39],"prezi_chart_insert":dependencies[40],"prezi_classic_import":dependencies[41],"prezi_classic_to_next_onboarding":dependencies[42],"prezi_dashed_line":dependencies[43],"prezi_debug":dependencies[44],"prezi_depth_of_field":dependencies[45],"prezi_editor_mode":dependencies[46],"prezi_equation_editor":dependencies[47],"prezi_extended_selection":dependencies[48],"prezi_favorites":dependencies[49],"prezi_file_picker_integrations":dependencies[50],"prezi_first_steps_onboarding":dependencies[51],"prezi_font_admin":dependencies[52],"prezi_font_preview":dependencies[53],"prezi_font_selector":dependencies[54],"prezi_grouping":dependencies[55],"prezi_icon_insert":dependencies[56],"prezi_image_insert":dependencies[57],"prezi_layout":dependencies[58],"prezi_local_service_mocks":dependencies[59],"prezi_marker_editor":dependencies[60],"prezi_narrative_editor":dependencies[61],"prezi_path_audio":dependencies[62],"prezi_path_editing":dependencies[63],"prezi_path_generation_strategy":dependencies[64],"prezi_pdf_insert":dependencies[65],"prezi_photo_editor":dependencies[66],"prezi_ppt_edit":dependencies[67],"prezi_ppt_insert":dependencies[68],"prezi_prezi_video_onboarding":dependencies[69],"prezi_qr_code_insert":dependencies[70],"prezi_scheme":dependencies[71],"prezi_search_replace":dependencies[72],"prezi_select_similar":dependencies[73],"prezi_shape_and_arc_editor":dependencies[74],"prezi_snippet_editing_layout_options":dependencies[75],"prezi_solid_color":dependencies[76],"prezi_storyblocks":dependencies[77],"prezi_storyblocks_admin":dependencies[78],"prezi_syntax_highlight":dependencies[79],"prezi_template_from_storyblocks":dependencies[80],"prezi_test_propertybar":dependencies[81],"prezi_test_sidebar":dependencies[82],"prezi_text_editor":dependencies[83],"prezi_text_style":dependencies[84],"prezi_topic_grouping_onboarding":dependencies[85],"prezi_topic_shape":dependencies[86],"prezi_turn_into_topic":dependencies[87],"prezi_video_background":dependencies[88],"prezi_video_insert":dependencies[89],"prezi_video_template_from_figma":dependencies[90],"prezi_view_to_dashboard_test":dependencies[91],"prezi_visual_types":dependencies[92],"prezi_watermark":dependencies[93],"prezi_z_order_object":dependencies[94]}};})());};})(arguments);var moduleImpl=(function(){return module(function(m){function vb(a){switch(a){case "(":return")";case ")":return"(";default:return a}}function ra(a){a=a.replace(wb,function(a,b,c){return ra(c)+b}).replace(xb,"$2$1");let b="",c=a.length;for(;c--;)b+=a.charAt(c);return b}var yb=null,C=m.dependencies["prezi.engine.dom"],K=m.dependencies["prezi.geometry"],w=m.dependencies.prezi_cet_model,kb=m.dependencies.prezi_editor_error,H=m.dependencies.prezi_editor_store_focus,v=m.dependencies.prezi_editor_store_mode,u=m.dependencies.prezi_editor_store_object,
t=m.dependencies.prezi_plugin_meta,Aa=m.dependencies.prezi_service_browsernotification,Ba=m.dependencies.prezi_service_data,W=m.dependencies.prezi_uaparser,D=m.dependencies.prezi_utils,sa=m.dependencies.prezi_widgets,zb=m.dependencies.prezi_about_box,Ab=m.dependencies.prezi_alignment_tools,Bb=m.dependencies.prezi_ar_convert,Cb=m.dependencies.prezi_ar_video_template_tools,Db=m.dependencies.prezi_background_image,Eb=m.dependencies.prezi_bracket_frame,Fb=m.dependencies.prezi_brand_colors,Gb=m.dependencies.prezi_chart_insert,
Hb=m.dependencies.prezi_classic_import,Ib=m.dependencies.prezi_classic_to_next_onboarding,Jb=m.dependencies.prezi_dashed_line,Kb=m.dependencies.prezi_debug,Lb=m.dependencies.prezi_depth_of_field,Mb=m.dependencies.prezi_editor_mode,Nb=m.dependencies.prezi_equation_editor,Ob=m.dependencies.prezi_extended_selection,Pb=m.dependencies.prezi_favorites,Qb=m.dependencies.prezi_file_picker_integrations,Rb=m.dependencies.prezi_first_steps_onboarding,Sb=m.dependencies.prezi_font_admin,Tb=m.dependencies.prezi_font_preview,
Ub=m.dependencies.prezi_font_selector,Vb=m.dependencies.prezi_grouping,Wb=m.dependencies.prezi_icon_insert,Xb=m.dependencies.prezi_image_insert,Yb=m.dependencies.prezi_layout,Zb=m.dependencies.prezi_local_service_mocks,$b=m.dependencies.prezi_marker_editor,ac=m.dependencies.prezi_narrative_editor,bc=m.dependencies.prezi_path_audio,lb=m.dependencies.prezi_path_editing,cc=m.dependencies.prezi_path_generation_strategy,dc=m.dependencies.prezi_pdf_insert,ec=m.dependencies.prezi_photo_editor,fc=m.dependencies.prezi_ppt_edit,
gc=m.dependencies.prezi_ppt_insert,hc=m.dependencies.prezi_prezi_video_onboarding,ic=m.dependencies.prezi_qr_code_insert,mb=m.dependencies.prezi_scheme,jc=m.dependencies.prezi_search_replace,kc=m.dependencies.prezi_select_similar,lc=m.dependencies.prezi_shape_and_arc_editor,mc=m.dependencies.prezi_snippet_editing_layout_options,nc=m.dependencies.prezi_solid_color,oc=m.dependencies.prezi_storyblocks,pc=m.dependencies.prezi_storyblocks_admin,qc=m.dependencies.prezi_syntax_highlight,rc=m.dependencies.prezi_template_from_storyblocks,
nb=m.dependencies.prezi_test_propertybar,ob=m.dependencies.prezi_test_sidebar,sc=m.dependencies.prezi_text_editor,tc=m.dependencies.prezi_text_style,uc=m.dependencies.prezi_topic_grouping_onboarding,vc=m.dependencies.prezi_topic_shape,wc=m.dependencies.prezi_turn_into_topic,xc=m.dependencies.prezi_video_background,yc=m.dependencies.prezi_video_insert,zc=m.dependencies.prezi_video_template_from_figma,Ac=m.dependencies.prezi_view_to_dashboard_test,Bc=m.dependencies.prezi_visual_types,Cc=m.dependencies.prezi_watermark,
Dc=m.dependencies.prezi_z_order_object,E=m.dependencies.prezi_app_utils,l=m.dependencies.prezi_bacon,h=m.dependencies.prezi_canvas_listener,k=m.dependencies.prezi_cet,p=m.dependencies.prezi_cet_model_editor,ba=m.dependencies.prezi_cet_renderer,g=m.dependencies.prezi_editor_commander,aa=m.dependencies.prezi_playback,q=m.dependencies.prezi_select,fa=m.dependencies.prezi_featureswitcher,z=m.dependencies.prezi_logger,y=m.dependencies.prezi_plugin_api,Ca={};Object.defineProperty(Ca,"__esModule",{value:!0});
Ca.pf=class{constructor(a,b){this.dc=a;this.Id=b;this.logger=z.LoggerModule.getLoggerManager().createLogger("BasicEditControllerImpl");this.Ab=E.AppUtilsModule.getLogHelperUtils();this.jd=l.Bacon.newBus()}save(a=()=>{}){this.Id.save().take(1).onValue(a)}forceSaveAndGetStorageProperties(a=()=>{}){this.Id.forceSaveAndGetStorageProperties().take(1).onValue(a)}undo(a,b=()=>{}){this.Ab.undoRedo(this.logger,"undo",F.UndoRedoRequestTrigger[a]);z.avro.Avro.createDefaultLogger().logUndo();if(this.dc().isUndoable())try{y.invalidateAsyncUserActionTokens(),
this.dc().executeUndo(),this.jd.push(F.UndoRedoAction.UNDO)}catch(c){if(!k.Cet.getErrorInfo(c).isCannotStartTransactionError)throw c;}b()}redo(a,b=()=>{}){this.Ab.undoRedo(this.logger,"redo",F.UndoRedoRequestTrigger[a]);z.avro.Avro.createDefaultLogger().logRedo();if(this.dc().isRedoable())try{this.dc().executeRedo(),this.jd.push(F.UndoRedoAction.REDO)}catch(c){if(!k.Cet.getErrorInfo(c).isCannotStartTransactionError)throw c;}b()}getUndoRedoStream(){return this.jd.toEventStream()}};var N={};Object.defineProperty(N,
"__esModule",{value:!0});N.Ga=class{static getExtensionFromMimeType(a){return(a=N.Ga.Qf[a])?"."+a:""}static wb(a){return a?"application/vnd.ms-powerpoint"===a||"application/vnd.openxmlformats-officedocument.presentationml.presentation"===a?"powerpoint":0===a.indexOf("image/")?"image":"application/pdf"===a?"pdf":"video/mp4"===a?"video":"unknown":"unknown"}};N.Ga.Qf={"image/jpeg":"jpg","image/png":"png","image/gif":"gif","application/pdf":"pdf","video/mp4":"mp4","application/vnd.openxmlformats-officedocument.presentationml.presentation":"pptx"};
var r={};Object.defineProperty(r,"__esModule",{value:!0});r.lb="text";r.Of="text/plain";r.Pb="image/";r.td="application/json";r.Rb="PreziDoc";r.qc="TextRange";r.md=104857600;(function(a){a[a.wd=0]="Proximity";a[a.Center=1]="Center";a[a.sd=2]="LastClickPosition"})(r.Ia||(r.Ia={}));(function(a){a[a.None=0]="None";a[a.rd=1]="KeepWorldSize";a[a.vd=2]="ParentRelativeSize"})(r.Xa||(r.Xa={}));(function(a){a[a.None=0]="None";a[a.ud=1]="Panning";a[a.Click=2]="Click"})(r.Fa||(r.Fa={}));var ca={};Object.defineProperty(ca,
"__esModule",{value:!0});ca.kb=class{static Og(a){var b=new Date;if(0!==a.indexOf("data:"))return null;var c=a.substr(5).split(",",2);if(2!==c.length)return null;var d=c[0].split(";");a=d[0];var e;0<d.length&&(e=d[d.length-1]);c=c[1];e="base64"===e?atob(c):decodeURIComponent(c);c=new ArrayBuffer(e.length);c=new Uint8Array(c);for(d=0;d<e.length;d+=1)c[d]=e.charCodeAt(d);e=ca.kb.wf;a.match(ca.kb.Pf)&&(e=a);a=new Blob([c],{type:e});a.name="droppeddata"+N.Ga.getExtensionFromMimeType(e);a.lastModifiedDate=
b;return a}};ca.kb.Pf=/^(\w+)\/(.*)$/;ca.kb.wf="text/plain";var Da={};Object.defineProperty(Da,"__esModule",{value:!0});Da.xf=class{constructor(a,b,c){this.Bb=a;this.applicationController=b;this.za=c;this.Th=[(a,b)=>this.Eh(a,b),(a,b,c)=>this.Fh(a,b,c),(a,b,c)=>this.Ih(a,b,c),(a,b,c)=>this.Gh(a,b,c),(a,b)=>this.Hh(a,b)];this.logger=z.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.DropTarget");this.Da=l.Bacon.newBus()}getErrorStream(){return this.Da}handle(a,b,c){this.Th.some((d)=>
d(a,b,c))}vh(a){const b=a.types;for(let c=0;c<a.types.length;++c)if(b[c].startsWith("prezi-data"))return a.getData(b[c]);return""}Wi(a,b){const c=[];for(let b=0;b<a.length;b++){const d=a[b];c.push({type:d.type,size:d.size})}if(1===c.length)this.logger.info({action:"insert",object:N.Ga.wb(c[0].type),trigger:"dragdrop",payload:{file_size:c[0].size,file_type:c[0].type,drag_source:"system",user_intent_id:b,data_transfer_method:"file"}});else for(this.logger.info({action:"insert",object:"multiple",trigger:"dragdrop",
payload:{num_files:c.length,drag_source:"system",user_intent_id:b,data_transfer_method:"file"}}),a=0;a<c.length;++a)this.logger.info({action:"insert_multiple_details",object:N.Ga.wb(c[a].type),trigger:"dragdrop",payload:{file_size:c[a].size,file_type:c[a].type,drag_source:"system",user_intent_id:b,data_transfer_method:"file"}})}Eh(a,b){try{const c=JSON.parse(this.vh(a));if(this.za.isPlaceholderDrag())this.za.onDrop(b,c);else this.applicationController.listItemDrop({stageX:b.x,stageY:b.y,data:c,targetTopic:null});
return!0}catch(c){}return!1}Hh(a,b){a=a.getData("text");return null!=a&&0<a.length?this.applicationController.styledTextDrop({stageX:b.x,stageY:b.y,targetTopic:null,data:{text:a,characterPropss:null}}):!1}Ih(a,b,c){a=a.getData("text/uri-list");return null!=a?this.ae(a.split("\n")[0],b,c):!1}Gh(a,b,c){var d=/img[^<]*src=('|")([^'"]*)/;a=a.getData("text/html");return null!=a&&(d=d.exec(a))?this.ae(d[2],b,c):!1}Fh(a,b,c){let d=!1;if(a.files&&a.files.length){this.Wi(a.files,c);for(let e=0;e<a.files.length;e++){const f=
a.files[e];f.size<r.md?this.Bb.Mc({file:f,stageX:b.x+42*e,stageY:b.y+42*e,userIntentId:c})&&(d=!0):this.Da.push({errorCase:kb.EditorErrorCase.DROPPED_CONTENT_TOO_LARGE})}}return d}ae(a,b,c){if(null==a||""===a)return!1;if(/^(?:(?:data:([^;]*);base64,)?)((?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==))$/.exec(a))return a=ca.kb.Og(a),this.logger.info({action:"insert",object:N.Ga.wb(a.type),trigger:"dragdrop",payload:{file_size:a.size,file_type:a.type,drag_source:"system",
user_intent_id:c,data_transfer_method:"data_url"}}),this.Bb.Mc({file:a,stageX:b.x,stageY:b.y,userIntentId:c});{let d=null;try{d=new URL(a)}catch(e){}return null!=d&&this.Bb.xi({url:d,stageX:b.x,stageY:b.y,userIntentId:c})}}};var Ea={};Object.defineProperty(Ea,"__esModule",{value:!0});Ea.Af=class{constructor(a,b,c,d){this.za=d;this.$d=l.Bacon.newBus();this.Ii=b;this.Ac=new Da.xf(a,c,d)}addDropTargetElement(a){void 0!==$(a).droppable&&$(a).droppable({accept:".image-sidebar-content",over:(b,d)=>{d.draggable.data("current-droppable",
$(a))},out:(a,b)=>{b.draggable.removeData("current-droppable")},drop:(a,b)=>{b.draggable.removeData("current-droppable")}});const b=(b)=>{const c=$(a).offset();var e=c.top;const f=b.originalEvent.clientY;b=Math.round(b.originalEvent.clientX-c.left-Math.floor($(a).width()/2));e=Math.round(f-e-Math.floor($(a).height()/2));return{x:b,y:e}};$(a).on({dragenter:(a)=>{a.originalEvent.dataTransfer.dropEffect="copy";a.preventDefault();const c=a.originalEvent.dataTransfer.types;let e=!1;const f=new Set;for(let a=
0;a<c.length;a++){var n=c[a].slice(11);0<n.length&&(n=parseInt(n,10),n&sa.PreziDataMimeParam.showPlaceholder&&(e=!0),n&sa.PreziDataMimeParam.snapTargetRegularPlanet&&f.add(g.SnapTargetKind.RegularPlanet),n&sa.PreziDataMimeParam.snapTargetSlideOnOverview&&f.add(g.SnapTargetKind.SlideOnOverview),n&sa.PreziDataMimeParam.snapTargetSlideOnPlanet&&f.add(g.SnapTargetKind.SlideOnPlanet))}if(e||0<f.size)this.za.onDragStart(b(a),null,e,f)},dragleave:(a)=>{a.originalEvent.dataTransfer.dropEffect="copy";a.preventDefault();
if(this.za.isPlaceholderDrag())this.za.onDragLeave(b(a))},dragover:(a)=>{a.originalEvent.dataTransfer.dropEffect="copy";a.preventDefault();if(this.za.isPlaceholderDrag())this.za.onDragOver(b(a),!1,!0)},drop:(a)=>{this.$d.push(a);"true"!==a.originalEvent.dataTransfer.getData("ReactDnd")&&(a.preventDefault(),a.stopPropagation())}});this.$d.filterWithStream(this.Ii).onValue((a)=>{const c=a.originalEvent&&a.originalEvent.dataTransfer;if(c&&c.getData){a=b(a);var e=z.LoggerModule.getLoggerManager().generateUserIntentId();
this.Ac.handle(c,a,e)}})}integration_test_drop(a){this.Ac.handle(a,{x:0,y:0},z.LoggerModule.getLoggerManager().generateUserIntentId())}getErrorStream(){return this.Ac.getErrorStream()}excludeDropTargetElement(a){a.addEventListener("dragover",(a)=>{a.dataTransfer.dropEffect="none";a.preventDefault()})}};var ha={};Object.defineProperty(ha,"__esModule",{value:!0});ha.Ob=class{constructor(a){this.logger=a}Zi(a,b){const c=[];for(let b=0;b<a.length;++b){const d=a[b];c.push({size:d.file.size,type:d.file.type})}if(1===
c.length)this.logger.info({action:"insert",object:N.Ga.wb(c[0].type),trigger:"paste",payload:{file_size:c[0].size,file_type:c[0].type,paste_from:"system_clipboard",user_intent_id:b}});else for(this.logger.info({action:"insert",object:"multiple",trigger:"paste",payload:{num_files:c.length,paste_from:"system_clipboard",user_intent_id:b}}),a=0;a<c.length;++a)this.logger.info({action:"insert_multiple_details",object:N.Ga.wb(c[a].type),trigger:"paste",payload:{file_size:c[a].size,file_type:c[a].type,paste_from:"system_clipboard",
user_intent_id:b}})}$i(a){a=ha.Ob.re(a);const b={paste_from:"prezi_clipboard",num_objects:a.length};let c;1===a.length?(c=this.oe(a[0]),"topic"===c&&(b.type=a[0])):c="multiple";this.logger.info({action:"insert",object:c,trigger:"paste",payload:b})}oe(a){if(0===a.indexOf("Z_")){if(/FRAME$/.test(a))return"topic";a=a.substr(2)}return a.toLowerCase()}static re(a){const b=[];a=a.getZObjects();for(let c=0;c<a.length();++c){const d=a.get(c).getObjectType();b.push(C.ZObjectType[d])}return b}Vi(a){this.logger.info({action:"copy_to_clipboard",
object:"plain_text",trigger:"copy",payload:{text_length:a?a.length:0}})}He(a){a=ha.Ob.re(a);const b={num_objects:a.length};let c;1===a.length?(c=this.oe(a[0]),"topic"===c&&(b.type=a[0])):c="multiple";this.logger.info({action:"copy_to_clipboard",object:c,trigger:"copy",payload:b})}};var qb={Aj:function(a){{let c=0,d=0;for(let e=0;e<a.length&&300>e;e++){var b=a.charCodeAt(e);1424<=b&&1791>=b?c+=1:d+=1}b=c>d}a=b?ra(a).replace(/[\(\)]/g,vb).replace(/[0-9a-zA-Z][0-9a-zA-Z \.\-,]*[0-9a-zA-Z]/g,ra).replace(/[\u0660-\u0669\u06F0-\u06F9]+/g,
ra).split("\n").reverse().join("\n"):a;return pb.test(a)?a.replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(pb," "):a}};Object.defineProperty(qb,"__esModule",{value:!0});const pb=new RegExp(/[\u0000-\u0009\u000B-\u001F]/g),wb=/([\0-\u02FF\u0370-\u1AAF\u1B00-\u1DBF\u1E00-\u20CF\u2100-\uD7FF\uE000-\uFE1F\uFE30-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])([\u0300-\u036F\u1AB0-\u1AFF\u1DC0-\u1DFF\u20D0-\u20FF\uFE20-\uFE2F]+)/g,xb=/([\uD800-\uDBFF])([\uDC00-\uDFFF])/g;
var Fa={};Object.defineProperty(Fa,"__esModule",{value:!0});Fa.dg=class{constructor(){}we(a){a=this.eh(a);return this.xg(a)}xg(a){let b=0;for(let c=0;c<a.length;++c)b=(b<<5)-b+a.charCodeAt(c),b|=0;return b}eh(a){if(!a)return"null";let b=a.text;if(L.Ja.Ni(b))return b;if(a.files)for(var c=0;c<a.files.length;++c)b+="-"+this.ie(a.files[c]);if(a.items)for(b+="-",c=0;c<a.items.length;++c)b+="-"+this.Si(a.items[c]);return b}ie(a){return a?[a.lastModified?a.lastModified.toString():"null",a.name,a.size,a.type].join(":"):
"null"}Si(a){return a?[a.kind,a.type,this.ie(a.getAsFile())].join(":"):"null"}};var P={},Ec=this&&P.Ub||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,n){function f(a){try{h(d.next(a))}catch(B){n(B)}}function I(a){try{h(d["throw"](a))}catch(B){n(B)}}function h(a){a.done?c(a.value):e(a.value).then(f,I)}h((d=d.apply(a,b||[])).next())})};Object.defineProperty(P,"__esModule",{value:!0});P.wa=class{constructor(){}static yc(a,b){return Ec(this,
void 0,void 0,function*(){const c=P.wa.Qd(b);null!=c.na.type&&(c.na.doc=C.DOM.IPreziCopy().copyPrezi(yield p.CetModelEditor.loadAndConvertPreziXmlAsync(a,c.Oe.doc)));return c.na})}static Qd(a){const b={na:new P.wa,Oe:null};try{const c=JSON.parse(a);b.Oe=c;if(c.type&&(c.type===r.Rb||c.type===r.qc)){const a=c.bounds;null!=a&&(b.na.bounds=P.wa.Ne(a));const e=c.parentBounds;null!=e&&(b.na.mj=P.wa.Ne(e));b.na.parentId=c.parent;b.na.fd=c.startSelection;b.na.Fc=c.endSelection;b.na.type=c.type;const f=c.viewport;
null!=f&&(b.na.viewport=P.wa.Qj(f));b.na.singlePageCopied=c.singlePageCopied;b.na.nj=c.parentIsPage}}catch(c){}return b}static Ri(a){return P.wa.Qd(a).na.isValid()}isValid(){return null!=this.type}getType(){return this.type}getBounds(){return this.bounds}getParentId(){return this.parentId}static Ne(a){return K.Geometry.obbFromData(a.centerX,a.centerY,a.width,a.height,a.degrees)}static Qj(a){return K.Geometry.rectangleFromData(a)}getViewport(){return this.viewport}};var L={},Ga=this&&L.Ub||function(a,
b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,n){function f(a){try{h(d.next(a))}catch(B){n(B)}}function I(a){try{h(d["throw"](a))}catch(B){n(B)}}function h(a){a.done?c(a.value):e(a.value).then(f,I)}h((d=d.apply(a,b||[])).next())})};Object.defineProperty(L,"__esModule",{value:!0});var Fc=p.base.modelColorToCharacterColor;L.Ja=class{constructor(a,b,c,d,e,f){this.scene=a;this.Ve=b;this.applicationController=c;this.kc=d;this.Bb=e;this.ob=
f;this.Vb=l.Bacon.newBus();this.Se=l.Bacon.newBus();this.Ib=l.Bacon.newBus();this.gd=l.Bacon.newBus();this.Pe=l.Bacon.newBus();this.Fd=l.Bacon.newBus();this.Sd=l.Bacon.newBus();this.Hg=l.Bacon.newBus();this.kd=l.Bacon.newBus();this.Gd=l.Bacon.newBus();this.Md=l.Bacon.newBus();this.Da=l.Bacon.newBus();this.Fj();this.ni();a=this.sg(this.Re);this.yi=l.Bacon.mergeAll([this.xe(a,this.gd.toProperty(!0)),this.ye(a,this.gd.toProperty(!0),!0)]);l.Bacon.mergeAll([this.xe(a,this.Ib.toProperty(!0)),this.fi(a,
this.Ib.toProperty(!0))]).onValue((a)=>{this.applicationController.styledTextDrop({targetTopic:null,stageX:a.stageX,stageY:a.stageY,data:{text:a.text,characterPropss:a.characterPropss}});this.Vb.push(y.PasteEventType.preziContent)});this.ei(a);this.di(a);this.logger=z.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.SmartPaster");this.cb=new ha.Ob(this.logger);this.Kd=new Fa.dg;this.Jb={left:0,right:0,top:0,bottom:0}}Bd(a){this.Se.plug(a)}tg(a){this.Ib.plug(a)}ug(a){this.gd.plug(a)}addPanningStream(a){this.Pe.plug(a)}addCameraNavStream(a){this.Fd.plug(a)}addCurrentTopicStream(a){this.Sd.plug(a)}addCoverEditModeStream(a){this.Hg.plug(a)}rg(a){this.Md.plug(a)}addCanvasMouseInteractionStream(a){a=
a.filter((a)=>a.type===h.MouseInteractionType.Click).map((a)=>a.event.stagePos);this.Gd.plug(a)}addViewportUICoverStream(a){a.onValue((a)=>{this.Jb=a})}getErrorStream(){return this.Da}getUnsupportedPastedDocumentErrorStream(){return this.kd}setCamera(a){this.camera=a}xe(a,b){return a.filter((a)=>a.Ua===G.TEXT).filterWithStream(b).map((a)=>{const b=qb.Aj(a.ya.text);this.logger.info({action:"insert",object:"plain_text",trigger:"paste",payload:{text_length:b.length}});z.avro.Avro.createDefaultLogger().logPasteObject({object_type:"TEXT"});
this.Ca=a=this.mb(this.Ca,a.Va);return{text:b,characterPropss:null,stageX:a?a.x:null,stageY:a?a.y:null}})}fi(a,b){b=this.ye(a,b,!1);return l.Bacon.combineWith(({Va:a},{characterPropss:b,text:e})=>{this.Ca=a=this.mb(this.Ca,a);return{text:e,characterPropss:b,stageX:a?a.x:null,stageY:a?a.y:null}},a,b).sampledBy(b).filterWithStream(this.Ib.toProperty(!0))}ei(a){a.filter((a)=>a.Ua===G.oc).flatMap((a)=>{const b=a.ya,d=z.LoggerModule.getLoggerManager().generateUserIntentId();this.Ca=a=this.mb(this.Ca,a.Va);
const e=[];let f=!1;for(var n=0;n<b.files.length;n++)if(L.Ja.Xb(r.Pb,b.files[n].type)){var x=b.files[n];this.ee(x)||(e.push({file:x,userIntentId:d,stageX:a.x,stageY:a.y}),f=!0)}if(b.items)for(n=0;n<b.items.length;n++)L.Ja.Xb(r.Pb,b.items[n].type)&&(x=b.items[n].getAsFile(),null!=x&&(f&&"file"===b.items[n].kind||this.ee(x)||e.push({file:x,userIntentId:d,stageX:a.x,stageY:a.y})));0<e.length&&this.cb.Zi(e,d);return l.Bacon.fromArray(e)}).onValue((a)=>{z.avro.Avro.createDefaultLogger().logPasteObject({object_type:this.qh(a.file.type)});
this.Bb.Mc(a);this.Vb.push(y.PasteEventType.file)})}ee(a){return a.size>=r.md?(this.Da.push({errorCase:kb.EditorErrorCase.PASTED_CONTENT_TOO_LARGE}),!0):!1}qh(a){return a?0===a.indexOf("image/")?"IMAGE":"application/pdf"===a?"PDF":"video/mp4"===a?"VIDEO":null:null}Oi(a){if(1!==a.getZObjects().length())return!1;a=a.getZObjects().get(0);return a.getObjectType()!==C.ZObjectType.Z_TEXT||a.getIsPlaceholder()?!1:!0}sg(a){const b=l.Bacon.newBus();a.onValue((a)=>Ga(this,void 0,void 0,function*(){let c,e;
a.ya.text&&(c=yield P.wa.yc(this.ob,a.ya.text),c.isValid()&&c.getType()===r.Rb&&(e=this.Oi(c.doc)?G.Sb:G.PREZI),c.isValid()&&c.getType()===r.qc&&(e=G.yd));const f=a.ya;null!=e||!f.text||this.Ji(f.text)||this.Ae(f.text)||(e=G.TEXT);if(null==e){if(f.files)for(var n=0;n<f.files.length;n++)if(L.Ja.Xb(r.Pb,f.files[n].type)){e=G.oc;break}if(f.items)for(n=0;n<f.items.length;n++)if(L.Ja.Xb(r.Pb,f.items[n].type)){e=G.oc;break}}null==e&&f.text&&!this.Ae(f.text)&&(e=G.TEXT);b.push({ya:a.ya,ed:a.ed,Va:a.Va,Ua:e,
$c:c,Kb:a.ya.Kb})}));return b}Ji(a){a=300<a.length?a.slice(a.length-300):a;return/.*[.][a-zA-Z]*$/.test(a)}Ae(a){return 0===a.indexOf("data:")}getLogObjectType(a){switch(a){case C.ZObjectType.Z_LINE:return"LINE";case C.ZObjectType.Z_ARROW:return"ARROW";case C.ZObjectType.Z_BRACKET_FRAME:case C.ZObjectType.Z_CIRCLE_FRAME:case C.ZObjectType.Z_INVISIBLE_FRAME:case C.ZObjectType.Z_RECTANGLE_FRAME:case C.ZObjectType.Z_TOPIC_CONTAINER:return"TOPIC";case C.ZObjectType.Z_IMAGE:return"IMAGE";case C.ZObjectType.Z_VIDEO:return"VIDEO";
case C.ZObjectType.Z_TEXT:return"TEXT";case C.ZObjectType.Z_PDF:return"PDF";case C.ZObjectType.Z_SHAPE:return"SHAPE";case C.ZObjectType.Z_CHART_PDF:return"CHART";case C.ZObjectType.Z_ZOOM_AREA:return"ZOOMAREA";default:return null}}di(a){const b=a.filter((a)=>a.Ua===G.PREZI);a=a.filter((a)=>a.Ua===G.Sb).filterWithStream(this.Ib.toProperty(!0));b.merge(a).onValue((a)=>Ga(this,void 0,void 0,function*(){const b=yield P.wa.yc(this.ob,a.ya.text),c=b.doc;this.cb.$i(c);var f=c.getZObjects();1<f.length()?
(f=f.get(0),f="TOPIC"===this.getLogObjectType(f.getObjectType())?"TOPIC":"MULTIPLE",z.avro.Avro.createDefaultLogger().logPasteObject({object_type:f})):(f=f.get(0),z.avro.Avro.createDefaultLogger().logPasteObject({object_type:this.getLogObjectType(f.getObjectType())}));f=b.getBounds();var n=this.zg({x:f.getCenterX(),y:f.getCenterY()});this.camera&&!this.Cb&&(n=p.CetModelEditor.createPositionFinder(this.scene,this.camera).findPosition(f.getWidth(),f.getHeight()).localToWorld.getTranslation(),n=this.camera.getTransform().transformPoint(n));
this.Ca=n=this.mb(n,a.Va);const x=this.Ag(f,a.ed);let I=null;this.Cb&&!this.nb&&(I=b.getParentId());const h=this.yg(x);n=this.aj(n,h);this.gc=r.Fa.None;this.Wb=!1;this.kc.insert({doc:c,originalWorldBounds:f,stageX:n.x,stageY:n.y,worldWidth:x.width,worldHeight:x.height,suggestedParent:I,originalParent:this.Cb?b.getParentId():null,originalParentIsPage:b.nj,originalParentWorldBounds:b.mj,viewportInWorld:b.getViewport(),singlePageCopied:b.singlePageCopied},"clipboard",z.LoggerModule.getLoggerManager().generateUserIntentId());
this.Vb.push(y.PasteEventType.preziContent)}))}ye(a,b,c){return a.filter((a)=>a.Ua===G.yd||c&&a.Ua===G.Sb).filterWithStream(b).map((a)=>{var b=C.DOM.createLocalSession(a.$c.doc,()=>{}).getPrezi().getZObjects().get(0);if(b.getObjectType()!==C.ZObjectType.Z_TEXT)return null;z.avro.Avro.createDefaultLogger().logPasteObject({object_type:"TEXT"});var c=a.Ua===G.Sb,d=c?0:a.$c.fd;c=c?b.getText().getLength():a.$c.Fc;b=this.Ve.create(b.getText(),this.Ve.createDefaultBaseStyle());b=b.replaceText(c,b.getLength(),
"");b=b.replaceText(0,d,"");this.Ca=d=this.mb(this.Ca,a.Va);c=[];for(let a=0;a<b.getLength();a++){const d=b.getCharacterStylesAt(a);c.push({fontWeight:d.getFontWeight(),fontStyle:d.getFontStyle(),fontSize:d.getFontSize(),color:Fc(d.getColor())})}return{text:b.getRawText(),characterPropss:a.Kb?null:c,stageX:d?d.x:null,stageY:d?d.y:null}}).filter((a)=>null!=a)}mb(a,b){let c;switch(b){case r.Ia.wd:(c=this.Ca||a)?(a=L.Ja.bg,c={x:c.x+a,y:c.y+a}):c=this.Ed();break;case r.Ia.Center:c=this.Ed();break;case r.Ia.sd:c=
this.Ui}return c}Ag(a,b){let c=null,d=null;switch(b){case r.Xa.rd:c=a.getWidth();d=a.getHeight();break;case r.Xa.vd:this.camera&&this.nf&&(b=this.camera.viewportInWorld().getWidth()/this.nf.getWidth(),c=a.getWidth()*b,d=a.getHeight()*b)}return{width:c,height:d}}Fj(){this.ad();this.Md.onValue((a)=>{this.Ge=this.Kd.we(a);this.ad();this.Cb=!0;this.nf=this.camera?this.camera.viewportInWorld():null});this.Re=l.Bacon.newBus();this.kd=l.Bacon.newBus();this.Se.onValue((a)=>Ga(this,void 0,void 0,function*(){var b=
this.Kd.we(a);this.Ge!==b&&(this.ad(),this.Ge=b);b={ya:a,ed:this.xh(),Va:this.uh()};const c=yield P.wa.yc(this.ob,b.ya.text);let d=!0;c.isValid()&&c.getType()===r.Rb&&!p.CetModelEditor.createLegacyInserter().canPaste(this.scene,c.doc)&&(this.logger.warn({action:"paste",object:"cannot-paste",trigger:"unknown-in-context"}),d=!1);d?this.Re.push(b):this.kd.push(null)}))}xh(){return this.Cb?this.nb?r.Xa.vd:r.Xa.rd:r.Xa.None}uh(){switch(this.gc){case r.Fa.None:return this.nb&&this.Wb?r.Ia.Center:r.Ia.wd;
case r.Fa.Click:return r.Ia.sd;case r.Fa.ud:return r.Ia.Center;default:return null}}ad(){this.Wb=this.nb=this.Cb=!1;this.gc=r.Fa.None;this.Ca=null}ni(){this.Pe.onValue((a)=>{a===k.PanningEvent.PanningStarted&&(this.gc=r.Fa.ud)});this.Fd.onValue(()=>{this.Wb=this.nb=!0});this.Sd.onValue(()=>{this.Wb=this.nb=!0});this.Gd.onValue((a)=>{this.Ui=a;this.gc=r.Fa.Click})}static Xb(a,b){return(new RegExp(a)).test(b)}static Ni(a){return P.wa.Ri(a)}zg(a){return this.camera?this.camera.getTransform().transformPoint(a):
null}yg(a){return this.camera?(a=K.Geometry.rectangleFromData({x:0,y:0,width:a.width,height:a.height}),a=this.camera.getTransform().transformRectangle(a),{width:a.getWidth(),height:a.getHeight()}):null}Ed(){return this.camera?this.camera.getViewport().getCenter():null}aj(a,b){const c={x:0,y:0};if(!this.camera)return c;const d=this.camera.getViewport();var e=a.x-b.width/2;e=d.getLeft()+this.Jb.left-e;const f=a.x+b.width/2-d.getRight()-this.Jb.right;0<e&&f<=-e?c.x=e:0<f&&e<=-f&&(c.x=-f);e=a.y-b.height/
2;e=d.getTop()+this.Jb.top-e;b=a.y+b.height/2-d.getBottom()-this.Jb.bottom;0<e&&b<=-e?c.y=e:0<b&&e<=-b&&(c.y=-b);return{x:a.x+c.x,y:a.y+c.y}}};L.Ja.bg=10;var G;(function(a){a[a.PREZI=0]="PREZI";a[a.Sb=1]="PREZI_OR_TEXT_RANGE";a[a.TEXT=2]="TEXT";a[a.oc=3]="FILE";a[a.yd=4]="TEXT_RANGE"})(G||(G={}));var ia={};Object.defineProperty(ia,"__esModule",{value:!0});ia.Tb=class{constructor(a,b){this.Hj=a;this.Hd=b;this.Qc=-1!==navigator.userAgent.toLowerCase().indexOf("msie")||-1!==navigator.userAgent.toLowerCase().indexOf("trident");
const c=-1!==navigator.appVersion.search("Safari")&&-1===navigator.appVersion.search("Chrome")&&-1===navigator.appVersion.search("CrMo")&&-1===navigator.appVersion.search("CriOS");this.xb=$(document.body).append($('<div id="ie-clipboard-contenteditable" style="position:absolute;bottom:0;left:0;width:10px;height:10px;display:block;font-size:1px;z-index:-1;color:transparent;background:transparent;overflow:hidden;border:none;padding:0;resize:none;outline:none;-webkit-user-select:text;user-select:text;" contenteditable="true" tabindex="-1"></div>'));
this.Ta=$('<input id="hidden-input" style="position:absolute;bottom:0;left:0;width:10px;height:10px;display:block;font-size:1px;z-index:-1;color:transparent;background:transparent;overflow:hidden;border:none;padding:0;resize:none;outline:none;-webkit-user-select:text;user-select:text;" type="text" value="" tabindex="-1" autocomplete="off"/>');$(document.body).append(this.Ta);this.Qc&&document.addEventListener("beforepaste",()=>{this.Ta.is(":focus")&&this.ke()},!0);this.Ta.on("input",()=>{this.Ta.val();
c?(this.Ta.focus(),setTimeout(()=>this.Ya(),0)):this.Ya()});l.Bacon.fromEvent(document,"mouseup").filterWithStream(this.Hj.toProperty(!0)).onValue(()=>this.Ya());l.Bacon.fromEvent(document,"beforecopy").onValue(ia.Tb.ce);l.Bacon.fromEvent(document,"beforepaste").onValue(ia.Tb.ce);l.Bacon.fromEvent(document,"keydown").filter((a)=>a.shiftKey).onValue(()=>this.gf=!0);l.Bacon.fromEvent(document,"keyup").onValue(()=>this.gf=!1)}static ce(a){a.preventDefault&&a.preventDefault();return a.returnValue=!1}Ya(){this.Ta.val();
this.Ta.focus().select()}ke(){this.xb.focus();const a=document.createRange();a.selectNodeContents(this.xb.get(0));const b=window.getSelection();b.removeAllRanges();b.addRange(a)}Zh(){const a=window.clipboardData.getData(r.lb);this.xb.empty();const b=l.Bacon.newBus();setTimeout(()=>{b.push({text:a});this.xb.empty();this.Ya()},0);return b}Kj(a){return(a=a.clipboardData)?l.Bacon.once({text:a.getData(r.td)||a.getData(r.Of)||a.getData(r.lb),files:a.files,items:a.items,Kb:this.gf}):l.Bacon.never()}Yh(a){window.clipboardData.setData(r.lb,
a);this.ke();setTimeout(()=>{this.Ya();this.xb.empty()},0)}static Jj(a,b,c){(a=a.clipboardData)&&a.setData(c,b)}copy(a,b,c=r.lb){const d=a.originalEvent;this.Qc?this.Yh(b):(ia.Tb.Jj(d,b,c),this.Ya(),a.preventDefault())}mh(){return l.Bacon.fromEvent(document,"copy").merge(l.Bacon.fromEvent(document,"cut")).filterWithStream(this.Hd.toProperty(!0))}th(){return l.Bacon.fromEvent(document,"paste").filterWithStream(this.Hd.toProperty(!0)).flatMap((a)=>{if(this.Qc)return this.Zh();a.preventDefault();return this.Kj(a.originalEvent)})}};
var Ha={};Object.defineProperty(Ha,"__esModule",{value:!0});Ha.rf=class{constructor(a,b,c,d,e,f,n,x,I){this.ea=b;this.kc=c;this.Wa=e;this.Bg=x;this.logger=z.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.ClipboardImpl");this.cb=new ha.Ob(this.logger);this.Lj=l.Bacon.newBus();this.Td=l.Bacon.newBus();this.ta=l.Bacon.newBus();this.vc=l.Bacon.newBus();this.Ld=l.Bacon.newBus();this.ga=l.Bacon.newBus();this.ge=l.Bacon.newBus();this.he=l.Bacon.newBus();this.fa=new L.Ja(this.ea,a.getRenderingTextFactory(),
f,c,d,I);this.Be=l.Bacon.newBus();this.Da=l.Bacon.newBus();this.Gb=new ia.Tb(this.vc.map((a)=>-1===[H.ComponentFocusMode.ui,H.ComponentFocusMode.uiInput,H.ComponentFocusMode.textEditor].indexOf(a)).skipDuplicates(),this.vc.map((a)=>a!==H.ComponentFocusMode.ui&&a!==H.ComponentFocusMode.uiInput).skipDuplicates());this.bi();a=this.Be.toProperty();this.fa.Bd(this.Gb.th().filterWithStream(a));this.fa.Bd(this.ph().filterWithStream(a));this.fa.ug(this.se());this.fa.tg(this.se().map((a)=>!a));this.cc=new Ea.Af(d,
a,f,n);this.fa.yi.onValue((a)=>{f.styledTextDrop({stageX:null,stageY:null,data:a,targetTopic:null});f.afterPaste(y.PasteEventType.preziContent)});this.fa.Vb.onValue((a)=>f.afterPaste(a));this.Da.plug(this.cc.getErrorStream());this.Da.plug(this.fa.getErrorStream())}addIsEditModeSteam(a){this.Be.plug(a)}integration_test_drop(a){this.cc.integration_test_drop(a)}bi(){var a=this.ge.map(()=>null);a=this.Gb.mh().merge(a);var b=this.ga.map((a)=>!a||!a.isEditing()).toProperty(!0),c=this.ga.map((a)=>a&&a.isEditing()).toProperty(!1);
b=l.Bacon.combineWith((a,b)=>({selection:a.allEntityIds,event:b}),this.ta.filterWithStream(b),a).sampledBy(a.filterWithStream(b));a=l.Bacon.combineWith3((a,b,c)=>{a=c.allEntityIds[0];var d=this.ea.getEntityById(a);const e=p.CetModelEditor.createTextHelper();c=e.getSelectedText(d);const f=e.getSelectionStartOffset(d);d=e.getSelectionEndOffset(d);return{id:a,Db:c,event:b,fd:f,Fc:d}},this.ga.filterWithStream(c),a,this.ta.filter((a)=>0!==a.allEntityIds.length)).sampledBy(a.filterWithStream(c));const d=
k.Cet.createHierarchyQuery(this.ea);c=b.filter((a)=>a.selection&&0<a.selection.length).map(({selection:a,event:b})=>{var c=a.map((a)=>this.ea.getEntityById(a)).filter((a)=>null!=a).map((a)=>null!=a.get(w.CetModel.ID.TRANSFORMED.LOCAL_TO_WORLD)?a.getId():a.isDef(w.CetModel.ID.FLY_TO_OBJECT_EP)?a.get(w.CetModel.ID.HAS_TARGET.TARGET):null).filter((a)=>null!=a);if(0===c.length)return null;var e=1===c.length&&p.CetModelEditor.isPage(c[0],this.ea),f=this.kc.copyObjects(c);this.cb.He(f);c=C.DOM.saveXml(f);
f=[...w.CetModel.pdomIterable(f.getZObjects())].map((a)=>a.getId());const h=k.Cet.createTopicChildrenQuery(this.ea),g=k.Cet.createHierarchyQuery(this.ea).getLowestCommonAncestor(f),l=k.Cet.createHierarchyQuery(this.ea).getLowestCommonAncestor(((a)=>a.map((a)=>h.isVisibleOutside(a)?d.getParentOrOverview(this.ea.getEntityById(a)):a))(f));e=JSON.stringify({type:r.Rb,doc:c,bounds:this.getWorldBounds(f),parent:g,parentBounds:null!=g?this.getWorldBounds([l]):null,viewport:this.Bg.getMarginCorrectedViewportInWorld().getData(),
singlePageCopied:e,parentIsPage:null!=g&&p.CetModelEditor.isPage(g,this.ea)});return{event:b,ib:e,ids:a}}).filter((a)=>null!=a);c.onValue((a)=>{if(a.event){this.Gb.copy(a.event,a.ib);const b=a.ids,c=1===b.length?this.ea.getEntityById(b[0]):"MULTIPLE",d=1===b.length?b[0]:null;"cut"===a.event.type?(this.Td.push({entityIds:b,trigger:"CUT"}),z.avro.Avro.createDefaultLogger().logCutObject({object_id:d,object_type:c})):z.avro.Avro.createDefaultLogger().logCopyObject({object_id:d,object_type:c});this.zb=
null}else this.zb=a.ib});this.fa.rg(c.map((a)=>({text:a.ib})));a.filter((a)=>""!==a.Db).map((a)=>{this.cb.Vi(a.Db);var b=this.kc.copyObjects([a.id]);this.cb.He(b);b=C.DOM.saveXml(b);const c=k.Cet.createHierarchyQuery(this.ea).getParentId(this.ea.getEntityById(a.id));b=JSON.stringify({type:r.qc,doc:b,parent:c,startSelection:a.fd,endSelection:a.Fc});return{event:a.event,ib:b,Db:a.Db}}).filter((a)=>null!=a).onValue((a)=>{a.event?(this.Gb.copy(a.event,a.Db,r.lb),this.Gb.copy(a.event,a.ib,r.td),"cut"===
a.event.type&&this.Wa.deleteText(F.DeleteAction.CHARACTER_FORWARD),this.zb=null):this.zb=a.ib;this.Ld.push(H.ComponentFocusAction.enterTextEditor)})}getWorldBounds(a){let b=k.Cet.world(this.ea.getEntityById(a[0])).getWorldBounds();for(let c=1;c<a.length;c++)b=b.union(k.Cet.world(this.ea.getEntityById(a[c])).getWorldBounds());return this.Rj(b)}Rj(a){return{centerX:a.getCenterX(),centerY:a.getCenterY(),width:a.getWidth(),height:a.getHeight(),degrees:a.getRotationDegrees()}}addSelectionStream(a){this.ta.plug(a)}addComponentFocusStream(a){this.vc.plug(a)}getComponentFocusActionStream(){return this.Ld}addTextStateStream(a){this.ga.plug(a)}addTextOnlyPasteEventStream(a){this.Lj.plug(a)}getErrorStream(){return this.Da}getUnsupportedPastedDocumentErrorStream(){return this.fa.getUnsupportedPastedDocumentErrorStream()}getDeleteActionStream(){return this.Td}addDropTargetElement(a){this.cc.addDropTargetElement(a)}excludeDropTargetElement(a){this.cc.excludeDropTargetElement(a)}addPanningStream(a){this.fa.addPanningStream(a)}addCameraNavStream(a){this.fa.addCameraNavStream(a)}addCurrentTopicStream(a){this.fa.addCurrentTopicStream(a)}addCoverEditModeStream(a){this.fa.addCoverEditModeStream(a)}addCanvasMouseInteractionStream(a){this.fa.addCanvasMouseInteractionStream(a)}addViewportUICoverStream(a){this.fa.addViewportUICoverStream(a)}addFakeCopyActionStream(a){this.ge.plug(a)}addFakePasteActionStream(a){this.he.plug(a)}setCamera(a){this.fa.setCamera(a)}ph(){return this.he.flatMap(([a,
b])=>{a=null!=a?a:!1;return null!=b?l.Bacon.once({text:b,files:null,items:null,Kb:a}):this.zb?l.Bacon.once({text:this.zb,files:null,items:null,Kb:a}):l.Bacon.never()})}se(){return this.ga.map((a)=>a?a.isEditing()||a.isSingleSelection()&&this.isPlaceholderText(a.getSingleEntityId()):!1).toProperty()}isPlaceholderText(a){return p.CetModelEditor.createTextHelper().isPlaceholder(this.ea.getEntityById(a))}};var Ia={};Object.defineProperty(Ia,"__esModule",{value:!0});Ia.sf=class{triggerCut(){return this.Hc("cut")}triggerCopy(){return this.Hc("copy")}triggerPaste(){return this.Hc("paste")}Hc(a){try{if(document.queryCommandSupported(a))return document.execCommand(a)}catch(b){}return!1}};
var Ja={};Object.defineProperty(Ja,"__esModule",{value:!0});Ja.Uf=class{constructor(a){this.applicationController=a}Mc(a){return this.applicationController.fileDrop(a.file.type,{stageX:a.stageX,stageY:a.stageY,data:{file:a.file,source:"DRAG"},targetTopic:null})}xi(a){return this.applicationController.urlDrop({stageX:a.stageX,stageY:a.stageY,data:{url:a.url},targetTopic:null})}};var Ka={};Object.defineProperty(Ka,"__esModule",{value:!0});Ka.tf=class{constructor(a,b,c,d){this.Jd=c;this.ob=d;this.tc=
l.Bacon.newBus();a(this.tc);this.sc=l.Bacon.newBus();b(this.sc)}disableEdit(){this.sc.push(!1);this.tc.push({newMode:E.EditorMode.playback,trigger:"ConnectivityController",shouldGoFullscreen:!1,shouldSeekPathToStart:!1,showTopmenu:!0,linkClickedFlow:!1,presenterNotesFlow:!1})}enableEdit(){this.sc.push(!0);this.tc.push({newMode:E.EditorMode.edit,trigger:"ConnectivityController"})}setCetSessionMode(a){this.Jd.setSessionMode(a)}loadPrezi(a){this.Jd.getPreziLoader().loadPrezi(this.ob,a)}};var La={};Object.defineProperty(La,
"__esModule",{value:!0});La.Df=class{constructor(a){this.Cc=l.Bacon.newBus();this.Zd=l.Bacon.newBus();this.Oc=l.Bacon.newBus();a.onValue((a)=>{this.currentTopicId=a});this.Tc=!1}isPlaceholderDrag(){return this.Tc}getDragStream(){return this.Zd.throttle(33).filterWithStream(this.Oc.toProperty(!1)).merge(this.Cc)}onDragStart(a,b,c,d){this.Tc=!0;this.Cc.push({kind:g.ActionKind.Start,startKind:g.DragActionStartKind.PlaceholderMove,target:{kind:g.ActionTargetMultiplicity.multiple,entityIds:[]},entitiesToTransformInSync:[],
currentTopicId:this.currentTopicId,mouseStagePosition:a,originalMouseStagePosition:a,size:b,showPlaceholder:c,allowedSnapTargetKinds:d});this.Oc.push(!0)}onDragLeave(){this.finish({kind:g.ActionKind.Finish,finishKind:g.DragPlaceholderActionFinishKind.cancelled})}onDrop(a,b){this.finish({kind:g.ActionKind.Finish,finishKind:g.DragPlaceholderActionFinishKind.drop,dropData:b,mouseStagePosition:a})}onDragOver(a,b,c){this.Zd.push({kind:g.ActionKind.Step,stagePosition:a,isCenterResizeKeyPressed:!1,isSnapDisableKeyPressed:!b,
isTopicNestingDisableKeyPressed:!c})}finish(a){this.Cc.push(a);this.Oc.push(!1);this.Tc=!1}};var na={};Object.defineProperty(na,"__esModule",{value:!0});na.mc=class{constructor(a,b,c,d,e,f){this.scene=a;this.f=b;this.v=c;this.o=d;this.$b=e;this.Dc=f;if(null==this.f)throw Error("editorStore cannot be null");if(null==this.v)throw Error("selectionController cannot be null");if(null==this.o)throw Error("runner cannot be null");if(null==this.$b)throw Error("coverCommander cannot be null");this.logger=
z.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.CoverControllerImpl");b.getCurrentTopicStream().onValue((a)=>this.currentTopicId=a);this.xc=l.Bacon.newBus();b.addCoverEditModeStream(this.xc);b.getCoverEditModeStream().onValue((a)=>this.coverEditMode=a);b.getSelectionStream().onValue((a)=>this.selectedEntityIds=a.allEntityIds)}setPlayback(a){this.playback=a}startCoverEditing(a,b,c=[],d=v.CoverEditModeKind.advanced){if(null==this.coverEditMode||a!==this.coverEditMode.topicId||
d!==this.coverEditMode.kind){var e=k.Cet.createHierarchyQuery(this.scene).getParentOrOverview(this.scene.getEntityById(a));this.currentTopicId!==e&&d!==v.CoverEditModeKind.insideAdvanced?e===this.scene.getPreziW().getOverview().getId()?this.playback.flyToOverview():this.playback.flyToObject(e):d===v.CoverEditModeKind.insideAdvanced&&(this.currentTopicId!==a&&this.playback.flyToObject(a),this.Dc.je([a],a,40));this.xc.push(d===v.CoverEditModeKind.titleEditOnly?{kind:v.CoverEditModeKind.titleEditOnly,
topicId:a}:d===v.CoverEditModeKind.advanced?{kind:v.CoverEditModeKind.advanced,topicId:a}:{kind:v.CoverEditModeKind.insideAdvanced,topicId:a});c=c.slice();if(0===c.length&&d!==v.CoverEditModeKind.insideAdvanced&&(e=this.o.scene.getEntityById(a),null!=e)){const a=p.CetModelEditor.createTopicQuery(this.o.scene).getTopicKind(e.getId());if(a===p.TopicKind.Page||a===p.TopicKind.Stack||a===p.TopicKind.Planet)e=k.Cet.createTopicChildrenQuery(this.o.scene).getChildrenIds(e.getId(),k.TopicChildBehavior.Cover),
1===e.length&&(c=e.slice(0,1))}this.ah(c);E.AppUtilsModule.getLogHelperUtils().startCoverEditing(this.logger,a,b);z.LoggerModule.setEditingMode(d===v.CoverEditModeKind.advanced?"COVER":d===v.CoverEditModeKind.insideAdvanced?"ADVANCED":"DEFAULT")}}stopCoverEditing(a,b=!0){null!=this.coverEditMode&&(this.xc.push(null),this.ih(b),E.AppUtilsModule.getLogHelperUtils().stopCoverEditing(this.logger,a),z.LoggerModule.setEditingMode("DEFAULT"))}ah(a){this.v.select({selectedGroupIds:[],selectedEntityIds:a,
type:u.SelectActionType.replace})}ih(a){const b=k.Cet.createTopicChildrenQuery(this.o.scene);a=a?this.selectedEntityIds.filter((a)=>!b.isVisibleOutside(a)):[];this.v.select({selectedGroupIds:[],selectedEntityIds:a,type:u.SelectActionType.replace})}checkCoverSelectionInvariants(a,b){let c=null,d=k.Cet.createTopicChildrenQuery(this.o.scene);a.forEach((a)=>{const f=d.hasBehavior(a,k.TopicChildBehavior.Cover),e=d.hasBehavior(a,k.TopicChildBehavior.Visual),x=d.hasBehavior(a,k.TopicChildBehavior.Surface),
I=d.hasBehavior(a,k.TopicChildBehavior.Content),h=d.hasBehavior(a,k.TopicChildBehavior.Master),g=d.getChildReferer(a);if(null==b)f?c="Cover object "+a+" is selected when not in any cover edit mode!":e?c="Visual object "+a+" is selected when not in any advanced topic edit mode!":x&&(c="Surface object "+a+" is selected when not in any advanced topic edit mode!");else switch(b.kind){case v.CoverEditModeKind.insideAdvanced:f?c="Cover object "+a+" is selected when not in an outside cover edit mode!":e&&
b.topicId!==g?c="Visual object "+a+" is selected when not in parent's topic edit mode!":x&&b.topicId!==g?c="Surface object "+a+" is selected when not in parent's topic edit mode!":I&&b.topicId!==g&&b.topicId!==a?c="Content object "+a+" of a different topic is selected!":null!=h&&b.topicId!==g&&b.topicId!==a&&(c="Master object "+a+" of a different topic is selected!");break;case v.CoverEditModeKind.advanced:case v.CoverEditModeKind.titleEditOnly:f&&b.topicId!==g?c="Cover object "+a+" is selected when not in parent's topic edit mode!":
e&&b.topicId!==g?c="Visual object "+a+" is selected when not in parent's topic edit mode!":x&&b.topicId!==g?c="Surface object "+a+" is selected when not in parent's topic edit mode!":I&&b.topicId!==a?c="Content object "+a+" is selected when in an outside topic cover edit mode!":h&&(c="Master object "+a+" is selected when in an outside topic cover edit mode!");break;default:D.Utils.assertNever(b)}});return c}fixCoverSelection(){const a=k.Cet.createTopicChildrenQuery(this.o.scene);var b=this.selectedEntityIds&&
this.selectedEntityIds.length?this.selectedEntityIds.reduce((b,d)=>{d=a.getBehaviorReferer(d,k.TopicChildBehavior.Cover);return""===b||b===d?d:null},""):null;null==b||null!=this.coverEditMode&&this.coverEditMode.topicId===b?null==b&&null!=this.coverEditMode&&this.stopCoverEditing("FIXER",!1):this.startCoverEditing(b,"FIXER",this.selectedEntityIds);this.selectedEntityIds&&this.selectedEntityIds.length&&(b=this.selectedEntityIds.filter((b)=>!a.hasBehavior(b,k.TopicChildBehavior.Cover)&&!a.hasBehavior(b,
k.TopicChildBehavior.Visual)&&!a.hasBehavior(b,k.TopicChildBehavior.Surface)),b.length<this.selectedEntityIds.length&&this.v.select({selectedGroupIds:[],selectedEntityIds:b,type:u.SelectActionType.replace}))}convertToTopicVisual(a){const b=p.CetModelEditor.createTopicQuery(this.scene);a=a.filter((a)=>!b.isTopic(this.scene.getEntityById(a)));this.o.executeApiCommand(this.$b.convertToTopicVisualCmd(a))}convertToCoverItem(a){this.o.executeApiCommand(this.$b.convertToCoverItemCmd(a));null==this.coverEditMode&&
this.v.select({selectedGroupIds:[],selectedEntityIds:[],source:u.SelectActionSource.CANVAS,type:u.SelectActionType.replace})}convertToContentItem(a){null!=this.coverEditMode&&this.v.select({selectedGroupIds:[],selectedEntityIds:[],source:u.SelectActionSource.CANVAS,type:u.SelectActionType.replace});this.o.executeApiCommand(this.$b.convertToContentItemCmd(a))}isObjectCoverEditable(a){a=p.CetModelEditor.createTopicQuery(this.scene).getTopicKind(a);return a===p.TopicKind.Planet||a===p.TopicKind.Stack}isObjectInsideTopicEditable(a){return p.CetModelEditor.createTopicQuery(this.scene).getTopicKind(a)===
p.TopicKind.Planet}shouldCoTransformContent(a){if(null==a)return!1;switch(a.kind){case v.CoverEditModeKind.advanced:return!0;case v.CoverEditModeKind.insideAdvanced:case v.CoverEditModeKind.titleEditOnly:return!1;default:return D.Utils.assertNever(a)}}};var M={};Object.defineProperty(M,"__esModule",{value:!0});M.ha=class{constructor(a){this.da=a}start(a,b){this.execute(a,b)}step(a,b){this.execute(a,b)}finish(a,b){this.execute(a,b)}zc(){return{kind:g.ActionKind.Finish}}};var Ma={};Object.defineProperty(Ma,
"__esModule",{value:!0});Ma.zf=class extends M.ha{constructor(a,b){super(a);this.objectStore=b}getName(){return"DragArcTool"}execute(a,b){b=b.execute((b)=>this.da.action.arc(b,a,this.state));this.objectStore.setCanvasHoveredEntityIds(null==b.snapDestinationId?null:[b.snapDestinationId]);this.state=b.state}};var ja={};Object.defineProperty(ja,"__esModule",{value:!0});ja.Mb=class extends M.ha{constructor(a,b,c,d,e,f){super(a);this.objectStore=b;this.v=c;this.camera=d;this.scene=e;this.pluginAccess=
f;this.logger=z.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.DragTool");this.Za=p.CetModelEditor.createGroupQuery();b.getSelectionStream().onValue((a)=>this.selection=a.allEntityIds)}getName(){return"DragMoveAction"}execute(a,b){a.kind===g.ActionKind.Finish&&null!=this.Ud&&(this.Ud(),this.Ud=null);let c=a;if(a.kind===g.ActionKind.Start){var d=a.target.entityIds;1===d.length&&(d=d[0],0>this.selection.indexOf(d)&&(d=this.Za.getGroupIdFromEntityId(this.scene,d),null!=d&&(d=this.Za.getGroupMembers(this.scene,
d).map((a)=>a.getId()),c=Object.assign(Object.assign({},a),{target:{kind:g.ActionTargetMultiplicity.multiple,entityIds:d}}))))}a=b.execute((a)=>{const b=this.da.action.dragMove(a,c,this.tb);this.tb=Object.assign({_DragMoveState_:void 0},b.dragState);return this.da.action.topicNestingDragMove(a,c,this.tb)});this.oj(a,c)}oj(a,b){this.tb=Object.assign({_DragMoveState_:void 0},a.dragState);a.nestingDirection===g.TopicNestingDirection.In||a.nestingDirection===g.TopicNestingDirection.Out?b.kind===g.ActionKind.Finish&&
null!=a.nestingTargetTopicId&&(this.objectStore.setCanvasHoveredEntityIds([]),this.v.select({selectedGroupIds:[],selectedEntityIds:a.nestingDirection===g.TopicNestingDirection.In?[a.nestingTargetTopicId]:[],type:u.SelectActionType.replace}),this.pluginAccess.send(t.topicNestingOnboarding,{kind:"requestNestInGrouping",groupedIntoId:a.nestingTargetTopicId})):a.nestingDirection!==g.TopicNestingDirection.None&&D.Utils.assertNever(a.nestingDirection)}};ja.Mb.mg="TopicHoverEntityFade";var Na={};Object.defineProperty(Na,
"__esModule",{value:!0});var rb=p.base.ShapeStyle,sb=p.base.ObjectKind,Gc=p.base.FillKind,Hc=p.base.AnchorPoint;Na.Ef=class extends ja.Mb{constructor(a,b,c,d,e,f,n){super(a,b,c,d,e,n);this.applicationController=f}getName(){return"DragPlaceholderMoveAction"}zc(){return{kind:g.ActionKind.Finish,finishKind:g.DragPlaceholderActionFinishKind.cancelled}}execute(a,b){let c=a;a.kind===g.ActionKind.Start&&(this.Zc=b.execute((b)=>this.Ng(b,a)),c=Object.assign(Object.assign({},a),{target:{kind:g.ActionTargetMultiplicity.multiple,
entityIds:[this.Zc]}}));super.execute(c,b);c.kind===g.ActionKind.Finish&&(null!=this.Zc&&(b.rollback(),this.Zc=null),c.finishKind===g.DragPlaceholderActionFinishKind.drop&&null!=this.tb&&this.applicationController.listItemDrop({stageX:c.mouseStagePosition.x,stageY:c.mouseStagePosition.y,data:c.dropData,targetTopic:this.tb.proximitySnapParent}))}Ng(a,b){var c=b.size;null==c&&(c={width:100,height:100});if(a.overview.id===b.currentTopicId)var d=a.overview.add.shape("rectangle",rb.Poly1);else if(d=a.lookup.object(b.currentTopicId),
d.kind===sb.planetTopic||d.kind===sb.page)d=d.add.shape("rectangle",rb.Poly1);else throw Error("DragMoveCommander.createDragPlaceholder: invalid parent: "+d.kind);d.height=d.width*c.height/c.width;const e=p.CetModelEditor.createCameraControl(this.camera).getScreenLayoutBox();c=e.withSize(c).move(Hc.center,e.referenceFrame.point(b.mouseStagePosition));d.fitInto(c);c=b.showPlaceholder?.2:0;d.border={thickness:1,color:{r:239,g:207,b:28,a:b.showPlaceholder?1:0}};d.fill={fillKind:Gc.solid,color:{r:239,
g:207,b:28,a:c}};a=a.toDecorator(d);a.set(k.Cet.getNotCalculatedIntoOverviewCompKey(),!0);a.set(g.EditorCommander.getSnapDescriptionKey(),{allowedSnapTargetKinds:b.allowedSnapTargetKinds});return d.id}};var Oa={};Object.defineProperty(Oa,"__esModule",{value:!0});Oa.Gf=class extends M.ha{constructor(a){super(a)}getName(){return"DragArcTool"}execute(a,b){this.state=b.execute((b)=>this.da.action.topicZoomAreaMove(b,a,this.state)).dragTopicZoomAreaState}};var Pa={};Object.defineProperty(Pa,"__esModule",
{value:!0});Pa.Wf=class extends M.ha{getName(){return"NonProportionalResizeTool"}execute(a,b){this.state=b.execute((b)=>this.da.action.nonProportionalResize(b,a,this.state)).state}};var Qa={};Object.defineProperty(Qa,"__esModule",{value:!0});Qa.Xf=class extends M.ha{getName(){return"NudgeTool"}execute(a,b){this.state=b.execute((b)=>this.da.action.nudge(b,a,this.state)).nudgeState}};var Ra={};Object.defineProperty(Ra,"__esModule",{value:!0});Ra.Zf=class extends M.ha{getName(){return"NudgeTopicZoomAreaTool"}execute(a,
b){this.state=b.execute((b)=>this.da.action.nudgeTopicZoomArea(b,a,this.state)).nudgeTopicZoomAreaState}};var U={};Object.defineProperty(U,"__esModule",{value:!0});U.xd=class extends M.ha{constructor(a,b,c){super(a);this.name=b;this.Vg=c;this.state=null}getName(){return this.name}execute(a,b){this.state=b.execute((b)=>this.Vg(b,a,this.state)).resizeState}};U.jg=class extends U.xd{constructor(a){super(a,"ResizeTool",(a,c,d)=>this.da.action.resize(a,c,d))}};U.ig=class extends U.xd{constructor(a){super(a,
"ResizeSingleTextTool",(a,c,d)=>this.da.action.resizeSingleText(a,c,d))}};var Sa={};Object.defineProperty(Sa,"__esModule",{value:!0});Sa.kg=class extends M.ha{constructor(a){super(a);this.state=null}getName(){return"RotateTool"}execute(a,b){this.state=b.execute((b)=>this.da.action.rotate(b,a,this.state)).rotateState}};var Ta={};Object.defineProperty(Ta,"__esModule",{value:!0});Ta.pg=class extends M.ha{constructor(){super(...arguments);this.state=null}getName(){return"ResizeTool"}execute(a,b){this.state=
b.execute((b)=>this.da.action.topicZoomAreaResize(b,a,this.state)).resizeTopicZoomAreaState}};var oa={};Object.defineProperty(oa,"__esModule",{value:!0});oa.Cf=class extends M.ha{constructor(a){super(a)}getName(){return"DragMaskTool"}execute(a,b){this.state=b.execute((b)=>this.da.action.maskImageMove(b,a,this.state)).state}};oa.Bf=class extends M.ha{constructor(a){super(a)}getName(){return"DragMaskTool"}execute(a,b){this.state=b.execute((b)=>this.da.action.maskAreaMove(b,a,this.state)).state}};var da=
{};Object.defineProperty(da,"__esModule",{value:!0});da.Tf=class extends M.ha{constructor(a){super(a);this.state=null}getName(){return"MaskResizeTool"}execute(a,b){this.state=b.execute((b)=>this.da.action.maskResizeImage(b,a,this.state)).state}};da.Sf=class extends M.ha{constructor(a){super(a);this.state=null}getName(){return"MaskResizeTool"}execute(a,b){this.state=b.execute((b)=>this.da.action.maskResizeArea(b,a,this.state)).state}};da.Rf=class extends M.ha{constructor(a){super(a);this.state=null}getName(){return"MaskResizeTool"}execute(a,
b){this.state=b.execute((b)=>this.da.action.maskNonProportionalResizeArea(b,a,this.state)).state}};var S={};Object.defineProperty(S,"__esModule",{value:!0});S.Ad=class{constructor(a,b,c){this.aa=a;this.fb=b;this.ca=c;this.logger=z.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.Tool");this.reset()}reset(){this.ua=this.xa=null}process(a){switch(a.kind){case g.ActionKind.Start:this.start(this.Rd(a),a);break;case g.ActionKind.Step:this.step(a);break;case g.ActionKind.Finish:this.finish(a);
break;default:D.Utils.assertNever(a)}}start(a,b){null!=this.ua&&this.finish(this.ua.zc());this.ca.clearSelection();this.Dd=!1;this.xa=this.aa.beginAsyncApiCommand({name:a.getName()},(a)=>{this.Dd=!0;if(a.reason===k.FinishEventKind.BeginOtherTransaction){if(null!=this.ua&&null!=this.xa)try{this.ua.finish(this.ua.zc(),this.xa)}finally{this.reset()}}else a.reason===k.FinishEventKind.AbortTransaction&&this.reset();return!0});this.ua=a;this.ve(()=>this.ua.start(b,this.xa));switch(b.target.kind){case g.ActionTargetMultiplicity.single:this.fb.setCanvasEditedEntities([b.target.entityId]);
break;case g.ActionTargetMultiplicity.multiple:this.fb.setCanvasEditedEntities(b.target.entityIds);break;default:throw D.Utils.assertNever(b.target);}}step(a){null!=this.ua&&null!=this.xa&&this.ve(()=>this.ua.step(a,this.xa))}finish(a){if(null!=this.ua&&null!=this.xa)try{this.ua.finish(a,this.xa)}finally{try{this.Dd||this.xa.end()}finally{this.reset()}}this.fb.setCanvasEditedEntities([])}ve(a){try{a()}catch(b){try{this.xa.end()}catch(c){}this.reset();throw b;}}};S.Yf=class extends S.Ad{Rd(a){switch(a.startKind){case g.NudgeActionStartKind.object:return new Qa.Xf(this.aa);
case g.NudgeActionStartKind.topicZoomArea:return new Ra.Zf(this.aa);default:throw D.Utils.assertNever(a);}}};S.Ff=class extends S.Ad{constructor(a,b,c,d,e,f,n){super(a,b,d);this.v=c;this.camera=e;this.applicationController=f;this.pluginAccess=n}Rd(a){switch(a.startKind){case g.DragActionStartKind.ObjectMove:return new ja.Mb(this.aa,this.fb,this.v,this.camera,this.aa.scene,this.pluginAccess);case g.DragActionStartKind.PlaceholderMove:return new Na.Ef(this.aa,this.fb,this.v,this.camera,this.aa.scene,
this.applicationController,this.pluginAccess);case g.DragActionStartKind.TopicZoomAreaMove:return new Oa.Gf(this.aa);case g.DragActionStartKind.ArcMove:return new Ma.zf(this.aa,this.fb);case g.DragActionStartKind.NonProportionalResize:return new Pa.Wf(this.aa);case g.DragActionStartKind.Resize:return 1===a.target.entityIds.length&&this.aa.executeApiCommand({name:"isSingleText",run:(b)=>b.lookup.base(a.target.entityIds[0]).is(p.base.ObjectKind.text)})?new U.ig(this.aa):new U.jg(this.aa);case g.DragActionStartKind.TopicZoomAreaResize:return new Ta.pg(this.aa);
case g.DragActionStartKind.Rotate:return new Sa.kg(this.aa);case g.DragActionStartKind.MaskImageMove:return new oa.Cf(this.aa);case g.DragActionStartKind.MaskAreaMove:return new oa.Bf(this.aa);case g.DragActionStartKind.MaskImageResize:return new da.Tf(this.aa);case g.DragActionStartKind.MaskAreaResize:return new da.Sf(this.aa);case g.DragActionStartKind.MaskAreaNonProportionalResize:return new da.Rf(this.aa);default:throw D.Utils.assertNever(a);}}};var Q={};Object.defineProperty(Q,"__esModule",{value:!0});
Q.Ha=class{static Sc(a){return W.PreziUAParser.isMac()?a.metaKey:a.altKey}static fc(a){return W.PreziUAParser.isMac()?a.metaKey:a.altKey&&a.ctrlKey}static Di(a){return W.PreziUAParser.isMac()?a.altKey:a.ctrlKey}};var ka={};Object.defineProperty(ka,"__esModule",{value:!0});ka.Qb=class{constructor(a,b,c,d,e,f){this.camera=e;this.scene=f;this.w=null;c=c.map((a)=>Q.Ha.fc(a)).merge(a.map((a)=>Q.Ha.fc(a.j.event))).toProperty(!1);a=a.filterWithStream(b.map((a)=>a.kind===E.EditorMode.edit).toProperty(!1));
this.fj=l.Bacon.combineWith3((a,b)=>({fh:a,bj:b}),a,c,d.toProperty(!0)).filterWithStream(this.camera.getPanningStream().map((a)=>a===k.PanningEvent.PanningFinished).toProperty(!0)).filterWithStream(this.camera.getZoomingStream().map((a)=>a===k.ZoomingEvent.NoZoom).toProperty(!0)).map(({fh:a,bj:b})=>{var c=a.j;return c.type===h.MouseInteractionType.DragMove||c.type===h.MouseInteractionType.DragEnd?this.nh(a):this.oh(a,b)}).toEventStream()}pe(a,b,c){if(a.type===q.ControlPointType.resize||a.type===q.ControlPointType.resizeMaskImage||
a.type===q.ControlPointType.resizeMaskArea||a.type===q.ControlPointType.topicZoomAreaResize)if(b){if(a.type===q.ControlPointType.resize)return this.Zb([u.MouseCursorShapes.TOPLEFT_ROTATE,u.MouseCursorShapes.TOPRIGHT_ROTATE,u.MouseCursorShapes.BOTTOMRIGHT_ROTATE,u.MouseCursorShapes.BOTTOMLEFT_ROTATE],ka.Qb.Pd(a.position),c)}else return this.Zb([u.MouseCursorShapes.TOPLEFT_BOTTOMRIGHT_RESIZE,u.MouseCursorShapes.TOPRIGHT_BOTTOMLEFT_RESIZE,u.MouseCursorShapes.TOPLEFT_BOTTOMRIGHT_RESIZE,u.MouseCursorShapes.TOPRIGHT_BOTTOMLEFT_RESIZE],
ka.Qb.Pd(a.position),c);else{if(a.type===q.ControlPointType.widthResize||a.type===q.ControlPointType.widthResizeMaskArea)return this.Zb([u.MouseCursorShapes.COL_RESIZE,u.MouseCursorShapes.ROW_RESIZE,u.MouseCursorShapes.COL_RESIZE,u.MouseCursorShapes.ROW_RESIZE],0,c);if(a.type===q.ControlPointType.heightResize||a.type===q.ControlPointType.heightResizeMaskArea)return this.Zb([u.MouseCursorShapes.ROW_RESIZE,u.MouseCursorShapes.COL_RESIZE,u.MouseCursorShapes.ROW_RESIZE,u.MouseCursorShapes.COL_RESIZE],
0,c);if(a.type===q.ControlPointType.line)return u.MouseCursorShapes.MOVE}return u.MouseCursorShapes.DEFAULT}Zb(a,b,c){if(1!==c.length)return a[b];c=this.scene.getEntityById(c[0]);c=k.Cet.transform(c).getLocalToWorld().getRotationRad()+this.camera.getTransform().getRotationRad();return a[(b+ka.Qb.ij(c))%4]}static Pd(a){switch(a){case g.ControlPointPosition.TOP_RIGHT:return 1;case g.ControlPointPosition.BOTTOM_RIGHT:return 2;case g.ControlPointPosition.BOTTOM_LEFT:return 3}return 0}static ij(a){for(;0>
a;)a+=2*Math.PI;for(;a>2*Math.PI;)a-=2*Math.PI;const b=Math.PI/4;return a<b||7*b<=a?0:b<=a&&a<3*b?1:3*b<=a&&a<5*b?2:3}nh(a){null==this.w&&(this.w=a.w,this.Ka=a.Ka,this.wc=a.wc);let b;b=null==this.w?{cursor:a.selection.De?u.MouseCursorShapes.MOVE:u.MouseCursorShapes.DEFAULT}:null!=this.Ka&&this.Ka.interactionType===q.InteractionType.controlPoint?{cursor:this.pe(this.wc,Q.Ha.fc(a.j.baseEvent),a.selection.selectionInfo.allEntityIds)}:null==this.Ka||this.Ka.interactionType!==q.InteractionType.border&&
this.Ka.interactionType!==q.InteractionType.topicZoomAreaBorder&&this.Ka.interactionType!==q.InteractionType.maskDrag?null!=a.textSelectionState&&a.textSelectionState.isEditing()?{cursor:u.MouseCursorShapes.TEXT}:a.j.type===h.MouseInteractionType.DragEnd?a.selection.selectionInfo.allEntityIds.find((a)=>a===this.w)?{cursor:u.MouseCursorShapes.MOVE}:{cursor:u.MouseCursorShapes.DEFAULT}:{cursor:u.MouseCursorShapes.MOVE}:{cursor:u.MouseCursorShapes.MOVE};a.j.type===h.MouseInteractionType.DragEnd&&(this.w=
null);return b}oh(a,b){const c=this.scene.getEntityById(a.w);if(null!=c){if(k.Cet.hasShapedText(c)&&null!=a.textSelectionState&&a.textSelectionState.isEditing())return{cursor:u.MouseCursorShapes.TEXT};if(p.CetModelEditor.isClickableNextLogo(c.getId(),this.scene))return{cursor:u.MouseCursorShapes.POINTER}}if(null==c)return a.selection.De?{cursor:u.MouseCursorShapes.MOVE}:{cursor:u.MouseCursorShapes.DEFAULT};const d=c.get(q.SelectionModule.getDecoratorKey());if(null!=d&&d.interactionType===q.InteractionType.controlPoint)return{cursor:this.pe(c.get(q.SelectionModule.getControlPointKey()),
b,a.selection.selectionInfo.allEntityIds)};if(null!=d){if(d.interactionType===q.InteractionType.border||d.interactionType===q.InteractionType.topicZoomAreaBorder||d.interactionType===q.InteractionType.maskDrag)return{cursor:u.MouseCursorShapes.MOVE};if(d.interactionType===q.InteractionType.clickable)return{cursor:u.MouseCursorShapes.POINTER}}return a.selection.selectionInfo.allEntityIds.some((a)=>a===c.getId())?{cursor:u.MouseCursorShapes.MOVE}:{cursor:u.MouseCursorShapes.DEFAULT}}};var Ua={};Object.defineProperty(Ua,
"__esModule",{value:!0});Ua.ag=class{constructor(a,b,c,d,e,f,n){this.Mj=n;b=b.map((b)=>b.allEntityIds.filter((b)=>{b=a.getEntityById(b);return null!=b&&k.Cet.hasPdomComponent(b)&&k.Cet.hasZOrder(b)})).map((b)=>{let c=[],d=p.CetModelEditor.createEntityQuery(a);b.forEach((f)=>{f=a.getEntityById(f);if(f.isDef(w.CetModel.ID.CONNECTOR)){let a=d.getConnectorTail(f);null!=a&&-1===c.indexOf(a)&&-1===b.indexOf(a)&&c.push(a);f=d.getConnectorHead(f);null!=f&&-1===c.indexOf(f)&&-1===b.indexOf(f)&&c.push(f)}});
return b.concat(c)});f=f.filter((a)=>a.keyCode===h.Key.UP_ARROW||a.keyCode===h.Key.DOWN_ARROW||a.keyCode===h.Key.LEFT_ARROW||a.keyCode===h.Key.RIGHT_ARROW).slidingWindow(2,1);n=f.filter((a)=>1===a.length&&a[0].type===h.KeyboardEventType.KEYDOWN||a[0].type===h.KeyboardEventType.KEYUP&&a[1].type===h.KeyboardEventType.KEYDOWN).map((a)=>a[a.length-1]);const x=(a,b)=>{if(null==b)return!1;switch(b.kind){case v.CoverEditModeKind.advanced:case v.CoverEditModeKind.insideAdvanced:return 1===a.length&&b.topicId===
a[0];case v.CoverEditModeKind.titleEditOnly:return!1;default:return D.Utils.assertNever(b)}};c=l.Bacon.combineWith5((a,b,c,d,f)=>({Ti:a,selection:b,currentTopicId:c,coverEditMode:d,isTopicZoomAreaEditEnabled:f}),n,b,c,d,e).sampledBy(n).map(({Ti:a,selection:b,currentTopicId:c,coverEditMode:d,isTopicZoomAreaEditEnabled:f})=>x(b,d,c)?f?{kind:g.ActionKind.Start,startKind:g.NudgeActionStartKind.topicZoomArea,direction:this.qe(a),target:{kind:g.ActionTargetMultiplicity.single,entityId:b[0]},isFast:a.shiftKey,
coTransformContent:this.Mj.shouldCoTransformContent(d)}:null:0<b.length?{kind:g.ActionKind.Start,startKind:g.NudgeActionStartKind.object,direction:this.qe(a),target:{kind:g.ActionTargetMultiplicity.multiple,entityIds:b},isFast:a.shiftKey}:null).filter((a)=>null!=a).toEventStream();d=f.filter((a)=>2===a.length&&a[0].type===h.KeyboardEventType.KEYDOWN&&a[1].type===h.KeyboardEventType.KEYDOWN).map((a)=>({kind:g.ActionKind.Step,snapEnabled:!Q.Ha.Sc(a[1]),isFast:a[1].shiftKey})).toEventStream();e=f.filter((a)=>
a[a.length-1].type===h.KeyboardEventType.KEYUP).map(()=>({kind:g.ActionKind.Finish})).toEventStream();this.gj=l.Bacon.mergeAll([c,d,e]);this.Yi(c);this.Xi(c)}qe(a){switch(a.keyCode){case h.Key.UP_ARROW:return g.NudgeDirection.Up;case h.Key.DOWN_ARROW:return g.NudgeDirection.Down;case h.Key.LEFT_ARROW:return g.NudgeDirection.Left;case h.Key.RIGHT_ARROW:return g.NudgeDirection.Right;default:return null}}Yi(a){this.logUseKeyboardShortcut(!1,a)}Xi(a){this.logUseKeyboardShortcut(!0,a)}logUseKeyboardShortcut(a,
b){b.filter((b)=>b.isFast===a).debounce(1E3).onValue(()=>{z.avro.Avro.createDefaultLogger().logUseKeyboardShortcut({shortcut_type:a?"MOVE_SELECTION":"NUDGE_SELECTION"})})}};var Va={};Object.defineProperty(Va,"__esModule",{value:!0});Va.lg=class{constructor(a,b,c,d,e,f,n,x,h,g,k){this.ra=a;this.Fg=b;this.Ra=c;this.sb=d;this.Ug=e;this.bd=f;this.dd=n;this.f=x;this.v=h;this.camera=g;this.scene=k;this.Za=p.CetModelEditor.createGroupQuery();this.si()}getAreaSelectionStream(){return this.wg}getHighlightEntitiesOnDragSelectActionStream(){return this.Xh}si(){var a=
this.ra.filter((a)=>(a.type===h.MouseInteractionType.DragMove||a.type===h.MouseInteractionType.DragEnd)&&a.baseEvent.shiftKey).filterWithStream(this.camera.getPanningStream().map((a)=>a===k.PanningEvent.PanningFinished).toProperty(!0)).filterWithStream(this.camera.getZoomingStream().map((a)=>a===k.ZoomingEvent.NoZoom).toProperty(!0)).map((a)=>({rect:this.Dj(a),originalEvent:a}));this.wg=a.map((a)=>a.originalEvent.type===h.MouseInteractionType.DragMove?a.rect:null);a=l.Bacon.combineWith4((a,b,c,n)=>
({entityIds:this.rh(a.rect,b,c,n.allEntityIds),originalEvent:a.originalEvent}),a,this.f.getCurrentTopicStream(),this.f.getCoverEditModeStream(),this.f.getSelectionStream()).sampledBy(a).toEventStream();this.Xh=a.map((a)=>({entityIds:a.originalEvent.type===h.MouseInteractionType.DragMove?a.entityIds:[]}));a=a.filter((a)=>a.originalEvent.type===h.MouseInteractionType.DragEnd).map((a)=>{a=a.entityIds;const b=q.SelectionModule.getEditedGroupId(this.scene,this.f.getSelection());if(null==b){var {groupIds:c,
entities:d}=q.SelectionModule.getGroupsWithEntities(this.scene,a);return{type:u.SelectActionType.add,selectedGroupIds:c,selectedEntityIds:d.map((a)=>a.getId())}}if(q.SelectionModule.getContainerGroupId(this.scene,a)===b)return{type:u.SelectActionType.add,selectedGroupIds:[],selectedEntityIds:a};var {groupIds:x,entities:h}=q.SelectionModule.getGroupsWithEntities(this.scene,a);return{type:u.SelectActionType.replace,selectedGroupIds:[...x,b],selectedEntityIds:h.map((a)=>a.getId())}});a.onValue(()=>{z.avro.Avro.createDefaultLogger().logUseKeyboardShortcut({shortcut_type:"DRAW_A_RECTANGLE_TO_SELECT_MULTIPLE_OBJECTS"})});
const b=this.Ra.filter((a)=>a.kind===g.ActionKind.Start&&a.startKind===g.DragActionStartKind.ObjectMove).map((a)=>a);var c=this.sb.filter((a)=>null!=a.entity&&a.entity.isDef(w.CetModel.ID.Z_ZOOM_AREA)).map(()=>null);c=this.Ug.merge(c);this.Ig(this.Fg).merge(this.Mg(b)).merge(a).merge(this.Sg(this.sb)).merge(this.Rg()).merge(c.map(()=>({selectedGroupIds:[],selectedEntityIds:[],type:u.SelectActionType.replace}))).onValue((a)=>{this.v.select(a)})}Hi(a,b,c){if(1===b.length&&null==this.scene.getEntityById(b[0])||
1!==b.length||!this.scene.getEntityById(b[0]).isDef(w.CetModel.ID.Z_TEXT)||null==a||null==this.scene.getEntityById(a)||!this.scene.getEntityById(a).isDef(w.CetModel.ID.Z_TEXT))return!1;c=null!=c&&c.isEditing();a=-1!==b.indexOf(a);return c&&a}Ki(a){a=a.getWrapper(w.CetModel.ID.Z_OBJECT.W);return a.is(w.CetModel.ID.Z_IMAGE)&&a.getIsPlaceholder()}Ig(a){a=a.filter((a)=>a.j.type===h.MouseInteractionType.Click);return l.Bacon.combineWith((a,c)=>({event:a,kj:c}),a,this.f.getOpenedPopupIdStream()).sampledBy(a).toEventStream().map(({event:a,
kj:c})=>{var b=this.scene.getEntityById(a.w),e=a.selection.selectionInfo,f=e.allEntityIds;if(null!=b){var n=b.get(q.SelectionModule.getDecoratorKey()),x=p.CetModelEditor.createTopicQuery(this.scene);if(null!=n&&n.interactionType===q.InteractionType.clickable&&x.isTopic(this.scene.getEntityById(n.ownerIds[0])))b=this.scene.getEntityById(n.ownerIds[0]);else if(!T.Qa.ab(a.w,a.currentTopicId,a.coverEditMode,f,this.scene)||this.Hi(a.w,f,a.textSelectionState))return null}a.j.event.shiftKey&&z.avro.Avro.createDefaultLogger().logUseKeyboardShortcut({shortcut_type:"SELECT_MULTIPLE_OBJECTS"});
if(null!=b){c=this.Za.getGroupIdFromEntity(this.scene,b);if(0===e.nonGroupedEntityIds.length&&1===e.groupIds.length&&e.groupIds[0]===c)return{type:u.SelectActionType.replace,selectedGroupIds:[],selectedEntityIds:[b.getId()]};e=q.SelectionModule.getEditedGroupId(this.scene,e);f=null!=c&&e===c;a=this.wh(a.j.event);n={type:a,selectedGroupIds:[],selectedEntityIds:[b.getId()]};x={type:a,selectedGroupIds:[c],selectedEntityIds:[]};if(a!==u.SelectActionType.toggle&&a!==u.SelectActionType.add||null==e||f)return null==
c||f||this.Ki(b)&&a===u.SelectActionType.replace?n:x;b=null==c?n:x;return{type:u.SelectActionType.replace,selectedGroupIds:b.selectedGroupIds.concat(e),selectedEntityIds:b.selectedEntityIds}}return null===c&&0<f.length?{type:u.SelectActionType.replace,selectedGroupIds:[],selectedEntityIds:[]}:null}).filter((a)=>null!=a)}wh(a){return a.shiftKey?u.SelectActionType.toggle:a.ctrlKey?u.SelectActionType.add:u.SelectActionType.replace}Mg(a){return l.Bacon.combineWith4((a,c,d,e)=>({Yd:a,selection:c.allEntityIds,
currentTopic:d,coverEditMode:e}),a,this.f.getSelectionStream(),this.f.getCurrentTopicStream(),this.f.getCoverEditModeStream()).sampledBy(a).filter(({Yd:a,currentTopic:c,coverEditMode:d,selection:e})=>a.target.entityIds.every((a)=>T.Qa.ab(a,c,d,e,this.scene))).map(({Yd:a,selection:c})=>0<c.length&&a.target.entityIds.every((a)=>-1===c.indexOf(a))?{type:u.SelectActionType.replace,selectedGroupIds:[],selectedEntityIds:[]}:null).filter((a)=>null!=a)}Rg(){const a=this.f.getTextSelectionStateStream().map((a)=>
null==a||!a.isEditing()),b=this.dd.filter((a)=>-1!==a.actions.indexOf(h.ShortcutAction.SELECT_ALL)).filterWithStream(a).doAction((a)=>a.event.preventDefault());return l.Bacon.combineWith((a,b)=>({currentTopic:a,coverEditMode:b}),this.f.getCurrentTopicStream(),this.f.getCoverEditModeStream()).sampledBy(b.mergeAny(this.bd.filterWithStream(a))).map(({currentTopic:a,coverEditMode:b})=>{const c=k.Cet.createTopicChildrenQuery(this.scene);let d;if(null==b)d=c.getChildrenIds(a,k.TopicChildBehavior.Content);
else switch(b.kind){case v.CoverEditModeKind.insideAdvanced:d=c.getChildrenIdsVisibleInside(b.topicId);break;case v.CoverEditModeKind.titleEditOnly:case v.CoverEditModeKind.advanced:d=c.getChildrenIdsVisibleOutside(b.topicId);break;default:D.Utils.assertNever(b)}d=d.filter((c)=>T.Qa.ab(c,a,b,[],this.scene));const {groupIds:n,entities:x}=q.SelectionModule.getGroupsWithEntities(this.scene,[...d]);return{selectedGroupIds:n,selectedEntityIds:x.map((a)=>a.getId()),type:u.SelectActionType.replace}})}Sg(a){return a.filter((a)=>
null!=a.entity&&k.Cet.hasCurvedLine(a.entity)).map((a)=>{var b=k.Cet.createHierarchyQuery(this.scene).getParentOrOverview(a.entity);b=k.Cet.createHierarchyQuery(this.scene).getChildrenIdsWithOverviewFallback(b);const d=k.Cet.getStyleClass(a.entity);return{selectedGroupIds:[],selectedEntityIds:b.filter((a)=>{a=this.scene.getEntityById(a);return null!=d&&d===k.Cet.getStyleClass(a)}),type:u.SelectActionType.replace}})}Dj(a){const b=K.Geometry.rectangleFromData({x:a.baseEvent.stagePos.x,y:a.baseEvent.stagePos.y,
width:0,height:0});a=K.Geometry.rectangleFromData({x:a.event.stagePos.x,y:a.event.stagePos.y,width:0,height:0});return b.union(a)}rh(a,b,c,d){const e=K.Geometry.obbFromRect(a.getData()).transform(this.camera.getTransform().invert()),f=k.Cet.createTopicChildrenQuery(this.scene),n=p.CetModelEditor.createScreenBoundsCalculator(this.scene,this.camera);return this.Aa().getEntitiesByWorldArea(e).apply(this.Aa().strategies().entitiesInArea(this.scene,null!=c&&null!=c.topicId)).filter((a)=>T.Qa.ab(a.getEntityId(),
b,c,d,this.scene)).filter((a)=>this.bh(a.getData().entity,e,f,n)).filter((a)=>!a.is(p.HitTag.Z_TOPIC_CONTAINER)||0===f.getChildrenIdsVisibleOutside(a.getEntityId()).length).entities().map((a)=>a.getId())}bh(a,b,c,d){if(a.isDef(w.CetModel.ID.Z_TOPIC_CONTAINER))return c=c.getChildrenIdsVisibleOutside(a.getId()),d.getUnionWorldBoundsParentAligned(a,c).getObb().intersects(b);c=k.Cet.transform(a).getLocalToWorld();a=d.getLocalBoundsForHittest(a);return K.Geometry.obbFromRect(a.getData()).transform(c).intersects(b)}Aa(){return this.scene.getPrezi().get(p.CetModelEditor.getStageQueryKey())}};
var Wa={};Object.defineProperty(Wa,"__esModule",{value:!0});Wa.uf=class{constructor(a,b,c){this.Vd=a;this.Od=b;this.scene=c;this.Nd=this.Jg()}Oj(a,b){a.select({selectedGroupIds:[],selectedEntityIds:[],type:u.SelectActionType.replace});b.stopCoverEditing("FLY-IN")}Jg(){var a=this.Vd.debounce(1).map(()=>({pa:null,selection:[]}));a=this.Od.debounce(500).merge(a).map(()=>({pa:null,selection:[]}));const b=(a)=>{const b=this.scene.getEntityById(a.pa),c=k.Cet.createTopicChildrenQuery(this.scene);return!(1===
a.selection.length&&c.isVisibleOutside(a.pa)&&a.selection[0]===c.getChildReferer(a.pa)&&b.isDef(w.CetModel.ID.Z_TEXT))};return this.Od.filter((a)=>b(a)).merge(a).sampledBy(this.Vd).filter((a)=>null!=a.pa)}yh(a){return this.Nd.map((b)=>{b=a.getEntityById(b.pa);return a.getEntityById(k.Cet.createHierarchyQuery(a).getParentId(b))})}};var T={};Object.defineProperty(T,"__esModule",{value:!0});var O=p.base.AnchorPoint,ea;(function(a){a[a.nd=0]="FlyToEntity";a[a.pc=1]="SelectEntity"})(ea||(ea={}));T.Qa=
class{constructor(a,b,c,d,e,f,n,x,k,m,q,t,r,w,y,z){this.ra=a;this.scene=b;this.camera=c;this.f=d;this.v=e;this.qa=n;this.Ma=x;this.dd=k;this.$a=t;this.va=r;this.Za=p.CetModelEditor.createGroupQuery();this.me=(a)=>{switch(a.position){case g.ControlPointPosition.TOP_LEFT:return O.topLeft;case g.ControlPointPosition.TOP_RIGHT:return O.topRight;case g.ControlPointPosition.BOTTOM_LEFT:return O.bottomLeft;case g.ControlPointPosition.BOTTOM_RIGHT:return O.bottomRight;default:throw D.Utils.assert(!1,"invalid controlpoint position");
}};this.ne=(a)=>{switch(a.position){case g.ControlPointPosition.MIDDLE_LEFT:return O.centerLeft;case g.ControlPointPosition.MIDDLE_RIGHT:return O.centerRight;case g.ControlPointPosition.MIDDLE_TOP:return O.topCenter;case g.ControlPointPosition.MIDDLE_BOTTOM:return O.bottomCenter;default:return this.me(a)}};this.ta=this.f.getSelectionStream();this.Dh();this.Sh(m);this.hj=new Ua.ag(this.scene,this.ta,d.getCurrentTopicStream(),d.getCoverEditModeStream(),this.f.getIsTopicZoomAreaEditEnabledStream(),this.Ma,
this.qa);a=this.Ie(this.ra,this.f.getSelectionStream(),this.f.getTextSelectionStateStream(),this.f.getCurrentTopicStream(),this.f.getCoverEditModeStream(),this.f.getMaskEditingModeStream());b=this.Kg(a);b.onValue((a)=>{a.action===ea.pc&&this.v.select({type:u.SelectActionType.replace,selectedGroupIds:[],selectedEntityIds:[a.entity.getId()]})});this.ub=l.Bacon.newBus();this.ub.plug(b.filter((a)=>a.action===ea.nd).map((a)=>a.entity));this.sb=this.Lg(a);this.ci(a);this.gi(w);this.oi(a);w=l.Bacon.combineWith((a,
b)=>({flyTo:a,selection:b}),this.ub,this.ta).sampledBy(this.ub).filter(({flyTo:a,selection:b})=>-1===b.allEntityIds.indexOf(a.getId())).map(()=>null);w=l.Bacon.mergeAll([w,this.Ma.filter((a)=>a.keyCode===h.Key.ESC).filterWithStream(this.f.getMaskEditingModeStream().map((a)=>a.kind===v.MaskingModeKind.off)).map(()=>null)]);this.Ye=new Va.lg(this.ra,a,this.Ra,this.sb,w,q,k,this.f,this.v,this.camera,this.scene);k=this.Ie(this.ra,this.f.getSelectionStream(),this.f.getTextSelectionStateStream(),this.f.getCurrentTopicStream(),
this.f.getCoverEditModeStream(),this.f.getMaskEditingModeStream(),!0);this.Jh(k,this.f.getRecalculateEntityUnderMouseActionStream(),this.f.getLogoStream());this.dj=new ka.Qb(k,this.f.getModeStream(),x,this.f.getRecalculateEntityUnderMouseActionStream(),this.camera,this.scene);this.yj=this.Ra.filter((a)=>a.kind!==g.ActionKind.Step).map((a)=>a.kind===g.ActionKind.Start&&(a.startKind===g.DragActionStartKind.Resize||a.startKind===g.DragActionStartKind.NonProportionalResize)).skipDuplicates();this.vb=
this.Pg(this.Ra,this.f.getTextSelectionStateStream());this.Xd=new S.Ff(r,this.f,this.v,f,this.camera,z,y);this.Ra.onValue((a)=>this.Xd.process(a));this.Me=new S.Yf(r,this.f,f);this.hj.gj.onValue((a)=>this.Me.process(a));this.Lh(a);this.Kh(a,y)}getAreaSelectionStream(){return this.Ye.getAreaSelectionStream()}getHighlightEntitiesOnDragSelectActionStream(){return this.Ye.getHighlightEntitiesOnDragSelectActionStream()}getDoubleClickedEntityStream(){return this.sb}getResizeControlPointStream(){return this.yj}getFocusStream(){return this.vb}getMouseCursorStateStream(){return this.dj.fj}getFlyToEntityActionStream(){return this.ub}getOutputInteractionStream(){return this.lj}reset(){this.Xd.reset();
this.Me.reset()}Kh(a,b){a.filter((a)=>a.j.type===h.MouseInteractionType.Click).onValue((a)=>{a=a.w;null!=a&&this.Ce(a)&&this.scene.getEntityById(a).get(q.SelectionModule.getDecoratorKey()).interactionType===q.InteractionType.clickable&&b.send(t.watermark,{request:"openSidebar"})})}Lh(a){const b=(a)=>{a=this.scene.getEntityById(a);if(null==a)return!1;a=a.get(q.SelectionModule.getDecoratorKey());return null!=a&&a.interactionType===q.InteractionType.clickable?(a=this.scene.getEntityById(a.ownerIds[0]),
null!=a&&a.isDef(w.CetModel.ID.Z_IMAGE)):!1};var c=a.filter((a)=>a.j.type===h.MouseInteractionType.Click&&b(a.w));a=this.f.getMaskEditingModeStream();c=a.sampledBy(c).map((a)=>a.kind===v.MaskingModeKind.on?Object.assign(Object.assign({},a),{target:a.target===v.MaskEditTarget.mask?v.MaskEditTarget.image:v.MaskEditTarget.mask}):a);var d=this.Ra.filter((a)=>a.kind===g.ActionKind.Start&&(a.startKind===g.DragActionStartKind.MaskAreaMove||a.startKind===g.DragActionStartKind.MaskImageMove)).map((a)=>a.startKind===
g.DragActionStartKind.MaskAreaMove?v.MaskEditTarget.mask:v.MaskEditTarget.image);d=l.Bacon.combineWith((a,b)=>({mask:a,target:b}),a,d).sampledBy(d).map((a)=>Object.assign(Object.assign({},a.mask),{target:a.target}));const e=(a)=>{switch(a){case v.MaskEditTarget.image:return{image_masking_mode:"MASKING"};case v.MaskEditTarget.mask:return{image_masking_mode:"CROPPING"};default:throw D.Utils.assertNever(a);}};a.slidingWindow(2,1).onValue((a)=>{a[0].kind===v.MaskingModeKind.on&&a[1].kind===v.MaskingModeKind.on&&
a[0].target!==a[1].target&&z.avro.Avro.createDefaultLogger().logSwitchMaskingAndCropping(e(a[1].target))});a=this.f.getMaskEditingModeStream().sampledBy(this.Ma.filter((a)=>"Enter"===a.key)).map((a)=>a.kind===v.MaskingModeKind.on?{kind:v.MaskingModeKind.off}:a);a.onValue(()=>{this.v.select({selectedGroupIds:[],selectedEntityIds:[],type:u.SelectActionType.replace})});this.f.addMaskEditingModeStream(l.Bacon.mergeAll([c,d,a]))}Ei(a){return a===h.MouseInteractionType.Click||a===h.MouseInteractionType.DoubleClick||
a===h.MouseInteractionType.TripleClick}Gi(a,b,c){const d=k.Cet.createTopicChildrenQuery(this.scene),e=p.CetModelEditor.createTopicQuery(this.scene);b=k.Cet.createHierarchyQuery(this.scene).getParentId(a)!==b&&e.getTopicKind(b)!==p.TopicKind.Page;a=null!=a&&d.isVisibleOutside(a.getId());return b&&a&&null==c}Fe(a){a=p.CetModelEditor.createTopicQuery(this.scene).getTopicKind(a.getId());return a===p.TopicKind.Planet||a===p.TopicKind.Stack}ci(a){var b=a.filter((a)=>a.j.type===h.MouseInteractionType.Click||
a.j.type===h.MouseInteractionType.DoubleClick),c=b.filter((a)=>a.j.type===h.MouseInteractionType.Click);b=b.filter((a)=>a.j.type===h.MouseInteractionType.DoubleClick);c=c.map((a)=>{const b=this.$a.getEntityForClickInEditMode(this.Aa(),this.camera,this.scene,a.j.event.stagePos,a.selection.selectionInfo.allEntityIds,a.j.type,null);return this.Gi(b,a.currentTopicId,a.coverEditMode)?{pa:b.getId(),selection:a.selection.selectionInfo.allEntityIds}:{pa:null,selection:a.selection.selectionInfo.allEntityIds}}).filter((a)=>
null!=a.pa);const d=new Wa.uf(b,c,this.scene);d.Nd.onValue(()=>d.Oj(this.v,this.qa));this.ub.plug(d.yh(this.scene));c.onValue((a)=>{const b=this.scene.getEntityById(a.pa);this.qa.startCoverEditing(k.Cet.createHierarchyQuery(this.scene).getParentId(b),"CLICK-COVER-ITEM",[a.pa],v.CoverEditModeKind.titleEditOnly)});const e=k.Cet.createTopicChildrenQuery(this.scene);l.Bacon.combineWith((a,b)=>({selection:a.allEntityIds,coverEditMode:b}),this.ta,this.f.getCoverEditModeStream()).sampledBy(this.ta).toEventStream().filter(({selection:a,
coverEditMode:b})=>null==b?!1:a.some((a)=>b.kind!==v.CoverEditModeKind.insideAdvanced?!e.isVisibleOutside(a)&&a!==b.topicId:!e.isVisibleInside(a)&&a!==b.topicId)).onValue(()=>this.qa.stopCoverEditing("SELECT"));a.filter((a)=>null!=a.coverEditMode&&a.j.type===h.MouseInteractionType.Click).filter((a)=>{const b=p.CetModelEditor.createScreenBoundsCalculator(this.scene,this.camera);switch(a.coverEditMode.kind){case v.CoverEditModeKind.titleEditOnly:return a=this.scene.getEntityById(a.w),null==a||!this.Aa().queryableInTitleEditOnlyMode(a);
case v.CoverEditModeKind.insideAdvanced:return null==a.w;case v.CoverEditModeKind.advanced:return null==a.w&&!b.getScreenAABBForEntities([a.coverEditMode.topicId],{topic:p.TopicBoundsOptions.zoomArea}).pointIsInside(a.j.event.stagePos);default:return D.Utils.assertNever(a.coverEditMode)}}).onValue((a)=>{this.qa.stopCoverEditing("CLICK");if(0<a.selection.selectionInfo.allEntityIds.length){a=k.Cet.createHierarchyQuery(this.scene).getParentId(this.scene.getEntityById(a.selection.selectionInfo.allEntityIds[0]));
const b=p.CetModelEditor.createTopicQuery(this.scene).getTopicKind(a);p.TopicKind.Planet!==b&&p.TopicKind.Stack!==b||this.v.select({selectedGroupIds:[],selectedEntityIds:[a],type:u.SelectActionType.replace})}})}oi(a){const b=(a)=>{const b=a.j.type===h.MouseInteractionType.Zoom;let c=null;a.j.type===h.MouseInteractionType.DragMove&&(c=this.$a.getEntityUnderPointInEditMode(this.Aa(),this.camera,this.scene,a.j.baseEvent.stagePos,!0,null!=a.selection?a.selection.selectionInfo.allEntityIds[0]:null));a=
a.j.type===h.MouseInteractionType.DragMove&&null==c||a.j.type===h.MouseInteractionType.DragEnd;return b||a};this.lj=a.filterWithStream(this.Li.map((a)=>!a)).filter((a)=>{var c=a.textSelectionState;return(!(null!=c&&c.isEditing())||b(a))&&!0!==(a.j.baseEvent||{shiftKey:!1}).shiftKey}).filter((a)=>a.j.type!==h.MouseInteractionType.Click||this.isLogo(a.w)).map((a)=>a.j)}isLogo(a){a=this.scene.getEntityById(a);return null!=a&&(a.isDef(w.CetModel.ID.LOGO)||a.isDef(w.CetModel.ID.NEXT_LOGO_V1))}Ce(a){a=
this.scene.getEntityById(a);if(null==a)return!1;a=a.get(q.SelectionModule.getDecoratorKey());return null!=a&&1===a.ownerIds.length&&this.isLogo(a.ownerIds[0])}Wd(a,b,c){if(0<a.length){const d=this.Ic(a.map((a)=>this.scene.getEntityById(a)),b).map((a)=>a.getId());return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.ObjectMove,mouseStagePosition:c.event.stagePos,originalMouseStagePosition:c.baseEvent.stagePos,target:{kind:g.ActionTargetMultiplicity.multiple,entityIds:a.slice()},entitiesToTransformInSync:d,
currentTopicId:b}}return null}Xg(a,b,c){return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.TopicZoomAreaMove,mouseStagePosition:c.event.stagePos,originalMouseStagePosition:c.baseEvent.stagePos,target:{kind:g.ActionTargetMultiplicity.single,entityId:a},coTransformContent:this.qa.shouldCoTransformContent(b)}}Wg(a,b,c,d,e,f){if(b.type===q.ControlPointType.resize||b.type===q.ControlPointType.topicZoomAreaResize)if(!Q.Ha.fc(e.baseEvent)){let n;switch(b.position){case g.ControlPointPosition.TOP_LEFT:n=
O.topLeft;break;case g.ControlPointPosition.TOP_RIGHT:n=O.topRight;break;case g.ControlPointPosition.BOTTOM_LEFT:n=O.bottomLeft;break;case g.ControlPointPosition.BOTTOM_RIGHT:n=O.bottomRight;break;default:throw D.Utils.assert(!1,"invalid controlpoint position");}if(b.type===q.ControlPointType.resize)return b=this.Ic(a.ownerIds.map((a)=>this.scene.getEntityById(a)),d).map((a)=>a.getId()),{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.Resize,resizeAnchor:n,isCenterResize:f,mouseStagePosition:e.event.stagePos,
originalMouseStagePosition:e.baseEvent.stagePos,target:{kind:g.ActionTargetMultiplicity.multiple,entityIds:a.ownerIds},entitiesToTransformInSync:b};if(b.type===q.ControlPointType.topicZoomAreaResize)return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.TopicZoomAreaResize,resizeAnchor:n,isCenterResize:f,mouseStagePosition:e.event.stagePos,originalMouseStagePosition:e.baseEvent.stagePos,target:{kind:g.ActionTargetMultiplicity.single,entityId:a.ownerIds[0]},coTransformContent:this.qa.shouldCoTransformContent(c)}}else{if(b.type===
q.ControlPointType.resize)return f=this.Ic(a.ownerIds.map((a)=>this.scene.getEntityById(a)),d).map((a)=>a.getId()),{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.Rotate,mouseStagePosition:e.event.stagePos,originalMouseStagePosition:e.baseEvent.stagePos,target:{kind:g.ActionTargetMultiplicity.multiple,entityIds:a.ownerIds},entitiesToTransformInSync:f}}else{if(1===a.ownerIds.length&&(b.type===q.ControlPointType.heightResize||b.type===q.ControlPointType.widthResize))return{kind:g.ActionKind.Start,
startKind:g.DragActionStartKind.NonProportionalResize,isCenterResize:f,mouseStagePosition:e.event.stagePos,originalMouseStagePosition:e.baseEvent.stagePos,target:{kind:g.ActionTargetMultiplicity.single,entityId:a.ownerIds[0]},isWidthResize:b.type===q.ControlPointType.widthResize};if(1===a.ownerIds.length&&b.type===q.ControlPointType.line){switch(b.position){case g.ControlPointPosition.MIDDLE_CENTER:f=O.center;break;case g.ControlPointPosition.MIDDLE_LEFT:f=O.centerLeft;break;case g.ControlPointPosition.MIDDLE_RIGHT:f=
O.centerRight;break;default:throw D.Utils.assert(!1,"invalid controlpoint position");}return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.ArcMove,mouseStagePosition:e.event.stagePos,originalMouseStagePosition:e.baseEvent.stagePos,target:{kind:g.ActionTargetMultiplicity.single,entityId:a.ownerIds[0]},dragArcAnchor:f}}}return null}gi(a){var b=this.ra.slidingWindow(2,2),c=this.Ma.map((a)=>a.keyCode===h.Key.SPACE&&a.type!==h.KeyboardEventType.KEYUP).skipDuplicates().toProperty(!1),d=this.Ma.map((a)=>
Q.Ha.Di(a)).skipDuplicates().toProperty(!1),e=this.Ma.map((a)=>Q.Ha.Sc(a)).merge(this.ra.map((a)=>Q.Ha.Sc(a.event))).skipDuplicates().toProperty(!1);c=l.Bacon.combineWithA((a,b,c,d,e,f,h,g)=>({Yc:a,selection:b.allEntityIds,textSelectionState:c,currentTopicId:d,coverEditMode:e,Wc:f,isCenterResize:h,Mi:g}),[b,this.f.getSelectionStream(),this.f.getTextSelectionStateStream(),this.f.getCurrentTopicStream(),this.f.getCoverEditModeStream(),this.f.getMaskEditingModeStream(),d,c]).sampledBy(b);b=c.filter(({Wc:a})=>
a.kind===v.MaskingModeKind.on).filter(({Yc:a})=>{const [b,c]=a;return b.type!==h.MouseInteractionType.DragMove&&c.type===h.MouseInteractionType.DragMove&&!c.baseEvent.shiftKey}).map(({Yc:a,coverEditMode:b,Wc:c})=>{a=a[1];b=this.$a.getEntityForDragStartInEditMode(this.Aa(),this.camera,this.scene,a.baseEvent.stagePos,null==b,null);const d=null!=b?b.get(q.SelectionModule.getDecoratorKey()):null;if(null!=d)if(d.interactionType===q.InteractionType.controlPoint){c=b.get(q.SelectionModule.getControlPointKey());
if(null!=c&&c.type===q.ControlPointType.resizeMaskImage)return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.MaskImageResize,resizeAnchor:this.me(b.get(q.SelectionModule.getControlPointKey())),mouseStagePosition:a.event.stagePos,originalMouseStagePosition:a.event.stagePos,target:{kind:g.ActionTargetMultiplicity.single,entityId:d.ownerIds[0]}};if(null!=c&&c.type===q.ControlPointType.resizeMaskArea)return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.MaskAreaResize,resizeAnchor:this.ne(b.get(q.SelectionModule.getControlPointKey())),
mouseStagePosition:a.event.stagePos,originalMouseStagePosition:a.event.stagePos,target:{kind:g.ActionTargetMultiplicity.single,entityId:d.ownerIds[0]}};if(null!=c&&c.type===q.ControlPointType.heightResizeMaskArea||c.type===q.ControlPointType.widthResizeMaskArea)return{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.MaskAreaNonProportionalResize,resizeAnchor:this.ne(b.get(q.SelectionModule.getControlPointKey())),mouseStagePosition:a.event.stagePos,originalMouseStagePosition:a.event.stagePos,
target:{kind:g.ActionTargetMultiplicity.single,entityId:d.ownerIds[0]},isWidthResize:c.type===q.ControlPointType.widthResizeMaskArea}}else if((d.interactionType===q.InteractionType.maskDrag||d.interactionType===q.InteractionType.border||d.interactionType===q.InteractionType.clickable)&&c.kind===v.MaskingModeKind.on)return(d.interactionType===q.InteractionType.clickable?c.target===v.MaskEditTarget.image?v.MaskEditTarget.mask:v.MaskEditTarget.image:c.target)===v.MaskEditTarget.image?{kind:g.ActionKind.Start,
startKind:g.DragActionStartKind.MaskImageMove,mouseStagePosition:a.event.stagePos,originalMouseStagePosition:a.event.stagePos,target:{kind:g.ActionTargetMultiplicity.single,entityId:d.ownerIds[0]}}:{kind:g.ActionKind.Start,startKind:g.DragActionStartKind.MaskAreaMove,mouseStagePosition:a.event.stagePos,originalMouseStagePosition:a.event.stagePos,target:{kind:g.ActionTargetMultiplicity.single,entityId:d.ownerIds[0]}};return null}).filter((a)=>null!=a).toEventStream();c=c.filter(({Wc:a,Mi:b})=>a.kind===
v.MaskingModeKind.off&&!b).map(({Yc:a,selection:b,textSelectionState:c,currentTopicId:d,coverEditMode:e,isCenterResize:f})=>{const [n,g]=a;if(n.type!==h.MouseInteractionType.DragMove&&g.type===h.MouseInteractionType.DragMove&&!g.baseEvent.shiftKey){a=null!=c&&c.isEditing()?b[0]:null;a=this.$a.getEntityForDragStartInEditMode(this.Aa(),this.camera,this.scene,g.baseEvent.stagePos,null==e,a);var x=null!=a?a.get(q.SelectionModule.getDecoratorKey()):null;if(null!=x)switch(x.interactionType){case q.InteractionType.border:return b=
this.fe(x.ownerIds.map((a)=>this.scene.getEntityById(a))).map((a)=>a.getId()),this.Wd(b,d,g);case q.InteractionType.topicZoomAreaBorder:return this.Xg(x.ownerIds[0],e,g);case q.InteractionType.controlPoint:return this.Wg(x,a.get(q.SelectionModule.getControlPointKey()),e,d,g,f);case q.InteractionType.locked:case q.InteractionType.clickable:case q.InteractionType.maskDrag:case q.InteractionType.none:break;default:throw D.Utils.assertNever(x.interactionType);}else return f=this.Ee(b,g.baseEvent.stagePos,
d),x=k.Cet.createHierarchyQuery(this.scene).getParentId(a),null==e||f||null==a||e.topicId===a.getId()||x===e.topicId&&e.kind!==v.CoverEditModeKind.titleEditOnly||(e=this.scene.getEntityById(x),p.CetModelEditor.createTopicQuery(this.scene).getTopicKind(x)!==p.TopicKind.None&&(a=e),this.qa.stopCoverEditing("DRAG")),b=this.zj(a,b,c,f).map((a)=>a.getId()),this.Wd(b,d,g)}return null}).filter((a)=>null!=a).toEventStream();const f=this.ra.filter((a)=>a.type===h.MouseInteractionType.DragMove);d=l.Bacon.combineWith3((a,
b,c)=>({kind:g.ActionKind.Step,stagePosition:a.event.stagePos,isCenterResizeKeyPressed:b,isSnapDisableKeyPressed:c,isTopicNestingDisableKeyPressed:c}),f,d,e).sampledBy(f.merge(d.toEventStream().merge(e.toEventStream()).map(()=>null).filterWithStream(this.ra.map((a)=>a.type===h.MouseInteractionType.DragMove).toProperty(!1)))).toEventStream();e=this.ra.filter((a)=>a.type===h.MouseInteractionType.DragEnd).map(()=>({kind:g.ActionKind.Finish}));this.Li=l.Bacon.mergeAll([c.map(()=>"entityDrag"),b.map(()=>
"entityDrag"),this.ra.filter((a)=>a.type!==h.MouseInteractionType.DragMove).map((a)=>a.type===h.MouseInteractionType.DragEnd?"dragEnd":"noEntityDrag")]).scan("noEntityDrag",(a,b)=>"entityDrag"===a&&"noEntityDrag"===b?"entityDrag":"entityDrag"===a&&"dragEnd"===b?"dragEnd":"noEntityDrag"===a&&"dragEnd"===b?"noEntityDrag":b).map((a)=>"noEntityDrag"!==a).toProperty(!1);this.Ra=l.Bacon.mergeAll([c,d,e,b,a])}Ie(a,b,c,d,e,f,n=!1){b=b.filter((a)=>null!=a);f=(a,b,c,d,e)=>{const f=a.allEntityIds,n=e.event.stagePos;
var g=e.event.onCanvas;const x=null!=b&&b.isEditing()?f[0]:null;g=e.type===h.MouseInteractionType.HoverMove?this.$a.getEntityForHoverInEditMode(this.Aa(),this.camera,this.scene,n,f,g,b):this.$a.getEntityForClickInEditMode(this.Aa(),this.camera,this.scene,n,f,e.type,x);return{j:e,w:null===g||void 0===g?void 0:g.getId(),Ka:null===g||void 0===g?void 0:g.get(q.SelectionModule.getDecoratorKey()),wc:null===g||void 0===g?void 0:g.get(q.SelectionModule.getControlPointKey()),selection:{selectionInfo:a,De:this.Ee(f,
n,c)},textSelectionState:b,currentTopicId:c,coverEditMode:d}};const g=l.Bacon.combineWith5(f,b,c,d,e,a).sampledBy(a);return n?g.merge(l.Bacon.combineWith5(f,b,c,d,e,a.map((a)=>Object.assign(Object.assign({},a),{type:h.MouseInteractionType.HoverMove}))).sampledBy(b.toEventStream().map(()=>!0).merge(e.toEventStream().map(()=>!0)).merge(d.toEventStream().map(()=>!0)).merge(c.toEventStream().map(()=>!0)))).toEventStream():g.toEventStream()}zj(a,b,c,d){let e;if(null!=a){e=[a];const f=-1<b.indexOf(a.getId());
c=null!=c&&c.isEditing();f&&!c?e=b.map((a)=>this.scene.getEntityById(a)).filter((a)=>null!=a):c&&(f||d)?e=[]:f||(e=[this.scene.getEntityById(a.getId())])}else e=d?b.map((a)=>this.scene.getEntityById(a)).filter((a)=>null!=a):[];return this.fe(e.filter((a)=>null!=a))}hf(a,b){const c=k.Cet.createHierarchyQuery(this.scene);return k.Cet.createTopicChildrenQuery(this.scene).isVisibleOutside(b.getId())&&c.getParentOrOverview(a)!==c.getParentOrOverview(b)}fe(a){const b=a.map((a)=>a.getId()),c=p.CetModelEditor.createEntityQuery(this.scene),
d=k.Cet.createHierarchyQuery(this.scene),e=[];for(let g=0;g<a.length;++g)if(a[g].isDef(w.CetModel.ID.CONNECTOR)){var f=c.getConnectorTail(a[g]),n=this.scene.getEntityById(f);null!=f&&-1===b.indexOf(f)&&(this.hf(a[g],n)?e.push(this.scene.getEntityById(d.getParentId(n))):e.push(n));f=c.getConnectorHead(a[g]);n=this.scene.getEntityById(f);null!=f&&-1===b.indexOf(f)&&(this.hf(a[g],n)?e.push(this.scene.getEntityById(d.getParentId(n))):e.push(n))}return a.concat(e)}Ic(a,b){const c=k.Cet.createTopicChildrenQuery(this.scene),
d=k.Cet.createHierarchyQuery(this.scene),e=d.getAncestorEntities(b).concat(b);var f=a.filter((a)=>c.hasBehavior(a.getId(),k.TopicChildBehavior.Visual)&&0<=e.indexOf(c.getBehaviorReferer(a.getId(),k.TopicChildBehavior.Visual)));a=a.filter((a)=>c.hasBehavior(a.getId(),k.TopicChildBehavior.Surface)&&0<=e.indexOf(c.getBehaviorReferer(a.getId(),k.TopicChildBehavior.Surface)));f=[...f,...a];f=0<f.length?c.getChildReferer(f[0].getId()):null;return null!=f&&(a=this.scene.getEntityById(f),d.getParentOrOverview(a)!==
b)?c.getChildrenIds(f,k.TopicChildBehavior.Cover).map((a)=>this.scene.getEntityById(a)):[]}Dh(){const a=this.ta.map((a)=>a.allEntityIds.filter((a)=>{a=this.va.scene.getEntityById(a);return null!=a&&k.Cet.hasPdomComponent(a)&&k.Cet.hasZOrder(a)})),b=this.Ma.map((a)=>"keyup"===a.type&&(a.keyCode===h.Key.BACKSPACE||a.keyCode===h.Key.DELETE)).filter((a)=>a);l.Bacon.combineWith4((a,b,e,f)=>({entityIds:a,event:b,currentTopicId:e,coverEditMode:f}),a,this.Ma,this.f.getCurrentTopicStream(),this.f.getCoverEditModeStream()).sampledBy(b).filter(({entityIds:a})=>
0<a.length).onValue(({entityIds:a,event:b,currentTopicId:e,coverEditMode:f})=>{1===a.length&&null!=f&&f.topicId===a[0]||null==f&&e===a[0]?this.v.select({selectedGroupIds:[],selectedEntityIds:[],type:u.SelectActionType.replace}):this.va.executeApiCommand(this.va.action.deleteObjectCmd(a,b.keyCode===h.Key.BACKSPACE?"KEY_BACKSPACE":"KEY_DEL"))})}Ee(a,b,c){var d=a.filter((a)=>{const b=this.scene.getEntityById(a);return null!=b&&null!=b.get(w.CetModel.ID.TRANSFORMED.LOCAL_TO_WORLD)&&a!==c});if(0===d.length)return!1;
b=this.camera.screenPointToWorld(b);a=p.CetModelEditor.createScreenBoundsCalculator(this.scene,this.camera);if(1<d.length)return a.getWorldBBForEntitiesScreenAxisAligned(d).containsPoint(b);{const c=this.scene.getEntityById(d[0]);if(this.Fe(c))return a.getWorldBoundsForInteraction(c.getId()).getObb().containsPoint(b);d=k.Cet.transform(c).getWorldToLocal();a=a.getLocalBoundsForHittest(c);b=d.transformPoint(b);return a.pointIsInside(b)}}We(a,b){const c=()=>{const b=this.scene.getEntityById(a).get(q.SelectionModule.getDecoratorKey());
return null!=b&&b.interactionType===q.InteractionType.border};return null!=a&&1===b.length&&c()?b[0]:a}Lg(a){return a.filter((a)=>a.j.type===h.MouseInteractionType.DoubleClick).map((a)=>{const b=this.We(a.w,a.selection.selectionInfo.allEntityIds);return{currentTopicId:a.currentTopicId,entity:this.scene.getEntityById(b)}})}Kg(a){return a.filter((a)=>a.j.type===h.MouseInteractionType.DoubleClick&&!p.CetModelEditor.isPage(a.currentTopicId,this.scene)).map((a)=>{const b=this.We(a.w,a.selection.selectionInfo.allEntityIds);
return Object.assign(Object.assign({},a),{qb:this.scene.getEntityById(b)})}).filter((a)=>{a=a.qb;return null==a||null!=a.get(q.SelectionModule.getDecoratorKey())?!1:!0}).map((a)=>{const b=this.Za.getGroupIdFromEntity(this.scene,a.qb);var d=a.selection.selectionInfo.nonGroupedEntityIds;d=1===d.length&&d[0]===a.qb.getId();return Object.assign(Object.assign({},a),{action:null==b||d?ea.nd:ea.pc})}).filter((a)=>{if(a.action===ea.pc)return!0;const b=a.qb;var d=0<a.selection.selectionInfo.allEntityIds.length;
if(null!=a.coverEditMode&&a.coverEditMode.kind===v.CoverEditModeKind.titleEditOnly)return!1;if(null!=a.coverEditMode&&!d)if(d=k.Cet.createTopicChildrenQuery(this.scene),null!=b.getId()){if(-1<d.getChildrenIds(a.coverEditMode.topicId,k.TopicChildBehavior.Cover).indexOf(b.getId()))return!0}else return!1;return null!=b&&b.getDef()!==w.CetModel.ID.Z_TEXT&&b.getDef()!==w.CetModel.ID.Z_ARROW&&b.getDef()!==w.CetModel.ID.Z_LINE}).map((a)=>({action:a.action,entity:a.qb}))}Jh(a,b,c){const d=(a)=>a===h.MouseInteractionType.HoverMove||
this.Ei(a);l.Bacon.combineWith3((a,b)=>({event:a,logo:b}),a.filter((a)=>d(a.j.type)),c,b.toProperty(!0)).toEventStream().map(({event:a,logo:b})=>{const c=a.w;var d=this.scene.getEntityById(c);if(null!=c&&b.editable&&(this.isLogo(c)||this.Ce(c)))return c;var e=null!=a.coverEditMode?a.coverEditMode.topicId:null;b=null;null!=d&&a.j.type===h.MouseInteractionType.HoverMove&&(d=a.selection.selectionInfo.allEntityIds,b=T.Qa.ab(c,a.currentTopicId,a.coverEditMode,d,this.scene)&&c!==e?c:null,null==b&&(b=this.sh(c,
a.coverEditMode,this.scene)),e=1===d.length?this.scene.getEntityById(d[0]):null,null!=e&&this.Fe(e)&&null==b&&T.Qa.ab(c,a.currentTopicId,{kind:v.CoverEditModeKind.titleEditOnly,topicId:d[0]},d,this.scene)&&(b=c));return b}).skipDuplicates().onValue((a)=>{this.f.setCanvasHoveredEntityIds(null==a?[]:[a])})}static ab(a,b,c,d,e){const f=e.getEntityById(a),g=k.Cet.createHierarchyQuery(e),h=k.Cet.createTopicChildrenQuery(e);if(null==f||!k.Cet.hasPdomComponent(f)||a===b&&p.CetModelEditor.isPlanetOrStack(a,
e)||p.CetModelEditor.isPage(f.getId(),e))return!1;if(g.getParentOrOverview(f)===b&&h.hasBehavior(f.getId(),k.TopicChildBehavior.Content))return!0;b=null!=c&&c.kind===v.CoverEditModeKind.titleEditOnly?c.topicId:1===d.length?d[0]:null;return h.getBehaviorReferer(f.getId(),k.TopicChildBehavior.Cover)===b&&f.isDef(w.CetModel.ID.Z_TEXT)?!0:null!=c&&c.kind===v.CoverEditModeKind.advanced?h.getChildReferer(a)===c.topicId&&h.isVisibleOutside(a):null!=c&&c.kind===v.CoverEditModeKind.insideAdvanced?h.getChildReferer(a)===
c.topicId&&h.isVisibleInside(a):!1}sh(a,b,c){a=c.getEntityById(a);if(null==b)return null;switch(b.kind){case v.CoverEditModeKind.advanced:case v.CoverEditModeKind.insideAdvanced:a=a.get(q.SelectionModule.getDecoratorKey());if(null!=a&&a.interactionType===q.InteractionType.clickable&&-1!==a.ownerIds.indexOf(b.topicId))return b.topicId;break;case v.CoverEditModeKind.titleEditOnly:break;default:D.Utils.assertNever(b)}return null}Aa(){return this.scene.getPrezi().get(p.CetModelEditor.getStageQueryKey())}Pg(a,
b){a=a.filter((a)=>a.kind!==g.ActionKind.Step).map((a)=>a.kind!==g.ActionKind.Finish);return l.Bacon.combineWith((a,b)=>a?H.ComponentFocusAction.enterCanvas:null!=b&&b.isSingleSelection()?H.ComponentFocusAction.enterTextEditor:H.ComponentFocusAction.exitAll,a,b).sampledBy(a)}Sh(a){this.dd.filter((a)=>{a=a.actions;return-1!==a.indexOf(h.ShortcutAction.UNDO)||-1!==a.indexOf(h.ShortcutAction.REDO)}).onValue((b)=>{b.event.preventDefault();-1!==b.actions.indexOf(h.ShortcutAction.UNDO)?a.undo(F.UndoRedoRequestTrigger.keyboard):
a.redo(F.UndoRedoRequestTrigger.keyboard)});a.getUndoRedoStream().onValue(()=>{this.qa.fixCoverSelection();g.EditorCommander.getImageMaskingApi_KILL_ME_HACK().setMaskingMode({kind:v.MaskingModeKind.off})})}};var ta={},Ic=this&&ta.Ub||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,g){function f(a){try{h(d.next(a))}catch(B){g(B)}}function n(a){try{h(d["throw"](a))}catch(B){g(B)}}function h(a){a.done?c(a.value):e(a.value).then(f,
n)}h((d=d.apply(a,b||[])).next())})};Object.defineProperty(ta,"__esModule",{value:!0});ta.cg=class{static init(a){return Ic(this,void 0,void 0,function*(){fa.isActive("js-plugin-e2e-run")?yield Promise.all([a.registerPlugin(t.testPropertybar,nb),a.registerPlugin(t.testSidebar,ob),a.registerPlugin(t.pathEditing,lb),a.registerPlugin(t.scheme,mb)]):yield Promise.all([a.registerPlugin(t.aboutBox,zb),a.registerPlugin(t.pathAudio,bc),a.registerPlugin(t.arConvert,Bb),a.registerPlugin(t.viewToDashboardTest,
Ac),a.registerPlugin(t.backgroundImage,Db),a.registerPlugin(t.brandColors,Fb),a.registerPlugin(t.chartInsert,Gb),a.registerPlugin(t.classicImport,Hb),a.registerPlugin(t.dashedLine,Jb),a.registerPlugin(t.debug,Kb),a.registerPlugin(t.depthOfField,Lb),a.registerPlugin(t.favorites,Pb),a.registerPlugin(t.firstStepsOnboarding,Rb),a.registerPlugin(t.classicToNextOnboarding,Ib),a.registerPlugin(t.fontAdmin,Sb),a.registerPlugin(t.fontPreview,Tb),a.registerPlugin(t.fontSelector,Ub),a.registerPlugin(t.grouping,
Vb),a.registerPlugin(t.iconInsert,Wb),a.registerPlugin(t.bracketFrame,Eb),a.registerPlugin(t.imageInsert,Xb),a.registerPlugin(t.markerEditor,$b),a.registerPlugin(t.narrativeEditor,ac),a.registerPlugin(t.layout,Yb),a.registerPlugin(t.pathGenerationStrategy,cc),a.registerPlugin(t.pdfInsert,dc),a.registerPlugin(t.photoEditor,ec),a.registerPlugin(t.alignmentTools,Ab),a.registerPlugin(t.pptInsert,gc),a.registerPlugin(t.pptEdit,fc),a.registerPlugin(t.scheme,mb),a.registerPlugin(t.searchReplace,jc),a.registerPlugin(t.selectSimilar,
kc),a.registerPlugin(t.extendedSelection,Ob),a.registerPlugin(t.equationEditor,Nb),a.registerPlugin(t.shapeAndArcEditor,lc),a.registerPlugin(t.solidColor,nc),a.registerPlugin(t.storyblocks,oc),a.registerPlugin(t.storyblocksAdmin,pc),a.registerPlugin(t.syntaxHighlight,qc),a.registerPlugin(t.testPropertybar,nb),a.registerPlugin(t.testSidebar,ob),a.registerPlugin(t.textEditor,sc),a.registerPlugin(t.textStyle,tc),a.registerPlugin(t.topicNestingOnboarding,uc),a.registerPlugin(t.preziVideoOnboarding,hc),
a.registerPlugin(t.topicShape,vc),a.registerPlugin(t.snippetEditingLayout,mc),a.registerPlugin(t.videoBackground,xc),a.registerPlugin(t.videoInsert,yc),a.registerPlugin(t.visualTypes,Bc),a.registerPlugin(t.watermark,Cc),a.registerPlugin(t.qrCodeInsert,ic),a.registerPlugin(t.zOrderObject,Dc),a.registerPlugin(t.arVideoTemplateTools,Cb),a.registerPlugin(t.templateFromStoryblocks,rc),a.registerPlugin(t.videoTemplateFromFigma,zc),a.registerPlugin(t.pathEditing,lb),a.registerPlugin(t.turnIntoTopic,wc),
a.registerPlugin(t.editorMode,Mb),a.registerPlugin(t.filePickerIntegrations,Qb)])})}};var pa={};Object.defineProperty(pa,"__esModule",{value:!0});pa.nc=class{constructor(a,b){this.kf=a;this.scene=b}je(a,b,c=0){const d=this.kf.getCamera();var e=p.CetModelEditor.createBoundsCalculator(this.scene),f=d.getTargetTransform().invert();f=K.Geometry.obbFromRect(d.getMarginCorrectedStageArea().getData()).transform(f);const g=K.Geometry.transform2dFromRad({x:0,y:0},1,f.getRotationRadians());a=e.getUnionWorldBoundsAlignedToReference(g,
a,p.TextBoundsOptions.TextBox).getObb();e=c/d.getStageArea().getWidth();c/=d.getStageArea().getHeight();c=f.union(a.inflateXY(a.getWidth()*e,a.getHeight()*c));if(c.equalsWithin(f,Math.pow(2,-30)))new Promise((a)=>a());else{f=K.Geometry.transform2dFromRad({x:-c.getCenterX(),y:-c.getCenterY()},1,0).concat(K.Geometry.transform2dFromRad({x:0,y:0},1,c.getRotationRadians())).concat(K.Geometry.transform2dFromRad({x:c.getCenterX(),y:c.getCenterY()},1,0));const a=this.kf.flyToRectangle(c.setRotation(0).getBounds(),
f,1,b,d.getMarginCorrectedStageArea());new Promise((b)=>a.onEnd(()=>b()))}}};var ua={},tb=this&&ua.Ub||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,g){function f(a){try{n(d.next(a))}catch(B){g(B)}}function h(a){try{n(d["throw"](a))}catch(B){g(B)}}function n(a){a.done?c(a.value):e(a.value).then(f,h)}n((d=d.apply(a,b||[])).next())})};Object.defineProperty(ua,"__esModule",{value:!0});ua.Hf=class{constructor(a,b,c,d,e,f,g,h,k,
m,p,q,t,u,v,r){this.be=c;this.Cd=d;this.f=e;this.Nj=q;this.va=t;this.Cj=u;this.za=v;this.Fb=r;d=new pa.nc(a,c);this.jc=new T.Qa(b,c,a.getCamera(),e,f,g,new na.mc(c,e,f,this.va,this.va.cover,d),h,k,m,p,aa.PlaybackModule.createInteractionQuery(),this.va,v.getDragStream(),r.pluginAccess,r.applicationController);e.addComponentFocusStream(this.jc.getFocusStream());e.addHighlightEntitiesOnDragSelectActionStream(this.jc.getHighlightEntitiesOnDragSelectActionStream());this.dh=l.Bacon.newBus()}pi(){return tb(this,
void 0,void 0,function*(){return new Promise((a)=>{let b=!1;this.f.getUserHasEditRightsStream().onValue((c)=>tb(this,void 0,void 0,function*(){c&&!b&&(b=!0,fa.isActive("js-use-local-mocks")&&(yield Zb()).registerMocks(this.Fb),ta.cg.init(this.Fb.applicationController).then(a))}))})})}resetPlugins(){this.Fb.applicationController.resetPlugins();return this.pi()}getOutputInteractionStream(){return this.jc.getOutputInteractionStream()}getScene(){return this.be}getZObjectEditor(){return this.va}getApplicationController(){return this.Fb.applicationController}getAnimationScene(){return this.Cd}getUpdatableAnimationScene_KILLME(){return this.Cd}reset(a){a&&
this.be.reset(!1)}getObjectEditor(){return this.jc}addAnimationTopicStateChangeStream(a){this.Nj.plug(a)}getErrorValueStream(){return this.dh}getCurrentSelectionDecorators(){return this.Cj.getCurrentDecorators()}getDragPlaceholderController(){return this.za}getPluginAccess(){return this.Fb.pluginAccess}};var Xa={};Object.defineProperty(Xa,"__esModule",{value:!0});Xa.qf=class{constructor(a,b,c,d,e,f,g,h){this.hb=a;this.playback=b;this.Eb=c;this.Yg=d;this.La=e;this.Zg=f;this.store=g;this.Dc=h;l.Bacon.combineWith((a,
b)=>({currentTopicId:a,cj:b}),this.store.getCurrentTopicStream(),this.store.getModeStream().slidingWindow(2,1)).sampledBy(this.store.getModeStream()).onValue((a)=>{this.Mh(a.currentTopicId,a.cj)});this.ri();this.Gj()}Mh(a,b){switch(b[b.length-1].kind){case E.EditorMode.view:case E.EditorMode.playback:this.setScene(this.Eb,this.Eb);b[0].kind===E.EditorMode.info?this.playback.resumeFromInfo():this.playback.resume();break;case E.EditorMode.animationPreview:this.setScene(this.Eb,this.Eb);break;case E.EditorMode.edit:this.setScene(this.Yg,
this.La),b[0].kind!==E.EditorMode.animationPreview&&this.hb.getMainStage().flyToId(a)}}setScene(a,b){this.hb.getMainStage().setScene(a,b)}ri(){const a=this.store.getModeStream().map((a)=>{switch(a.kind){case E.EditorMode.view:case E.EditorMode.playback:case E.EditorMode.animationPreview:return this.Eb;case E.EditorMode.edit:return this.La;default:return this.La}});this.playback.setSceneStream(a);this.playback.setEntityChangeStream(this.hb.getBaseScene().getImmediateChangeStream(k.ChangeEventKind.Entity))}Gj(){l.Bacon.combineWith((a,
b)=>null==b?{currentTopicId:a,bc:null}:{currentTopicId:a,bc:b.topicId},this.store.getCurrentTopicStream(),this.store.getCoverEditModeStream()).combineAndSample(({currentTopicId:a,bc:b},c)=>({currentTopicId:a,bc:b,selectedIds:c.allEntityIds}),this.store.getSelectionStream()).sampledBy(this.hb.getEndOfFrameStream()).skipDuplicates().onValue(({currentTopicId:a,bc:b,selectedIds:c})=>this.kh(a,b,c))}kh(a,b,c){if(!fa.isActive("js-for-test-no-fly-to-selection")){var d=c.filter((a)=>{a=this.La.getEntityById(a);
return null!=a&&null!=k.Cet.world(a)});null!=d&&0!==d.length&&(b=this.xj(d,a,b),c=this.Zg.getCurrentSelectionDecorators().filter((a)=>{a=this.La.getEntityById(a);if(null==a)return!1;a=a.get(q.SelectionModule.getDecoratorKey());return null==a?!1:a.ownerIds.some((a)=>-1!==d.indexOf(a))}),b=b.concat(c),this.Dc.je(b,a))}}xj(a,b,c){let d=[];const e=k.Cet.createTopicChildrenQuery(this.La),f=p.CetModelEditor.createTopicQuery(this.La);1===a.length&&null===c&&a[0]===b?(a=a[0],d=[a,...e.getChildrenIds(a,k.TopicChildBehavior.Content)]):
a.forEach((a)=>{const b=this.La.getEntityById(a);f.isTopic(b)?d=[...d,...e.getChildrenIds(b.getId(),k.TopicChildBehavior.Cover),...e.getChildrenIds(b.getId(),k.TopicChildBehavior.Visual),...e.getChildrenIds(b.getId(),k.TopicChildBehavior.Surface)]:null!=c&&(e.hasBehavior(a,k.TopicChildBehavior.Visual)||e.hasBehavior(a,k.TopicChildBehavior.Surface))&&e.getChildReferer(a)===c?(d.push(a),-1===d.indexOf(c)&&d.push(c)):d.push(a)});return d}};var Ya={};Object.defineProperty(Ya,"__esModule",{value:!0});
Ya.Lf=class{constructor(a,b,c){this.scene=a;this.mainStage=b;this.playback=c;this.logger=z.LoggerModule.getLoggerManager().createLogger("prezi_editor_controller.FlyToEntityActionExecutor");this.Ab=E.AppUtilsModule.getLogHelperUtils()}execute(a){if(null==a)this.mainStage.flyToOverview(),this.Ab.canvasZoom(this.logger,E.ZoomToObjectLogTrigger.DOUBLECLICK,{actionIndex:this.playback.getCurrentActionIndex(),stepIndex:this.playback.getCurrentStepIndex(),totalStepNumber:this.playback.getStepCount()});else{if(p.CetModelEditor.isPlanetOrStack(a.getId(),
this.scene)){const b=p.CetModelEditor.getPagesOfChapter(a.getId(),this.scene);a=0<b.length?this.scene.getEntityById(b[0]):a}null==a||p.CetModelEditor.isLogo(a.getId(),this.scene)||(this.playback.flyToObject(a.getId()),this.Ab.zoomToObject(p.CetModelEditor.createLogHelper(this.scene),this.logger,E.ZoomToObjectLogTrigger.DOUBLECLICK,a,this.scene,{stepIndex:this.playback.getCurrentStepIndex(),actionIndex:this.playback.getCurrentActionIndex(),totalStepNumber:this.playback.getStepCount()}))}}};var Za=
{};Object.defineProperty(Za,"__esModule",{value:!0});Za.If=class{constructor(a,b,c,d,e,f,g){this.hb=a;this.playback=b;this.la=c;this.Cg=d;this.f=e;this.va=g;b=new pa.nc(a.getMainStage(),this.la.getScene());new Xa.qf(a,this.playback,this.playback.getScene(),this.la.getUpdatableAnimationScene_KILLME().getParentScene(),this.la.getUpdatableAnimationScene_KILLME(),this.la,this.f,b);this.qa=new na.mc(this.la.getScene(),this.f,f,this.va,this.va.cover,b);this.f.getCurrentTopicStream().onValue((a)=>this.currentTopic=
a);this.wi();const h=new Ya.Lf(this.la.getScene(),this.hb.getMainStage(),this.playback);this.la.getObjectEditor().getFlyToEntityActionStream().onValue((a)=>h.execute(a))}Bj(){const a=this.la.getScene(),b=p.CetModelEditor.isOverview(this.currentTopic,a);return k.Cet.createEditorPath(a).hasCustomStartPoint()&&b}wi(){this.Dg=this.Cg.getKeyboardStream().filter((a)=>(a.metaKey||a.ctrlKey)&&"keydown"===a.type&&a.keyCode===h.Key.P||!W.PreziUAParser.isMac()&&"keydown"===a.type&&a.keyCode===h.Key.F5?(a.preventDefault(),
!0):!1).map((a)=>({newMode:E.EditorMode.playback,trigger:a.keyCode===h.Key.P?"ctrl+p":"F5",shouldGoFullscreen:!0,shouldSeekPathToStart:this.Bj(),showTopmenu:!0,linkClickedFlow:!1,presenterNotesFlow:!1}));this.ej=this.la.getObjectEditor().getMouseCursorStateStream().merge(this.playback.getMouseCursorStateStream()).skipDuplicates((a,b)=>a.cursor===b.cursor)}getChangeModeActionStream(){return this.Dg.merge(this.playback.getChangeModeActionStream().filterWithStream(this.f.getBoolModeStream(E.EditorMode.playback)))}getResizeControlPointStream(){return this.la.getObjectEditor().getResizeControlPointStream()}getMouseCursorStateStream(){return this.ej}reset(a){this.la.reset(a);
this.la.getUpdatableAnimationScene_KILLME().update();this.playback.reset(a);this.la.getObjectEditor().reset()}setupInvariantChecks(a){return this.f.getStateStream().sampledBy(a).map((a)=>(a=this.qa.checkCoverSelectionInvariants(a.selectionInfo.allEntityIds,a.coverEditMode))?a:null).skipDuplicates()}};var va={};Object.defineProperty(va,"__esModule",{value:!0});va.qd=class{constructor(a,b){a.onValue((a)=>this.topicId=a);b.onValue((a)=>this.coverEditMode=a)}getCurrentParentId(){return this.shouldInsertIntoCover()?
this.coverEditMode.topicId:this.topicId}getCurrentKind(){return this.shouldInsertIntoCover()?p.InsertHierarchyDestinationKind.COVER:p.InsertHierarchyDestinationKind.CHILD}shouldInsertIntoCover(){if(null==this.coverEditMode)return!1;switch(this.coverEditMode.kind){case v.CoverEditModeKind.advanced:return!0;case v.CoverEditModeKind.titleEditOnly:case v.CoverEditModeKind.insideAdvanced:return!1;default:return D.Utils.assertNever(this.coverEditMode)}}};var $a={};Object.defineProperty($a,"__esModule",
{value:!0});$a.eg=class{constructor(a,b,c,d,e,f){this.Uj=a;this.o=d;this.Te=e;this.Nc=f;b.onValue((a)=>{this.currentTopicId=a});c.onValue((a)=>{this.currentSelection=a.allEntityIds})}insert(a,b,c){const d=this.Pi(a.doc.getZObjects()),e=this.currentTopicId===this.o.scene.getPreziW().getOverview().getId();if(this.Nc.shouldInsertIntoCover()&&d)return null;const f=Object.assign(Object.assign({},a),{targetParentId:this.Nc.getCurrentParentId(),positionRelativeToId:this.currentTopicId,currentSelection:this.currentSelection,
insertAsContent:!this.Nc.shouldInsertIntoCover()});this.o.executeApiCommand(this.Te.insertCmd(f),{trigger:c,userIntentId:b});e&&!this.Ij(a)&&d&&setTimeout(()=>this.Uj.flyToOverview(),0)}copyObjects(a){return this.Te.copyObjects(a)}Ij(a){let b=!1,c=!1;for(let d=0;d<a.doc.getZObjects().length();++d){const e=a.doc.getZObjects().get(d);null!=e.getIsPage&&e.getIsPage()&&(b=!0);null!=e.getIsChapter&&e.getIsChapter()&&(c=!0)}return b&&!c}Pi(a){for(a=a.iterator();a.hasNext();){var b=a.next();if(b.getObjectType()===
C.ZObjectType.Z_TOPIC_CONTAINER&&(b=b.getTopic().getObjectType(),b===C.TopicType.PLANET_CHAPTER||b===C.TopicType.STACK_CHAPTER))return!0}return!1}};var ab={};Object.defineProperty(ab,"__esModule",{value:!0});var V=p.base.VisualLayoutRole,wa=p.base.CoverLayoutRole,xa=p.base.ContentLayoutRole,R=p.base.ObjectKind,bb=p.base.SurfaceLayoutRole;ab.fg=class{constructor(a){this.o=a}setLayoutRole(a,b){null==b?this.o.executeApiCommand(this.oa(a,null)):b.isDef(w.CetModel.ID.VISUAL_ANCHOR)?this.o.executeApiCommand(this.oa(a,
V.visualAnchor)):b.isDef(w.CetModel.ID.SLIDE_ANCHOR_16_9)?this.o.executeApiCommand(this.oa(a,V.slideAnchor_16_9)):b.isDef(w.CetModel.ID.SLIDE_ANCHOR_4_3)?this.o.executeApiCommand(this.oa(a,V.slideAnchor_4_3)):b.isDef(w.CetModel.ID.SLIDE_DECORATOR)?this.o.executeApiCommand(this.oa(a,V.slideDecorator)):b.isDef(w.CetModel.ID.CONTENT_AREA)?this.o.executeApiCommand(this.oa(a,V.contentArea)):b.isDef(w.CetModel.ID.TOPIC_SHAPE)?this.o.executeApiCommand(this.oa(a,V.topicShape)):b.isDef(w.CetModel.ID.SURFACE_TOPIC_SHAPE)?
this.o.executeApiCommand(this.oa(a,bb.surfaceTopicShape)):b.isDef(w.CetModel.ID.COVER_TITLE)?this.o.executeApiCommand(this.oa(a,wa.coverTitle)):b.isDef(w.CetModel.ID.COVER_ICON)?this.o.executeApiCommand(this.oa(a,wa.coverIcon)):b.isDef(w.CetModel.ID.CONTENT_TITLE)?this.o.executeApiCommand(this.oa(a,xa.contentTitle)):b.isDef(w.CetModel.ID.CONTENT_ICON)&&this.o.executeApiCommand(this.oa(a,xa.contentIcon))}setPaletteColor(a,b){this.o.executeApiCommand(this.Ej(a,b))}Ej(a,b){return{name:"setPaletteColor",
run:(c)=>{c=c.lookup.simpleObject(a);if(c.kind===R.image||c.kind===R.pdf||c.kind===R.swf){var d=g.EditorCommander.createColorMixCommander().getShapefilterStyle(b);if(null!=b)if(null!=d)c.filterStyle=d;else throw`Unkown palette color type: ${b}`;else c.filterStyle=null}else if(c.kind===R.shape)if(d=g.EditorCommander.createColorMixCommander().getShapeStyle(b),null!=b)if(null!=d)c.shapeStyle=d;else throw`Unkown palette color type: ${b}`;else c.shapeStyle=null;else if(c.kind===R.arc)if(d=g.EditorCommander.createColorMixCommander().getArcStyle(b),
null!=b)if(null!=d)c.arcStyle=d;else throw`Unkown palette color type: ${b}`;else c.arcStyle=null}}}oa(a,b){return{name:"setLayoutRole",run:(c)=>{c=c.lookup.simpleObject(a).parent;switch(c.kind){case R.cover:null==b&&(b=wa.none);if(D.isFromEnum(b,wa))c=c.contentChildren.find((b)=>b.id===a),null!=c&&(c.coverLayoutRole=b);else throw Error(`Trying to set cover layout role on a non cover object: ${a}`);break;case R.visual:null==b&&(b=V.none);if(D.isFromEnum(b,V))c=c.contentChildren.find((b)=>b.id===a),
null!=c&&(c.visualLayoutRole=b);else throw Error(`Trying to set visual layout role on a non visual object: ${a}`);break;case R.planetTopic:null==b&&(b=xa.none);if(D.isFromEnum(b,xa))c=c.contentChildren.find((b)=>b.id===a),null!=c&&(c.contentLayoutRole=b);else throw Error(`Trying to set content layout role on a non content object: ${a}`);break;case R.surface:null==b&&(b=bb.none);if(D.isFromEnum(b,bb))c=c.contentChildren.find((b)=>b.id===a),null!=c&&(c.surfaceLayoutRole=b);else throw Error(`Trying to set content layout role on a non surface object: ${a}`);
break;case R.page:case R.master:case R.overview:throw Error(`Trying to set content layout role on a non content object: ${a}`);default:D.Utils.assertNever(c)}}}}};var Y={};Object.defineProperty(Y,"__esModule",{value:!0});Y.Lb=class{constructor(a,b){this.entityId=a;this.kind=b}getEntityId(){return this.entityId}};Y.gg=class{createImageProps(a){return new Y.Lb(a,u.PropsKind.Image)}createPdfProps(a){return new Y.Lb(a,u.PropsKind.Pdf)}createChartPdfProps(a){return new Y.Lb(a,u.PropsKind.ChartPdf)}createOverviewProps(a){return new Y.Lb(a,
u.PropsKind.Overview)}};var ya={},la=this&&ya.Ub||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,g){function f(a){try{n(d.next(a))}catch(B){g(B)}}function h(a){try{n(d["throw"](a))}catch(B){g(B)}}function n(a){a.done?c(a.value):e(a.value).then(f,h)}n((d=d.apply(a,b||[])).next())})};Object.defineProperty(ya,"__esModule",{value:!0});ya.hg=class{constructor(a){this.ld=a;this.onPushNotificationPermissionDenied=()=>{this.ld.setBoolean(Ba.UserSettingBooleanKeys.BROWSER_NOTIFICATION_PERMISSION_DENIED,
!0)};this.onPushNotificationPermissionGranted=()=>{this.ld.setBoolean(Ba.UserSettingBooleanKeys.BROWSER_NOTIFICATION_PERMISSION_DENIED,!1)};this.jj=()=>la(this,void 0,void 0,function*(){if("denied"===(yield Aa.BrowserNotificaionModule.getBrowserNotificationServiceInstance()).getPermission())this.onPushNotificationPermissionDenied()})}shouldShowNativePushNotificationPermission(){return la(this,void 0,void 0,function*(){return fa.isActive("abtest-act-browser-notifications-builtin-permission-dialog")&&
this.jf()})}shouldShowPushNotificationPermissionDialog(){return la(this,void 0,void 0,function*(){return fa.isActive("abtest-act-browser-notifications-custom-permission-dialog")&&this.jf()})}requestPushNotificationPermission(){return la(this,void 0,void 0,function*(){(yield Aa.BrowserNotificaionModule.getBrowserNotificationServiceInstance()).requestPermission(this.onPushNotificationPermissionGranted,this.jj)})}Ci(){return this.ld.getBoolean(Ba.UserSettingBooleanKeys.BROWSER_NOTIFICATION_PERMISSION_DENIED)}Wh(){return la(this,
void 0,void 0,function*(){return"default"===(yield Aa.BrowserNotificaionModule.getBrowserNotificationServiceInstance()).getPermission()})}jf(){return la(this,void 0,void 0,function*(){return!this.Ci()&&this.Wh()})}};var cb={};Object.defineProperty(cb,"__esModule",{value:!0});cb.vf=class{constructor(a){this.gb=a}select(a,b){var c=this.gb.getCurrentPosition();if(null==c)return null;var d=b.getPreziW().getEntity().getComponent(w.CetModel.ID.PREZI.PATH);if(c.getStep()>d.length()-1)return!0;c=d.getAt(c.getStep());
d=b.getEntityById(c).getWrapper(w.CetModel.ID.PATH_STEP.W);return d.is(w.CetModel.ID.FLY_TO_OBJECT)?d.getTarget()!==this.gb.getCurrentTargetId():d.is(w.CetModel.ID.FLY_TO_OVERVIEW)?b.getPreziW().getOverview().getId()!==this.gb.getCurrentTargetId():a.getId()===c}getTriggerKeys(){return[w.CetModel.getRemovedEntityCompKey(),w.CetModel.ID.PATH_STEP.ACTIONS,w.CetModel.ID.EDITOR_PATH_V1.STEPS,w.CetModel.ID.EDITOR_PATH_V2.STEPS]}process(a,b){a=this.gb.getCurrentPosition();b=k.Cet.createPlaybackPath(b).getClosestValidPathPosition(a,
this.gb.getCurrentTargetId());b.getStep()===a.getStep()&&b.getAction()===a.getAction()||this.gb.seekTo(b)}getName(){return"CurrentPathPositionGuardSystem"}changesPdomComponents(){return!1}};var db={};Object.defineProperty(db,"__esModule",{value:!0});db.Kf=class{constructor(){}getName(){return"EditorVisibility"}process(a){a.hasComponent(p.CetModelEditor.getEditVisibilityKey())||a.set(p.CetModelEditor.getEditVisibilityKey(),{isEnabled:!0,alpha:1})}select(a){return a.hasComponent(ba.CetRendererModule.getDrawComponentKey())}reset(){}init(a){a.getTweener().createVisibilityAnimationHelper("EditAppearVisibility");
a.getTweener().createVisibilityAnimationHelper("DragPreviewVisibility");a.getTweener().createVisibilityAnimationHelper(ja.Mb.mg)}changesPdomComponents(){return!1}};var eb={};Object.defineProperty(eb,"__esModule",{value:!0});eb.qg=class{constructor(a){this.Gg=a}getName(){return"VideoInitSystem"}process(a){k.Cet.setFocusBehavior(a,this.Gg.createNoFocusBehaviorComponent())}select(a){return a.getDef()===w.CetModel.ID.Z_VIDEO}changesPdomComponents(){return!1}};var fb={};Object.defineProperty(fb,"__esModule",
{value:!0});fb.Jf=class{createEditmode(a,b,c,d,e,f,n,m,t,u,v,r,w,y,z,C,D,F,G,M,O){var x=b.getMainStage().getRenderer().createChannel("edit"),I=b.getSceneBuilder(),B=b.getMainStage().getCamera(),A=I.getSystemFactory(),X=q.SelectionModule.createSelection(f);const J=X.createSelectionSystem(B,b.getDomLayerManager(),b.getMainStage(),b.getMainStage());var K=new db.Kf,H=f.getCurrentTopicNavigationStream();H=l.Bacon.combineWith((a,b)=>null==a||b.kind===E.EditorMode.edit?a:{newCurrentTopic:a.newCurrentTopic,
navigationType:k.NavigationActionAnimationType.Focus},H,f.getModeStream()).sampledBy(H).toProperty(null);const P=aa.PlaybackModule.createTopicVisibilitySystem(H,!0,b.getMainStage(),b.getDomLayerManager());H=l.Bacon.newBus();const R=aa.PlaybackModule.createLogoSystem(f.getLogoStream().map((a)=>a.type),f.getCanvasHoverStream(),b.getCetUI().getSizeProperty(),b.getMainStage()),L=A.createWorldGeometrySystem(),N=A.createBoundCalculationSystem(),Q=A.createOverviewFrameSystem(B);var T=p.CetModelEditor.createEditorConnectorFixerSystem(A);
const W=p.CetModelEditor.createHideDegenerateConnectorsFixerSystem(A),U=A.createQuadTreeSystem(b.getMainStage().getRenderer().getQuadTreeUpdater());var S=[P,R].filter((a)=>null!=a),V=[N,L,W];let Y=[A.createShaperSystem(aa.PlaybackModule.createStageQuerySystem(b.getMainStage(),f.getCoverEditModeStream(),f.getCurrentTopicStream(),p.ApplicationMode.Edit,p.CetModelEditor.getStageQueryKey())),A.createShaperSystem(aa.PlaybackModule.createStageQuerySystem(b.getMainStage(),f.getCoverEditModeStream(),f.getCurrentTopicStream(),
p.ApplicationMode.View,aa.PlaybackModule.getStageQueryKey())),A.createThumbnailOnlyVideoSystem(),A.createInitializerSystem(new eb.qg(b.createComponentFactory())),N,L,U,fa.isActive("js-disable-spellcheck-for-test")?null:X.createTextHighlightSystem(B,b.getMainStage())].filter((a)=>null!=a),Z=[N,L,Q,T,N,L,Q];T=[Q,T,N,L,Q,U,A.createZTextInitSystem(),A.createImageInitSystem(b.getMainStage().getRenderer().getAssetManager(),b.getDomLayerManager(),b.getMediaAssetPatcher(),b.getAssetThumbnailAnnouncer()),
A.createInitializerSystem(A.createInvisibleFrameSystem(()=>ba.CetRendererModule.createInvisibleFrameRenderer())),W,A.createShaperSystem(new cb.vf(b.getMainStage().getPathNavigator())),p.CetModelEditor.createFranklinPathFixerSystem(A)].filter((a)=>null!=a);r=[X.createSnapSystem(A,B,b.getDomLayerManager()),X.createTopicNestingSystem(B,b.getDomLayerManager()),J,P,R,X.createCustomStartingPointSystem(b.getDomLayerManager(),B,r,b.getMainStage()),N,L,Q,U,A.createInitializerSystem(K),b.getMainStage().getRenderer().getInvalidator()?
A.createRenderingInvalidatorSystem(x,b.getMainStage().getRenderer().getInvalidator()):null].filter((a)=>null!=a);r={initList:S,inflateList:V,updateList:Y,updateOnceList:T,preRenderList:r,geometryUpdateList:Z};r=I.createChildScene("edit",b.getBaseScene(),r);b.getMainStage().registerScene(x,r);X=A.createShaperSystem(aa.PlaybackModule.createVisibilityAggregator([p.CetModelEditor.getEditVisibilityKey()],(a,b,c)=>k.Cet.updateVisibility(a).setAlpha(b).setEnabled(c)));K=A.createShaperSystem(aa.PlaybackModule.createVisibilityAggregator([],
(a,b,c)=>k.Cet.updateCommentVisibility(a).setEnabled(c).setAlpha(b)));x=b.getMainStage().getRenderer().createChannel("edit-animation");S=A.createWorldGeometrySystem();B=[X,K];S=[S];V=[A.createWorldGeometrySystem(),A.createQuadTreeSystem(b.getMainStage().getRenderer().getQuadTreeUpdater())];A=[X,K,b.getMainStage().getRenderer().getInvalidator()?A.createRenderingInvalidatorSystem(x,b.getMainStage().getRenderer().getInvalidator()):null].filter((a)=>null!=a);I=I.createAnimScene("edit-animation",r,{initList:B,
inflateList:S,updateList:V,preRenderList:A});b.getMainStage().registerScene(x,I);r.setAnimationScene(I);A=b.createIdleStream(b.getBaseScene().getImmediateChangeStream(k.ChangeEventKind.Entity));r.setIdleChangeStream(A);A=p.CetModelEditor.createPositionFinder(r,b.getMainStage().getCamera());x=new va.qd(f.getCurrentTopicStream(),f.getCoverEditModeStream());B=p.CetModelEditor.createCameraControl(b.getMainStage().getCamera());X=b.getMainStage().getRenderer().getAssetManager();f.addMaskEditingModeStream(g.EditorCommander.getImageMaskingApi_KILL_ME_HACK().getMaskingMode());
G.onDocumentLoaded(b,this.pluginMetaDataFromNativeMetadata(a),r,A,x,n,f,O,m,b.getMainStage(),D,b.getMediaAssetPatcher(),v,b.getAssetThumbnailAnnouncer(),w,z,C,X,b.fontsLoadedStateHolder,b.getMainStage(),F,c.filter((a)=>a.type===h.MouseInteractionType.HoverMove).map((a)=>a.event.stagePos),b.getBaseScene().getIdleChangeStream(null),b,M);a=g.EditorCommander.createZObjectEditor(b,r,x,v,b.getMediaAssetPatcher(),b.getAssetThumbnailAnnouncer(),B,G.applicationController.behaviorExtensions,D,G.getEditorSession());
y=this.createDragPlaceholderController(y);b=new ua.Hf(b.getMainStage(),c,r,I,f,n,m,d,e,t,u,H,a,J,y,G);J.addAreaSelectionStream(b.getObjectEditor().getAreaSelectionStream());J.addTextStateStream(f.getTextSelectionStateStream());return b}createEditorBehavior(a,b,c,d,e,f,g){return new Za.If(a,c,b,d,e,f,g)}createPreziDocEditController(a,b,c,d,e,f){return new $a.eg(a,b,c,e,f,new va.qd(b,d))}createConnectivityController(a,b,c,d){return new Ka.tf(a,b,c,d)}createDragPlaceholderController(a){return new La.Df(a)}getChildIndexFromPathId(a,
b,c){a=p.CetModelEditor.createTopicQuery(c).getChildTopics(a);if(null==b)return a.length-1;b=p.CetModelEditor.createEditorPathQuery(c).getStepTargetId(b);return a.map((a)=>{if(p.CetModelEditor.isPlanetOrStack(a,c)&&!p.CetModelEditor.isPlanet(a,c)){const b=p.CetModelEditor.getPagesOfChapter(a,c);0<b.length&&(a=b[0])}return a}).indexOf(b)}createBasicEditController(a,b){return new Ca.pf(a,b)}createClipboard(a,b,c,d,e,f,g,h,k){e=new Ja.Uf(f);return new Ha.rf(a,b,c,e,d,f,g,h,k)}createClipboardTrigger(){return new Ia.sf}createPreziLayoutController(a){return new ab.fg(a)}createPropertyEditor(){return new Y.gg}createPushNotificationController(a){return new ya.hg(a)}pluginMetaDataFromNativeMetadata(a){return{preziOid:null!=
a.oid?a.oid:a.desktopId,copyright:a.copyright,title:a.title,logoType:a.logo_type,ownerId:a.owner_id,showcaseProhibited:a.showcase_prohibited}}};var gb={};Object.defineProperty(gb,"__esModule",{value:!0});gb.$f=class{constructor(){this.Bc=null}createCoverController(a,b,c,d,e,f){f=new pa.nc(f,a);return new na.mc(a,b,c,d,e,f)}getDragDisabledKey(){null==this.Bc&&(this.Bc=w.CetModel.createValueComponentKey("drag_enabled",!1,!1));return this.Bc}};var ub={jh:function(a,b){if(null==a||null==b||0===a.length||
a.length!==b.length||a===b)return null;for(let c=0;c<a.length&&c<b.length;c++)if(a[c]!==b[c])return b[c];return null}};Object.defineProperty(ub,"__esModule",{value:!0});var ma={};Object.defineProperty(ma,"__esModule",{value:!0});ma.Nb=class{constructor(a){this.rb=a;this.Rc=this.Pc=!1;this.hc=null;this.Ec=!0;this.Uc=l.Bacon.newBus();this.Qe=l.Bacon.newBus();this.yb=l.Bacon.newBus();this.vb=l.Bacon.newBus()}ki(){const a=$(this.ba);a.focusin(()=>{this.vb.push(!0)});a.focusout(()=>{this.vb.push(!1)});
a.on("paste",(a)=>{this.Qe.push(a.originalEvent)});a.keypress((a)=>{this.Rc=!0;this.Uc.push(a)});a.keydown((a)=>{this.Uc.push(a)});a.keyup(()=>{this.Rc=!1});a.on("input",()=>{if(!this.Rc&&this.Ec){const a=ub.jh(this.hc,this.ba.value);null!=a&&this.yb.push({eventType:"osxlongpress",text:a})}this.hc=this.ba.value});a[0].addEventListener("compositionstart",(a)=>{this.yb.push({eventType:"compositionstart",text:a.data});this.hc=this.ba.value;this.Ec=!1});a[0].addEventListener("compositionupdate",(a)=>
{""!==a.data&&this.yb.push({eventType:"compositionupdate",text:a.data})});a[0].addEventListener("compositionend",(a)=>{""!==a.data&&this.yb.push({eventType:"compositionend",text:a.data})})}Ue(){null!=this.ba&&this.ba.parentElement.removeChild(this.ba);this.ba=null;null!=this.ma&&(this.ma.style.display="none")}mf(a){if(null!=this.ma){let b=this.rb.getWidth()/2+a.x;a=this.rb.getHeight()/2+a.y;b=Math.max(0,Math.min(b,this.rb.getWidth()-20));a=Math.max(0,Math.min(a,this.rb.getHeight()-20));this.ma.style.left=
b+"px";this.ma.style.top=a+"px"}}Qg(a){this.hc="";this.Ec=!0;this.Ue();if(null==this.ma||null==this.ma.parentElement)this.ma=this.rb.createElement("ime-input-container"),this.ma.style.pointerEvents="none",this.ma.style.position="absolute",this.ma.style.opacity="0",this.ma.style.height="0px";this.mf(a);this.ma.style.display="";this.ba=document.createElement("input");this.ba.setAttribute("tabindex","0");this.ba.setAttribute("id",ma.Nb.pd);this.ba.style.width="10px";this.ba.style.height="0";this.ba.style.overflow=
"hidden";this.ba.style.margin="0";this.ba.style.padding="0";this.ba.autocomplete="off";this.ma.appendChild(this.ba);this.ki()}Jc(){this.Pc||(this.Pc=!0,setTimeout(()=>{this.Pc=!1;null!=this.ba&&this.ba.focus()},10))}getPasteEventAction(){return this.Qe}getFocusInOutStream(){return this.vb}};ma.Nb.pd="IME_Input";var za={};Object.defineProperty(za,"__esModule",{value:!0});za.od=class{constructor(a,b,c,d,e,f){this.Vc=a;this.$h=b;this.ga=c;this.scene=d;this.Na=e;this.Wa=f;this.Xe=l.Bacon.newBus();this.mi()}Bi(a){if("keypress"!==
a.type||a.keyCode===h.Key.ENTER)return!1;let b;null!==a.charCode?b=a.charCode:null!==a.which?b=a.which:null!==a.keyCode&&(b=a.keyCode);return 32>b||a.metaKey!==a.ctrlKey&&!a.altKey&&!a.shiftKey?!1:!0}static Ai(a){switch(a.event.keyCode){case h.Key.MAC_META_LEFT:case h.Key.MAC_META_RIGHT:case h.Key.WIN_META_RIGHT:case h.Key.SHIFT:case h.Key.ALT:case h.Key.CTRL:return!1}return!0}Qi(a){return a.event.metaKey&&(a.event.keyCode===h.Key.Z||a.event.keyCode===h.Key.Y)}Fi(a){return(a.event.metaKey||a.event.ctrlKey)&&
(a.event.keyCode===h.Key.C||a.event.keyCode===h.Key.X)}mi(){this.$h.onValue((a)=>this.Wa.ze(a));this.Vc.filter(this.Bi).onValue((a)=>{this.Wa.ze({text:String.fromCharCode(a.charCode),eventType:"keypress"})});var a=l.Bacon.combineWith((a,b)=>({state:a,event:b}),this.ga.filter((a)=>null!=a&&a.isSingleSelection()),this.Vc.filter((a)=>"keydown"===a.type)).sampledBy(this.Vc.filter((a)=>"keydown"===a.type)).filter(za.od.Ai).filter((a)=>!this.Qi(a));a.filter((a)=>!a.state.isEditing()).onValue((a)=>this.Vh(a));
var b=a.filter((a)=>a.state.isEditing()).filter((a)=>!this.Fi(a));b.onValue((a)=>this.Uh(a));a=b.map((a)=>({entityId:a.state.getEntityIds()[0],ec:!0}));b=b.debounce(300).map((a)=>({entityId:a.state.getEntityIds()[0],ec:!1}));a.merge(b).skipDuplicates((a,b)=>a.ec===b.ec).onValue((a)=>{this.scene.requestNoDomBatchUpdate((b)=>{b=b.getEntityById(a.entityId);null!=b&&b.set(q.SelectionModule.getEnableBlinkingCaretKey(),!a.ec)})})}Vh(a){a=a.event;a.keyCode===h.Key.ENTER?this.Wa.hh():a.keyCode===h.Key.BACKSPACE||
a.keyCode===h.Key.DELETE?this.Wa.deleteText(F.DeleteAction.CHARACTER_BACKWARD):a.keyCode===h.Key.ESC&&this.Xe.push({selectedGroupIds:[],selectedEntityIds:[],type:u.SelectActionType.replace})}Uh(a){var b=a.event;a=a.state.getEntityIds()[0];const c=this.scene.getEntityById(a);null!=c&&(b=b.metaKey&&b.shiftKey?this.Na.uj(b,c):b.ctrlKey&&b.shiftKey?this.Na.sj(b,c):b.altKey&&b.shiftKey?this.Na.qj(b,c):b.metaKey?this.Na.tj(b,c):b.altKey?this.Na.pj(b,c):b.ctrlKey?this.Na.rj(b,c):b.shiftKey?this.Na.wj(b,
c):this.Na.vj(b,c),this.Wa.vg(a,b))}};var hb={};Object.defineProperty(hb,"__esModule",{value:!0});hb.Nf=class{constructor(a,b){this.helper=a;this.i=b}wj(a,b){const c=k.Cet.shapedText(b),d=c.getLength(),e=this.helper.getCaretOffset(b),f=this.helper.getSelectionStartOffset(b),g=this.helper.getSelectionEndOffset(b);let l=e,m=null,p=null,q=null;switch(a.keyCode){case h.Key.UP_ARROW:l=this.i.ic(b,e,!0);null!==f&&null!==g?(m=e===f?l:f,p=e===g?l:g):(m=l,p=e);break;case h.Key.DOWN_ARROW:l=this.i.ic(b,e,!1);
null!==f&&null!==g?(m=e===f?l:f,p=e===g?l:g):(m=e,p=l);break;case h.Key.LEFT_ARROW:null!==f&&null!==g?(m=e===f?f-1:f,p=e===g?g-1:g):0<=e-1&&(m=e-1,p=e);l=Math.max(e-1,0);break;case h.Key.RIGHT_ARROW:null!==f&&null!==g?(m=e===f?f+1:f,p=e===g?g+1:g):(m=e,p=e+1);l=Math.min(e+1,d);break;case h.Key.HOME:a=this.i.$e(c,b);m=a.sa.start;p=a.sa.end;l=a.caretOffset;break;case h.Key.END:a=this.i.af(c,b);m=a.sa.start;p=a.sa.end;l=a.caretOffset;break;case h.Key.TAB:q=Object.assign({kind:y.TextEditEventKind.Command,
command:y.TextEditCommandKind.Tab},this.Sa(a));break;default:m=this.helper.getSelectionStartOffset(b),p=this.helper.getSelectionEndOffset(b)}return{caretOffset:l,selectionStartOffset:m,selectionEndOffset:p,command:q,Pa:!1}}pj(a,b){let c=k.Cet.shapedText(b),d=this.helper.getCaretOffset(b),e=d,f=null,g=null,l=null;switch(a.keyCode){case h.Key.LEFT_ARROW:e=c.getWordBoundaryToLeft(d,!0);break;case h.Key.RIGHT_ARROW:e=c.getWordBoundaryToRight(d);break;case h.Key.UP_ARROW:e=c.getParagraphBoundaryToLeft(d);
break;case h.Key.DOWN_ARROW:e=c.getParagraphBoundaryToRight(d);break;case h.Key.BACKSPACE:l=Object.assign({kind:y.TextEditEventKind.Command,command:y.TextEditCommandKind.Backspace},this.Sa(a));break;default:f=this.helper.getSelectionStartOffset(b),g=this.helper.getSelectionEndOffset(b)}return{caretOffset:e,selectionStartOffset:f,selectionEndOffset:g,command:l,Pa:!1}}rj(a,b){let c=k.Cet.shapedText(b),d=this.helper.getCaretOffset(b),e=d,f=this.helper.getSelectionStartOffset(b);b=this.helper.getSelectionEndOffset(b);
let g=null;switch(a.keyCode){case h.Key.A:W.PreziUAParser.getOsKind()!==W.OsKind.Mac&&(f=0,e=b=c.getLength());break;case h.Key.HOME:b=f=null;e=0;break;case h.Key.END:b=f=null;e=c.getLength();break;case h.Key.LEFT_ARROW:b=f=null;e=c.getWordBoundaryToLeft(d,!0);break;case h.Key.RIGHT_ARROW:b=f=null;e=c.getWordBoundaryToRight(d);break;case h.Key.UP_ARROW:b=f=null;e=c.getParagraphBoundaryToLeft(d);break;case h.Key.DOWN_ARROW:b=f=null;e=c.getParagraphBoundaryToRight(d);break;case h.Key.BACKSPACE:g=Object.assign({kind:y.TextEditEventKind.Command,
command:y.TextEditCommandKind.Backspace},this.Sa(a))}return{caretOffset:e,selectionStartOffset:f,selectionEndOffset:b,command:g,Pa:!1}}Sa(a){return{modifiers:{altKey:a.altKey,ctrlKey:a.ctrlKey,metaKey:a.metaKey,shiftKey:a.shiftKey,os:W.PreziUAParser.getOsKind()}}}tj(a,b){const c=k.Cet.shapedText(b),d=this.helper.getCaretOffset(b);let e=d,f=this.helper.getSelectionStartOffset(b);b=this.helper.getSelectionEndOffset(b);switch(a.keyCode){case h.Key.A:f=0;e=b=c.getLength();break;case h.Key.UP_ARROW:b=
f=null;e=0;break;case h.Key.DOWN_ARROW:b=f=null;e=c.getLength();break;case h.Key.LEFT_ARROW:b=f=null;e=this.i.bb(c,d,!0);break;case h.Key.RIGHT_ARROW:b=f=null,e=this.i.bb(c,d,!1)}return{caretOffset:e,selectionStartOffset:f,selectionEndOffset:b,Pa:!1,command:null}}uj(a,b){let c=k.Cet.shapedText(b);switch(a.keyCode){case h.Key.UP_ARROW:a=this.i.ff(c,b);break;case h.Key.DOWN_ARROW:a=this.i.Ze(c,b);break;case h.Key.LEFT_ARROW:a=this.i.$e(c,b);break;case h.Key.RIGHT_ARROW:a=this.i.af(c,b);break;default:a=
this.i.Kc(b)}return{caretOffset:a.caretOffset,selectionStartOffset:a.sa.start,selectionEndOffset:a.sa.end,Pa:!1,command:null}}sj(a,b){let c=k.Cet.shapedText(b);switch(a.keyCode){case h.Key.LEFT_ARROW:a=this.i.ef(c,b);break;case h.Key.RIGHT_ARROW:a=this.i.cf(c,b);break;case h.Key.UP_ARROW:a=this.i.df(c,b);break;case h.Key.DOWN_ARROW:a=this.i.bf(c,b);break;case h.Key.HOME:a=this.i.ff(c,b);break;case h.Key.END:a=this.i.Ze(c,b);break;default:a=this.i.Kc(b)}return{caretOffset:a.caretOffset,selectionStartOffset:a.sa.start,
selectionEndOffset:a.sa.end,Pa:!1,command:null}}qj(a,b){let c=k.Cet.shapedText(b);switch(a.keyCode){case h.Key.LEFT_ARROW:a=this.i.ef(c,b);break;case h.Key.RIGHT_ARROW:a=this.i.cf(c,b);break;case h.Key.UP_ARROW:a=this.i.df(c,b);break;case h.Key.DOWN_ARROW:a=this.i.bf(c,b);break;default:a=this.i.Kc(b)}return{caretOffset:a.caretOffset,selectionStartOffset:a.sa.start,selectionEndOffset:a.sa.end,Pa:!1,command:null}}vj(a,b){let c=k.Cet.shapedText(b);const d=this.helper.getSelection(b);let e=this.helper.getCaretOffset(b),
f=e,g=null,l=null,m=null,p=!1;switch(a.keyCode){case h.Key.UP_ARROW:f=this.i.Ch(b);break;case h.Key.DOWN_ARROW:f=this.i.zh(b);break;case h.Key.RIGHT_ARROW:f=this.i.Bh(b);break;case h.Key.LEFT_ARROW:f=this.i.Ah(b);break;case h.Key.ENTER:m=Object.assign({kind:y.TextEditEventKind.Command,command:y.TextEditCommandKind.Enter},this.Sa(a));break;case h.Key.DELETE:m=Object.assign({kind:y.TextEditEventKind.Command,command:y.TextEditCommandKind.Delete},this.Sa(a));break;case h.Key.BACKSPACE:m=Object.assign({kind:y.TextEditEventKind.Command,
command:y.TextEditCommandKind.Backspace},this.Sa(a));break;case h.Key.ESC:p=!0;f=c.getLength();break;case h.Key.HOME:f=this.i.bb(c,e,!0);break;case h.Key.END:f=this.i.bb(c,e,!1);break;case h.Key.TAB:m=Object.assign({kind:y.TextEditEventKind.Command,command:y.TextEditCommandKind.Tab},this.Sa(a));break;default:g=null!=d?d.start:null,l=null!=d?d.end:null}return{caretOffset:f,selectionStartOffset:g,selectionEndOffset:l,Pa:p,command:m}}};var ib={};Object.defineProperty(ib,"__esModule",{value:!0});ib.Vf=
class{constructor(a,b,c,d,e,f){this.eb=a;this.ga=b;this.jb=c;this.camera=d;this.scene=e;this.Hb=f;this.li();this.ai();this.hi()}hi(){let a=this.Xc.filter((a)=>{a=this.camera.screenPointToWorld(a.event.stagePos);a=this.jb.getEntityIdUnderPoint(a);a=this.scene.getEntityById(a);return null!=a?(a=a.get(q.SelectionModule.getDecoratorKey()),null!=a&&a.interactionType!==q.InteractionType.none):!1}).map(()=>null);this.ga.sampledBy(a).filter((a)=>null!=a&&a.isSingleSelection()&&a.isEditing()).onValue(()=>
{this.Hb.Yb()})}li(){this.Xc=this.eb.filter((a)=>a.type===h.MouseInteractionType.Click);this.Je=this.eb.filter((a)=>a.type===h.MouseInteractionType.DoubleClick);this.Le=this.eb.filter((a)=>a.type===h.MouseInteractionType.TripleClick);this.Ke=this.eb.filter((a)=>a.type===h.MouseInteractionType.DragMove||a.type===h.MouseInteractionType.DragEnd)}ai(){this.Nh();this.Oh();this.Qh();this.Ph()}Qh(){const a=l.Bacon.combineWith((a,c)=>({ia:a,state:c}),this.Le,this.ga).sampledBy(this.Le).filter((a)=>null!=
a.state&&a.state.isSingleSelection());this.Lc(a).onValue((a)=>{this.Hb.Gc({ia:a.ka.ia,Ea:a.Ea,uc:3,isEditing:a.ka.state.isEditing(),entityId:a.ka.state.getSingleEntityId()})})}Oh(){const a=l.Bacon.combineWith((a,c)=>({ia:a,state:c}),this.Je,this.ga).sampledBy(this.Je).filter((a)=>null!=a.state&&a.state.isSingleSelection());this.Lc(a).onValue((a)=>{this.Hb.Gc({ia:a.ka.ia,Ea:a.Ea,uc:2,isEditing:a.ka.state.isEditing(),entityId:a.ka.state.getSingleEntityId()})})}Nh(){const a=l.Bacon.combineWith((a,c)=>
({ia:a,state:c}),this.Xc,this.ga).sampledBy(this.Xc).filter((a)=>null!=a.state&&a.state.isSingleSelection());this.Lc(a).onValue((a)=>{this.Hb.Gc({ia:a.ka.ia,Ea:a.Ea,uc:1,isEditing:a.ka.state.isEditing(),entityId:a.ka.state.getSingleEntityId()})})}Ph(){l.Bacon.combineWith((a,b)=>({ia:a,state:b}),this.Ke,this.ga).sampledBy(this.Ke).filter((a)=>null!=a.state&&a.state.isSingleSelection()&&a.state.isEditing()).onValue((a)=>{const b=this.camera.screenPointToWorld(a.ia.baseEvent.stagePos),c=this.camera.screenPointToWorld(a.ia.event.stagePos);
this.jb.getEntityIdUnderPoint(b,!0,a.state.getSingleEntityId())===a.state.getSingleEntityId()&&this.Hb.gh({Tj:b,Sj:c})})}Lc(a){return a.map((a)=>({ka:a,Ea:this.camera.screenPointToWorld(a.ia.event.stagePos)})).filter((a)=>null!=a.ka.state&&a.ka.state.isSingleSelection()?(a.ka.state.isEditing()?this.jb.getEntityIdUnderPoint(a.Ea,!0,a.ka.state.getSingleEntityId()):this.jb.getEntityIdUnderPoint(a.Ea))===a.ka.state.getSingleEntityId():!1)}};var qa={};Object.defineProperty(qa,"__esModule",{value:!0});
var J;(function(a){a[a.LEFT=0]="LEFT";a[a.RIGHT=1]="RIGHT"})(J=qa.yf||(qa.yf={}));class Jc{constructor(a){this.helper=a}le(a,b,c){const d=k.Cet.transform(a).getWorldToLocal(),e=k.Cet.localBounds(a).getGraphicsBounds().getData();c=d.transformPoint(c);a=a.getWrapper(w.CetModel.ID.HAS_FONT.W);a=a.getDisplayBackground()?a.getBackgroundPadding():0;b=b.locateCaretOffset({x:c.x+e.width/2-a,y:c.y+e.height/2-a});return b.endOfLine?b.offset-1:b.offset}ic(a,b,c){a=k.Cet.shapedText(a);let d=a.getLineAt(b,!1);
b=a.locatePosition(b,!1);c=c?b.y-1:b.y+(d.ascent-d.descent)+d.lineGap+1;0>c?c=0:c>a.getLayoutHeight()?c=a.getLength():(c=a.locateCaretOffset({x:b.x,y:c}),c=c.endOfLine?c.offset-1:c.offset);return c}bb(a,b,c){b=a.locatePosition(b,!1);if(!c&&1===a.getLineCount())return a.getLength();a=a.locateCaretOffset({x:c?0:a.getWrapWidth()-1,y:b.y+1});return a.endOfLine?a.offset-1:a.offset}pb(a,b,c=!1){return c&&this.helper.hasSelection(a)?b===J.LEFT?this.helper.getSelectionStartOffset(a):this.helper.getSelectionEndOffset(a):
this.helper.getCaretOffset(a)}bf(a,b){return this.Oa(a,b,J.RIGHT,(a,b)=>a.getParagraphBoundaryToRight(b))}af(a,b){return this.Oa(a,b,J.RIGHT,(a,b)=>this.bb(a,b,!1))}cf(a,b){return this.Oa(a,b,J.RIGHT,(a,b)=>a.getWordBoundaryToRight(b))}$e(a,b){return this.Oa(a,b,J.LEFT,(a,b)=>this.bb(a,b,!0))}ef(a,b){return this.Oa(a,b,J.LEFT,(a,b)=>a.getWordBoundaryToLeft(b,!0))}ff(a,b){return this.Oa(a,b,J.LEFT,()=>0)}Ze(a,b){return this.Oa(a,b,J.RIGHT,(a)=>a.getLength())}Oa(a,b,c,d){c=this.pb(b,c);const e=this.helper.getSelectionStartOffset(b);
b=this.helper.getSelectionEndOffset(b);let f=e,g=b;a=d(a,c);null==e&&null==b?a<c?(f=a,g=c):(f=c,g=a):c===e?f=a:g=a;return{sa:{start:f,end:g},caretOffset:a}}Kc(a){return{sa:{start:this.helper.getSelectionStartOffset(a),end:this.helper.getSelectionEndOffset(a)},caretOffset:this.helper.getCaretOffset(a)}}df(a,b){return this.Oa(a,b,J.LEFT,(a,b)=>a.getParagraphBoundaryToLeft(b))}Ch(a){const b=this.pb(a,J.LEFT,this.helper.hasSelection(a));return this.ic(a,b,!0)}zh(a){const b=this.pb(a,J.RIGHT,this.helper.hasSelection(a));
return this.ic(a,b,!1)}Ah(a){const b=this.helper.hasSelection(a);a=this.pb(a,J.LEFT,b);!b&&0<=a-1&&--a;return a}Bh(a){const b=this.helper.hasSelection(a);let c=this.pb(a,J.RIGHT,b);!b&&c+1<=k.Cet.shapedText(a).getLength()&&++c;return c}}qa.ng=Jc;var Z={};Object.defineProperty(Z,"__esModule",{value:!0});Z.zd=class{constructor(a,b,c){this.v=a;this.u=b;this.getScene=c;this.ga=l.Bacon.newBus();this.lf=l.Bacon.newBus();this.helper=p.CetModelEditor.createTextHelper();this.u.addTextSelectionStateStream(this.ga)}clearSelection(){this.setTextSelection(null)}setTextSelection(a){null==
a||null==a.id?(a=this.u.getTextSelectionState(),null!=a&&a.isSingleSelection()&&this.Eg(a.getSingleEntityId()),this.u.getTextSelectionState().isEditing()&&this.cd(this.u.getTextSelectionState().setEditing(!1))):(this.u.getTextSelectionState().isEditing()||this.cd(this.u.getTextSelectionState().setEditing(!0)),this.v.select({selectedGroupIds:[],selectedEntityIds:[a.id],type:u.SelectActionType.replace}),this.lc(a.id,a.caretPosition===y.CaretPosition.Start?a.offset:a.offset+a.length,a.offset,a.offset+
a.length))}getTextSelectionInfo(){var a=this.u.getTextSelectionState();if(null==a||!a.isEditing()||!a.isSingleSelection())return null;a=this.getScene().getEntityById(a.getEntityIds()[0]);const b=this.helper.getSelection(a),c=this.helper.getCaretOffset(a);var d=a.get(w.CetModel.ID.POSSIBLY_PLACEHOLDER.IS_PLACEHOLDER)?0:k.Cet.shapedText(a).getLength();let e;null!=b&&null!=b.start&&null!=b.end?(e=b.start,d=b.end):null!=c?d=e=c:e=0;d-=e;return{id:a.getId(),offset:e,length:d,caretPosition:null!=b&&b.start===
c?y.CaretPosition.Start:y.CaretPosition.End}}Eg(a){this.lc(a,null,null,null)}lc(a,b,c,d){this.getScene().executeNoDomBatchUpdate((e)=>{e=e.getEntityById(a);if(null!=e&&(0===d-c&&(c=d=null),this.helper.getCaretOffset(e)!==b||this.helper.getSelectionStartOffset(e)!==c||this.helper.getSelectionEndOffset(e)!==d)){this.helper.setCaretOffset(e,b);this.helper.setSelection(e,this.getScene(),c,d);var f=k.Cet.shapedText(e);if(null!=b&&b<=f.getLength()){const a=f.getText().getRawText(),c=Math.max(b-1,0);f=c<
a.length&&"\n"===a[c]?f.getCharacterStylesAt(Math.max(c+1,0)):f.getCharacterStylesAt(Math.max(c,0));e.set(ba.CetRendererModule.getInEditFontSizeComponentKey(),f.getFontSize())}else e.discardOwnComponent(ba.CetRendererModule.getInEditFontSizeComponentKey());null!=b?e.set(ba.CetRendererModule.getHidePlaceHolderTextKey(),!0):e.discardOwnComponent(ba.CetRendererModule.getHidePlaceHolderTextKey())}})}cd(a){this.ga.push(a)}getTextEditEvents(){return this.lf}hd(a){this.lf.push(a)}};Z.rc=class{constructor(a,
b,c,d,e,f,g,h,k,l,m,q){this.ta=a;this.u=b;this.ca=c;this.eb=d;this.lh=e;this.o=f;this.Tg=g;this.jb=h;this.camera=k;this.bd=m;this.$g=q;this.ac=-1;this.scene=f.scene;this.helper=p.CetModelEditor.createTextHelper();this.i=new qa.ng(this.helper);this.Ba=new ma.Nb(l);this.ji()}Yb(){this.ca.clearSelection()}Rh(a){if(!D.Utils.arrayEquals(a,this.u.getTextSelectionState().getEntityIds())){this.Yb();var b=[];a=this.scene.getEntityList().getEntitiesById(a);for(let c=0;c<a.length;c++)if(null!=a[c]&&a[c].isDef(w.CetModel.ID.Z_TEXT))b.push(a[c].getId());
else{b=[];break}1!==b.length?this.Ba.Ue():(this.Ba.Qg(this.ue(b[0])),this.Ba.Jc());this.ca.cd(this.u.getTextSelectionState().setEntityIds(b))}}getPasteEventAction(){return this.Ba.getPasteEventAction()}getSelectAction(){return this.zi.Xe}getFocusInOutStream(){return this.Ba.getFocusInOutStream()}gh(a){if(this.u.getTextSelectionState().isEditing()){var b=this.u.getTextSelectionState().getSingleEntityId(),c=this.scene.getEntityById(b);if(null!=c){var d=k.Cet.transform(c).getWorldToLocal(),e=k.Cet.localBounds(c).getGraphicsBounds().getData(),
f=d.transformPoint(a.Tj);a=d.transformPoint(a.Sj);d=k.Cet.shapedText(c);c=c.getWrapper(w.CetModel.ID.HAS_FONT.W);c=c.getDisplayBackground()?c.getBackgroundPadding():0;f=d.locateCaretOffset({x:f.x+e.width/2-c,y:f.y+e.height/2-c}).offset;e=d.locateCaretOffset({x:a.x+e.width/2-c,y:a.y+e.height/2-c}).offset;f===e?f=a=null:f>e?a=e:(a=f,f=e);this.ca.lc(b,e,a,f)}}}Gc(a){const b=a.entityId;var c=this.scene.getEntityById(b);if(null!=c){var d=k.Cet.shapedText(c),e;if(this.helper.isPlaceholder(c)){var f=e=null;
var g=0}else{const b=this.i.le(c,d,a.Ea);if(a.isEditing)switch(a.uc){case 1:a.ia.event.shiftKey?(a=this.helper.getCaretOffset(c),f=b,this.helper.hasSelection(c)?(c=this.helper.getSelection(c),e=a===c.start?c.end:c.start):e=a,g=b):a.ia.event.ctrlKey?(f=d.getWordBoundaryToLeft(b,!1),g=e=d.getWordBoundaryToRight(b)):g=f=e=b;break;case 2:f=d.getWordBoundaryToLeft(b,!1);g=e=d.getWordBoundaryToRight(b);break;case 3:f=d.getParagraphBoundaryToLeft(b),g=e=d.getParagraphBoundaryToRight(b)}else f=e=null,g=b}this.ca.setTextSelection({id:b,
offset:null!=f?f:g,length:null!=e?e-f:0,caretPosition:null!=f&&null!=e&&f===g?y.CaretPosition.Start:y.CaretPosition.End})}}selectRightClickedWord_forSpellCheck(a){const b=this.u.getTextSelectionState().getSingleEntityId();var c=this.scene.getEntityById(b);if(null!=c){var d=k.Cet.shapedText(c);if(this.helper.isPlaceholder(c))c=d=null,a=0;else if(a=this.i.le(c,d,a),this.u.getTextSelectionState().isEditing()){if(this.helper.hasSelection(c)&&(c=this.helper.getSelection(c),null!=c&&c.start<=a&&c.end>=
a))return;c=this.helper.getSpecialTokens(d.getRawText());const b=this.helper.findSpecialToken(c,a,a);null!=b?(c=b.pos,a=d=b.end):(c=d.getWordBoundaryToLeft(a,!1),a=d=d.getWordBoundaryToRight(a))}else c=d=null;this.ca.setTextSelection({id:b,offset:null!=c?c:a,length:null!=d?d-c:0,caretPosition:null!=c&&null!=d&&c===a?y.CaretPosition.Start:y.CaretPosition.End})}}hh(){if(this.u.getTextSelectionState().isSingleSelection()){var a=this.u.getTextSelectionState().getSingleEntityId(),b=this.scene.getEntityById(a);
if(null!=b){var c=k.Cet.shapedText(b),d=0;this.helper.isPlaceholder(b)||""===c.getRawText()||(d=c.getRawText().length);this.ca.setTextSelection({id:a,offset:d,length:0,caretPosition:y.CaretPosition.End})}}}vg(a,b){if(null!=b.command)this.ca.hd(b.command);else if(b.Pa)this.Yb();else{var c=this.scene.getEntityById(a);if(null!=c){c=k.Cet.shapedText(c).getLength();let d=null,e=null;b.selectionStartOffset!==b.selectionEndOffset&&(d=Math.max(b.selectionStartOffset,0),e=Math.min(b.selectionEndOffset,c));
this.ca.lc(a,b.caretOffset,d,e)}}}ze(a){var b=this.u.getTextSelectionState();if(null!=b&&b.isSingleSelection()){let c=this.ca.getTextSelectionInfo();null==c&&(this.ca.setTextSelection({id:b.getEntityIds()[0],offset:Infinity,length:0,caretPosition:y.CaretPosition.End}),c=this.ca.getTextSelectionInfo());b="compositionupdate"===a.eventType||"compositionend"===a.eventType||"osxlongpress"===a.eventType;const d=this.Pj(c&&c.id,a);b&&this.ca.setTextSelection({id:c.id,offset:d,length:c.length+(c.offset-d),
caretPosition:y.CaretPosition.End});this.ca.hd({kind:y.TextEditEventKind.Insert,text:a.text})}}deleteText(){if(this.u.getTextSelectionState().isSingleSelection()){var a=this.u.getTextSelectionState().getSingleEntityId();this.u.getTextSelectionState().isEditing()?this.ca.hd({kind:y.TextEditEventKind.Command,command:y.TextEditCommandKind.Backspace,modifiers:{altKey:!1,shiftKey:!1,ctrlKey:!1,metaKey:!1,os:W.PreziUAParser.getOsKind()}}):this.o.executeApiCommand(this.Tg.deleteObjectCmd([a],"KEY_BACKSPACE"))}}getSelectedTextFromEntity_forSpellCheck(a,
b=!1){return this.helper.getSelectedText(a,b)}ji(){this.ta.onValue((a)=>{this.Rh(a.allEntityIds)});this.vi();this.ii();this.ti();this.zi=new za.od(this.Ba.Uc,this.Ba.yb,this.u.getTextSelectionStateStream(),this.scene,new hb.Nf(this.helper,this.i),this);new ib.Vf(this.eb,this.u.getTextSelectionStateStream(),this.jb,this.camera,this.scene,this)}ti(){this.bd.onValue(()=>{if(this.u.getTextSelectionState().isSingleSelection()){var a=this.scene.getEntityById(this.u.getTextSelectionState().getSingleEntityId());
if(a){let b=k.Cet.shapedText(a);this.ca.setTextSelection({id:a.getId(),offset:0,length:b.getLength(),caretPosition:y.CaretPosition.End})}}})}ii(){let a;const b=this.$g.map((a)=>a===E.EditorMode.edit).toProperty(!0);this.lh.throttle(0).filterWithStream(b).onValue((b)=>{b!==H.ComponentFocusMode.ui&&b!==H.ComponentFocusMode.canvas||this.Yb();b===H.ComponentFocusMode.textEditor&&this.Ba.Jc();b===H.ComponentFocusMode.none&&this.u.getTextSelectionState().isEditing()&&(clearTimeout(a),a=setTimeout(()=>{this.Ba.Jc()},
0))})}ue(a){a=this.scene.getEntityById(a).getComponent(ba.CetRendererModule.getWorldGeometryComponentKey());if(null==a)return{x:0,y:0};a=a.getWorldBounds().getVertices();a=K.Geometry.interpolatePoint(a[0],a[1],.5);return this.camera.getTransform().transformPoint(a)}vi(){this.scene.getIdleChangeStream(k.ChangeEventKind.Entity).toProperty([]).onValue((a)=>{if(this.u.getTextSelectionState().isSingleSelection()){var b=this.u.getTextSelectionState().getSingleEntityId();a.some((a)=>{let c=a.entities?a.entities:
[a.entity];return a.type===w.ChangeType.ModifyComponent&&a.componentKey===w.CetModel.ID.TRANSFORMED.LOCAL_TO_WORLD&&c.some((a)=>null!=a&&a.getId()===b)})&&this.Ba.mf(this.ue(b))}})}te(a){a=this.scene.getEntityById(a);return this.helper.hasSelection(a)?this.helper.getSelectionStartOffset(a):this.helper.isPlaceholder(a)?0:this.helper.getCaretOffset(a)}Pj(a,b){"compositionstart"===b.eventType&&null!=a?this.ac=a=this.te(a):"compositionend"===b.eventType?(a=this.ac,this.ac=-1):a="osxlongpress"===b.eventType&&
null!=a?this.te(a)-1:this.ac;return a}getSelection_forSpellCheck(a){return this.helper.hasSelection(a)?this.helper.getSelection(a):null}};Z.rc.Mf="#"+ma.Nb.pd;var jb={};Object.defineProperty(jb,"__esModule",{value:!0});jb.og=class{createTextSelectionController(a,b,c){return new Z.zd(a,b,c)}createTextEditorController(a,b,c,d,e,f,g,h,k,l,m,p,q){if(!(d instanceof Z.zd))throw Error("textSelectionController should be TextSelectionControllerImpl");return new Z.rc(a,b,d,c,e,f,g,h,k,l,m,q)}getImeInputSelector(){return Z.rc.Mf}};
var F={};Object.defineProperty(F,"__esModule",{value:!0});(function(a){a[a.UNDO=0]="UNDO";a[a.REDO=1]="REDO"})(F.UndoRedoAction||(F.UndoRedoAction={}));(function(a){a[a.COPY=0]="COPY";a[a.PASTE=1]="PASTE";a[a.CUT=2]="CUT"})(F.CopyPasteType||(F.CopyPasteType={}));(function(a){a[a.button=0]="button";a[a.keyboard=1]="keyboard"})(F.UndoRedoRequestTrigger||(F.UndoRedoRequestTrigger={}));(function(a){a[a.CHARACTER_FORWARD=0]="CHARACTER_FORWARD";a[a.CHARACTER_BACKWARD=1]="CHARACTER_BACKWARD"})(F.DeleteAction||
(F.DeleteAction={}));F.EditorControllerModule=new fb.Jf;F.TextEditorModule=new jb.og;F.ObjectEditorModule=new gb.$f;return yb=F});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_editor_controller",["require","prezi.engine.dom","prezi.geometry","prezi.text","prezi.text.model","prezi_app_utils","prezi_bacon","prezi_canvas_listener","prezi_cet","prezi_cet_model","prezi_cet_model_editor","prezi_cet_renderer","prezi_editor_commander","prezi_editor_error","prezi_editor_store_common","prezi_editor_store_focus","prezi_editor_store_mode","prezi_editor_store_object","prezi_externalserviceprovider","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_nativeapitypes","prezi_playback","prezi_plugin_api","prezi_plugin_meta","prezi_select","prezi_service_browsernotification","prezi_service_data","prezi_service_media","prezi_templateservice","prezi_uaparser","prezi_utils","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_editor_controller.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1).concat([function(){return new Promise(function(resolve,reject){require(["prezi_about_box"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_alignment_tools"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_ar_convert"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_ar_video_template_tools"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_background_image"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_bracket_frame"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_brand_colors"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_chart_insert"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_classic_import"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_classic_to_next_onboarding"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_dashed_line"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_debug"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_depth_of_field"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_editor_mode"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_equation_editor"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_extended_selection"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_favorites"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_file_picker_integrations"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_first_steps_onboarding"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_font_admin"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_font_preview"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_font_selector"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_grouping"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_icon_insert"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_image_insert"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_layout"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_local_service_mocks"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_marker_editor"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_narrative_editor"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_path_audio"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_path_editing"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_path_generation_strategy"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_pdf_insert"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_photo_editor"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_ppt_edit"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_ppt_insert"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_prezi_video_onboarding"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_qr_code_insert"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_scheme"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_search_replace"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_select_similar"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_shape_and_arc_editor"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_snippet_editing_layout_options"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_solid_color"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_storyblocks"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_storyblocks_admin"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_syntax_highlight"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_template_from_storyblocks"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_test_propertybar"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_test_sidebar"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_text_editor"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_text_style"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_topic_grouping_onboarding"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_topic_shape"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_turn_into_topic"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_video_background"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_video_insert"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_video_template_from_figma"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_view_to_dashboard_test"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_visual_types"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_watermark"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});},function(){return new Promise(function(resolve,reject){require(["prezi_z_order_object"],function(m){resolve(m.lazyModule);},function(err){reject(err);});});}]));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.engine.dom"),require("prezi.geometry"),require("prezi.text"),require("prezi.text.model"),require("prezi_app_utils"),require("prezi_bacon"),require("prezi_canvas_listener"),require("prezi_cet"),require("prezi_cet_model"),require("prezi_cet_model_editor"),require("prezi_cet_renderer"),require("prezi_editor_commander"),require("prezi_editor_error"),require("prezi_editor_store_common"),require("prezi_editor_store_focus"),require("prezi_editor_store_mode"),require("prezi_editor_store_object"),require("prezi_externalserviceprovider"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_nativeapitypes"),require("prezi_playback"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_select"),require("prezi_service_browsernotification"),require("prezi_service_data"),require("prezi_service_media"),require("prezi_templateservice"),require("prezi_uaparser"),require("prezi_utils"),require("prezi_widgets"),function(){return Promise.resolve(require("prezi_about_box").lazyModule);},function(){return Promise.resolve(require("prezi_alignment_tools").lazyModule);},function(){return Promise.resolve(require("prezi_ar_convert").lazyModule);},function(){return Promise.resolve(require("prezi_ar_video_template_tools").lazyModule);},function(){return Promise.resolve(require("prezi_background_image").lazyModule);},function(){return Promise.resolve(require("prezi_bracket_frame").lazyModule);},function(){return Promise.resolve(require("prezi_brand_colors").lazyModule);},function(){return Promise.resolve(require("prezi_chart_insert").lazyModule);},function(){return Promise.resolve(require("prezi_classic_import").lazyModule);},function(){return Promise.resolve(require("prezi_classic_to_next_onboarding").lazyModule);},function(){return Promise.resolve(require("prezi_dashed_line").lazyModule);},function(){return Promise.resolve(require("prezi_debug").lazyModule);},function(){return Promise.resolve(require("prezi_depth_of_field").lazyModule);},function(){return Promise.resolve(require("prezi_editor_mode").lazyModule);},function(){return Promise.resolve(require("prezi_equation_editor").lazyModule);},function(){return Promise.resolve(require("prezi_extended_selection").lazyModule);},function(){return Promise.resolve(require("prezi_favorites").lazyModule);},function(){return Promise.resolve(require("prezi_file_picker_integrations").lazyModule);},function(){return Promise.resolve(require("prezi_first_steps_onboarding").lazyModule);},function(){return Promise.resolve(require("prezi_font_admin").lazyModule);},function(){return Promise.resolve(require("prezi_font_preview").lazyModule);},function(){return Promise.resolve(require("prezi_font_selector").lazyModule);},function(){return Promise.resolve(require("prezi_grouping").lazyModule);},function(){return Promise.resolve(require("prezi_icon_insert").lazyModule);},function(){return Promise.resolve(require("prezi_image_insert").lazyModule);},function(){return Promise.resolve(require("prezi_layout").lazyModule);},function(){return Promise.resolve(require("prezi_local_service_mocks").lazyModule);},function(){return Promise.resolve(require("prezi_marker_editor").lazyModule);},function(){return Promise.resolve(require("prezi_narrative_editor").lazyModule);},function(){return Promise.resolve(require("prezi_path_audio").lazyModule);},function(){return Promise.resolve(require("prezi_path_editing").lazyModule);},function(){return Promise.resolve(require("prezi_path_generation_strategy").lazyModule);},function(){return Promise.resolve(require("prezi_pdf_insert").lazyModule);},function(){return Promise.resolve(require("prezi_photo_editor").lazyModule);},function(){return Promise.resolve(require("prezi_ppt_edit").lazyModule);},function(){return Promise.resolve(require("prezi_ppt_insert").lazyModule);},function(){return Promise.resolve(require("prezi_prezi_video_onboarding").lazyModule);},function(){return Promise.resolve(require("prezi_qr_code_insert").lazyModule);},function(){return Promise.resolve(require("prezi_scheme").lazyModule);},function(){return Promise.resolve(require("prezi_search_replace").lazyModule);},function(){return Promise.resolve(require("prezi_select_similar").lazyModule);},function(){return Promise.resolve(require("prezi_shape_and_arc_editor").lazyModule);},function(){return Promise.resolve(require("prezi_snippet_editing_layout_options").lazyModule);},function(){return Promise.resolve(require("prezi_solid_color").lazyModule);},function(){return Promise.resolve(require("prezi_storyblocks").lazyModule);},function(){return Promise.resolve(require("prezi_storyblocks_admin").lazyModule);},function(){return Promise.resolve(require("prezi_syntax_highlight").lazyModule);},function(){return Promise.resolve(require("prezi_template_from_storyblocks").lazyModule);},function(){return Promise.resolve(require("prezi_test_propertybar").lazyModule);},function(){return Promise.resolve(require("prezi_test_sidebar").lazyModule);},function(){return Promise.resolve(require("prezi_text_editor").lazyModule);},function(){return Promise.resolve(require("prezi_text_style").lazyModule);},function(){return Promise.resolve(require("prezi_topic_grouping_onboarding").lazyModule);},function(){return Promise.resolve(require("prezi_topic_shape").lazyModule);},function(){return Promise.resolve(require("prezi_turn_into_topic").lazyModule);},function(){return Promise.resolve(require("prezi_video_background").lazyModule);},function(){return Promise.resolve(require("prezi_video_insert").lazyModule);},function(){return Promise.resolve(require("prezi_video_template_from_figma").lazyModule);},function(){return Promise.resolve(require("prezi_view_to_dashboard_test").lazyModule);},function(){return Promise.resolve(require("prezi_visual_types").lazyModule);},function(){return Promise.resolve(require("prezi_watermark").lazyModule);},function(){return Promise.resolve(require("prezi_z_order_object").lazyModule);});}else{this["prezi_editor_controller"]=__factory(this["prezi.engine.dom"],this["prezi.geometry"],this["prezi.text"],this["prezi.text.model"],this["prezi_app_utils"],this["prezi_bacon"],this["prezi_canvas_listener"],this["prezi_cet"],this["prezi_cet_model"],this["prezi_cet_model_editor"],this["prezi_cet_renderer"],this["prezi_editor_commander"],this["prezi_editor_error"],this["prezi_editor_store_common"],this["prezi_editor_store_focus"],this["prezi_editor_store_mode"],this["prezi_editor_store_object"],this["prezi_externalserviceprovider"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_nativeapitypes"],this["prezi_playback"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_select"],this["prezi_service_browsernotification"],this["prezi_service_data"],this["prezi_service_media"],this["prezi_templateservice"],this["prezi_uaparser"],this["prezi_utils"],this["prezi_widgets"],function(){return Promise.resolve(this["prezi_about_box"].lazyModule);},function(){return Promise.resolve(this["prezi_alignment_tools"].lazyModule);},function(){return Promise.resolve(this["prezi_ar_convert"].lazyModule);},function(){return Promise.resolve(this["prezi_ar_video_template_tools"].lazyModule);},function(){return Promise.resolve(this["prezi_background_image"].lazyModule);},function(){return Promise.resolve(this["prezi_bracket_frame"].lazyModule);},function(){return Promise.resolve(this["prezi_brand_colors"].lazyModule);},function(){return Promise.resolve(this["prezi_chart_insert"].lazyModule);},function(){return Promise.resolve(this["prezi_classic_import"].lazyModule);},function(){return Promise.resolve(this["prezi_classic_to_next_onboarding"].lazyModule);},function(){return Promise.resolve(this["prezi_dashed_line"].lazyModule);},function(){return Promise.resolve(this["prezi_debug"].lazyModule);},function(){return Promise.resolve(this["prezi_depth_of_field"].lazyModule);},function(){return Promise.resolve(this["prezi_editor_mode"].lazyModule);},function(){return Promise.resolve(this["prezi_equation_editor"].lazyModule);},function(){return Promise.resolve(this["prezi_extended_selection"].lazyModule);},function(){return Promise.resolve(this["prezi_favorites"].lazyModule);},function(){return Promise.resolve(this["prezi_file_picker_integrations"].lazyModule);},function(){return Promise.resolve(this["prezi_first_steps_onboarding"].lazyModule);},function(){return Promise.resolve(this["prezi_font_admin"].lazyModule);},function(){return Promise.resolve(this["prezi_font_preview"].lazyModule);},function(){return Promise.resolve(this["prezi_font_selector"].lazyModule);},function(){return Promise.resolve(this["prezi_grouping"].lazyModule);},function(){return Promise.resolve(this["prezi_icon_insert"].lazyModule);},function(){return Promise.resolve(this["prezi_image_insert"].lazyModule);},function(){return Promise.resolve(this["prezi_layout"].lazyModule);},function(){return Promise.resolve(this["prezi_local_service_mocks"].lazyModule);},function(){return Promise.resolve(this["prezi_marker_editor"].lazyModule);},function(){return Promise.resolve(this["prezi_narrative_editor"].lazyModule);},function(){return Promise.resolve(this["prezi_path_audio"].lazyModule);},function(){return Promise.resolve(this["prezi_path_editing"].lazyModule);},function(){return Promise.resolve(this["prezi_path_generation_strategy"].lazyModule);},function(){return Promise.resolve(this["prezi_pdf_insert"].lazyModule);},function(){return Promise.resolve(this["prezi_photo_editor"].lazyModule);},function(){return Promise.resolve(this["prezi_ppt_edit"].lazyModule);},function(){return Promise.resolve(this["prezi_ppt_insert"].lazyModule);},function(){return Promise.resolve(this["prezi_prezi_video_onboarding"].lazyModule);},function(){return Promise.resolve(this["prezi_qr_code_insert"].lazyModule);},function(){return Promise.resolve(this["prezi_scheme"].lazyModule);},function(){return Promise.resolve(this["prezi_search_replace"].lazyModule);},function(){return Promise.resolve(this["prezi_select_similar"].lazyModule);},function(){return Promise.resolve(this["prezi_shape_and_arc_editor"].lazyModule);},function(){return Promise.resolve(this["prezi_snippet_editing_layout_options"].lazyModule);},function(){return Promise.resolve(this["prezi_solid_color"].lazyModule);},function(){return Promise.resolve(this["prezi_storyblocks"].lazyModule);},function(){return Promise.resolve(this["prezi_storyblocks_admin"].lazyModule);},function(){return Promise.resolve(this["prezi_syntax_highlight"].lazyModule);},function(){return Promise.resolve(this["prezi_template_from_storyblocks"].lazyModule);},function(){return Promise.resolve(this["prezi_test_propertybar"].lazyModule);},function(){return Promise.resolve(this["prezi_test_sidebar"].lazyModule);},function(){return Promise.resolve(this["prezi_text_editor"].lazyModule);},function(){return Promise.resolve(this["prezi_text_style"].lazyModule);},function(){return Promise.resolve(this["prezi_topic_grouping_onboarding"].lazyModule);},function(){return Promise.resolve(this["prezi_topic_shape"].lazyModule);},function(){return Promise.resolve(this["prezi_turn_into_topic"].lazyModule);},function(){return Promise.resolve(this["prezi_video_background"].lazyModule);},function(){return Promise.resolve(this["prezi_video_insert"].lazyModule);},function(){return Promise.resolve(this["prezi_video_template_from_figma"].lazyModule);},function(){return Promise.resolve(this["prezi_view_to_dashboard_test"].lazyModule);},function(){return Promise.resolve(this["prezi_visual_types"].lazyModule);},function(){return Promise.resolve(this["prezi_watermark"].lazyModule);},function(){return Promise.resolve(this["prezi_z_order_object"].lazyModule);});}}).call(this);