;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_select";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.geometry":dependencies[0],"prezi.text.model":dependencies[1],"prezi_app_utils":dependencies[2],"prezi_bacon":dependencies[3],"prezi_cet":dependencies[4],"prezi_cet_model":dependencies[5],"prezi_cet_model_editor":dependencies[6],"prezi_cet_renderer":dependencies[7],"prezi_editor_commander":dependencies[8],"prezi_editor_store_common":dependencies[9],"prezi_editor_store_mode":dependencies[10],"prezi_editor_store_object":dependencies[11],"prezi_featureswitcher":dependencies[12],"prezi_i18n":dependencies[13],"prezi_logger":dependencies[14],"prezi_plugin_meta":dependencies[15],"prezi_spellcheck":dependencies[16],"prezi_utils":dependencies[17],"prezi_widgets":dependencies[18]}};})());};})(arguments);var moduleImpl=(function(){return module(function(y){var ea=null,ia=y.dependencies["prezi.text.model"],ja=y.dependencies.prezi_app_utils,ka=y.dependencies.prezi_bacon,t=y.dependencies.prezi_cet_renderer,n=y.dependencies.prezi_editor_commander,w=y.dependencies.prezi_editor_store_mode,F=y.dependencies.prezi_featureswitcher,H=y.dependencies.prezi_i18n,la=y.dependencies.prezi_logger,L=y.dependencies.prezi_spellcheck,fa=y.dependencies.prezi_widgets,k=y.dependencies["prezi.geometry"],h=y.dependencies.prezi_cet,q=y.dependencies.prezi_cet_model,
r=y.dependencies.prezi_cet_model_editor,B=y.dependencies.prezi_editor_store_object,C=y.dependencies.prezi_utils,O={};Object.defineProperty(O,"__esModule",{value:!0});O.ed=class{constructor(a,b){this.bc=a;this.getScene=b}Se(a,b,c){a=[...new Set(a)];b=[...new Set(b)];const d=[...b];if(0<a.length){const b=r.CetModelEditor.createGroupQuery();for(var e of a)for(const a of b.getGroupMembers(this.getScene(),e))d.push(a.getId())}e=[...new Set(d)];this.bc.setSelection({groupIds:a,nonGroupedEntityIds:b,allEntityIds:e},
c)}wc(a,b,c){switch(c){case B.SelectActionType.replace:return b;case B.SelectActionType.add:return[...a,...b];case B.SelectActionType.remove:return a.filter((a)=>0>b.indexOf(a));case B.SelectActionType.toggle:const d=new Set(a),e=new Set(b.filter((a)=>d.has(a)));return[...a,...b].filter((a)=>!e.has(a));default:return C.Utils.assertNever(c)}}select(a){const b=void 0===a.source?null:a.source,c=this.bc.getSelectionSource()===b?a.type:a.type===B.SelectActionType.remove?B.SelectActionType.remove:B.SelectActionType.replace,
d=this.bc.getSelection();this.Se(this.wc(d.groupIds,a.selectedGroupIds,c),this.wc(d.nonGroupedEntityIds,a.selectedEntityIds,c),b)}};var u={ga:function(a){return{interactionType:p.InteractionType.none,ownerIds:a}},clickable:function(a){return{interactionType:p.InteractionType.clickable,ownerIds:[a]}},$b:function(a){return{interactionType:p.InteractionType.border,ownerIds:a}},topicZoomAreaBorder:function(a){return{interactionType:p.InteractionType.topicZoomAreaBorder,ownerIds:[a]}},controlPoint:function(a){return{interactionType:p.InteractionType.controlPoint,
ownerIds:a}},locked:function(a){return{interactionType:p.InteractionType.locked,ownerIds:a}},maskDrag:function(a){return{interactionType:p.InteractionType.maskDrag,ownerIds:[a]}},Ee:function(a){return{interactionType:p.InteractionType.controlPoint,ownerIds:[a]}}};Object.defineProperty(u,"__esModule",{value:!0});var l={};Object.defineProperty(l,"__esModule",{value:!0});const ma={Ha:0,Ga:0,Kb:0,Sc:0},I=()=>({borderColor:"#3181ff",oa:1,fillColor:"#000000",aa:0,thickness:F.isActive("js-for-test-thick-selection")?
6:1});l.j=class{constructor(a,b){this.camera=a;this.f=b;this.da=v.v.getDecoratorKey()}cb(a,b,c,d,e){if(1>c.getHeight()||1>c.getWidth())return null;const f={color:"#ffffff",borderColor:"#3181ff",opacity:.5},g=(b)=>{const {color:c,opacity:d,borderColor:g}=Object.assign(Object.assign({},f),e);h.Cet.setFillComponentWithSolidColor(b,k.Geometry.colorFromRGBString(c),d);h.Cet.setBorder(b,2,k.Geometry.colorFromRGBString(g),1);b.set(this.da,u.ga([a]));return b};return this.f.cb(b,(a,b)=>g(a,b),(a)=>{const {x:b,
y:e}=this.rotate({x:c.topLeftVertex().x-d.getCenterX(),y:c.topLeftVertex().y-d.getCenterY()},d.getRotation()),f=k.Geometry.rectangleFromData({x:b,y:e,height:c.getHeight(),width:c.getWidth()});a.set(t.CetRendererModule.getDrawingDimensionsKey(),f)},d)}bb(a,b,c,d){b=this.f.qa(b,c);return this.f.bb(l.j.qe(a),(b)=>{b.set(h.Cet.getEntityHittestDisabledKey(),!0,!0);b.set(this.da,u.ga([a]));return b},(a)=>{a.set(t.CetRendererModule.getArcComponentKey(),d)},b)}Hd(a,b,c,d){var e=t.CetRendererModule.CurvedLineCalculation(),
f=e.getStartPoint(a),g=e.getEndPoint(a),m=e.getOrigin(a),h=e.getRadius(a);const k=e.getStartAngle(a);e=e.getEndAngle(a);b*=this.f.getCameraTransform().getScale();f={x:f.x*b,y:f.y*b};g={x:g.x*b,y:g.y*b};m={x:m.x*b,y:m.y*b};h*=b;a=a.getArcHeight()*b;return{headPos:g,tailPos:f,origin:m,radius:h,startAngle:k,endAngle:e,isStraight:0===a,isInverse:0<a,color:c,thickness:F.isActive("js-for-test-thick-selection")?12:1,alpha:d}}ja(a,b,c,d,e,f=0){var g=d;const m=this.f.qa(c,d);0<f&&(g=c.getScale()*this.f.getCameraTransform().getScale(),
f/=g,g=d.inflate(f,f));c=this.f.qa(c,g);e=e?c:k.Geometry.obbFromRect(c.getBounds().getData());return 1>e.getHeight()||1>e.getWidth()?null:this.f.Pa(a,b,(a)=>{a.set(t.CetRendererModule.getDrawingDimensionsKey(),k.Geometry.rectangleFromData({x:-m.getWidth()/2,y:-m.getHeight()/2,height:m.getHeight(),width:m.getWidth()}))},e)}Fd(a,b,c){this.ja(l.j.ye(a),(b)=>{h.Cet.setZOrderComp(b,t.CetRendererModule.createZOrderComponent(0,t.LayerType.DecoratorLayer));b.setComponent(t.CetRendererModule.getDrawComponentKey(),
t.CetRendererModule.createTextHittestRectangleRenderer());h.Cet.setFillComponentWithSolidColor(b,k.Geometry.colorFromRGBString("#000000"),0);h.Cet.setBorder(b,F.isActive("js-for-test-thick-selection")?6:2,k.Geometry.colorFromRGBString("#3181ff"),1);b.set(this.da,u.$b([a]));return b},b,c,!0,6)}wa(a,b,c,d,e={}){const f=Object.assign(Object.assign({},I()),e);this.ja(l.j.Hc(a),(a)=>{h.Cet.setBorder(a,f.thickness,k.Geometry.colorFromRGBString(f.borderColor),f.oa);h.Cet.setFillComponentWithSolidColor(a,
k.Geometry.colorFromRGBString(f.fillColor),f.aa);a.set(this.da,u.$b(d));return a},b,c,!0,6)}ud(a,b,c,d){const e=Object.assign(Object.assign({},Object.assign(Object.assign({},I()),{borderColor:"#ffffff"})),{borderColor:"#747c87"});this.ja(l.j.Hc(a),(a)=>{h.Cet.setBorder(a,e.thickness,k.Geometry.colorFromRGBString(e.borderColor),e.oa);h.Cet.setFillComponentWithSolidColor(a,k.Geometry.colorFromRGBString(e.fillColor),e.aa);a.set(t.CetRendererModule.getDashedDecoratorComponentKey(),[2,2]);a.set(this.da,
u.$b(d));return a},b,c,!0,6)}oc(a,b,c,d,e={}){const f=Object.assign(Object.assign({},{borderColor:"#ffffff",oa:1,fillColor:"#000000",aa:0,thickness:1}),e);this.ja(l.j.xe(a),(a)=>{h.Cet.setFillComponentWithSolidColor(a,k.Geometry.colorFromRGBString(f.fillColor),f.aa);h.Cet.setBorder(a,f.thickness,k.Geometry.colorFromRGBString(f.borderColor),f.oa);a.set(this.da,d);return a},b,c,!0)}ka(a,b,c,d={},e={}){const {ownerIds:f,Qc:g}=Object.assign(Object.assign({},{Qc:!0,ownerIds:[c]}),d),m=Object.assign(Object.assign({},
Object.assign(Object.assign({},I()),{thickness:F.isActive("js-for-test-thick-selection")?4:1})),e);this.ja(l.j.ue(c),(a)=>{h.Cet.setFillComponentWithSolidColor(a,k.Geometry.colorFromRGBString(m.fillColor),m.aa);h.Cet.setBorder(a,m.thickness,k.Geometry.colorFromRGBString(m.borderColor),m.oa);a.set(this.da,u.ga(f));return a},a,b,g)}kc(a,b,c){this.ja(l.j.Fc(c),(a)=>{h.Cet.setBorder(a,2,k.Geometry.colorFromRGBString("#3181ff"),1);h.Cet.setFillComponentWithSolidColor(a,k.Geometry.colorFromRGBString("#000000"),
0);a.set(t.CetRendererModule.getDashedDecoratorComponentKey(),[5,5]);a.set(this.da,u.ga([c]));return a},a,b,!0)}wd(a,b,c){this.ja(l.j.Fc(c),(a)=>{h.Cet.setBorder(a,2,k.Geometry.colorFromRGBString("#3181ff"),1);h.Cet.setFillComponentWithSolidColor(a,k.Geometry.colorFromRGBString("#000000"),0);a.set(this.da,u.ga([c]));return a},a,b,!0)}eb(a,b,c,d,e){this.va(l.j.Ic(JSON.stringify(d)),d,p.ControlPointType.resize,a,e,c,u.controlPoint(b),{Ga:l.j.ab,Ha:l.j.ab})}Qa(a,b,c){const d=k.Geometry.rectangleFromData({x:-4,
y:-4,width:8,height:8});this.eb(a,c,d,n.ControlPointPosition.TOP_LEFT,b.getTopLeft());this.eb(a,c,d,n.ControlPointPosition.TOP_RIGHT,b.getTopRight());this.eb(a,c,d,n.ControlPointPosition.BOTTOM_LEFT,b.getBottomLeft());this.eb(a,c,d,n.ControlPointPosition.BOTTOM_RIGHT,b.getBottomRight())}Dd(a,b,c,d,e){b=b.getTopLeft();const f=a.getRotationDeg()+this.f.getCameraTransform().getRotationDeg();this.f.qd(l.j.we(`${c}_${d}_${f}_${e}`),k.Geometry.obbFromData(b.x,b.y,0,0,0).transform(a),d,e?"#3181ff":"#747c87")}fb(a,
b,c,d,e=!1){const f=this.f.qa(b,c);if(!(1>f.getHeight()||1>f.getWidth())){e=e?l.j.jd:0;var g=e/(this.f.getCameraTransform().getScale()*b.getScale());this.qc(n.ControlPointPosition.MIDDLE_LEFT,a,b,{x:c.getTopLeft().x-g,y:c.getTopLeft().y+c.getHeight()/2},f.getHeight(),d,-e);this.qc(n.ControlPointPosition.MIDDLE_RIGHT,a,b,{x:c.getTopRight().x+g,y:c.getTopRight().y+c.getHeight()/2},f.getHeight(),d,e)}}Ab(a,b,c,d){const e=this.f.qa(b,c);1>e.getHeight()||1>e.getWidth()||(this.lc(n.ControlPointPosition.MIDDLE_TOP,
a,b,{x:c.getTopLeft().x+c.getWidth()/2,y:c.getTopLeft().y},e.getWidth(),d),this.lc(n.ControlPointPosition.MIDDLE_BOTTOM,a,b,{x:c.getBottomLeft().x+c.getWidth()/2,y:c.getBottomLeft().y},e.getWidth(),d))}qc(a,b,c,d,e,f,g=0){this.va(l.j.ze(JSON.stringify(a)),a,b,c,d,k.Geometry.rectangleFromData({x:-3-g,y:-6,height:12,width:6}),u.controlPoint(f),{Ha:l.j.ic+2*Math.abs(g),Ga:.8*e,Sc:g})}lc(a,b,c,d,e,f){this.va(l.j.te(JSON.stringify(a)),a,b,c,d,k.Geometry.rectangleFromData({x:-6,y:-3,width:12,height:6}),
u.controlPoint(f),{Ha:.8*e,Ga:l.j.ic})}va(a,b,c,d,e,f,g,m={},l={}){const n=Object.assign(Object.assign({},Object.assign(Object.assign({},I()),{fillColor:"#ffffff",aa:1,thickness:1})),l);m=Object.assign(Object.assign({},ma),m);l=0<m.Ga?m.Ga:f.getHeight();let q=0<m.Ha?m.Ha:f.getWidth();l=k.Geometry.rectangleFromData({x:-q/2,y:-l/2,width:q,height:l});e=this.f.Mb(d,e);d=d.getRotationDeg()+this.f.getCameraTransform().getRotationDeg()+m.Kb;d=k.Geometry.obbFromData(e.x,e.y,l.getWidth()-2*Math.abs(m.Sc),
l.getHeight(),d);this.f.Pa(a,(a)=>{h.Cet.setFillComponentWithSolidColor(a,k.Geometry.colorFromRGBString(n.fillColor),n.aa);h.Cet.setBorder(a,n.thickness,k.Geometry.colorFromRGBString(n.borderColor),n.oa);a.set(this.da,g);a.set(p.SelectionModule.getControlPointKey(),{position:b,type:c});return a},(a)=>{a.set(t.CetRendererModule.getDrawingDimensionsKey(),f)},d)}zb(a,b,c,d,e,f,g){c=k.Geometry.obbFromData(c.x,c.y,e.getWidth(),e.getHeight(),d);this.f.zb(a,(a)=>{h.Cet.setFillComponentWithSolidColor(a,k.Geometry.colorFromRGBString("#000000"),
1);h.Cet.setBorder(a,f,g,1);a.set(this.da,b);return a},(a)=>{a.set(t.CetRendererModule.getDrawingDimensionsKey(),e)},c)}Cd(a,b,c,d){d?this.wa(a,b,c,[a],{aa:.01}):this.oc(a,b,c,u.clickable(a),{aa:.01});const e=k.Geometry.rectangleFromData({x:-4,y:-4,width:8,height:8}),f=d?p.ControlPointType.resizeMaskImage:p.ControlPointType.lockedMarker,g=d?{}:{borderColor:"#747c87"},m={Ga:l.j.ab,Ha:l.j.ab};[{jb:n.ControlPointPosition.TOP_LEFT,center:c.getTopLeft()},{jb:n.ControlPointPosition.TOP_RIGHT,center:c.getTopRight()},
{jb:n.ControlPointPosition.BOTTOM_LEFT,center:c.getBottomLeft()},{jb:n.ControlPointPosition.BOTTOM_RIGHT,center:c.getBottomRight()}].forEach(({jb:c,center:d})=>this.va(l.j.Ic(JSON.stringify(c)),c,f,b,d,e,u.Ee(a),m,g))}Bd(a,b,c,d,e){const f={borderColor:"#ffffff",oa:.6,aa:.01};d?(this.wa(a+"_maskarea",b,c,[a],f),e||(this.Ab(p.ControlPointType.heightResizeMaskArea,b,c,[a]),this.fb(p.ControlPointType.widthResizeMaskArea,b,c,[a]))):this.oc(a+"_maskarea",b,c,u.clickable(a),f);const g=d?(b,c,d)=>{b.set(p.SelectionModule.getDecoratorKey(),
u.controlPoint([a]));b.set(p.SelectionModule.getControlPointKey(),{position:c,type:d});return b}:(b)=>b.set(p.SelectionModule.getDecoratorKey(),u.ga([a]));d=d?{}:{borderColor:"#747c87"};this.Oa(n.ControlPointPosition.TOP_LEFT,b,c.getTopLeft(),d,(a)=>g(a,n.ControlPointPosition.TOP_LEFT,p.ControlPointType.resizeMaskArea));this.Oa(n.ControlPointPosition.TOP_RIGHT,b,c.getTopRight(),d,(a)=>g(a,n.ControlPointPosition.TOP_RIGHT,p.ControlPointType.resizeMaskArea));this.Oa(n.ControlPointPosition.BOTTOM_LEFT,
b,c.getBottomLeft(),d,(a)=>g(a,n.ControlPointPosition.BOTTOM_LEFT,p.ControlPointType.resizeMaskArea));this.Oa(n.ControlPointPosition.BOTTOM_RIGHT,b,c.getBottomRight(),d,(a)=>g(a,n.ControlPointPosition.BOTTOM_RIGHT,p.ControlPointType.resizeMaskArea))}rc(a,b,c,d){this.gb(a,n.ControlPointPosition.TOP_LEFT,b,c.getTopLeft(),d);this.gb(a,n.ControlPointPosition.TOP_RIGHT,b,c.getTopRight(),d);this.gb(a,n.ControlPointPosition.BOTTOM_LEFT,b,c.getBottomLeft(),d);this.gb(a,n.ControlPointPosition.BOTTOM_RIGHT,
b,c.getBottomRight(),d)}gb(a,b,c,d,e){this.Oa(b,c,d,{},(c)=>{c.set(p.SelectionModule.getDecoratorKey(),u.controlPoint([a]));c.set(p.SelectionModule.getControlPointKey(),{position:b,type:e?p.ControlPointType.topicZoomAreaResize:p.ControlPointType.resize});return c})}Oa(a,b,c,d,e){const f=Object.assign(Object.assign({},Object.assign(Object.assign({},I()),{fillColor:"#ffffff",aa:1,thickness:2})),d),g=f.thickness;var m=this.f.getCameraTransform().invert().concat(b.invert());d=b.getRotationDeg()+this.f.getCameraTransform().getRotationDeg();
const p=a===n.ControlPointPosition.TOP_LEFT||a===n.ControlPointPosition.BOTTOM_LEFT?1:-1,q=a===n.ControlPointPosition.TOP_LEFT||a===n.ControlPointPosition.TOP_RIGHT?1:-1,r=15*m.getScale(),t=15*m.getScale();m=g*m.getScale();b=this.f.Mb(b,{x:c.x+p*r/2-p*m,y:c.y+q*t/2-q*m});this.f.yd(l.j.Ae(n.ControlPointPosition[a]),a,(a,b)=>{h.Cet.setBorder(a,g,k.Geometry.colorFromRGBString(f.borderColor),f.oa);h.Cet.setFillComponentWithSolidColor(a,k.Geometry.colorFromRGBString(f.fillColor),f.aa);return e(a,b)},()=>
{},k.Geometry.obbFromData(b.x,b.y,20,20,d))}sc(a,b){this.f.sd(`${l.j.guid}.circle.zoom-out-area`,(a)=>{h.Cet.setFillComponentWithSolidColor(a,k.Geometry.colorFromRGBString(b),.3);a.set(p.SelectionModule.getDecoratorKey(),u.ga([]));return a},(a)=>{h.Cet.setFillComponentWithSolidColor(a,k.Geometry.colorFromRGBString(b),.3);return a},a)}static qe(a){return""+l.j.guid+".arc."+a}static ye(a){return""+l.j.guid+".text-hittest-border."+a}static Ze(a){return""+l.j.guid+".outline-decorator."+a}static Hc(a){return""+
l.j.guid+".border."+a}static xe(a){return""+l.j.guid+".secondary-border."+a}static ue(a){return""+l.j.guid+".hover-border."+a}static Fc(a){return""+l.j.guid+".cover-edited-topic-border."+a}static We(a){return""+l.j.guid+".dragged-item-hovered-topic-border."+a}static Ve(){return""+l.j.guid+".topic-area-overlay"}static Jc(a){return""+l.j.guid+".topic-zoom-area."+a}static Ic(a){return""+l.j.guid+".control-resize-point."+a}static Xe(a){return""+l.j.guid+".locked-decorator."+a}static se(a){return""+l.j.guid+
".chain-topic-decorator."+a}static re(a){return""+l.j.guid+".chain-link-decorator."+a}static Ae(a){return""+l.j.guid+".control-resize-point.zoom-area."+a}static ze(a){return""+l.j.guid+".control-widthresize-point."+a}static te(a){return""+l.j.guid+".control-heightresize-point."+a}static Gc(a){return""+l.j.guid+".control-linemanipulation-point."+a}static ve(a){return""+l.j.guid+".control-linemanipulation-point.middle."+a}static Ye(a){return""+l.j.guid+".control-orderindicator-point."+a}static we(a){return""+
l.j.guid+".control-orderindicator-label."+a}rotate(a,b){return{x:a.x*Math.cos(b)+a.y*Math.sin(b),y:-1*a.x*Math.sin(b)+a.y*Math.cos(b)}}Je(a,b){let c=a.getPrezi().getChild(q.CetModel.ID.PREZI.OVERVIEW);return b.filter((d)=>{var e=a.getEntityById(d);d=h.Cet.createHierarchyQuery(a);for(e=d.getParentId(e);e!==c.getId()&&null!=e;){if(-1!==b.indexOf(e))return!1;e=d.getParentId(a.getEntityById(e))}return!0})}};l.j.guid="Decorator";l.j.ab=22;l.j.ic=12;l.j.jd=2;var J={};Object.defineProperty(J,"__esModule",
{value:!0});const na=Math.pow(2,-30);J.$e=()=>({color:"#ffffff",bgColor:"#2c86fb",$a:!1,Ta:!1,Ob:null,offsetX:0,offsetY:-8,fontSize:11,Tc:0,fontFamily:"RalewayMedium"});J.fc=class{constructor(a,b){this.camera=a;this.u=b;this.ma=[]}Jb(){this.ma=[]}Ca(){return this.ma}rd(a,b,c,d,e){if(null!=this.u){const m=a+"canvas-button-container",h=this.u.createElement(m);h.style.display="inline-flex";var f=a+"canvas-button-with-chevron";let k=document.getElementById(f);if(null==k){k=document.createElement("div");
k.id=f;k.style.transform="translate(-50%, -100%)";k.style.display="inline-flex";k.style.flexDirection="column";k.style.alignItems="center";k.style.opacity="0.8";f=this.u.createElement(a+"canvas-button-decorator");f.style.display="inline-flex";f.style.alignItems="center";f.style.height="32px";f.style.borderRadius="6px";f.style.backgroundColor="#152235";f.style.padding="4px";f.style.boxSizing="border-box";var g=a+"canvas-button";const c=document.createElement("div");c.id=g;c.style.display="inline-flex";
c.style.alignItems="center";c.style.height="24px";c.style.borderRadius="4px";c.style.borderColor="#ffffff";c.style.borderStyle="solid";c.style.borderWidth="thin";c.style.backgroundColor="rgba(255, 255, 255, 0)";c.onmouseenter=()=>c.style.backgroundColor="rgba(255, 255, 255, 0.1)";c.onmouseleave=()=>c.style.backgroundColor="rgba(255, 255, 255, 0)";c.onmousedown=b;c.style.cursor="pointer";b=document.createAttribute("data-lookup");b.value=p.Lookup.zoomInButton;c.attributes.setNamedItem(b);b=this.kb(a+
"canvas-button-content-wrapper","12px");null!=e&&(g=document.createElement("span"),g.className=e,g.style.color="#ffffff",b.appendChild(g));a=this.createText(a+"canvas-label-text",d,"#ffffff","RalewaySemiBOld");b.appendChild(a);c.appendChild(b);f.appendChild(c);k.appendChild(f);h.appendChild(k)}c=c.transform(this.camera.getTransform());c=this.qb(c,this.camera.getMarginCorrectedViewport());this.u.transformScreen(m,{x:c.x,y:-8+c.y},0);this.ma.push(h)}}Ad(a,b,c){if(null!=this.u){const d=a+"canvas-icon-container",
e=this.u.createElement(d);e.style.display="inline-flex";a+="canvas-icon";let f=document.getElementById(a);null==f?(b=document.createElement("img"),b.id=a,b.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzQiIGhlaWdodD0iMzQiIHZpZXdCb3g9IjAgMCAzNCAzNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMSIgeT0iMSIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iMTYiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjQuNzA0MyAxMi41NTQ1QzI1LjA5NDggMTIuMTY0IDI1LjA5NDggMTEuNTMwOCAyNC43MDQzIDExLjE0MDNMMjIuODU5OSA5LjI5NTk0QzIyLjQ2OTQgOC45MDU0MiAyMS44MzYyIDguOTA1NDIgMjEuNDQ1NyA5LjI5NTk1TDExLjIxODYgMTkuNTIzTDE0LjQ3NzIgMjIuNzgxNkwyNC43MDQzIDEyLjU1NDVaTTEzLjA3MzMgMjQuMTg1M0w5IDI1TDkuODE0NjYgMjAuOTI2OEwxMy4wNzMzIDI0LjE4NTNaIiBmaWxsPSJibGFjayIvPgo8ZyBmaWx0ZXI9InVybCgjZmlsdGVyMF9iKSI+CjxyZWN0IHg9IjEiIHk9IjEiIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgcng9IjE2IiBmaWxsPSJibGFjayIgZmlsbC1vcGFjaXR5PSIwLjgiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0yNC43MDQzIDEyLjU1NDVDMjUuMDk0OCAxMi4xNjQgMjUuMDk0OCAxMS41MzA4IDI0LjcwNDMgMTEuMTQwM0wyMi44NTk5IDkuMjk1OTRDMjIuNDY5NCA4LjkwNTQyIDIxLjgzNjIgOC45MDU0MiAyMS40NDU3IDkuMjk1OTVMMTEuMjE4NiAxOS41MjNMMTQuNDc3MiAyMi43ODE2TDI0LjcwNDMgMTIuNTU0NVpNMTMuMDczMyAyNC4xODUzTDkgMjVMOS44MTQ2NiAyMC45MjY4TDEzLjA3MzMgMjQuMTg1M1oiIGZpbGw9IndoaXRlIi8+CjwvZz4KPHJlY3QgeD0iMC41IiB5PSIwLjUiIHdpZHRoPSIzMyIgaGVpZ2h0PSIzMyIgcng9IjE2LjUiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS1vcGFjaXR5PSIwLjA4Ii8+CjxkZWZzPgo8ZmlsdGVyIGlkPSJmaWx0ZXIwX2IiIHg9Ii0zOSIgeT0iLTM5IiB3aWR0aD0iMTEyIiBoZWlnaHQ9IjExMiIgZmlsdGVyVW5pdHM9InVzZXJTcGFjZU9uVXNlIiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnM9InNSR0IiPgo8ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPgo8ZmVHYXVzc2lhbkJsdXIgaW49IkJhY2tncm91bmRJbWFnZSIgc3RkRGV2aWF0aW9uPSIyMCIvPgo8ZmVDb21wb3NpdGUgaW4yPSJTb3VyY2VBbHBoYSIgb3BlcmF0b3I9ImluIiByZXN1bHQ9ImVmZmVjdDFfYmFja2dyb3VuZEJsdXIiLz4KPGZlQmxlbmQgbW9kZT0ibm9ybWFsIiBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJlZmZlY3QxX2JhY2tncm91bmRCbHVyIiByZXN1bHQ9InNoYXBlIi8+CjwvZmlsdGVyPgo8L2RlZnM+Cjwvc3ZnPgo=",
b.style.height=c.getHeight()+"px",b.style.width=c.getWidth()+"px",b.style.transform="translate(-50%, -50%)",b.style.animationName="fadeIn",b.style.animationDuration="0.3s",b.style.webkitAnimationName="fadeIn",b.style.webkitAnimationDuration="0.3s",b.className="canvas-icon",e.appendChild(b),e.style.pointerEvents="none"):f.style.opacity=b?"0.8":"1";b=c.getCenterX();a=c.getCenterY();b={x:b,y:a};c=c.getRotationRadians();this.u.transformScreen(d,b,c);e.className="icon-decorator";this.ma.push(e)}}qd(a,
b,c,d){if(null!=this.u){var e=a+"canvas-path-element-label-container",f=this.u.createElement(e);f.style.display="inline-flex";f.style.zIndex="1";var g=a+"canvas-button-with-chevron";if(null==document.getElementById(g)){const b=document.createElement("div");b.id=g;b.style.display="inline-flex";b.style.height="22px";b.style.borderRadius="11px";b.style.backgroundColor=d;b.style.minWidth="22px";b.style.justifyContent="center";b.style.alignItems="center";b.className="gadgetFadeOnHover";a=this.createText(a+
"canvas-label-text",c,"#ffffff","RalewayBold","12px");a.style.marginLeft="4px";a.style.marginRight="4px";b.appendChild(a);f.appendChild(b)}b=b.transform(this.camera.getTransform());b=this.qb(b,this.camera.getMarginCorrectedViewport());this.u.transformScreen(e,{x:b.x-11,y:b.y-11},0);this.ma.push(f)}}Bb(a,b,c,d){var e=Object.assign(Object.assign({},{color:"#ffffff",bgColor:"#2c86fb",$a:!1,Ta:!1,Ob:null,offsetX:0,offsetY:-8,fontSize:11,Tc:0,fontFamily:"RalewayMedium"}),d);if(null!=this.u){d=a+"canvas-label-container";
var f=a+"canvas-label-content-wrapper";const m=this.u.createElement(d);m.style.display="inline-flex";b=b.transform(this.camera.getTransform());m.style.height="18px";e.$a&&(m.style.zIndex="1");var g=document.getElementById(f);null==g&&(g=this.kb(f,"18px"),g.style.backgroundColor=e.bgColor,g.style.borderRadius="3px",g.style.transform="translate(-50%, -100%)",e.$a&&(g.style.animationName="fadeOut",g.style.animationDuration="0.2s",g.style.animationDelay="3s",g.style.animationFillMode="forwards"),null!=
e.Ob&&(f=document.createElement("img"),f.src="data:image/svg+xml;charset=utf-8,"+e.Ob,f.style.height="12px",g.appendChild(f)),a=this.createText(a+"canvas-label-text",c,e.color,e.fontFamily,`${e.fontSize}px`),a.style.transform=`rotate(${e.Tc}deg)`,g.appendChild(a),m.appendChild(g));a=e.offsetX;c=e.offsetY;g=e.Ta?this.qb(b,this.camera.getMarginCorrectedViewport()):{x:(b.topLeftVertex().x+b.topRightVertex().x)/2,y:(b.topLeftVertex().y+b.topRightVertex().y)/2};a={x:a+g.x,y:c+g.y};e=e.Ta?0:b.getRotationRadians();
this.u.transformScreen(d,a,e);this.ma.push(m)}}Gd(a,b=-8){if(null!=this.u){var c=this.camera.getMarginCorrectedStageArea(),d=c.getCenter().x,e=c.getTop();c=this.u.createElement("universeLimitWarningcanvas-label-container");c.style.display="flex";d=k.Geometry.obbFromData(d,e+47,0,0,0);c.style.height="32px";c.style.padding="8px";e=document.getElementById("universeLimitWarningcanvas-label-content-wrapper");if(null==e){e=this.kb("universeLimitWarningcanvas-label-content-wrapper","32px");e.style.backgroundColor=
"#222222";e.style.borderRadius="4px";e.style.transform="translate(-50%, -100%)";const b=document.createElement("i");b.className=`${fa.IconSmallId.InfoWithCircle}`;b.style.height="16px";b.style.color="#ffffff";b.style.fontFamily="RalewaySemiBold";b.style.lineHeight="16px";e.appendChild(b);a=this.createText("universeLimitWarningcanvas-label-text",a,"#ffffff","RalewayMedium","12px");a.style.fontWeight="600";a.style.lineHeight="16px";e.appendChild(a);c.appendChild(e)}a=this.qb(d,this.camera.getMarginCorrectedStageArea());
this.u.transformScreen("universeLimitWarningcanvas-label-container",{x:a.x,y:b+a.y},0);this.ma.push(c)}}vd(a,b){var c=["growBlink"];if(null!=this.u){const e=a+"canvas-circle-container",f=a+"canvas-circle-content-wrapper";a=this.u.createElement(e);a.style.display="inline-flex";a.style.width="700px";a.style.height="700px";a.style.zIndex="100";var d=document.getElementById(f);null==d&&(d=this.kb(f,"700px"),d.style.borderRadius="0px",d.style.transform="translate(-50%, 0%)",d.style.width="700px",d.style.height=
"700px",d.classList.add(...c),c=document.createElement("img"),c.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='100' width='100'%3E%3Ccircle cx='50' cy='50' r='40' fill='white'/%3E%3C/svg%3E",c.style.width="700px",c.style.height="700px",d.appendChild(c),a.appendChild(d));c=(b.topLeftVertex().x+b.topRightVertex().x)/2;d=(b.topLeftVertex().y+b.topRightVertex().y)/2;c={x:c,y:d};b=b.getRotationRadians();this.u.transformScreen(e,c,b);this.ma.push(a)}}td(a,b,c,d,e){if(null!=this.u){var f=
this.u.getElement("canvas-custom-starting-point-decorator-container"),g=this.u.getElement("canvas-custom-starting-point-decorator");null==f&&(f=this.u.createElement("canvas-custom-starting-point-decorator-container"),f.style.display="inline-flex",g=this.u.createElement("canvas-custom-starting-point-decorator"),g.style.display="initial",g.setAttribute("data-starting-point-id",a),g.setAttribute("data-position",d),g.style.width="24px",g.style.height="24px",g.style.borderRadius="50%",g.style.backgroundColor=
"#3181ff",g.style.boxShadow="0 3px 6px 0 rgba(21, 34, 53, 0.5)",g.style.border="solid 2px #ffffff",g.style.position="relative",g.style.left="-15px",g.style.top="10px",g.style.cursor="pointer",g.style.backgroundPositionX="2px",g.style.backgroundPositionY="2px",g.style.boxSizing="border-box",f.appendChild(g));g.getAttribute("data-kind")!==d&&(g.style.backgroundImage="onParent"===d?"url(\"data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M5.5 8C5.5 8.82843 4.82843 9.5 4 9.5C3.17157 9.5 2.5 8.82843 2.5 8C2.5 7.17157 3.17157 6.5 4 6.5C4.82843 6.5 5.5 7.17157 5.5 8ZM9.5 8C9.5 8.82843 8.82843 9.5 8 9.5C7.17157 9.5 6.5 8.82843 6.5 8C6.5 7.17157 7.17157 6.5 8 6.5C8.82843 6.5 9.5 7.17157 9.5 8ZM12 9.5C12.8284 9.5 13.5 8.82843 13.5 8C13.5 7.17157 12.8284 6.5 12 6.5C11.1716 6.5 10.5 7.17157 10.5 8C10.5 8.82843 11.1716 9.5 12 9.5Z' fill='white'/%3E%3C/svg%3E%0A\")":
"url(\"data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M8 2.66669C5.66667 2.66669 4 4.55558 4 6.66669C4 9.55557 8 14 8 14C8 14 12 9.55558 12 6.66669C12 4.55558 10.3333 2.66669 8 2.66669ZM8 8C8.82843 8 9.5 7.32843 9.5 6.5C9.5 5.67157 8.82843 5 8 5C7.17157 5 6.5 5.67157 6.5 6.5C6.5 7.32843 7.17157 8 8 8Z' fill='white'/%3E%3C/svg%3E%0A\")",g.setAttribute("data-kind",d));g.onclick=
c;"onCurrentTopic"===d?(b=this.camera.getMarginCorrectedStageArea(),g=b.getRight()+-90,b=b.getTop()+20,this.u.transformScreen("canvas-custom-starting-point-decorator-container",{x:g,y:b},0)):(a=e||a,b=r.CetModelEditor.createScreenBoundsCalculator(b,this.camera).getWorldBoundsForLayout(a,r.TextBoundsOptions.Visible).getObb().transform(this.camera.getTransform()),a=b.getRotationRadians(),0!==a&&(g.style.transform=`rotate(${-a}rad)`),this.u.transformScreen("canvas-custom-starting-point-decorator-container",
b.topRightVertex(),a));this.ma.push(f)}}qb(a,b){let c=null;var d=k.Geometry.obbFromRect(b.getData());b=[];const e=a.getVertices();for(let a=0;4>a;a++){var f=(a+1)%4;let c=[];d.containsPoint(e[a])&&c.push(e[a]);d.containsPoint(e[f])&&c.push(e[f]);f=k.Geometry.intersection().boundingBoxIntersectionWithLine(d,e[a],e[f],!0);c=c.concat(f);2===c.length&&(f=k.Geometry.distance(c[0],c[1]),f<na||b.push({Ka:c[0],ra:c[1],hb:Math.asin(Math.abs(c[0].y-c[1].y)/f)}))}if(3<=Number(d.containsPoint(e[0]))+Number(d.containsPoint(e[1]))+
Number(d.containsPoint(e[2]))+Number(d.containsPoint(e[3]))&&0<b.length)b.sort((a,b)=>a.hb<b.hb-.01?-1:b.hb<a.hb-.01?1:a.Ka.y/2+a.ra.y/2<=a.ra.y/2+b.ra.y/2?-1:1),c={x:b[0].Ka.x/2+b[0].ra.x/2,y:b[0].Ka.y/2+b[0].ra.y/2};else{d=0;for(let a of b)b=k.Geometry.distance(a.Ka,a.ra),b>d&&(d=b,c={x:a.Ka.x/2+a.ra.x/2,y:a.Ka.y/2+a.ra.y/2})}null==c&&(c={x:a.topLeftVertex().x/2+a.topRightVertex().x/2,y:a.topLeftVertex().y/2+a.topRightVertex().y/2});return c}createText(a,b,c,d,e="11px"){const f=document.createElement("span");
f.id=a;f.innerText=b;f.style.marginLeft="3px";f.style.fontSize=e;f.style.fontWeight="500";f.style.fontStyle="normal";f.style.fontStretch="normal";f.style.lineHeight="1.09";f.style.letterSpacing="0.5px";f.style.color=c;f.style.fontFamily=d;f.style.whiteSpace="nowrap";f.style.textOverflow="ellipsis";f.style.overflow="hidden";return f}kb(a,b){const c=document.createElement("div");c.id=a;c.style.height=b;c.style.display="inline-flex";c.style.alignItems="center";c.style.paddingLeft="6px";c.style.paddingRight=
"6px";c.style.backfaceVisibility="hidden";return c}};var D={};Object.defineProperty(D,"__esModule",{value:!0});const ha=Math.pow(2,-30);D.ta=class extends J.fc{constructor(a,b,c){super(a,b);this.Ue=c;this.la=[]}update(a,b){super.Jb();this.scene=a;this.version=b;this.Ce=this.camera.getTransform().invert();this.la=[]}Ca(){return super.Ca()}Mb(a,b){return this.camera.getTransform().transformPoint(a.transformPoint(b))}getCamera(){return this.camera}xd(a,b,c){this.sa(a.getId()+"clone"+a.getWrapper(q.CetModel.ID.MEDIA_ASSET.W).getOnlineAssetId(),
(c,e)=>{var d=t.CetRendererModule.createImageDrawComponent();c.setComponent(t.CetRendererModule.getDrawComponentKey(),d);d=a.getWrapper(q.CetModel.ID.TRANSFORMED_IMAGE.W);var g=c.getMutableWrapper(q.CetModel.ID.TRANSFORMED_IMAGE.W);c.set(q.CetModel.DEF(),q.CetModel.ID.Z_IMAGE);g.setMask(null);g.setHeight(d.getHeight());g.setWidth(d.getWidth());g.setImageScaleX(d.getImageScaleX());g.setImageScaleY(d.getImageScaleY());g.setIsFlipped(d.getIsFlipped());d=a.getWrapper(q.CetModel.ID.MEDIA_ASSET.W);g=c.getMutableWrapper(q.CetModel.ID.MEDIA_ASSET.W);
g.setAssetSourceFilename(d.getAssetSourceFilename());g.setOfflineAssetId(d.getOfflineAssetId());g.setOnlineAssetId(d.getOnlineAssetId());g.setOnlineAssetUrl(d.getOnlineAssetUrl());c.set(h.Cet.getDisableSpinnerKey(),!0);b(c,e);return c},(b)=>{const d=a.getWrapper(q.CetModel.ID.TRANSFORMED_IMAGE.W),f=b.getMutableWrapper(q.CetModel.ID.TRANSFORMED_IMAGE.W);f.setHeight(d.getHeight());f.setWidth(d.getWidth());b=b.getMutableWrapper(q.CetModel.ID.RECTANGULAR.W);b.setWidth(c.getWidth());b.setHeight(c.getHeight())},
c)}cb(a,b,c,d){return this.sa(a,(a,c)=>{a.setComponent(t.CetRendererModule.getDrawComponentKey(),t.CetRendererModule.createHollowRectangleRenderer());return b(a,c)},(a,b)=>{let e=a.getMutableWrapper(q.CetModel.ID.RECTANGULAR.W);e.setWidth(d.getWidth());e.setHeight(d.getHeight());c(a,b)},d)}Pa(a,b,c,d,e=!1){return this.sa(a,(a,c)=>{a.setComponent(t.CetRendererModule.getDrawComponentKey(),t.CetRendererModule.createRectangleRenderer());return b(a,c)},(a,b)=>{let e=a.getMutableWrapper(q.CetModel.ID.RECTANGULAR.W);
e.setWidth(d.getWidth());e.setHeight(d.getHeight());c(a,b)},d,e)}zb(a,b,c,d){this.sa(a,(a,c)=>{a.setComponent(t.CetRendererModule.getDrawComponentKey(),t.CetRendererModule.createAxRenderer());return b(a,c)},(a,b)=>{let e=a.getMutableWrapper(q.CetModel.ID.RECTANGULAR.W);e.setWidth(d.getWidth());e.setHeight(d.getHeight());c(a,b)},d)}bb(a,b,c,d){return this.sa(a,(a,c)=>{a.setComponent(t.CetRendererModule.getDrawComponentKey(),t.CetRendererModule.createArcRenderer());return b(a,c)},(a,b)=>{let e=a.getMutableWrapper(q.CetModel.ID.RECTANGULAR.W);
e.setWidth(d.getWidth());e.setHeight(d.getHeight());c(a,b)},d)}sd(a,b,c,d){this.sa(a,(a,c)=>{a.setComponent(t.CetRendererModule.getDrawComponentKey(),t.CetRendererModule.createCircleRenderer());return b(a,c)},(a,b)=>{let e=a.getMutableWrapper(q.CetModel.ID.RECTANGULAR.W);e.setWidth(d.getWidth());e.setHeight(d.getHeight());c(a,b)},d)}yd(a,b,c,d,e){var f={height:15,width:15};this.sa(a,(a,d)=>{a.setComponent(t.CetRendererModule.getDrawComponentKey(),t.CetRendererModule.createLShapeRenderer(this.Md(b),
f));return c(a,d)},(a,b)=>{let c=a.getMutableWrapper(q.CetModel.ID.RECTANGULAR.W);c.setWidth(e.getWidth());c.setHeight(e.getHeight());d(a,b)},e)}Ed(a,b,c,d,e){const f=k.Geometry.fromPoint({x:(d.x+e.x)/2,y:(d.y+e.y)/2}),g=f.clone().sub(k.Geometry.fromPoint(d)).length();d=Math.atan2(e.y-d.y,e.x-d.x);const m=k.Geometry.obbFromData(f.getX(),f.getY(),2*(g+40),1,360*d/(2*Math.PI));this.sa(a,(a,c)=>{a.setComponent(t.CetRendererModule.getDrawComponentKey(),t.CetRendererModule.createRectangleRenderer());return b(a,
c)},(a,b)=>{let d=a.getMutableWrapper(q.CetModel.ID.RECTANGULAR.W);d.setWidth(m.getWidth());d.setHeight(m.getHeight());c(a,b)},m)}qa(a,b){return k.Geometry.obbFromRect(b.getData()).transform(a).transform(this.camera.getTransform())}getCameraTransform(){return this.camera.getTransform()}Nd(a,b){a=a.getEntityList().createEntity(b);a.set(h.Cet.getDefComponentKey(),q.CetModel.ID.Z_OBJECT);a.set(h.Cet.getDecoratorComponentKey(),!0);h.Cet.setTransformComp(a,k.Geometry.transform2dIdentity());h.Cet.setGrouping(a,
"NotGroup");h.Cet.setVisibility(a,!0,1);h.Cet.setZOrderComp(a,t.CetRendererModule.createZOrderComponent(this.la.length+this.Ue,t.LayerType.DecoratorLayer));return a}sa(a,b,c,d,e=!1){e=e?a:a+"."+this.version;this.la.push(e);a=this.scene.getEntityById(e);null==a&&(a=this.Nd(this.scene,e),b(a,this.scene));c(a,this.scene);b=h.Cet.draw(a).calculateGraphicsBounds(a);h.Cet.updateTransform(a).setLocalToWorld(r.CetModelEditor.createLayoutEditor().localToWorldCompute(this.Ce,b,d));d=a.get(p.SelectionModule.getDecoratorKey());
if(null==d||d.interactionType===p.InteractionType.controlPoint&&null==a.get(p.SelectionModule.getControlPointKey()))throw Error("Decorator component of entity is not set: "+a.getId());return a.getId()}sign(a){return a>ha?1:a<-ha?-1:0}Md(a){switch(a){case n.ControlPointPosition.TOP_LEFT:return t.LShapeOrientation.TOP_LEFT;case n.ControlPointPosition.TOP_RIGHT:return t.LShapeOrientation.TOP_RIGHT;case n.ControlPointPosition.BOTTOM_LEFT:return t.LShapeOrientation.BOTTOM_LEFT;case n.ControlPointPosition.BOTTOM_RIGHT:return t.LShapeOrientation.BOTTOM_RIGHT;
default:throw"Invalid position";}}};var P={};Object.defineProperty(P,"__esModule",{value:!0});P.Yc=class{constructor(a,b,c,d,e,f){this.Gb=c;this.Fe=d;this.Oe=e;this.o=f;this.f=new J.fc(b,a)}init(a){this.Ua=r.CetModelEditor.createEditorPathQuery(a);this.wb=r.CetModelEditor.createTopicQuery(a);this.ne=h.Cet.createHierarchyQuery(a);this.Xa({currentTopicId:null,sb:!1});a.getSceneHierarchy().getRootScene().getImmediateChangeStream(null).onValue(()=>{null!=this.state.za&&this.Xa({})});this.Gb.onValue((a)=>
{a=null!==a&&void 0!==a?a:this.wb.getRootTopic();this.state.currentTopicId!==a&&this.Xa({currentTopicId:a})});this.Fe.onValue((a)=>{a=a.kind===ja.EditorMode.edit;this.state.sb!==a&&(this.Xa({sb:a}),a||this.ac())});this.rb=!0}Xa(a){this.state=Object.assign(Object.assign(Object.assign({},this.state),a),{za:null});this.o.markViewChanged()}update(a){var b,c;if(this.rb&&this.state.sb){if(null==this.state.za){var d=null;if(null!=(null===(c=null===(b=a.getPreziW())||void 0===b?void 0:b.getPathStartPointToken())||
void 0===c?void 0:c.getId())&&(b=this.Ua.hasCustomStartPoint()?this.Ua.getStartPoint():null,null!=b)){var {stepId:e,actionId:f}=this.Ua.pathPositionToIds(b);d=null!=f?this.Ua.getTargetEntitiesForActionById(f).allIds[0]:this.Ua.getStepTargetId(e)}if(null==d)d={La:d,Aa:"none",parentId:null};else if(null==this.state.currentTopicId||this.wb.getTopicKind(this.state.currentTopicId)===r.TopicKind.Page)d={La:d,Aa:"none",parentId:null};else if(d===this.state.currentTopicId)d={La:d,Aa:"onCurrentTopic",parentId:null};
else if(-1<this.wb.getReachableEntities(this.state.currentTopicId).indexOf(d))d={La:d,Aa:"onEntity",parentId:null};else{const a=this.ne.getAncestorEntities(d);b=this.wb.getChildTopics(this.state.currentTopicId).find((b)=>-1<a.indexOf(b));d=null!=b?{La:d,Aa:"onParent",parentId:b}:{La:d,Aa:"none",parentId:null}}this.state=Object.assign(Object.assign({},this.state),{za:d})}"none"===this.state.za.Aa?this.ac():(this.f.Jb(),this.f.td(this.state.za.La,a,this.Oe,this.state.za.Aa,this.state.za.parentId))}}getName(){return"CustomStartingPointSystem"}reset(){this.Xa({currentTopicId:null,
sb:!1});this.ac()}ac(){0<this.f.Ca().length&&(this.f.Ca().forEach((a)=>{null!=a.parentNode&&a.parentNode.removeChild(a)}),this.f.Jb())}changesPdomComponents(){return!1}};var Q={};Object.defineProperty(Q,"__esModule",{value:!0});Q.Vc=class{constructor(a){this.Za=null;this.o=a;this.uc=ka.Bacon.newBus();this.uc.onValue((a)=>{null!=this.o&&this.o.markViewChanged();this.Za=a})}addAreaSelectionStream(a){this.uc.plug(a)}decorate(a){return null==this.Za||0===this.Za.getWidth()||0===this.Za.getHeight()?null:
a.Pa("prezi_selection.AreaHighlightDecorator.highlight",(a)=>{h.Cet.setBorder(a,.5,k.Geometry.colorFromRGBString("#000000"),1);h.Cet.setFillComponentWithSolidColor(a,k.Geometry.colorFromRGBString("#ffffff"),.3);a.set(p.SelectionModule.getDecoratorKey(),u.ga([]));return a},()=>{},k.Geometry.obbFromRect(this.Za.getData()))}};var R={};Object.defineProperty(R,"__esModule",{value:!0});R.Wc=class{constructor(a,b,c){this.camera=a;this.f=b;this.Ba=c}fa(a,b,c,d,e){this.Ba.fa(a,b,c,d,e);h.Cet.createTopicChildrenQuery(a).isVisibleOutsideAndInside(b)&&
(c=a.getEntityById(b),d=r.CetModelEditor.createScreenBoundsCalculator(a,this.camera),a=h.Cet.transform(c).getLocalToWorld(),c=d.getLocalBoundsForHittest(c),a=k.Geometry.obbFromRect(c.getData()).transform(a),c=H.I18n.ts("Visible inside and outside",{context:"on-canvas information label about a topic visual when editing it inside a topic"}),this.f.Bb(b,a,c,{$a:!0,Ta:!0}))}ha(a,b,c,d){this.Ba.ha(a,b,c,d)}};var S={};Object.defineProperty(S,"__esModule",{value:!0});S.Xc=class{constructor(a,b){this.f=a;
this.Ba=b}fa(a,b,c,d,e){var f=a.getEntityById(b);const g=h.Cet.transform(f).getLocalToWorld();f=h.Cet.localBounds(f).getGraphicsBounds();this.Ba.fa(a,b,c,d,e);h.Cet.createTopicChildrenQuery(a).isVisibleOutsideAndInside(b)&&(a=k.Geometry.obbFromRect(f.getData()).transform(g),c=H.I18n.ts("Visible inside and outside",{context:"on-canvas information label about a topic visual when editing it on the topic cover"}),this.f.Bb(b,a,c,{$a:!0,Ta:!0}))}ha(a,b,c,d){this.Ba.ha(a,b,c,d)}};var T={};Object.defineProperty(T,
"__esModule",{value:!0});T.Zc=class{constructor(a,b,c,d,e,f,g,m,h,k){this.camera=a;this.f=b;this.Ma=c;this.tb=d;this.Fa=e;this.ec=f;this.Be=g;this.cc=m;this.Qb=h;this.Ia=k}Ba(a){switch(a.getDef()){case q.CetModel.ID.Z_TEXT:return this.Ma;case q.CetModel.ID.Z_LINE:return this.tb;case q.CetModel.ID.Z_ARROW:return this.tb;case q.CetModel.ID.Z_TOPIC_CONTAINER:return this.Fa;case q.CetModel.ID.Z_ZOOM_AREA:return this.ec;case q.CetModel.ID.Z_IMAGE:return this.Be;case q.CetModel.ID.Z_SHAPE:return this.cc;
case q.CetModel.ID.LOGO:case q.CetModel.ID.NEXT_LOGO_V1:return this.Qb;default:return this.Ia}}Dc(a,b,c,d){const e=b.getEntityById(a);a=r.CetModelEditor.createTopicQuery(b).getTopicKind(a);const f=this.Ba(e);b=h.Cet.createHierarchyQuery(b).getParentId(e);return a===r.TopicKind.Planet||a===r.TopicKind.Stack?this.Fa:null!=c&&b===c.topicId||1===d.length&&b===d[0]?new S.Xc(this.f,f):new R.Wc(this.camera,this.f,f)}};var M={};Object.defineProperty(M,"__esModule",{value:!0});M.gc=class{constructor(a,b){this.camera=
a;this.i=b;this.Wa=r.CetModelEditor.createGroupQuery()}Ec(a,b){var c=a.getPreziW().getEntity().get(n.EditorCommander.getMultiselectDecoratorComponentKey());if(null!=c)return a=r.CetModelEditor.createReferenceFrame(this.camera.getTransform().invert()),a=c.withReferenceFrame(a),c=a.size,a=k.Geometry.transform2dFromRad(a.center,1,a.rotationRad).concat(this.camera.getTransform().invert()),c=k.Geometry.rectangleFromData({x:-c.width/2,y:-c.height/2,width:c.width,height:c.height}),{Da:a,localBounds:c};c=
r.CetModelEditor.createScreenBoundsCalculator(a,this.camera).getScreenAABBForEntities(b,{topic:r.TopicBoundsOptions.layout});return{Da:this.camera.getTransform().invert(),localBounds:c}}pb(a,b){const {Da:c,localBounds:d}=this.Ec(a,b);this.i.wa("multiselect",c,d,b);this.i.Qa(c,d,b)}nc(a,b,c){b=this.Wa.getGroupMembers(a,b).map((a)=>a.getId());var {Da:d,localBounds:e}=this.Ec(a,b);this.i.ka(d,e,c,{Qc:!0,ownerIds:b})}Rd(a,b){this.nc(a,b,"groupedit")}pe(a,b){this.nc(a,b,`grouphover-${b}`)}fa(a,b){var c=
a.getEntityById(b);a=h.Cet.transform(c).getLocalToWorld();c=h.Cet.localBounds(c).getGraphicsBounds();this.i.wa(b,a,c,[b]);this.i.Qa(a,c,[b])}ha(a,b){var c=a.getEntityById(b);a=h.Cet.transform(c).getLocalToWorld();c=h.Cet.localBounds(c).getGraphicsBounds();this.i.ka(a,c,b)}};var U={};Object.defineProperty(U,"__esModule",{value:!0});U.ad=class extends M.gc{constructor(a,b,c){super(a,b);this.Va=c}fa(a,b,c,d){if(d.kind===w.MaskingModeKind.on){var e=a.getEntityById(b);a=h.Cet.transform(e).getLocalToWorld();
var f=h.Cet.world(e).getWorldBounds();c=h.Cet.localBounds(e).getGraphicsBounds();var g=e.getWrapper(q.CetModel.ID.Z_IMAGE.W),m=h.Cet.getMask_Killme(g);m={x:-m.getWidth()/2-m.getTopLeft().x,y:-m.getHeight()/2-m.getTopLeft().y,width:g.getWidth(),height:g.getHeight()};g=k.Geometry.obbFromRect(m).transform(a).transform(this.camera.getTransform());f=f.transform(this.camera.getTransform());this.Va.xd(e,(a)=>{a.set(p.SelectionModule.getDecoratorKey(),u.maskDrag(b));return a},g);e=k.Geometry.rectangleFromData(m);
this.i.cb(b,b+d.maskedImageId,f,g,{color:"#ffffff",opacity:.3});this.i.Cd(b,a,e,d.target===w.MaskEditTarget.image);this.i.Bd(b,a,c,d.target===w.MaskEditTarget.mask,d.isFixedAspect)}else super.fa(a,b,c,d)}};var N={};Object.defineProperty(N,"__esModule",{value:!0});N.hc=class{constructor(a,b,c){this.camera=a;this.f=b;this.i=c}zd(a,b,c,d,e,f,g){if(c.x!==d.x||c.y!==d.y)f=N.hc.Ie(c,f),null!=b&&-1===b.indexOf(n.ControlPointPosition.MIDDLE_LEFT)||this.i.va(l.j.Gc(n.ControlPointPosition[n.ControlPointPosition.MIDDLE_LEFT]),
n.ControlPointPosition.MIDDLE_LEFT,p.ControlPointType.line,a,c,k.Geometry.rectangleFromData({x:-6,y:-6,width:12,height:12}),u.controlPoint(g),{Kb:-f}),null!=b&&-1===b.indexOf(n.ControlPointPosition.MIDDLE_RIGHT)||this.i.va(l.j.Gc(n.ControlPointPosition[n.ControlPointPosition.MIDDLE_RIGHT]),n.ControlPointPosition.MIDDLE_RIGHT,p.ControlPointType.line,a,d,k.Geometry.rectangleFromData({x:-6,y:-6,width:12,height:12}),u.controlPoint(g),{Kb:f}),null!=b&&-1===b.indexOf(n.ControlPointPosition.MIDDLE_CENTER)||
null==e||this.i.va(l.j.ve(n.ControlPointPosition[n.ControlPointPosition.MIDDLE_CENTER]),n.ControlPointPosition.MIDDLE_CENTER,p.ControlPointType.line,a,e,k.Geometry.rectangleFromData({x:-6,y:-6,width:12,height:12}),u.controlPoint(g))}static Ie(a,b){if(0===a.x&&0===a.y)return 0;a=k.Geometry.fromPoint(a);const c=k.Geometry.fromCoordinates(0,1);a.perpendicular();return 0<b?-180*Math.acos(a.dot(c)/a.length()*c.length()):180*Math.acos(a.dot(c)/a.length()*c.length())}Ac(a,b,c){const d=a.getEntityById(b),
e=h.Cet.curvedLine(d);var f=d.getWrapper(q.CetModel.ID.HAS_THICKNESS.W),g=Math.abs(e.getStartEndDistance())+f.getThickness();f=Math.abs(e.getArcHeight())+f.getThickness();g=k.Geometry.rectangleFromData({x:-(g/2),y:-(f/2),width:g,height:f});f=h.Cet.transform(d).getLocalToWorld();a=a.getTweener().getTweenedComponent(d.getId(),t.CetRendererModule.getVisibilityComponentKey());null==a&&(a=h.Cet.visibility(d));c=this.i.Hd(e,f.getScale(),c,a.getAlpha());this.i.bb(b,f,g,c)}fa(a,b){this.Ac(a,b,k.Geometry.colorFromRGBString("#0000FF"));
var c=a.getEntityById(b);a=h.Cet.transform(c).getLocalToWorld();const d=h.Cet.curvedLine(c);var e=t.CetRendererModule.CurvedLineCalculation();const f=e.getStartPoint(d);e=e.getEndPoint(d);const g={x:0,y:d.getArcHeight()/2};c=c.get(v.v.getEnabledControlPointsKey());this.zd(a,c,f,e,g,d.getArcHeight(),[b])}ha(a,b){this.Ac(a,b,k.Geometry.colorFromRGBString("#3181ff"))}};var V={};Object.defineProperty(V,"__esModule",{value:!0});V.bd=class{constructor(a,b,c){this.camera=a;this.f=b;c.onValue((a)=>this.networkStatus=
a)}fa(){}ha(a,b,c){var d,e=r.CetModelEditor.createScreenBoundsCalculator(a,this.camera).getLogoBoundsInScreen(a,b);if(null!=e){var f=e.topRightVertex(),g=k.Geometry.obbFromRect({x:f.x,y:e.getCenterY()-16-8,width:48,height:48});this.mc("hover_hit_area"+b,u.locked([b]),g);1===this.networkStatus&&(e=k.Geometry.obbFromRect({x:f.x+8,y:e.getCenterY()-16,width:32,height:32}),this.mc("click_hit_area"+b,u.clickable(b),e),a=null===(d=a.getEntityById(c))||void 0===d?void 0:d.get(p.SelectionModule.getDecoratorKey()),
this.f.Ad(b,null!=a&&a.interactionType===p.InteractionType.clickable&&1===a.ownerIds.length&&a.ownerIds[0]===b,e))}}mc(a,b,c){this.f.Pa(a,(a)=>{h.Cet.setFillComponentWithSolidColor(a,k.Geometry.colorFromRGBString("#000000"),.01);h.Cet.setBorder(a,0,k.Geometry.colorFromRGBString("#000000"),0);a.set(p.SelectionModule.getDecoratorKey(),b);return a},()=>{},c)}};var G={Lb:function(a){a=a.getObb();return{localBounds:k.Geometry.rectangleFromData({x:-a.getWidthHalf(),y:-a.getHeightHalf(),height:a.getHeight(),
width:a.getWidth()}),Da:k.Geometry.transform2dFromRad(a.getCenter(),1,a.getRotationRadians())}}};Object.defineProperty(G,"__esModule",{value:!0});const oa={border:"#ffffff",Kc:"#152235",Mc:"#152235",Lc:"#ffffff",aa:0},pa={border:"#3181ff",Kc:"#3181ff",Mc:"#ffffff",Lc:"#3181ff",aa:0};G.od=class{constructor(a,b,c,d){this.i=a;this.f=b;this.navigationControl=c;this.camera=d}Wd(a,b,c){const d=r.CetModelEditor.createScreenBoundsCalculator(a,this.camera).getWorldBoundsForInteraction(b);let {localBounds:e,
Da:f}=(0,G.Lb)(d);const g=f.getScale()*this.camera.getTransform().getScale();e=e.inflate(x.w.ca/g,x.w.ca/g);this.i.wa(b,f,e,[b]);a.getEntityById(b).get(v.v.getDisabledResizeControlPointKey())||this.i.Qa(f,e,[b]);0===c.length&&this.f.rd(b+"zoom_in_btn",()=>this.le(b,a),d.getObb(),H.I18n.ts("Zoom In",{context:"zoom in button on topic selection"}),fa.IconSmallId.ZoomIn)}le(a,b){b=r.CetModelEditor.getPagesOfChapter(a,b);a=0<b.length?b[0]:a;r.CetModelEditor.setCameraAndPathFor({navigationControl:this.navigationControl,
pathPosition:r.CetModelEditor.getPathPositionForTarget({navigationControl:this.navigationControl,targetId:a})});this.navigationControl.flyToId(a)}Sd(a,b,c){if(this.Rc(c,[b])){const d=a.getEntityById(b);c=h.Cet.transform(d).getLocalToWorld();a=h.Cet.getViewportWorldIfFocusedOnEntity(d,a,this.camera).transform(h.Cet.transform(d).getWorldToLocal()).getBounds();this.i.ka(c,a,b)}else{a=r.CetModelEditor.createScreenBoundsCalculator(a,this.camera);var {localBounds:d,Da:e}=(0,G.Lb)(a.getWorldBoundsForInteraction(b));
a=e.getScale()*this.camera.getTransform().getScale();d=d.inflate(x.w.ca/a,x.w.ca/a);this.i.ka(e,d,b)}}Hb(a,b,c,d){const e=a.getEntityById(b),f=h.Cet.transform(e).getLocalToWorld(),g=h.Cet.calculateZoomBounds(a,e);d?(this.pc(e,f,g,u.topicZoomAreaBorder(b),pa,null!=c,a),this.i.rc(e.getId(),f,g,!0)):(b=r.CetModelEditor.isPage(b,a)||!this.De(c)?u.ga([b]):u.clickable(b),this.pc(e,f,g,b,oa,null!=c,a))}Rc(a,b){if(null==a)return!1;switch(a.kind){case w.CoverEditModeKind.advanced:case w.CoverEditModeKind.insideAdvanced:return 1===
b.length&&a.topicId===b[0];case w.CoverEditModeKind.titleEditOnly:return!1;default:return C.Utils.assertNever(a)}}De(a){if(null==a)return!1;switch(a.kind){case w.CoverEditModeKind.advanced:case w.CoverEditModeKind.insideAdvanced:return!0;case w.CoverEditModeKind.titleEditOnly:return!1;default:return C.Utils.assertNever(a)}}pc(a,b,c,d,e,f,g){this.i.ja(l.j.Jc(d.interactionType),(a)=>{h.Cet.setFillComponentWithSolidColor(a,k.Geometry.colorFromRGBString(e.border),e.aa);h.Cet.setBorder(a,1,k.Geometry.colorFromRGBString(e.border),
1);a.set(t.CetRendererModule.getInnerBorderColorKey(),k.Geometry.colorFromRGBString(e.Kc));a.set(v.v.getDecoratorKey(),d);return a},b,c,!0,6);f&&(b=h.Cet.getViewportWorldIfFocusedOnEntity(a,g,this.camera),this.f.Bb(a.getId()+d.interactionType,b,H.I18n.ts("Topic zoom area",{context:"label of the zoom area rectangle in cover edit mode"}),{color:e.Mc,bgColor:e.Lc}))}};var x={};Object.defineProperty(x,"__esModule",{value:!0});x.w=class{constructor(a,b,c,d,e){this.camera=a;this.f=c;this.i=d;this.Le=e;
this.Na=new G.od(d,c,b,a)}fa(a,b,c,d,e){this.Na.Rc(c,[b])||this.Na.Wd(a,b,e)}ha(a,b,c,d){this.Na.Sd(a,b,d)}$d(a,b,c,d,e){if(null==b)this.Ud(a,b,c,d);else switch(b.kind){case w.CoverEditModeKind.advanced:this.Od(a,b,d,e);break;case w.CoverEditModeKind.titleEditOnly:this.Zd(a,b);break;case w.CoverEditModeKind.insideAdvanced:this.Td(a,b,d);break;default:C.Utils.assertNever(b)}}Zd(a,b){if(null!=b&&null!=a.getEntityById(b.topicId)){var c=r.CetModelEditor.createScreenBoundsCalculator(a,this.camera);a=this.camera.getTransform().invert();
c=c.getScreenAABBForEntities([b.topicId],{topic:r.TopicBoundsOptions.layout}).inflate(x.w.ca,x.w.ca);this.i.ka(a,c,b.topicId)}}Td(a,b,c){this.Na.Hb(a,b.topicId,b,c);var d=r.CetModelEditor.createScreenBoundsCalculator(a,this.camera);c=this.camera.getTransform().invert();d=d.getScreenAABBForEntities([b.topicId],{topic:r.TopicBoundsOptions.zoomArea});a=a.getEntityById(b.topicId).getWrapper(q.CetModel.ID.HAS_PADDING.W).getPadding();a=null!=a&&0<a?(a-1)/2:0;this.i.kc(c,d.inflate(d.getWidth()*a-x.w.jc,
d.getHeight()*a-x.w.jc),b.topicId)}Od(a,b,c,d){if(null!=b&&null!=a.getEntityById(b.topicId)){var e=r.CetModelEditor.createScreenBoundsCalculator(a,this.camera);const f=this.camera.getTransform().invert();e=e.getScreenAABBForEntities(this.ke(a,b.topicId),{topic:r.TopicBoundsOptions.zoomArea}).inflate(x.w.ca,x.w.ca);this.i.kc(f,e.inflate(x.w.ca,x.w.ca),b.topicId);d||this.Na.Hb(a,b.topicId,b,c)}}Ud(a,b,c,d){if(this.Le){const e=r.CetModelEditor.createTopicQuery(a).getTopicKind(c);e!==r.TopicKind.Planet&&
e!==r.TopicKind.Page&&e!==r.TopicKind.Overview||this.Na.Hb(a,c,b,d)}}Pd(a,b){var c=r.CetModelEditor.createScreenBoundsCalculator(a,this.camera);a=this.camera.getTransform().invert();c=c.getScreenAABBForEntities([b],{topic:r.TopicBoundsOptions.layout});c=c.inflate(x.w.ca,x.w.ca);this.i.wd(a,c,b)}ke(a,b){a=h.Cet.createTopicChildrenQuery(a);return[b,...a.getChildrenIdsVisibleOutside(b)]}};x.w.ca=5;x.w.jc=10;var W={};Object.defineProperty(W,"__esModule",{value:!0});W.cd=class{constructor(a,b,c){this.camera=
a;this.i=b;this.Gb=c;this.rb=!1;this.ib=this.Ja=null}initialize(a){a.getImmediateChangeStream(null).onValue(()=>{this.ib=this.Ja=null});this.Gb.onValue((b)=>{var c,d,e;this.ib=this.Ja=null;this.currentTopicId=null!==b&&void 0!==b?b:null===(e=null===(d=null===(c=null===a||void 0===a?void 0:a.getPreziW())||void 0===c?void 0:c.getOverview())||void 0===d?void 0:d.getEntity())||void 0===e?void 0:e.getId()});this.rb=!0}Vd(a,b,c,d){this.rb||this.initialize(a.getRootScene());if(null==this.Ja||null==this.ib)r.CetModelEditor.createTopicQuery(a),
this.ib=[],this.Ja=new Map([...r.createPathLabelMap(a)].map(([a,b])=>[a,b.outsideLabel]));if([...c,...d].some((a)=>this.Ja.has(a))){const m=h.Cet.createHierarchyQuery(a);var e=[...this.Ja.entries()].map(([b,c])=>{const d=a.getEntityById(b);if(null!=d&&d.isDef(q.CetModel.ID.Z_OBJECT)){const a=m.getParentOrOverview(d);if(b!==a&&this.currentTopicId===a)return{id:b,label:c,entity:d}}return null}).filter((a)=>null!=a);const k=(0!==c.length||1===d.length)&&15>e.length,l=new Map;for(const {id:m,label:p,
entity:n}of e){e=1===c.length&&m===c[0];var f=r.CetModelEditor.createScreenBoundsCalculator(a,this.camera);if(n.isDef(q.CetModel.ID.Z_TOPIC_CONTAINER)){f=f.getWorldBoundsForInteraction(m);var g=G.Lb(f);f=g.localBounds;g=g.Da;const a=g.getScale()*this.camera.getTransform().getScale();f=f.inflate(x.w.ca/a,x.w.ca/a)}else f=f.getLocalBoundsForHittest(n),g=h.Cet.transform(n).getLocalToWorld();this.Qd(g,f,b,m,c,d,e,k,p);l.set(m,g.transformRectangle(f).getCenter())}if(k){const b=r.getLabelledIdsInOrder(a).filter((a)=>
l.has(a));b.forEach((a,c)=>{0<c&&(c=b[c-1],this.de(c,l.get(c),a,l.get(a)))})}}}Qd(a,b,c,d,e,f,g,m,h){1!==e.length||null!==c&&c.kind!==w.CoverEditModeKind.titleEditOnly||(g||this.i.ud(d,a,b,[d]),0===f.length&&this.i.Dd(a,b,d,h,g));m&&this.i.zb(l.j.se(d),u.ga([d]),this.camera.getTransform().transformPoint(a.transformPoint(b.getCenter())),a.getRotationRad(),k.Geometry.rectangleFromData({x:-2,y:-2,height:4,width:4}),F.isActive("js-for-test-thick-selection")?4:1,k.Geometry.colorFromRGBString("#3181ff"))}de(a,
b,c,d){var e={x:(b.x+d.x)/2,y:(b.y+d.y)/2},f=k.Geometry.distance(b,d);d=Math.atan2(d.y-b.y,d.x-b.x);b=F.isActive("js-for-test-thick-selection")?12:1;e=k.Geometry.transform2dFromRad(e,f/10,d);d=k.Geometry.rectangleFromData({x:-((10+b)/2),y:-((1+b)/2),width:10+b,height:1+b});const g=this.i.f.getCameraTransform().getScale(),m=g*e.getScale();30>f*g||(f={headPos:{x:-5*m+15,y:0},tailPos:{x:5*m-15,y:0},origin:null,radius:null,startAngle:null,endAngle:null,isStraight:!0,isInverse:!1,color:k.Geometry.colorFromRGBString("#EFCF1C"),
thickness:b,alpha:1},this.i.bb(l.j.re(`chain-from-${a}-to-${c}`),e,d,f))}};var X={};Object.defineProperty(X,"__esModule",{value:!0});X.gd=class{constructor(a,b){this.camera=a;this.i=b}fa(a,b){a=a.getEntityById(b);const c=h.Cet.transform(a).getLocalToWorld(),d=h.Cet.localBounds(a).getGraphicsBounds();this.i.wa(b,c,d,[b]);this.i.Qa(c,d,[b]);a.getWrapper(q.CetModel.ID.Z_SHAPE.W).getShapeType()!==q.ShapeType.Oval&&(this.i.fb(p.ControlPointType.widthResize,c,d,[b]),this.i.Ab(p.ControlPointType.heightResize,
c,d,[b]))}ha(a,b){var c=a.getEntityById(b);a=h.Cet.transform(c).getLocalToWorld();c=h.Cet.localBounds(c).getGraphicsBounds();this.i.ka(a,c,b)}};var E={};Object.defineProperty(E,"__esModule",{value:!0});E.ua=class{constructor(a,b,c,d){this.camera=a;this.f=b;this.i=c;this.o=d}addTextStateStream(a){a.onValue((a)=>{this.textSelectionState=a;null!=this.o&&null!=a&&this.o.markViewChanged()})}fa(a,b){const c=a.getEntityById(b),d=h.Cet.transform(c).getLocalToWorld();if(!r.CetModelEditor.createTextHelper().hasSelection(c)&&
null!=r.CetModelEditor.createTextHelper().getCaretOffset(c)&&null!=this.textSelectionState&&this.textSelectionState.isEditing()){const a=r.CetModelEditor.createTextHelper().getCaretOffset(c);this.Xd(d,h.Cet.localBounds(c).getGraphicsBounds(),c,a)}a=r.CetModelEditor.createScreenBoundsCalculator(a,this.camera).getLocalBoundsForHittest(c);this.i.Fd(b,d,a);this.i.Qa(d,a,[b]);this.i.fb(p.ControlPointType.widthResize,d,a,[b],!0)}ha(a,b){const c=a.getEntityById(b),d=h.Cet.transform(c).getLocalToWorld();
a=r.CetModelEditor.createScreenBoundsCalculator(a,this.camera).getLocalBoundsForHittest(c);this.i.ka(d,a,b)}Yd(a,b,c){a=a.getEntityById(b);c?(c=a.get(L.getSpellcheckComponentKey()),b=h.Cet.shapedText(a),c=this.Ld(b.getRawText(),Object.keys(c)),0<c.length?a.set(t.CetRendererModule.getTextUnderlineComponentKey(),c):a.discardOwnComponent(t.CetRendererModule.getTextUnderlineComponentKey())):a.discardOwnComponent(t.CetRendererModule.getTextUnderlineComponentKey());a.getId()}Xd(a,b,c,d){var e,f=c.get(t.CetRendererModule.getInEditFontSizeComponentKey()),
g=h.Cet.shapedText(c);f=g.replaceTextWithStyle(0,g.getLength()," ",ia.LayoutModel.withFontSize(f));0>=g.getWrapWidth()&&(f=f.setWrapWidth(g.getLayoutBounds().getWidth()));g=0===g.getLength()||c.get(q.CetModel.ID.POSSIBLY_PLACEHOLDER.IS_PLACEHOLDER)?f:g;var m=g.getLineAt(d,!1);const l=f.getLineAt(0,!1);f=l.ascent-l.descent;const n=g.locatePosition(d,!1);var r=c.getWrapper(q.CetModel.ID.HAS_FONT.W);r=r.getDisplayBackground()?r.getBackgroundPadding():0;b={x:n.x-b.getData().width/2+r,y:n.y-b.getData().height/
2+r+m.ascent-l.ascent+f/2};b=this.f.Mb(a,b);m=a.getRotationDeg()+this.f.getCameraTransform().getRotationDeg();a=a.getScale()*this.f.getCameraTransform().getScale();let w=c.get(v.v.getEnableBlinkingCaretKey());null==w&&(w=!0);d=null===(e=g.getCharacterStylesAt(d))||void 0===e?void 0:e.getColorWithFallback(g.getBaseStyle());const x=k.Geometry.colorFromRGBString(null!=d?d.asHexString():"#000000");this.f.Pa("prezi_select.TextDecorator.caret."+c.getId(),(a,b)=>{F.isActive("js-disable-blinking-cursor")||
(b.getTweener().createVisibilityAnimationHelper(z.ea.xb).blinking(a,{duration:50,delay:0,delayBeforeRecurring:450}),a.set(E.ua.Pb,!0));a.set(v.v.hd,!0);h.Cet.setBorder(a,-1,k.Geometry.colorFromRGBString("#ffffff"),1);h.Cet.setFillComponentWithSolidColor(a,x,1);a.set(p.SelectionModule.getDecoratorKey(),u.ga([a.getId()]));return a},(a,b)=>{F.isActive("js-disable-blinking-cursor")||w===a.get(E.ua.Pb)||(b=b.getTweener().createVisibilityAnimationHelper(z.ea.xb),w?b.blinking(a,{duration:50,delay:0,delayBeforeRecurring:450}):
b.removeVisibilityTweens(a),a.set(E.ua.Pb,w));h.Cet.setFillComponentWithSolidColor(a,x,1)},k.Geometry.obbFromData(b.x,b.y,2,f*a,m),!0)}Ld(a,b){const c=r.CetModelEditor.createTextHelper(),d=c.getSpecialTokens(a);let e;const f=[],g=new RegExp(/(?:[a-zA-Z'\d\u00C0-\u02AF\uac00-\ud7a3])+/,"g");for(;null!=(e=g.exec(a));)-1!==b.indexOf(e[0])&&f.push({start:e.index,end:g.lastIndex});return f.filter((a)=>null==c.findSpecialToken(d,a.start,a.end))}};E.ua.guid="prezi_select.TextDecorator";E.ua.Pb=q.CetModel.createValueComponentKey("lastBlinkingCaret",
!1,!1);var Y={};Object.defineProperty(Y,"__esModule",{value:!0});Y.pd=class{constructor(a,b,c){this.camera=a;this.f=b;this.i=c}fa(a,b){var c=a.getEntityById(b);a=h.Cet.transform(c).getLocalToWorld();c=h.Cet.localBounds(c).getGraphicsBounds();this.i.wa(b,a,c,[b],{fillColor:"#3080FF",aa:.2});this.i.rc(b,a,c,!1);this.i.fb(p.ControlPointType.widthResize,a,c,[b]);this.i.Ab(p.ControlPointType.heightResize,a,c,[b])}ha(a,b){var c=a.getEntityById(b);a=h.Cet.transform(c).getLocalToWorld();c=h.Cet.localBounds(c).getGraphicsBounds();
this.i.ka(a,c,b,{},{fillColor:"#3080FF",aa:.2})}};var z={};Object.defineProperty(z,"__esModule",{value:!0});z.ea=class{constructor(a,b,c,d,e,f,g,m,h,k,n,p,q,r,t,u,v){this.Ke=a;this.Kd=b;this.Qe=c;this.Jd=d;this.oe=e;this.camera=q;this.o=u;this.isTopicZoomAreaEditEnabled=!1;a=f.toProperty(null);a.onValue(()=>{});this.Db=[];this.Eb=[];this.Sa=[];this.nb=[];this.Tb=[];this.ya={ids:[],Ra:null};this.ob=null;this.mb=[];this.newCurrentTopic=null;this.Pc=[];this.Yb=[];this.Sb=[];this.xa=B.emptySelectionInfo();
this.Vb=B.emptySelectionInfo();this.lb=[];this.Xb=[];this.Fb=this.Ub=!1;this.f=new D.ta(this.camera,r,50);this.Va=new D.ta(this.camera,r,0);this.i=new l.j(this.camera,this.f);this.tc=new Q.Vc(this.o);this.ia={kind:w.MaskingModeKind.off};this.Ea={kind:w.MaskingModeKind.off};this.Ke.onValue((a)=>{null!=this.o&&this.o.markViewChanged();this.Vb=a});this.Kd.filterWithStream(m.map((a)=>a.kind===w.MaskingModeKind.off).toProperty(!0)).onValue((a)=>{null!=this.o&&this.o.markViewChanged();this.Pc=a});this.Qe.onValue((a)=>
{null!=this.o&&this.o.markViewChanged();this.Yb=a});this.Jd.toEventStream().onValue((a)=>{null!=this.o&&this.o.markViewChanged();this.Sb=a});this.oe.onValue((a)=>{null!=this.o&&this.o.markViewChanged();this.Tb=a.entityIds});a.onValue((a)=>{null!=this.o&&this.o.markViewChanged();this.newCurrentTopic=a});g.onValue((a)=>{null!=this.o&&this.o.markViewChanged();this.ub=a;null!=this.ub&&(this.draggedEntityHoveredTopicId=null)});m.onValue((a)=>{null!=this.o&&this.o.markViewChanged();this.Ea=null==a?{kind:w.MaskingModeKind.off}:
a});h.onValue((a)=>{null!=this.o&&this.o.markViewChanged();this.draggedEntityHoveredTopicId=a});k.onValue((a)=>{null!=this.o&&this.o.markViewChanged();this.isTopicZoomAreaEditEnabled=a});n.onValue((a)=>{null!=this.o&&this.o.markViewChanged();this.Ub=null==a?!1:a.isEditing()});this.Ma=new E.ua(this.camera,this.f,this.i,u);this.tb=new N.hc(this.camera,this.f,this.i);this.Fa=new x.w(this.camera,t,this.f,this.i,v);this.ec=new Y.pd(this.camera,this.f,this.i);this.cc=new X.gd(this.camera,this.i);this.Qb=
new V.bd(this.camera,this.f,p);this.Ia=new M.gc(this.camera,this.i);this.yc=new T.Zc(this.camera,this.f,this.Ma,this.tb,this.Fa,this.ec,new U.ad(this.camera,this.i,this.Va),this.cc,this.Qb,this.Ia);this.He=new W.cd(this.camera,this.i,a)}getName(){return"selection"}addAreaSelectionStream(a){this.tc.addAreaSelectionStream(a)}addTextStateStream(a){this.Ma.addTextStateStream(a)}Te(a){const b=[],c=[],d=h.Cet.createTopicChildrenQuery(a);a.getEntityList().forChangedMutableEntities((e)=>{for(let f of e)if(h.Cet.hasPdomComponent(f)){e=
f.get(q.CetModel.ENTITY_OWNER_ID());const g=a.getEntityById(e);null!=g&&(0===d.getChildrenIdsVisibleOutside(e).length?c.push(g.getId()):b.push(g.getId()))}},this.Pe);this.Xb=c.concat(this.lb.filter((c)=>null!=a.getEntityById(c)&&-1===b.indexOf(c)))}Id(a,b){return null!=b&&1===b.length&&(a=a.getEntityById(b[0]).get(p.SelectionModule.getDecoratorKey()),null!=a)?{ids:a.ownerIds,Ra:b[0]}:{ids:b,Ra:null}}update(a){this.Te(a);this.Re(a);const b=this.Id(a,this.Pc);this.xa!==this.Vb||!C.Utils.arrayEquals(this.ya.ids,
b.ids)&&this.ia.kind===w.MaskingModeKind.off||!C.Utils.arrayEquals(this.ob,this.Yb)&&this.ia.kind===w.MaskingModeKind.off||!C.Utils.arrayEquals(this.lb,this.Xb)||this.nb!==this.Tb||this.mb!==this.Sb&&this.ia.kind===w.MaskingModeKind.off||this.pa!==this.ub||this.ia.kind!==this.Ea.kind||this.Fb!==this.Ub?(++z.ea.version,++z.ea.Oc,this.xa=this.Vb,this.ya=b,this.ob=this.Yb,this.nb=this.Tb,this.mb=this.Sb,this.pa=this.ub,this.ia=this.Ea,this.lb=this.Xb,this.Fb=this.Ub):this.ia!==this.Ea?(++z.ea.version,
this.ia=this.Ea):this.ya.Ra!==b.Ra&&(this.ya=b);this.f.update(a,z.ea.version);this.Va.update(a,z.ea.Oc);this.decorate(a);this.Rb(a)}Re(a){this.Ea.kind===w.MaskingModeKind.off&&this.Ea.kind!==this.ia.kind&&(a=a.getEntityById(this.ia.maskedImageId))&&(a.set(t.CetRendererModule.getImageMaskEditingStateComponentKey(),!1),la.avro.Avro.createDefaultLogger().logCloseImageMaskingMode())}decorate(a){const b=p.SelectionModule.getEditedGroupId(a,this.xa);null!=b&&this.Ia.Rd(a,b);const c=this.xa.allEntityIds.filter((b)=>
{let c=a.getEntityById(b);return null!=c&&null!=c.get(q.CetModel.ID.TRANSFORMED.LOCAL_TO_WORLD)&&0===a.getTweener().getTweenCount(b)});this.Fa.$d(a,this.ub,this.newCurrentTopic,this.isTopicZoomAreaEditEnabled,this.Fb);const d=(a)=>1!==c.length||-1===c.indexOf(a);this.Nb(a,b,null!=this.ya.ids?this.ya.ids.filter(d):[],this.ya.Ra,c);this.Nb(a,b,null!=this.ob?this.ob.filter(d):[],null,c);const e=h.Cet.createHierarchyQuery(a);this.lb.forEach((b)=>{e.getParentOrOverview(a.getEntityById(b))===this.newCurrentTopic&&
this.Fa.ha(a,b,null,this.pa)});null!=this.nb&&this.Nb(a,b,this.i.Je(a,this.nb),null,this.xa.allEntityIds);this.He.Vd(a,this.pa,c,this.mb);1<c.length?this.Ia.pb(a,c):1===c.length&&this.yc.Dc(c[0],a,this.pa,c).fa(a,c[0],this.pa,this.ia,this.mb);null!=this.draggedEntityHoveredTopicId&&null==this.pa&&this.Fa.Pd(a,this.draggedEntityHoveredTopicId);this.tc.decorate(this.f)}Nb(a,b,c,d,e){const {groupIds:f,entities:g}=p.SelectionModule.getGroupsWithEntities(a,c,[b,1===this.xa.groupIds.length?this.xa.groupIds[0]:
null]);for(const c of g)b=c.getId(),this.yc.Dc(b,a,this.pa,e).ha(a,b,d,this.pa);for(const b of f)this.Ia.pe(a,b)}Rb(a){a=a.getEntityList();const b=this.f.la,c=this.f.Ca(),d=this.Va.la;for(let c of this.Db)-1===b.indexOf(c)&&a.deleteEntity(c);for(let b of this.Eb)-1===d.indexOf(b)&&a.deleteEntity(b);for(let a of this.Sa)-1===c.indexOf(a)&&null!=a.parentElement&&a.parentElement.removeChild(a);this.Db=b;this.Eb=d;this.Sa=c}reset(){}init(a){a.getTweener().createVisibilityAnimationHelper(z.ea.xb);this.Pe=
a.getEntityList().startNewTracking("SelectionSystemImpl-topic-child-change",[q.CetModel.ID.HAS_TOPIC_CHILDREN.TOPIC_CHILDREN],()=>!0)}changesPdomComponents(){return!1}getCurrentDecorators(){return[...this.Db,...this.Eb]}};z.ea.xb="blinking-caret";z.ea.version=0;z.ea.Oc=0;var A={};Object.defineProperty(A,"__esModule",{value:!0});A.na=class{constructor(a,b){this.camera=a;this.f=b;this.Uc=!1;this.i=new l.j(a,b);this.camera.getZoomingLimitStream().onValue((a)=>this.Uc=a===h.ZoomingLimit.ZoomInLimitReached)}fe(a,
b){switch(b.kind){case n.SnapResultKind.Align:this.be(b);break;case n.SnapResultKind.Highlight:this.ce(a,b);break;case n.SnapResultKind.UniverseLimit:this.he();break;default:C.Utils.assertNever(b)}}he(){this.f.Gd(H.I18n.ts("Size limit reached"),this.Uc?48:0)}be(a){const {from:b,to:c}=this.me([a.referenceSegment.P,a.referenceSegment.Q,a.subjectSegment.P,a.subjectSegment.Q]);b.x===c.x&&b.y===c.y||this.f.Ed(this.Ib(),(a)=>{h.Cet.setBorder(a,-1,k.Geometry.colorFromRGBString(A.na.BORDER_COLOR),1);h.Cet.setFillComponentWithSolidColor(a,
k.Geometry.colorFromRGBString(A.na.$c),1);a.set(p.SelectionModule.getDecoratorKey(),u.ga([]));return a},()=>{},b,c)}me(a){a=a.sort((a,c)=>.001>Math.abs(a.x-c.x)?0:a.x-c.x).sort((a,c)=>.001>Math.abs(a.y-c.y)?0:a.y-c.y);return{from:a[0],to:a[a.length-1]}}ce(a,b){b=a.getEntityById(b.referenceId);a=r.CetModelEditor.createScreenBoundsCalculator(a,this.camera).getScreenAABBForEntities([b.getId()],{topic:r.TopicBoundsOptions.layout});const c=this.camera.getTransform().invert();this.i.ka(c,a,b.getId(),{},
{thickness:3})}Ib(){A.na.Nc++;return"snap-decorator_"+A.na.Nc}};A.na.BORDER_COLOR="#3181ff";A.na.$c="#F05A0F";A.na.Nc=0;var K={};Object.defineProperty(K,"__esModule",{value:!0});K.yb=class{constructor(a,b){this.camera=a;this.f=new D.ta(a,b,0);this.Me=new A.na(this.camera,this.f)}select(a,b){return h.Cet.hasPdomComponent(a)||b.getPreziW().getId()===a.getId()}getTriggerKeys(){return[n.EditorCommander.getSnapComponentKey()]}process(a,b){for(const c of a){a=b.getEntityList();const d=this.f.la;if(null!=
d)for(const b of d)a.deleteEntity(b);a=this.f.Ca();for(let b of a)null!=b.parentElement&&b.parentElement.removeChild(b);this.f.update(b,0);a=c.get(n.EditorCommander.getSnapComponentKey());null!=a&&null!=a.results&&a.results.forEach((a)=>this.Me.fe(b,a))}}getName(){return"SnapSystem"}init(a){a.getTweener().createVisibilityAnimationHelper(K.yb.dd)}changesPdomComponents(){return!1}};K.yb.dd="SnapConnectorDecorator";var Z={};Object.defineProperty(Z,"__esModule",{value:!0});Z.ld=class{constructor(a,b){this.camera=
a;this.f=b}ge(a,b){if(null!=a.getEntityById(b.targetTopicId))switch(b.direction){case n.TopicNestingDirection.In:this.ee(b,a);break;case n.TopicNestingDirection.Out:this.ie(b,a);break;case n.TopicNestingDirection.None:break;default:C.Utils.assertNever(b.direction)}}ee(a,b){if(null!=b.getEntityById(a.targetTopicId)){var c=b.getTweener(),d=h.Cet.createTweenFactory();h.Cet.createTopicChildrenQuery(b).getChildrenIdsVisibleOutside(a.targetTopicId).forEach((e)=>{var f=b.getEntityById(e);f=h.Cet.transform(f).getLocalToWorld();
var g=b.getAnimationScene().getEntityById(e);g=null!=g?h.Cet.transform(g).getLocalToWorld():f;f=k.Geometry.transform2dFromRad(f.getTranslation(),f.getScale()*a.factor,f.getRotationRad());f.equalsWithin(g,Math.pow(2,-44))||(f=h.Cet.createTransformTween("TopicNestingDecorator-proximity",600,g,f),f.setEase(d.createExpOut(2.5,-10)),f.setDisableHittest(!1),c.addTween(e,f,!0))})}}ie(a,b){var c=b.getEntityById(a.targetTopicId);c=h.Cet.createHierarchyQuery(b).getParentOrOverview(c);!b.getEntityById(c).isDef(q.CetModel.ID.OVERVIEW)&&
a.nestingThresholdReached&&(b=this.camera.getMarginCorrectedStageArea().getTopLeft(),b=k.Geometry.obbFromData(b.x+-30,b.y+-20,700,700,0),this.sc(b,a))}Ib(a){return`${"topic-nesting-decorator"}_${a.targetTopicId}.circle.zoom-out-area`}sc(a,b){this.f.vd(this.Ib(b),a)}};var aa={};Object.defineProperty(aa,"__esModule",{value:!0});aa.md=class{constructor(a,b){this.camera=a;this.f=new D.ta(a,b,0);this.ae=new Z.ld(this.camera,this.f);this.Sa=[]}update(a){this.f.update(a,0);let b=null;a.getEntityList().forChangedMutableEntities((a)=>
{for(const c of a)b=c.get(n.EditorCommander.getTopicNestingComponentKey())},this.je);null!=this.action&&null!=this.action.results&&(this.action.results.forEach((b)=>this.ae.ge(a,b)),this.Rb(a));this.action=b}Rb(a){a=a.getEntityList();const b=this.f.la;if(null!=b)for(var c of b)a.deleteEntity(c);c=this.f.Ca();for(let a of this.Sa)-1===c.indexOf(a)&&null!=a.parentElement&&a.parentElement.removeChild(a);this.Sa=c}getName(){return"TopicGroupingSystem"}init(a){this.je=a.getEntityList().startNewTracking("TopicNestingSystemImpl-topic-nesting",
[n.EditorCommander.getTopicNestingComponentKey()],(b)=>b.getId()===a.getPrezi().getId())}reset(){}changesPdomComponents(){return!1}};var ba={};Object.defineProperty(ba,"__esModule",{value:!0});ba.kd=class{constructor(a,b,c,d){this.o=d;this.entityIds=[];this.vb=this.xc="NOT_INITIALIZED";this.f=new D.ta(a,null,0);d=new l.j(a,this.f);this.Ma=new E.ua(a,this.f,d);b.onValue((a)=>{null!=this.o&&this.o.markViewChanged();this.Wb=a});c.skipDuplicates().onValue((a)=>{null!=this.o&&this.o.markViewChanged();
this.vb=a})}init(a){this.Ge=a.getEntityList().startNewTracking("TextHighlight-newTextHighlights",[L.getSpellcheckComponentKey()],()=>!0);this.Ne=a.getEntityList().startNewTracking("TextHighlight-textHighlightChanges",[h.Cet.getShapedTextKey(),...q.CetModel.ID.TRANSFORMED.getFields(),q.CetModel.ID.ABSOLUTE.LOCAL_TO_WORLD,t.CetRendererModule.getLocalBoundsComponentKey(),q.CetModel.getRemovedEntityCompKey()],(a)=>a.hasComponent(L.getSpellcheckComponentKey()))}update(a){a.getEntityList().forChangedMutableEntities((a)=>
{0<a.length&&(this.entityIds=this.entityIds.concat(a.map((a)=>a.getId())))},this.Ge);a.getEntityList().forChangedMutableEntities((a)=>{0<a.length&&(this.entityIds=this.entityIds.concat(a.map((a)=>a.getId())))},this.Ne);if(0<this.entityIds.length){var b=a.getEntityList();let c=this.f.la;if(null!=c)for(let a of c)b.deleteEntity(a);this.f.update(a,0);this.pb(a,this.entityIds)}else if(this.xc!==this.vb||this.currentTopicId!==this.Wb)b=r.CetModelEditor.createTopicQuery(a).getReachableEntities(this.Wb),
this.pb(a,b),this.xc=this.vb,this.currentTopicId=this.Wb;this.entityIds=[]}getName(){return"TextHighlightSystem"}changesPdomComponents(){return!1}reset(){}pb(a,b){b.forEach((b)=>{const c=a.getEntityById(b);(null===c||void 0===c?0:c.hasComponent(L.getSpellcheckComponentKey()))&&this.Ma.Yd(a,b,"ENABLED"===this.vb)})}};var ca={};Object.defineProperty(ca,"__esModule",{value:!0});ca.fd=class{constructor(a){this.store=a}createSelectionSystem(a,b,c,d){return new z.ea(this.store.getSelectionStream(),this.store.getCanvasHoverStream(),
this.store.getUiHoverStream(),this.store.getCanvasEditedEntityIdsStream(),this.store.getHighlightEntitiesOnDragSelectActionStream(),this.store.getCurrentTopicStream(),this.store.getCoverEditModeStream(),this.store.getMaskEditingModeStream(),this.store.getDraggedEntityHoveredTopicIdStream(),this.store.getIsTopicZoomAreaEditEnabledStream(),this.store.getTextSelectionStateStream(),this.store.getNetworkStatusStream(),a,b,c,d,!0)}createSnapSystem(a,b,c){return a.createShaperSystem(new K.yb(b,c))}createTopicNestingSystem(a,
b){return new aa.md(a,b)}createTextHighlightSystem(a,b){return new ba.kd(a,this.store.getCurrentTopicStream(),this.store.getSpellcheckStatusStream(),b)}createCustomStartingPointSystem(a,b,c,d){return new P.Yc(a,b,this.store.getCurrentTopicStream(),this.store.getModeStream(),c,d)}};var da={};Object.defineProperty(da,"__esModule",{value:!0});class qa{constructor(a,b,c){this.scene=a;this.camera=b;this.f=new D.ta(b,c,0);this.i=new l.j(b,this.f);this.dc=this.scene.getTweener().createVisibilityAnimationHelper("OverlayDrawer");
this.f.update(a,0);this.ba=[]}Cb(a,b){var c=this.scene.getEntityById(a),d=(c.isDef(q.CetModel.ID.OVERVIEW)?h.Cet.world(this.scene.getPreziW().getOverview().getEntity()).getWorldBounds():h.Cet.getViewportWorldIfFocusedOnEntity(c,this.scene,this.camera)).transform(h.Cet.transform(c).getWorldToLocal());const e=d.getCenter();var f=this.camera.getStageArea().getVertices();f=((a,b)=>k.Geometry.distance(a,b))(f.reduce((a,b)=>k.Geometry.distance(b,e)>k.Geometry.distance(a,e)?b:a,f[0]),e);f=d.inflateXY(f,
f);d=this.f.qa(h.Cet.transform(c).getLocalToWorld(),d.getBounds());c=this.f.qa(h.Cet.transform(c).getLocalToWorld(),f.getBounds());return this.i.cb(a,b,d,c,{color:"#000000"})}update(){this.ba=this.ba.filter((a)=>null!=this.scene.getEntityById(a.topicId)&&(null==a.entityId||null!=this.scene.getEntityById(a.entityId)));const a=this.ba.filter((a)=>"alive"===a.state||"fading-out"===a.state);var b=this.ba.filter((a)=>"removed"===a.state);const c=this.ba.filter((a)=>"to-fade"===a.state),d=this.ba.filter((a)=>
"to-show"===a.state);this.f.update(this.scene,0);a.forEach((a)=>{this.Cb(a.topicId,a.Ya)});b.forEach((a)=>{this.scene.getEntityList().deleteEntity(a.entityId)});const e=this.camera.getMarginCorrectedViewport(),f=(a)=>{a=this.scene.getEntityById(a.topicId);const b=h.Cet.getViewportWorldIfFocusedOnEntity(a,this.scene,this.camera).transform(h.Cet.transform(a).getWorldToLocal());a=this.f.qa(h.Cet.transform(a).getLocalToWorld(),b.getBounds());return 1.4>=Math.max(e.getHeight(),a.getHeight())/Math.min(e.getHeight(),
a.getHeight())};b=c.filter((a)=>!f(a));const g=[];c.filter((a)=>f(a)).forEach((a)=>{const b=this.Cb(a.topicId,a.Ya);null!=b&&(g.push(Object.assign(Object.assign({},a),{entityId:b,state:"alive"})),this.dc.fadeIn(this.scene.getEntityById(b),{duration:250,delay:0},()=>{}))});d.forEach((a)=>{const b=this.Cb(a.topicId,a.Ya);null!=b&&(g.push(Object.assign(Object.assign({},a),{entityId:b,state:"alive"})),this.dc.fadeIn(this.scene.getEntityById(b),{duration:0,delay:0},()=>{}))});this.ba=a.concat(b).concat(g)}add(a,
b){this.remove(a);const c=this.scene.generateEntityId(),d=this.ba.filter((b)=>b.topicId!==a),e=this.ba.filter((b)=>b.topicId===a).map((a)=>Object.assign(Object.assign({},a),{state:"removed"}));d.push({topicId:a,Ya:c,entityId:null,state:b});this.ba=d.concat(e)}remove(a){const b=this.ba.filter((b)=>b.topicId!==a&&null!=b.entityId),c=this.ba.filter((b)=>b.topicId===a),d=[];b.forEach((a)=>{d.push(Object.assign(Object.assign({},a),{state:"fading-out"}));const b=this.scene.getEntityById(a.entityId);null!=
b&&this.dc.fadeOut(b,{duration:250,delay:0},()=>{this.ba=this.ba.filter((b)=>a.Ya!==b.Ya).concat(Object.assign(Object.assign({},a),{state:"removed"}))})});this.ba=c.concat(d)}reset(){this.f.la.forEach((a)=>{this.scene.getEntityList().deleteEntity(a)});this.f.update(this.scene,0);this.ba=[]}}da.nd=class{constructor(a,b){this.camera=a;this.u=b}init(a){this.Zb=new qa(a,this.camera,this.u)}reset(){this.Zb.reset()}decorate(a,b,c,d){c!==b&&this.Zb.add(b,d?"to-fade":"to-show");this.Zb.update()}};var v={};
Object.defineProperty(v,"__esModule",{value:!0});v.v=class{static createSelection(a){return new ca.fd(a)}static createDecoratorEntityForTest(a){const b=new D.ta(a.getCamera(),null,0),c=new l.j(a.getCamera(),b);b.update(a.getModelScene(),0);return c.ja(l.j.Jc(p.InteractionType.none),(a)=>{h.Cet.setFillComponentWithSolidColor(a,k.Geometry.colorFromRGBString("#dcdcdc"),0);h.Cet.setBorder(a,1,k.Geometry.colorFromRGBString("#dcdcdc"),1);a.set(v.v.getDecoratorKey(),u.ga([]));return a},k.Geometry.transform2dFromRad({x:0,
y:0},1,0),k.Geometry.rectangleFromData({x:0,y:0,width:1,height:1}),!0,6)}static getDecoratorKey(){null==v.v.da&&(v.v.da=q.CetModel.createValueComponentKey("decorator",!1,!1));return v.v.da}static getControlPointKey(){null==v.v.vc&&(v.v.vc=q.CetModel.createValueComponentKey("controlPoint",!1,!1));return v.v.vc}static getEnabledControlPointsKey(){null==v.v.Cc&&(v.v.Cc=q.CetModel.createValueComponentKey("enabled_ctrl_points",!1,!1));return v.v.Cc}static getDisabledResizeControlPointKey(){null==v.v.zc&&
(v.v.zc=q.CetModel.createValueComponentKey("disabledResizeControlPoint",!1,!1));return v.v.zc}static getEnableBlinkingCaretKey(){null==v.v.Bc&&(v.v.Bc=q.CetModel.createValueComponentKey("blinkingCaret",!1,!1));return v.v.Bc}static restrictToEntityAndCtrlPointsSQStrategy(a){return(b)=>[...b].sort((b,d)=>{const c=(a)=>{a=a.get(p.SelectionModule.getDecoratorKey());return null!=a&&a.interactionType===p.InteractionType.controlPoint};b=b.getData().entity.getId()===a||c(b.getData().entity);d=d.getData().entity.getId()===
a||c(d.getData().entity);return b&&!d?-1:d&&!b?1:0})}static createSelectionController(a,b){return new O.ed(a,b)}static createCustomSelectionSystem(a,b,c,d,e,f,g,h,k,l,n,p,q,r,t,u){return new z.ea(a,b,c,d,e,f,g,h,k,l,n,p,q,r,t,u,!1)}static createTopicOverlayAnimator(a,b){return new da.nd(a,b)}static getEditedGroupId(a,b){return 0<b.groupIds.length?null:this.getContainerGroupId(a,b.nonGroupedEntityIds)}static getContainerGroupId(a,b){if(null==b||0===b.length)return null;const c=this.Wa.getGroupIdFromEntityId(a,
b[0]);if(null==c)return null;const d=new Set(this.Wa.getGroupMembers(a,c).map((a)=>a.getId()));return b.every((a)=>d.has(a))?c:null}static getGroupsWithEntities(a,b,c=[]){const d=new Set,e=[];for(const f of b){if(null==f)continue;b=a.getEntityById(f);if(null==b)continue;const g=this.Wa.getGroupIdFromEntity(a,b);null!=g&&0>c.indexOf(g)?d.add(g):e.push(b)}return{entities:e,groupIds:Array.from(d)}}};v.v.hd=q.CetModel.createValueComponentKey("TEXT_CARET",!1,!1);v.v.Wa=r.CetModelEditor.createGroupQuery();
var p={};Object.defineProperty(p,"__esModule",{value:!0});(function(a){a[a.controlPoint=0]="controlPoint";a[a.border=1]="border";a[a.topicZoomAreaBorder=2]="topicZoomAreaBorder";a[a.locked=3]="locked";a[a.clickable=4]="clickable";a[a.maskDrag=5]="maskDrag";a[a.none=6]="none"})(p.InteractionType||(p.InteractionType={}));(function(a){a[a.lockedMarker=0]="lockedMarker";a[a.resize=1]="resize";a[a.topicZoomAreaResize=2]="topicZoomAreaResize";a[a.heightResize=3]="heightResize";a[a.widthResize=4]="widthResize";
a[a.resizeMaskImage=5]="resizeMaskImage";a[a.resizeMaskArea=6]="resizeMaskArea";a[a.heightResizeMaskArea=7]="heightResizeMaskArea";a[a.widthResizeMaskArea=8]="widthResizeMaskArea";a[a.line=9]="line"})(p.ControlPointType||(p.ControlPointType={}));(function(a){a.zoomInButton="selection-zoom-in-button";a.placeholderButton="selection-placeholder-button"})(p.Lookup||(p.Lookup={}));p.SelectionModule=v.v;ea=p;y=document.createElement("style");y.textContent=".gadgetFadeOnHover{transition:opacity 500ms}.gadgetFadeOnHover:hover{opacity:0}\n";
document.body.appendChild(y);return ea});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_select",["require","prezi.geometry","prezi.text.model","prezi_app_utils","prezi_bacon","prezi_cet","prezi_cet_model","prezi_cet_model_editor","prezi_cet_renderer","prezi_editor_commander","prezi_editor_store_common","prezi_editor_store_mode","prezi_editor_store_object","prezi_featureswitcher","prezi_i18n","prezi_logger","prezi_plugin_meta","prezi_spellcheck","prezi_utils","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_select.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.geometry"),require("prezi.text.model"),require("prezi_app_utils"),require("prezi_bacon"),require("prezi_cet"),require("prezi_cet_model"),require("prezi_cet_model_editor"),require("prezi_cet_renderer"),require("prezi_editor_commander"),require("prezi_editor_store_common"),require("prezi_editor_store_mode"),require("prezi_editor_store_object"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_meta"),require("prezi_spellcheck"),require("prezi_utils"),require("prezi_widgets"));}else{this["prezi_select"]=__factory(this["prezi.geometry"],this["prezi.text.model"],this["prezi_app_utils"],this["prezi_bacon"],this["prezi_cet"],this["prezi_cet_model"],this["prezi_cet_model_editor"],this["prezi_cet_renderer"],this["prezi_editor_commander"],this["prezi_editor_store_common"],this["prezi_editor_store_mode"],this["prezi_editor_store_object"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_meta"],this["prezi_spellcheck"],this["prezi_utils"],this["prezi_widgets"]);}}).call(this);