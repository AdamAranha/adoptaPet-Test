;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_ppt_insert";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi.engine.dom":dependencies[0],"prezi.engine.dom.converter.xpdom2":dependencies[1],"prezi.geometry":dependencies[2],"prezi.text":dependencies[3],"prezi.text.model":dependencies[4],"prezi_cet_model_editor":dependencies[5],"prezi_editor_commander":dependencies[6],"prezi_featureswitcher":dependencies[7],"prezi_i18n":dependencies[8],"prezi_koi_navigation":dependencies[9],"prezi_logger":dependencies[10],"prezi_plugin_api":dependencies[11],"prezi_plugin_meta":dependencies[12],"prezi_ppt_common":dependencies[13],"prezi_ppt_service":dependencies[14],"prezi_service_data":dependencies[15],"prezi_utils":dependencies[16],"prezi_widgets":dependencies[17]}};})());};})(arguments);var moduleImpl=(function(){return module(function(n){function I(a,d){return a.getState().uploadProcess.slideResults?a.getState().uploadProcess.slideResults.map((b,c)=>{var f;if(b.state===y.Error)return d.error({dataLookup:`ppt-slide-thumbnail-${b.slideOrder}`});const g=b.state===y.InProgress?`ppt-slide-thumbnail-progress-${b.slideOrder}`:`ppt-slide-thumbnail-${b.slideOrder}`;var q=a.getState().slidesInPrezi;q=-1!==Array.from(q.values()).indexOf(c+1)?{r:177,g:184,b:190,intensity:.4}:null;return d.droppableImage({id:`${c}`,src:{url:null===
(f=b.content)||void 0===f?void 0:f.thumbnail},blendColor:q,dataLookup:g})}):[]}var L=n.dependencies.prezi_ppt_service,t=n.dependencies.prezi_cet_model_editor,x=n.dependencies.prezi_editor_commander,A=n.dependencies.prezi_featureswitcher,k=n.dependencies.prezi_i18n,v=n.dependencies.prezi_logger,h=n.dependencies.prezi_plugin_api,e=n.dependencies.prezi_ppt_common,J=n.dependencies.prezi_service_data,B=n.dependencies.prezi_utils,u=n.dependencies.prezi_widgets,F=n.dependencies.prezi_koi_navigation,p={};
Object.defineProperty(p,"__esModule",{value:!0});F=F.Lookup.ZoomButton;p.SidebarId="ppt-sidebar-id";p.InsertButtonId="insert-ppt-button";p.StyleTabMenuId="style";p.TopicShapeMixerId="topic-shape-mixer-button";p.ZoominButtonId="selection-zoom-in-button";class C{}C.groupCalloutText=k.I18n.ts("Pick a few slides that belong together in the same chapter.");C.groupCalloutTitle=k.I18n.ts("Group your slides!");p.pptOnboardingSteps=[{id:"upload-in-progress",visual:{},isDone:(a)=>a.uploadFinished&&!a.uploadModalOpen},
{id:"multi-select",visual:{overlay:Object.assign(Object.assign({},x.DEFAULT_OVERLAY),{holes:[{around:{uiElementId:p.SidebarId},shape:u.HoleShape.rect,strict:!0,callout:{text:C.groupCalloutText,title:C.groupCalloutTitle,anchor:"left",media:{url:n.getResourceUrl("/multiselect.mp4"),type:u.CalloutMediaTypes.Mp4}}}]})},disableVisual:(a)=>!a.privacyNotificationChecked,onCompleted:()=>{v.avro.Avro.createDefaultLogger().logProgressedPptImportTutorial({tutorial_step:2,tutorial_step_name:"SLIDE_SELECT"})},
isDone:(a)=>2<=a.selectedIds.length||0<a.numberOfSlidesNotOnOverview},{id:"insert-slides",visual:{highlights:[{around:{uiElementId:p.InsertButtonId},shape:u.HoleShape.rounded,pulse:!0}]},isDone:(a)=>0<a.numberOfSlidesNotOnOverview},{id:"zoom-in",visual:{highlights:[{around:{uiElementId:p.ZoominButtonId},shape:u.HoleShape.rounded,pulse:!0}]},onCompleted:()=>{v.avro.Avro.createDefaultLogger().logProgressedPptImportTutorial({tutorial_step:4,tutorial_step_name:"NAVIGATION_FIRST_TOPIC"})},isDone:(a)=>
a.onNonOverview},{id:"open-tabmenu",visual:{highlights:[{around:{uiElementId:p.StyleTabMenuId},shape:u.HoleShape.rounded,pulse:!0}]},onCompleted:()=>{v.avro.Avro.createDefaultLogger().logProgressedPptImportTutorial({tutorial_step:5,tutorial_step_name:"OPEN_TABMENU"})},isDone:(a)=>a.tabMenuOpened||a.actualStyleId!==a.originalStyleId},{id:"style-mix",visual:{highlights:[{around:{uiElementId:p.TopicShapeMixerId},shape:u.HoleShape.rounded,pulse:!0}]},onCompleted:()=>{v.avro.Avro.createDefaultLogger().logProgressedPptImportTutorial({tutorial_step:6,
tutorial_step_name:"STYLE_MIX"})},fallback:{to:"open-tabmenu",when:(a)=>!a.tabMenuOpened},isDone:(a)=>a.actualStyleId!==a.originalStyleId},{id:"zoom-out",visual:{highlights:[{around:{uiElementId:F},shape:u.HoleShape.circle,pulse:!0}]},onCompleted:()=>{v.avro.Avro.createDefaultLogger().logProgressedPptImportTutorial({tutorial_step:7,tutorial_step_name:"ZOOM_OUT"})},isDone:(a)=>!a.onNonOverview},{id:"present",visual:{highlights:[{around:{uiElementId:"present-button"},shape:u.HoleShape.rounded,pulse:!0}]},
onCompleted:()=>{v.avro.Avro.createDefaultLogger().logProgressedPptImportTutorial({tutorial_step:8,tutorial_step_name:"PRESENT"})},setFlagsOnCompleted:[J.UserSettingBooleanKeys.JS_EDITOR_PPT_ONBOARDING],isDone:(a)=>!a.editMode}];var D={},E=this&&D.__awaiter||function(a,d,b,c){function f(a){return a instanceof b?a:new b(function(c){c(a)})}return new (b||(b=Promise))(function(b,q){function g(a){try{z(c.next(a))}catch(w){q(w)}}function e(a){try{z(c["throw"](a))}catch(w){q(w)}}function z(a){a.done?b(a.value):
f(a.value).then(g,e)}z((c=c.apply(a,d||[])).next())})};Object.defineProperty(D,"__esModule",{value:!0});D.PptUpload=class{constructor(a,d,b,c,f){this.onboarding=a;this.uiRoot=d;this.setState=b;this.uploadTimer=c;this.session=f;this.uploadToken=null;this.pptUploadUtils=e.createPptUploadUtils()}cancelUpload(){this.uploadToken=null}uploadPptFile(a,d){return E(this,void 0,void 0,function*(){const a=this.uploadToken=`${(new Date).getTime()}`,c=d.file;(()=>E(this,void 0,void 0,function*(){this.pptUploadUtils.logFilePickedForPptUpload(c,
d.source);let b;this.setState({uploadProcess:Object.assign(Object.assign({},this.uiRoot.getState().uploadProcess),{slideResults:[]}),slidesInPrezi:new Map});try{let d=this.uiRoot.getState().uploadProcess;this.pptUploadUtils.logUploadStarted(d.progress.startTime,d.jobId);this.setState({uploadProcess:Object.assign(Object.assign({},d),{state:e.UploadState.Uploading,fileName:c.name,slideResults:[],progress:Object.assign(Object.assign({},d.progress),{percentage:0,startTime:(new Date).getTime(),remainingTime:-1})})});
this.uploadTimer.run();b=yield this.session.document.progressiveAssetManager.uploadPpt(c,320,(a)=>this.uploadTimer.updateFileUploadPercentage(a));if(a!==this.uploadToken)return null;d=this.uiRoot.getState().uploadProcess;this.setState({uploadProcess:Object.assign(Object.assign({},d),{jobId:b.jobId})});return b}catch(g){return this.handleError(g,this.uiRoot.getState().uploadProcess.progress.startTime,null),null}}))().then((a)=>{null!=a&&this.handlePptUploadResult(a,this.uiRoot,a.jobId)})})}uploadSamplePptFile(a,
d){return E(this,void 0,void 0,function*(){try{const a=this.uploadToken=`${(new Date).getTime()}`;this.pptUploadUtils.logUploadStarted(d.progress.startTime,d.jobId);this.setState({uploadProcess:Object.assign(Object.assign({},d),{state:e.UploadState.Uploading,jobId:null,fileName:k.I18n.ts("Loading Sample PPT"),progress:Object.assign(Object.assign({},d.progress),{percentage:0,startTime:(new Date).getTime(),remainingTime:-1})}),slidesInPrezi:new Map});const c=this.session.document.progressiveAssetManager.getPpt(L.SAMPLE_PPT_JOB_ID,
320);v.avro.Avro.createDefaultLogger().logUseSamplePpt();c.then((c)=>{if(a!==this.uploadToken)return null;this.setState({uploadProcess:Object.assign(Object.assign({},this.uiRoot.getState().uploadProcess),{jobId:c.jobId})});this.handlePptUploadResult(c,this.uiRoot,c.jobId)})}catch(b){this.handleError(b,this.uiRoot.getState().uploadProcess.progress.startTime,null)}})}showError(a){null==a||null==a.state||a.modalShown||a.state!==e.UploadState.InvalidFileExtension&&a.state!==e.UploadState.Error||(this.onboarding.restartOnboarding(),
this.uiRoot.dialog.showError(k.I18n.ts("Ppt upload error"),this.calculateErrorModalText(a.state),"ppt_upload_error"),this.setState({uploadProcess:Object.assign(Object.assign({},a),{progress:e.IDLE_STATE_COMMON.progress,modalShown:!0})}))}calculateErrorModalText(a){switch(a){case e.UploadState.InvalidFileExtension:return k.I18n.ts("Unsupported file extension");case e.UploadState.Error:return k.I18n.ts("Unexpected error");default:return B.Utils.assertNever(a)}}handleError(a,d,b){if(this.uiRoot.getState().uploadProcess.jobId===
b){var c=this.uiRoot.getState().uploadProcess,f=e.UploadState.Error;c=Object.assign(Object.assign({},c),{progress:e.IDLE_STATE_COMMON.progress,state:f,modalShown:!1});this.setState({uploadProcess:c});this.showError(c);this.pptUploadUtils.logUploadError(d,b,a)}}handleSlidePromise(a,d,b){return E(this,void 0,void 0,function*(){return a.then((a)=>{const c=b.getState().uploadProcess;c.jobId===d&&(0===c.slideResults.length&&this.pptUploadUtils.logUploadFirstResult(c.progress.startTime,d),this.setState({uploadProcess:Object.assign(Object.assign({},
c),{slideResults:b.getState().uploadProcess.slideResults.map((c)=>c.slideOrder===a.slideAsset.sourcePageNumber?{content:a,state:r.SlideResultState.Done,slideOrder:a.slideAsset.sourcePageNumber,jobId:d}:c)})}))})})}handleSlidePromiseFailure(a,d){const b=this.uiRoot.getState().uploadProcess;b.jobId===d&&this.setState({uploadProcess:Object.assign(Object.assign({},b),{slideResults:b.slideResults.map((c)=>c.slideOrder===a?{content:null,state:r.SlideResultState.Error,slideOrder:a,jobId:d}:c)})})}handleFinishedOK(a){this.pptUploadUtils.logUploadComplete(this.uiRoot.getState().uploadProcess.progress.startTime,
this.uiRoot.getState().uploadProcess.jobId);v.avro.Avro.createDefaultLogger().logLoadedPptFile({ppt_slide_count:a.slides.length,ppt_import_flow_version:"VERSION_TWO"})}handleFinishedSlidesFailed(){var a=this.uiRoot.getState().uploadProcess;a=Object.assign(Object.assign({},a),{progress:e.IDLE_STATE_COMMON.progress,state:e.UploadState.Error});this.setState({uploadProcess:a})}handlePptImportFinished(a,d,b,c){if(b.getState().uploadProcess.jobId===c)switch(a){case "FinishedOk":this.handleFinishedOK(d);
this.setState({uploadFinished:!0});break;case "Crashed":this.setState({uploadFinished:!0});this.handleError(null,this.uiRoot.getState().uploadProcess.progress.startTime,c);this.pptUploadUtils.logUploadError(b.getState().uploadProcess.progress.startTime,c,`pptImportFinishedWith: ${a}`);break;case "FinishedStructureFailed":this.handleError(null,this.uiRoot.getState().uploadProcess.progress.startTime,c);this.pptUploadUtils.logUploadError(b.getState().uploadProcess.progress.startTime,c,`pptImportFinishedWith: ${a}`);
break;case "FinishedSlidesFailed":this.handleFinishedSlidesFailed();this.setState({uploadFinished:!0});break;default:B.Utils.assertNever(a)}}myPromiseAll(a,d){let b=0;return new Promise((c)=>{const f=()=>{null!==this.uiRoot.getState().uploadProcess&&this.uiRoot.getState().uploadProcess.jobId===d&&(b++,b===a.length&&c())};a.forEach((a)=>{a.slideResult.then(()=>f()).catch(()=>f())})})}handlePptUploadResult(a,d,b){this.setState({uploadProcess:Object.assign(Object.assign({},this.uiRoot.getState().uploadProcess),
{slideResults:a.slides.map((a)=>({content:null,state:r.SlideResultState.InProgress,slideOrder:a.slideOrder,jobId:b})).sort((a,b)=>a.slideOrder-b.slideOrder)})});this.myPromiseAll(a.slides,b).then(()=>{this.setState({uploadProcess:Object.assign(Object.assign({},this.uiRoot.getState().uploadProcess),{state:e.UploadState.UploadFinished,progress:e.IDLE_STATE_COMMON.progress,modalShown:!1})});null!=this.uploadTimer&&this.uploadTimer.isRunning()&&this.uiRoot.getState().uploadProcess.state===e.UploadState.UploadFinished&&
this.uploadTimer.finish()}).catch();a.slides.forEach((a)=>{this.handleSlidePromise(a.slideResult,b,d).catch(()=>this.handleSlidePromiseFailure(a.slideOrder,b))});a.fullPptResult.then((c)=>this.handlePptImportFinished(c,a,d,b)).catch(()=>{this.pptUploadUtils.logUploadError(d.getState().uploadProcess.progress.startTime,b,"Error during handling ppt status")})}};var G={};Object.defineProperty(G,"__esModule",{value:!0});var M=t.base.CoverLayoutRole,m=t.base.ObjectKind;G.SlideInsert=class{constructor(a){this.session=
a}insertSlides(a,d,b,c,f,g){const e=this.createSlideParent(b,c,d),l=e.topic;c=null!=l?l.id:null==c?this.session.insertTarget.getSimpleObjectParent(d).id:c;c=d.lookup.base(c);if(c.is(m.planetTopic)||c.is(m.overview))f=this.insertSlideIntoPlanetOrOverview(a,d,b,c,l,f,!e.hasFinalPosition,g);else if(c.is(m.stackTopic)||c.is(m.page))f=this.insertSlideIntoStackOrPage(a,d,b,c,g);else throw Error("invalid parent type");if(null!=l)this.session.selection.setSelection(a,[l]);else if(c.is(m.planetTopic)||c.is(m.overview))g=
f.map((a)=>d.lookup.topic(a)),this.session.selection.setSelection(a,g);v.avro.Avro.createDefaultLogger().logInsertPptSlide({ppt_slide_count:b.length,group_target:null!=l?"PPT_SLIDE":"TOPIC",target_object_id:null!=l?l.id:c.id,workflow_mode:"STANDARD"});return f}addNarrativeToTopic(a,d,b){null!=b.narrative&&(a=a.structuredPath.pathElementsInOrder.find((a)=>(a.is(t.base.ObjectKind.visitPlanet)||a.is(t.base.ObjectKind.visitPage))&&a.target.id===d),null!=a&&(a.narrative=b.narrative))}insertSlideIntoPlanetOrOverview(a,
d,b,c,f,g,e,l){const q=x.EditorCommander.createLayoutQuery(),z=x.EditorCommander.getLayoutRepository(),h=b.map((a)=>{const b=q.isSortedBySlideIdx(c)?c.layout.add.planet(q.findPositionBySlideIndex(a.sourcePageNumber,c)):c.layout.add.planet();b.contentChildren.forEach((a)=>a.delete());b.cover.contentChildren.forEach((a)=>a.delete());b.visual.contentChildren.filter((a)=>a.is(m.slide)).forEach((a)=>a.delete());var f=z.getPlanetLayoutInfos().find((a)=>a.id===b.layout.id);f=null!=f&&2===f.category?b.surface.add.slide(a):
b.visual.add.slide(a);l(a.sourcePageNumber,f.id);var g=b.simpleChildren(t.base.ChildVisibilityKind.outside).filter((a)=>!a.is(t.base.ObjectKind.slide)).map((a)=>a.layoutBox);0<g.length&&(g=g.reduce((a,b)=>a.union(b)),f.fitInto(g.scale(.7)));this.addNarrativeToTopic(d,b.id,a);return b}),w=x.EditorCommander.getLayoutRepository().getFocusedToContentLayoutId();null!=w&&h.forEach((a)=>{a.is(m.planetTopic)&&a.applyLayout(w)});null!=f&&(f.layout.reset(),f.applyTheme(f.getThemeIdForNewSubtopic(0,f.kind)));
b=h.map((a)=>a.id);((a,b)=>{const c=d.lookup.base(a);c.is(m.planetTopic)&&c.layout.adjust(b.map((a)=>{a=d.lookup.base(a);return null!=a&&a.is(t.base.ObjectKind.topic)&&a.parent===c?a:null}).filter((a)=>null!=a))})(c.id,b);e&&(e=h.filter((a)=>a.is(m.planetTopic)),this.positionNewlyInsertedTopics(e,c,f,g,this.session.positionFinder),this.session.navigation.flyTo(a,null!=f?f.parent:c));return b}insertSlideIntoStackOrPage(a,d,b,c,f){const g=c.is(m.stackTopic)?c:c.parent;let e=c.is(m.stackTopic)?g.pageChildren.length:
g.pageChildren.indexOf(c)+1;b=b.map((a)=>{const b=g.add.page(e++);b.simpleChildren(t.base.ChildVisibilityKind.inside).forEach((a)=>a.delete());const c=b.add.slide(a);f(a.sourcePageNumber,c.id);c.fitInto(b.zoomLayoutBox.scale(.9));this.addNarrativeToTopic(d,b.id,a);return b});c.is(m.page)&&0<b.length&&this.session.navigation.focusTo(a,b[b.length-1]);return b.map((a)=>a.id)}positionNewlyInsertedTopics(a,d,b,c,f){const g=null!=b?b.parent:d;if(g.is(m.overview)){const l=a.map((a)=>a.id),q=g.zoomLayoutBox.referenceFrame;
var e=g.zoomLayoutBox.size.width*f.getDefaultTopicWidthToContainerRatio();if(null!=b)d=g.topicChildren.filter((a)=>-1===l.indexOf(a.id)&&a.id!==b.id),e=this.getAverageWidth(g,[b.id],q,e),0<d.length&&b.fitInto(d[0].layoutBox),d=null!=c.x?f.findLayoutBox(g,42,42,c.x,c.y):f.findTopicPosition(b,d),this.positionTopic(b,e,d,q);else{const b=g.topicChildren.filter((a)=>-1===l.indexOf(a.id));0<b.length&&a.forEach((a)=>{a.fitInto(b[0].layoutBox)});const d=this.getAverageWidth(g,l,q,e);a.forEach((e,l)=>{l=null!=
c.x?f.findLayoutBox(g,42,42,c.x,c.y):f.findTopicPosition(e,b.concat(a.slice(0,l)));this.positionTopic(e,d,l,q)})}}}getAverageWidth(a,d,b,c){a=a.topicChildren.filter((a)=>-1===d.indexOf(a.id)).map((a)=>this.getAnchorBox(a)).filter((a)=>null!=a);const f=a.reduce((a,c)=>a+c.layoutBox.withReferenceFrame(b).size.width,0);return 0!==a.length?f/a.length:c}positionTopic(a,d,b,c){const f=this.getAnchorBox(a).layoutBox,g=d*f.size.height/f.size.width;d=b.withReferenceFrame(c).withSize({width:d,height:g});a.fitInto(a.layoutBox.align(f.centerLeft,
f.centerRight,d.centerLeft,d.centerRight))}getAnchorBox(a){a=a.simpleChildren(t.base.ChildVisibilityKind.outside);if(0===a.length)return null;let d=a[0];1<a.length&&(d=a[0].createLayoutGroupWith(a.slice(1)));return d}createSlideParent(a,d,b){if(null==d){if(d=this.session.insertTarget.getSimpleObjectParent(b),d.is(m.overview)&&1<a.length){const c=d.layout.add.planet();c.layout.reset();const f=c.contentChildren.filter((a)=>a.is(m.text));for(let a=1;a<f.length;++a)f[a].delete();f[0].contentLayoutRole=
t.base.ContentLayoutRole.contentTitle;this.setTopicTitle(c,a,b);d.layout.adjust([c]);return{topic:c,hasFinalPosition:!1}}}else if(a=b.lookup.base(d),a.is(m.planetTopic))return{topic:a,hasFinalPosition:!0};return{topic:null,hasFinalPosition:!1}}setTopicTitle(a,d,b){let c=a.cover.contentChildren.find((a)=>a.coverLayoutRole===M.coverTitle);null==c&&(c=a.cover.contentChildren.find((a)=>a.is(m.text)));a=d.reduce((a,b)=>a.sourcePageNumber<b.sourcePageNumber?a:b).title;null!=c&&null!=a&&""!==a&&(a=50<a.length?
a.slice(0,50)+"...":a,c.setText(a),c.isPlaceholder=!1,x.EditorCommander.createCounterpartUpdater(b).updateCounterpartTexts(c.id,x.UpdateOrigin.current))}};var r={},K=this&&r.__awaiter||function(a,d,b,c){function f(a){return a instanceof b?a:new b(function(b){b(a)})}return new (b||(b=Promise))(function(b,e){function g(a){try{h(c.next(a))}catch(w){e(w)}}function q(a){try{h(c["throw"](a))}catch(w){e(w)}}function h(a){a.done?b(a.value):f(a.value).then(g,q)}h((c=c.apply(a,d||[])).next())})};Object.defineProperty(r,
"__esModule",{value:!0});const H=Object.assign(Object.assign({},e.IDLE_STATE_COMMON),{slideResults:[]});r.insertModalId="pptPreloadInsertModal";var y;(function(a){a[a.InProgress=0]="InProgress";a[a.Error=1]="Error";a[a.Done=2]="Done"})(y=r.SlideResultState||(r.SlideResultState={}));class N{constructor(a,d){this.uiRoot=a;this.setState=d}getProcess(){return this.uiRoot.getState().uploadProcess}setProcess(a){this.setState({uploadProcess:Object.assign(Object.assign({},this.uiRoot.getState().uploadProcess),
a)})}}r.getThumbnailData=I;class O{constructor(){this.name="PptPlugin";this.supportsOffline=!1;this.pptUploadUtils=e.createPptUploadUtils()}openSidebar(){this.uiRoot.getState().isDirty&&this.updateOnDocumentChange();this.uiRoot.sidebar.open(p.SidebarId);this.setState({sidebarOpen:!0,sidebarClosedExplicitly:!1});this.licenseDownloadedPromise.then(()=>{this.uiRoot.getState().sidebarOpen&&(this.showPrivacyWarning(this.uiRoot.getState())?(this.setState({privacyNotificationShowed:!0}),this.uiRoot.dialog.showBuiltIn(h.BuiltinDialog.privacyPaywallWarning,
()=>{setTimeout(()=>this.setState({privacyNotificationChecked:!0}),u.DialogAnimationTime+1)})):setTimeout(()=>this.setState({privacyNotificationChecked:!0}),u.SidebarAnimationTime+1))})}showPrivacyWarning(a){return A.isActive("prezioption-pptcreate")&&(A.isActive("js-force-ppt-privacy-warning")||!a.license.pitchPrivacyPrivate)&&!a.privacyNotificationShowed}closeSidebar(){this.uiRoot.sidebar.close(p.SidebarId);this.setState({sidebarOpen:!1,sidebarClosedExplicitly:!0,selectedIds:[]})}closeModal(){this.uiRoot.dialog.hide(r.insertModalId);
this.setState({uploadModalOpen:!1})}processMessage(a){return K(this,void 0,void 0,function*(){switch(a.kind){case "handover":this.uploadTimer.isRunning()?this.uploadTimer.reset():this.uploadTimer.run();this.setState({uploadProcess:Object.assign(Object.assign({},this.uiRoot.getState().uploadProcess),{progress:Object.assign(Object.assign({},this.uiRoot.getState().uploadProcess.progress),a),jobId:a.jobId,state:e.UploadState.Uploading,fileName:a.fileName})});this.session.document.progressiveAssetManager.getPpt(a.jobId,
320).then((a)=>{null!=a&&this.pptUpload.handlePptUploadResult(a,this.uiRoot,a.jobId)});this.openSidebar();break;case "requestOpen":null==this.uiRoot.getState().uploadProcess.jobId||this.uiRoot.getState().sidebarClosedExplicitly||this.openSidebar();break;case "requestModalOpen":this.openPptUploadFileDialog();break;case "tabMenuOpened":this.setState({tabMenuOpened:!0});break;case "tabMenuClosed":this.setState({tabMenuOpened:!1});break;default:B.Utils.assertNever(a)}})}calculateButtonContent(a){switch(a){case e.UploadState.Idle:case e.UploadState.InvalidFileExtension:case e.UploadState.UploadFinished:return{text:k.I18n.ts("Upload PowerPoint")};
case e.UploadState.Uploading:return{text:k.I18n.ts("Uploading...")};default:return B.Utils.assertNever(a)}}openPptUploadFileDialog(){this.closeSidebar();this.uiRoot.dialog.show(r.insertModalId);this.setState({uploadModalOpen:!0})}uploadButton(a,d){return a.button(h.ButtonSize.Small,h.ButtonAlign.Center,(a)=>[a.button({id:"upload-ppt-button",color:h.ButtonColor.Blue,content:this.calculateButtonContent(d),disabled:d===e.UploadState.Uploading,onClick:()=>this.openPptUploadFileDialog()})])}onUploadRestart(){this.setState({uploadProcess:H});
this.openPptUploadFileDialog()}handleProgressBarCancel(){this.pptUpload.cancelUpload();this.uploadTimer.finish();this.openPptUploadFileDialog();this.initUploadTimer();this.setState({uploadFinished:!1,privacyNotificationChecked:!1,uploadProcess:Object.assign(Object.assign({},H),{progress:e.IDLE_STATE_COMMON.progress})});this.onboarding.restartOnboarding()}progressBarButton(a,d,b,c,f){return a.progressBar({id:"ppt-progressbar-id",title:b.split(/[\\/]/).pop(),titleTooltip:b,errorText:0<f.length&&f.some((a)=>
a.state===y.Error)?k.I18n.ts("Failed to upload some slides. Please click reload to try again"):d===e.UploadState.Error?k.I18n.ts("Failed to upload slides. Please click reload to try again"):null,caption:null!=c.prevPercentage?this.pptUploadUtils.calculateProgressMessage(c.remainingTime):null,percentage:null!=c.prevPercentage?c.percentage:d===e.UploadState.Error?100:0,onCancel:()=>this.handleProgressBarCancel(),onRestart:()=>this.onUploadRestart(),control:this.pptUploadUtils.calculateProgressBarControl(d)})}createProgressBarButton(a,
d){switch(d.state){case e.UploadState.Error:case e.UploadState.Uploading:return this.progressBarButton(a,d.state,d.fileName,d.progress,d.slideResults);case e.UploadState.Idle:case e.UploadState.UploadFinished:case e.UploadState.InvalidFileExtension:return null}}createTopPptButton(a,d,b){switch(d){case e.UploadState.Error:case e.UploadState.Uploading:return null;case e.UploadState.Idle:case e.UploadState.UploadFinished:case e.UploadState.InvalidFileExtension:return this.showsSomeResult(b)?null:this.uploadButton(a,
d)}}showsSomeResult(a){return a.uploadProcess.slideResults.some((a)=>a.state===y.Error||a.state===y.Done)}createBottomSection(a,d){if(this.showsSomeResult(d)){let b=!1,c=null;2>d.selectedIds.length&&this.onboarding.isActive()?(b=!0,c=k.I18n.ts("Please select at least 2 slides to insert.")):0===d.selectedIds.length&&(b=!0,c=k.I18n.ts("Please select a slide to insert."));return[a.button(h.ButtonSize.Large,h.ButtonAlign.Center,(a)=>[a.button({id:"insert-ppt-button",color:h.ButtonColor.Blue,content:{text:k.I18n.ts("Insert")},
disabled:b,tooltipText:c,tooltipPosition:"top",onClick:(a)=>{this.session.document.executeApiCommand(a,{name:"Insert ppt slides",run:(b)=>{const c=d.selectedIds.map((a)=>{a=d.uploadProcess.slideResults[parseInt(a,10)].content;return Object.assign(Object.assign({},a.slideAsset),{title:a.title,narrative:a.narrative})}),f=this.uiRoot.getState().slidesInPrezi;this.slideInsert.insertSlides(a,b,c,null,{x:null,y:null},(a,b)=>{f.set(b,a)});this.onboarding&&this.onboarding.isActive()?(b=this.session.selection.getSelectionInfo(b).allObjects,
0<b.length&&b[0].is(t.base.ObjectKind.topic)&&this.setState({originalStyleId:b[0].coverLayoutId,slidesInPrezi:f})):this.setState({slidesInPrezi:f})}});this.setState({selectedIds:[]})}}),a.button({id:"upload-ppt-button",color:h.ButtonColor.Gray,content:{text:k.I18n.ts("Upload New")},disabled:!1,onClick:()=>{this.setState({privacyNotificationChecked:!1});this.onboarding.restartOnboarding();this.openPptUploadFileDialog()}})])]}return[]}createSampleButtonProps(a,d){return{size:h.ButtonSize.Small,align:h.ButtonAlign.Center,
args:{id:"upload-sample-ppt-button",color:h.ButtonColor.Gray,content:{text:k.I18n.ts("Use sample .ppt file")},disabled:!1,onClick:(b)=>{d();this.pptUpload.uploadSamplePptFile(b,a)}}}}createLoadSamplePptButton(a,d,b){switch(d){case e.UploadState.Idle:return this.onboarding&&this.onboarding.isActive()&&!this.uiRoot.getState().uploadFinished?this.createSampleButtonProps(a,b):null;default:return null}}createSideBarContent(a){const {selectedIds:d,uploadProcess:b}=this.uiRoot.getState(),c=this.createLoadSamplePptButton(b,
b.state,()=>{}),f=[this.createProgressBarButton(a,b),this.createTopPptButton(a,b.state,this.uiRoot.getState()),null!=c?a.button(c.size,c.align,(a)=>[a.button(c.args)]):null,a.multiSelectList((a)=>({selectedIds:d,onSelectionChange:(a)=>{this.setState({selectedIds:a.selectedIds})},itemType:h.ListItemType.numbered,items:I(this.uiRoot,a),itemLayout:h.ListItemLayout.dynamic,progress:0===b.slideResults.length?h.ListProgress.working:h.ListProgress.finished,onDrop:(a,c)=>{this.session.document.executeApiCommand(a,
{name:"drop",run:(d)=>{const f=b.slideResults,e=c.draggedIds.map((a)=>f[parseInt(a,10)]).filter((a)=>null!=a.content).map((a)=>Object.assign(Object.assign({},a.content.slideAsset),{title:a.content.title,narrative:a.content.narrative})),g=this.uiRoot.getState().slidesInPrezi;this.slideInsert.insertSlides(a,d,e,c.targetTopic,{x:c.stageX,y:c.stageY},(a,b)=>{g.set(b,a)});this.setState({selectedIds:[],slidesInPrezi:g})}})},preziDataMimeParams:u.PreziDataMimeParam.snapTargetRegularPlanet|u.PreziDataMimeParam.snapTargetSlideOnOverview}))];
return[a.label(k.I18n.ts("Select one or more slides and click \u201cInsert\u201d to create a topic.")),...f]}init(a){a.onFileDrop({allowPpt:!0},(a,{data:c})=>K(this,void 0,void 0,function*(){this.uiRoot.getState().sidebarOpen||this.openSidebar();this.pptUpload.uploadPptFile(a,c)}));a.onApplicationModeChange((a)=>{this.setState({editMode:a===h.ApplicationMode.Edit})});a.onLicenseChange((a)=>this.setState({license:a}));this.licenseDownloadedPromise=new Promise((b)=>{a.onLicenseChange((a)=>{a.isDefaultLicense||
b()})});const d=a.declareUI({uploadFinished:!1,sidebarOpen:!1,sidebarClosedExplicitly:!1,uploadProcess:H,currentTopic:null,onNonOverview:!1,selectedIds:[],tabMenuOpened:null,numberOfSlidesNotOnOverview:null,uploadModalOpen:!1,license:null,privacyNotificationShowed:!1,editMode:!0,actualStyleId:null,originalStyleId:null,slidesInPrezi:new Map,privacyNotificationChecked:!1,isDirty:!1},({sidebarOpen:a,uploadProcess:c,editMode:d},e)=>{e.createMenuItem({kind:h.MenuItemKind.largeButton,enabled:d,onClick:()=>
{a?(this.uiRoot.sidebar.close(p.SidebarId),this.setState({sidebarClosedExplicitly:!0})):(null==this.uiRoot.getState().uploadProcess.jobId?this.openPptUploadFileDialog():(this.openSidebar(),this.setState({sidebarClosedExplicitly:!1})),v.avro.Avro.createDefaultLogger().logShowPptInsertOptions({ppt_import_flow_version:"VERSION_TWO"}))},parent:h.TabMenuId.Insert,weight:7,icon:h.IconSmallId.Ppt,id:"menu-item-open-ppt-sidebar",title:k.I18n.ts("PowerPoint")});const b=(a)=>{let b=[];b.push(a.droparea({text:k.I18n.ts("**Drag and drop** your .ppt file here or upload one from your computer."),
illustration:h.IllustrationSmallId.Ppt,caption:k.I18n.ts("We recommend using files under 15 MB (about 30 slides) for quicker uploads."),filter:{allowPpt:!0},onFileSelected:(a,b)=>{this.setState({privacyNotificationChecked:!1});this.onboarding.restartOnboarding();this.openSidebar();this.closeModal();this.pptUpload.uploadPptFile(a,b)},color:h.ButtonColor.Blue}));const d=this.createLoadSamplePptButton(c,c.state,()=>{this.openSidebar();this.closeModal()});null!=d&&(b.push(a.separator()),b.push(a.button(d.size,
d.align,(a)=>[a.button(d.args)])));return b};e.dialog.small((a)=>({id:r.insertModalId,title:k.I18n.ts("Upload PowerPoint file"),align:h.DialogAlign.center,content:b(a),onCloseButtonClicked:()=>{this.closeModal()}}));e.createSidebar((a)=>({id:p.SidebarId,onClose:()=>{this.setState({sidebarOpen:!1,selectedIds:[]})},disableClose:this.onboarding&&this.onboarding.isActive(),onCloseButtonClicked:()=>{this.setState({sidebarClosedExplicitly:!0,selectedIds:[]})},root:{title:k.I18n.ts("PowerPoint"),content:this.createSideBarContent(a),
footer:this.createBottomSection(a,this.uiRoot.getState())}}));this.onboarding.declareUI(e)});this.uiRoot=d;this.setState=(a)=>{d.setState(a);this.onboarding.refreshOnboarding()};this.onboarding=x.EditorCommander.createOnboarding(p.pptOnboardingSteps,this.uiRoot,A.isActive("js-force-ppt-onboarding")?"force":A.isActive("js-disable-ppt-onboarding")?"disable":[J.UserSettingBooleanKeys.JS_EDITOR_PPT_ONBOARDING],this.userSettings);this.initUploadTimer();a.onApplicationModeChange((a)=>{this.setState({editMode:a===
h.ApplicationMode.Edit})});a.onCurrentTopicChange((a)=>{const b=this.session.document.read((b)=>b.overview.id!==a);this.setState({currentTopic:a,onNonOverview:b})});this.pptUpload=new D.PptUpload(this.onboarding,this.uiRoot,this.setState,this.uploadTimer,this.session);this.slideInsert=new G.SlideInsert(this.session);a.onDocumentChange(()=>{this.uiRoot.getState().sidebarOpen||this.onboarding.isActive()?this.updateOnDocumentChange():this.setState({isDirty:!0})})}updateOnDocumentChange(){var a=this.session.document.read((a)=>
a.lookup.findAll(t.base.ObjectKind.slide).filter((b)=>b.parent!==a.overview).length);this.setState({numberOfSlidesNotOnOverview:a});a=this.session.document.read((a)=>0<a.overview.topicChildren.length?a.overview.topicChildren[0].coverLayoutId:null);this.session.document.read((a)=>{const b=this.uiRoot.getState().slidesInPrezi;Array.from(b.keys()).filter((b)=>null==a.lookup.base(b)).forEach((a)=>b.delete(a));this.setState({slidesInPrezi:b})});null!=a&&this.setState({actualStyleId:a});this.setState({isDirty:!1})}initUploadTimer(){null!=
this.uploadTimer?this.uploadTimer.reset():this.uploadTimer=e.createUploadTimer(e.createProgressState(new N(this.uiRoot,this.setState)))}unload(){null!=this.uploadTimer&&this.uploadTimer.reset()}}r.PptPlugin=O;n={};Object.defineProperty(n,"__esModule",{value:!0});n.lazyModule={createPlugin(){return new r.PptPlugin}};return n});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_ppt_insert",["require","prezi.engine.dom","prezi.engine.dom.converter.xpdom2","prezi.geometry","prezi.text","prezi.text.model","prezi_cet_model_editor","prezi_editor_commander","prezi_featureswitcher","prezi_i18n","prezi_koi_navigation","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_ppt_common","prezi_ppt_service","prezi_service_data","prezi_utils","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_ppt_insert.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi.engine.dom"),require("prezi.engine.dom.converter.xpdom2"),require("prezi.geometry"),require("prezi.text"),require("prezi.text.model"),require("prezi_cet_model_editor"),require("prezi_editor_commander"),require("prezi_featureswitcher"),require("prezi_i18n"),require("prezi_koi_navigation"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_ppt_common"),require("prezi_ppt_service"),require("prezi_service_data"),require("prezi_utils"),require("prezi_widgets"));}else{this["prezi_ppt_insert"]=__factory(this["prezi.engine.dom"],this["prezi.engine.dom.converter.xpdom2"],this["prezi.geometry"],this["prezi.text"],this["prezi.text.model"],this["prezi_cet_model_editor"],this["prezi_editor_commander"],this["prezi_featureswitcher"],this["prezi_i18n"],this["prezi_koi_navigation"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_ppt_common"],this["prezi_ppt_service"],this["prezi_service_data"],this["prezi_utils"],this["prezi_widgets"]);}}).call(this);