;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_textstyleprovider";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_cet_model_editor":dependencies[0],"prezi_featureswitcher":dependencies[1],"prezi_logger":dependencies[2],"prezi_plugin_api":dependencies[3],"prezi_service_fontcatalogue":dependencies[4],"prezi_utils":dependencies[5]}};})());};})(arguments);var moduleImpl=(function(){return module(function(e){var t=e.dependencies.prezi_cet_model_editor,C=e.dependencies.prezi_logger,D=e.dependencies.prezi_service_fontcatalogue,E=e.dependencies.prezi_utils,p={},z=this&&p.u||function(a,c,b,d){function f(a){return a instanceof b?a:new b(function(b){b(a)})}return new (b||(b=Promise))(function(b,n){function m(a){try{g(d.next(a))}catch(h){n(h)}}function k(a){try{g(d["throw"](a))}catch(h){n(h)}}function g(a){a.done?b(a.value):f(a.value).then(m,k)}g((d=d.apply(a,c||[])).next())})};Object.defineProperty(p,
"__esModule",{value:!0});p.o=class{constructor(a){this.service=a}getCustomTextStyles(){return z(this,void 0,void 0,function*(){return yield this.service.read("GET",[],{"custom-font-allowed":"true"})})}saveCustomTextStyle(a){return z(this,void 0,void 0,function*(){return this.isEmpty(a.id)?yield this.service.access("POST",[],{},a):yield this.service.access("PUT",[a.id],{},a)})}deleteCustomTextStyle(a){return z(this,void 0,void 0,function*(){return yield this.service.read("DELETE",[a],{})})}isEmpty(a){return!a||
0===a.length}};p.o.ma=["api","v4","usersettings","text_schemes"];var u={},F=this&&u.u||function(a,c,b,d){function f(a){return a instanceof b?a:new b(function(b){b(a)})}return new (b||(b=Promise))(function(b,n){function m(a){try{g(d.next(a))}catch(h){n(h)}}function k(a){try{g(d["throw"](a))}catch(h){n(h)}}function g(a){a.done?b(a.value):f(a.value).then(m,k)}g((d=d.apply(a,c||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0});u.ja=class{constructor(){this.ha=new Map}get(a,c){return F(this,
void 0,void 0,function*(){var b=this.ha.get(a.fontFamily);if(b)return b;b=this.downloadFont(a,c);this.ha.set(a.fontFamily,b);return b})}isBuiltinFont(a){return D.isBuiltinFont(a)}downloadFont(a,c){let b=c.document.progressiveAssetManager.getFontDescription(a.fontFamily);if(null==b){if(!a.isCustom)throw Error(`Font '${a.fontFamily}' cannot be downloaded`);b=c.document.progressiveAssetManager.createFontDescription(a.fontFamily,a.customKegProperties.normalKeg,a.customKegProperties.boldKeg,a.customKegProperties.italicKeg,
a.customKegProperties.boldItalicKeg)}return c.document.progressiveAssetManager.downloadFont(b)}};var v={},A=this&&v.u||function(a,c,b,d){function f(a){return a instanceof b?a:new b(function(b){b(a)})}return new (b||(b=Promise))(function(b,n){function m(a){try{g(d.next(a))}catch(h){n(h)}}function k(a){try{g(d["throw"](a))}catch(h){n(h)}}function g(a){a.done?b(a.value):f(a.value).then(m,k)}g((d=d.apply(a,c||[])).next())})};Object.defineProperty(v,"__esModule",{value:!0});v.la=class{constructor(a){this.i=
a}drawTextStyleThumbnail(a,c,b){return A(this,void 0,void 0,function*(){var d=B.get(a.fontFamily);d=d?d.aa:"Title";var f=B.get(c.fontFamily);f=f?f.v:"Body text";const m=151.2/f.length;d=yield this.ea(d,a,75.6,48.6,0,Math.min(43.2,189/d.length),!0,b);f=yield this.ea(f,c,86.4,27,54,m,!1,b);return E.Utils.svgToUrl(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0, 0, ${108}, ${108}" width="${108}" height="${108}">
<path d="${d}"/>
<path d="${f}"/>
</svg>`)})}ea(a,c,b,d,f,m,n,l){return A(this,void 0,void 0,function*(){var k=yield this.i.get(c,l);k=yield k.getDrawer(c.hasBold&&k.hasBold?t.base.FontWeight.Bold:t.base.FontWeight.Normal,c.hasItalic&&k.hasItalic?t.base.FontStyle.Italic:t.base.FontStyle.Normal);let g=!1,r=m,h=0;for(var e=0;!g;)e=k.getPath(a,0,0,r).getBoundingBox(),h=Math.abs(e.x2-e.x1),e=Math.abs(e.y2-e.y1),h<b&&e<d?g=!0:(r-=5,0>r&&(r=1,g=!0));return k.getPath(a,(108-h)/2,n?f+54:f+54-(54-e)/2*1.4,r).drawIntoSvgPath()})}};const B=
new Map([{fontFamily:"DFScreenMing-A",aa:"\u6a19\u984c",v:"\u4e3b\u9ad4"},{fontFamily:"NanumGothic",aa:"\uc81c\ubaa9",v:"\ubcf8\ubb38 \ud14d\uc2a4\ud2b8"},{fontFamily:"NotoSansJP",aa:"\u30bf\u30a4\u30c8\u30eb",v:"\u672c\u6587\u30c6\u30ad\u30b9\u30c8"}].map((a)=>[a.fontFamily,a]));var w={};Object.defineProperty(w,"__esModule",{value:!0});w.ia=[{id:"preset-1",fontScheme:{title:{fontFamily:"Arimo",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"Arimo",hasBold:!0,hasItalic:!1,hasBackground:!1},
subtitle2:{fontFamily:"Arimo",hasBold:!0,hasItalic:!1,hasBackground:!1},body:{fontFamily:"Arimo",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"Arimo",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-2",fontScheme:{title:{fontFamily:"NotoSans",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"NotoSans",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"NotoSans",hasBold:!0,hasItalic:!1,hasBackground:!1},body:{fontFamily:"Vollkorn",hasBold:!1,hasItalic:!1,
hasBackground:!1},body2:{fontFamily:"Vollkorn",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-3",fontScheme:{title:{fontFamily:"WorkSans",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"WorkSans",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"WorkSans",hasBold:!1,hasItalic:!1,hasBackground:!1},body:{fontFamily:"WorkSans",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"WorkSans",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-4",fontScheme:{title:{fontFamily:"Questrial",
hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"Questrial",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"Questrial",hasBold:!1,hasItalic:!1,hasBackground:!1},body:{fontFamily:"Questrial",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"Questrial",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-5",fontScheme:{title:{fontFamily:"Oswald",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"Oswald",hasBold:!1,hasItalic:!1,hasBackground:!1},
subtitle2:{fontFamily:"Oswald",hasBold:!1,hasItalic:!1,hasBackground:!1},body:{fontFamily:"OpenSans",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"OpenSans",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-6",fontScheme:{title:{fontFamily:"Titillium",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"Titillium",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"Titillium",hasBold:!1,hasItalic:!1,hasBackground:!1},body:{fontFamily:"Titillium",hasBold:!1,
hasItalic:!1,hasBackground:!1},body2:{fontFamily:"Titillium",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-7",fontScheme:{title:{fontFamily:"Vollkorn",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"Vollkorn",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"Vollkorn",hasBold:!1,hasItalic:!1,hasBackground:!1},body:{fontFamily:"Arimo",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"Arimo",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-8",
fontScheme:{title:{fontFamily:"FreeSerif",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"FreeSerif",hasBold:!0,hasItalic:!0,hasBackground:!1},subtitle2:{fontFamily:"FreeSerif",hasBold:!0,hasItalic:!0,hasBackground:!1},body:{fontFamily:"FreeSerif",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"FreeSerif",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-9",fontScheme:{title:{fontFamily:"KGEmpireofDirt",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"KGEmpireofDirt",
hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"KGEmpireofDirt",hasBold:!1,hasItalic:!1,hasBackground:!1},body:{fontFamily:"OpenSans",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"OpenSans",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-10",fontScheme:{title:{fontFamily:"GreatVibes",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"GreatVibes",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"GreatVibes",hasBold:!1,hasItalic:!1,
hasBackground:!1},body:{fontFamily:"Arimo",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"Arimo",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-11",fontScheme:{title:{fontFamily:"DFScreenMing-A",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"DFScreenMing-A",hasBold:!1,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"DFScreenMing-A",hasBold:!1,hasItalic:!1,hasBackground:!1},body:{fontFamily:"DFScreenMing-A",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"DFScreenMing-A",
hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-12",fontScheme:{title:{fontFamily:"NanumGothic",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"NanumGothic",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"NanumGothic",hasBold:!0,hasItalic:!1,hasBackground:!1},body:{fontFamily:"NanumGothic",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"NanumGothic",hasBold:!1,hasItalic:!1,hasBackground:!1}}},{id:"preset-13",fontScheme:{title:{fontFamily:"NotoSansJP",
hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle:{fontFamily:"NotoSansJP",hasBold:!0,hasItalic:!1,hasBackground:!1},subtitle2:{fontFamily:"NotoSansJP",hasBold:!0,hasItalic:!1,hasBackground:!1},body:{fontFamily:"NotoSansJP",hasBold:!1,hasItalic:!1,hasBackground:!1},body2:{fontFamily:"NotoSansJP",hasBold:!1,hasItalic:!1,hasBackground:!1}}}].map((a)=>Object.assign(Object.assign({},a),{title:a.id,isCustom:!1}));var q={};Object.defineProperty(q,"__esModule",{value:!0});var x;(function(a){a.title="title";
a.subtitle="subtitle";a.subtitle2="subtitle2";a.body="body";a.body2="body2"})(x||(x={}));q.j=class{static ca(a){const {id:c,title:b,fontScheme:d}=a;return{id:c,title:b,isCustom:!0,fontScheme:d}}static na(a){const {id:c,title:b,fontScheme:d}=a;Object.keys(x).forEach((b)=>{b=a.fontScheme[x[b]];b.isCustom&&(null==b.customKegProperties.boldKeg&&delete b.customKegProperties.boldKeg,null==b.customKegProperties.italicKeg&&delete b.customKegProperties.italicKeg,null==b.customKegProperties.boldItalicKeg&&
delete b.customKegProperties.boldItalicKeg)});return{id:c,title:b,fontScheme:d}}static convertFontSchemeToTextStyle(a,c){return{id:c,title:c,fontScheme:a,isCustom:!1}}};var y={},l=this&&y.u||function(a,c,b,d){function f(a){return a instanceof b?a:new b(function(b){b(a)})}return new (b||(b=Promise))(function(b,e){function l(a){try{g(d.next(a))}catch(h){e(h)}}function k(a){try{g(d["throw"](a))}catch(h){e(h)}}function g(a){a.done?b(a.value):f(a.value).then(l,k)}g((d=d.apply(a,c||[])).next())})};Object.defineProperty(y,
"__esModule",{value:!0});y.ka=class{constructor(a){this.i=new u.ja;this.logger=C.LoggerModule.getLoggerManager().createLogger("TextStyleProviderImpl");this.f=a.service(p.o.ma,(a)=>new p.o(a));this.$=new v.la(this.i)}getPresetTextStyles(a){return l(this,void 0,void 0,function*(){this.ba||(this.ba=this.w(w.ia,a).then(()=>this.fa(w.ia,a)));return this.ba})}getCustomTextStyles(a){return l(this,void 0,void 0,function*(){var c=yield this.f.getCustomTextStyles();c=this.da(c);c=yield this.w(c,a);return this.fa(c,
a)})}saveCustomTextStyle(a,c){return l(this,void 0,void 0,function*(){var b=q.j.na(a);b=yield this.f.saveCustomTextStyle(b);const d=q.j.ca(b);return this.w([d],c).then(()=>this.ga(d,c))})}deleteCustomTextStyle(a){return l(this,void 0,void 0,function*(){yield this.f.deleteCustomTextStyle(a.id)})}deleteAllCustomTextStyles(){return l(this,void 0,void 0,function*(){var a=yield this.f.getCustomTextStyles();a=this.da(a);for(const c of a)yield this.f.deleteCustomTextStyle(c.id)})}isBuiltinFont(a){return this.i.isBuiltinFont(a)}drawTextStyleThumbnail(a,
c,b){return l(this,void 0,void 0,function*(){return yield this.$.drawTextStyleThumbnail(a,c,b)})}convertFontSchemeToTextStyle(a,c,b){return l(this,void 0,void 0,function*(){const d=q.j.convertFontSchemeToTextStyle(a,c),f=yield this.$.drawTextStyleThumbnail(a.title,a.body,b);return Object.assign(Object.assign({},d),{thumbnailUrl:f})})}da(a){const c=[];for(const b of Object.keys(a))c.push(q.j.ca(a[b]));return c}w(a,c){return l(this,void 0,void 0,function*(){const b=new Set,d=new Map;a.forEach((a)=>
{d.set(a.fontScheme.title.fontFamily,a.fontScheme.title);d.set(a.fontScheme.subtitle.fontFamily,a.fontScheme.subtitle);d.set(a.fontScheme.subtitle2.fontFamily,a.fontScheme.subtitle2);d.set(a.fontScheme.body.fontFamily,a.fontScheme.body);d.set(a.fontScheme.body2.fontFamily,a.fontScheme.body2)});for(const a of d.values())try{yield this.i.get(a,c)}catch(m){this.logger.error({action:"failed_to_load_resource",object:"text_style_provider",trigger:"machine",payload:{message:`Error while downloading font '${a.fontFamily}'`,
error:m.toString()}}),b.add(a.fontFamily)}return 0<b.size?a.filter((a)=>!b.has(a.fontScheme.title.fontFamily)&&!b.has(a.fontScheme.subtitle.fontFamily)&&!b.has(a.fontScheme.subtitle2.fontFamily)&&!b.has(a.fontScheme.body.fontFamily)&&!b.has(a.fontScheme.body2.fontFamily)):a})}fa(a,c){return l(this,void 0,void 0,function*(){const b=[];a.forEach((a)=>{a=this.ga(a,c);b.push(a)});return Promise.all(b)})}ga(a,c){return l(this,void 0,void 0,function*(){return this.$.drawTextStyleThumbnail(a.fontScheme.title,
a.fontScheme.body,c).then((b)=>Object.assign(Object.assign({},a),{thumbnailUrl:b}))})}};e={};Object.defineProperty(e,"__esModule",{value:!0});(function(a){let c;a.getTextStyleProvider=function(a){null==c&&(c=new y.ka(a));return c}})(e.TextStyleProviderModule||(e.TextStyleProviderModule={}));return e});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_textstyleprovider",["require","prezi_cet_model_editor","prezi_featureswitcher","prezi_logger","prezi_plugin_api","prezi_service_fontcatalogue","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_textstyleprovider.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_cet_model_editor"),require("prezi_featureswitcher"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_service_fontcatalogue"),require("prezi_utils"));}else{this["prezi_textstyleprovider"]=__factory(this["prezi_cet_model_editor"],this["prezi_featureswitcher"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_service_fontcatalogue"],this["prezi_utils"]);}}).call(this);