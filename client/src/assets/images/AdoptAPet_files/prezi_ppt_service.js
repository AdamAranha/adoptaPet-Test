;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_ppt_service";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_bacon":dependencies[0],"prezi_bbpptximportapitypes":dependencies[1],"prezi_featureswitcher":dependencies[2],"prezi_service_http":dependencies[3],"prezi_utils":dependencies[4]}};})());};})(arguments);var moduleImpl=(function(){return module(function(r){function C(c,d){var b=d.times,a=c.timeout;return function(f,t,p){function A(){$.ajax(e).retry({times:b-1,timeout:d.timeout,statusCodes:d.statusCodes}).pipe(g.resolve,g.reject)}var e=this,g=new $.Deferred,l=c.getResponseHeader("Retry-After");1<b&&(!c.statusCodes||-1<$.inArray(f.status,c.statusCodes))?(l&&(a=isNaN(l)?(new Date(l)).getTime()-$.now():1E3*parseInt(l,10),isNaN(a)||0>a)&&(a=c.timeout),void 0!==a?setTimeout(A,a):A()):g.rejectWith(this,arguments);return g}}var m=r.dependencies.prezi_bacon,
h=r.dependencies.prezi_bbpptximportapitypes,y=r.dependencies.prezi_featureswitcher,v=r.dependencies.prezi_service_http,q=r.dependencies.prezi_utils;"$"in window&&$.ajaxTransport("+binary",function(c){if(window.FormData&&(c.dataType&&"binary"==c.dataType||c.data&&(window.ArrayBuffer&&c.data instanceof ArrayBuffer||window.Blob&&c.data instanceof Blob)))return{send:function(d,b){var a=new XMLHttpRequest,f=c.url,t=c.type,p=c.async||!0,e=c.responseType||"blob",h=c.data||null,g=c.username||null,l=c.password||
null;a.addEventListener("load",function(){var f={};f[c.dataType]=a.response;b(a.status,a.statusText,f,a.getAllResponseHeaders())});a.open(t,f,p,g,l);for(var n in d)a.setRequestHeader(n,d[n]);a.responseType=e;a.send(h)},abort:function(){}}});"$"in window&&$.ajaxPrefilter(function(c,d,b){b.retry=function(a){a.timeout&&(this.timeout=a.timeout);a.statusCodes&&(this.statusCodes=a.statusCodes);return this.pipe(null,C(this,a))}});var k={},D=this&&k.da||function(c,d,b,a){function f(a){return a instanceof
b?a:new b(function(b){b(a)})}return new (b||(b=Promise))(function(b,p){function t(b){try{g(a.next(b))}catch(n){p(n)}}function e(b){try{g(a["throw"](b))}catch(n){p(n)}}function g(a){a.done?b(a.value):f(a.value).then(t,e)}g((a=a.apply(c,d||[])).next())})};Object.defineProperty(k,"__esModule",{value:!0});k.h=class{constructor(c,d,b){this.hostname=c;this.S=d;this.R=b;this.G={}}static P(c){return new k.h(c)}static ja(c,d){return new k.h(c,(b,a,f)=>{b={N:-1,ma:!1,M:!1,ia:[]};if(f.match(/test_/)){const [a,
c]=f.split(".")[0].split("_").splice(1);b=Object.assign(Object.assign({},b),{N:JSON.parse(a),M:JSON.parse(c)})}return new x.Z(a,f,e.SAMPLE_NUMBER_OF_SLIDES_TO_SHOW,b,d)},y.isActive("js-test-local-ppt-upload")?200:1)}subscribeForStatusEvents(c,d,b){const a=this.G[d];a?a.na(b):this.G[d]=q.Utils.ActorSystem().startSyncActor(`import-status-${d}`,z.X,{F:d===e.SAMPLE_PPT_JOB_ID?new x.ca:this.S?this.S(this.hostname,c,d):new x.aa(this.hostname,d),m:b,H:this.R?this.R:k.h.Y,unregister:()=>{this.G[d]=void 0}})}};
k.h.Y=1E3;var x;(function(c){class d{constructor(a,b){this.hostname=a;this.importId=b}u(a){const b=Object.assign(Object.assign({},v.HttpService.getDefaultRetryOptions()),{times:30,timeout:2E3});a=v.HttpService.createJsonAjaxSettings("GET",`${this.hostname}/api/v1/pptx-import/${this.importId}/?includeStructure=${a}`);a.xhrFields={withCredentials:!0};return v.HttpService.createJQueryHttpRequester(a,b,!0).request().map((a)=>a)}}c.aa=d;class b{u(){return m.Bacon.fromPromise(this.ga())}ga(){return D(this,
void 0,void 0,function*(){return yield(yield fetch(r.getResourceUrl("sampleppt.json"))).json()})}}c.ca=b;class a{constructor(a,b,c,d,e){this.ka=a;this.importId=b;this.o=c;this.s=d;this.U=e;this.oa={title:"Dummy title",notes:"Dummy narrative",number:1,texts:[],pictures:[]};this.structure={format:h.PowerPointStructure.FormatEnum.Pptx,slides:[...Array(this.o).keys()].map((a)=>this.fa(a+1)),width:960,height:540};this.g=0;this.c=null;this.failedSlides=[];this.f=[];this.v=!1;this.i={preziOid:this.ka,importId:this.importId,
sourceFileName:"dummy.pptx",uploadedAt:new Date,importStatus:h.ModelImport.ImportStatusEnum.InProgress,slideMediaAssets:[],failedSlideNumbers:[]};this.ha()}ha(){this.c=this.g=0;this.failedSlides=[];this.f=[]}fa(a){return Object.assign(Object.assign({},this.oa),{number:a})}A(a){const b=Math.floor((a-1)/4);return{slideNumber:a,pdfAsset:{onlineAssetId:e.SAMPLE_ONLINE_ASSET_IDS[b],onlineAssetUrl:e.SAMPLE_ONLINE_ASSET_URLS[b],pageNumber:Math.max(1,a%4)},pdfAssetWithoutBackground:{onlineAssetId:e.SAMPLE_BG_ONLINE_ASSET_IDS[b],
onlineAssetUrl:e.SAMPLE_BG_ONLINE_ASSET_URLS[b],pageNumber:Math.max(1,a%4)}}}u(a){var b=a?this.structure:null;if(this.v)this.g++;else if(3>this.g)this.g++;else{if(null!=this.U&&!this.U())return m.Bacon.once(Object.assign(Object.assign({},this.i),{structure:b}));this.g++;this.c=null==this.c?this.g-3:Math.min(this.o,this.c+1)}if(0<this.c&&this.s.N===this.c){if(this.s.M)return b=m.Bacon.once(Object.assign(Object.assign({},this.i),{structure:this.structure,importStatus:h.ModelImport.ImportStatusEnum.Done,
slideMediaAssets:this.f.map((a)=>this.A(a)),failedSlideNumbers:this.failedSlides})),this.v=!0,b;this.failedSlides.push(this.c);return m.Bacon.once(Object.assign(Object.assign({},this.i),{slideMediaAssets:this.f.map((a)=>this.A(a)),failedSlideNumbers:this.failedSlides,importStatus:h.ModelImport.ImportStatusEnum.InProgress}))}if(-1<this.s.ia.indexOf(this.g))return null!=this.c&&this.f.length<this.o&&this.f.push(this.c),this.u(a);switch(this.g){case 1:return m.Bacon.once(this.i);case 2:case 3:return this.s.ma?
(this.v=!0,m.Bacon.once(Object.assign(Object.assign({},this.i),{importStatus:h.ModelImport.ImportStatusEnum.Done}))):m.Bacon.once(Object.assign(Object.assign({},this.i),{structure:b}));default:return this.f.length<this.o&&this.f.push(this.c),a=this.f.length+this.failedSlides.length===this.o,b=m.Bacon.once(Object.assign(Object.assign({},this.i),{structure:b,slideMediaAssets:this.f.map((a)=>this.A(a)),failedSlideNumbers:this.failedSlides,importStatus:a?h.ModelImport.ImportStatusEnum.Done:h.ModelImport.ImportStatusEnum.InProgress})),
a&&(this.v=!0),b}}}c.Z=a})(x=k.ba||(k.ba={}));var z;(function(c){class d{constructor(b,a){this.F=a.F;this.H=a.H;this.unregister=a.unregister;this.b=b({initialBehaviour:this.W({a:[a.m]})});this.w(!0);this.b.info("started")}na(b){this.b.tell({kind:"NewSubscriberForStatusEvents",m:b})}W(b){return{name:"waitingForStructure",handler:(a)=>{switch(a.kind){case "NewSubscriberForStatusEvents":return this.W(Object.assign(Object.assign({},b),{a:b.a.concat(a.m)}));case "ImportStatusQueryResponse":var f=a.response.structure;
const c=a.response.importStatus;if(f){const d=a.response.slideMediaAssets;a=a.response.failedSlideNumbers;switch(c){case h.ModelImport.ImportStatusEnum.InProgress:return this.T(b.a,f),this.I(b.a,d,a),this.w(!1),this.J({a:b.a,structure:f,slides:d,failedSlides:a,D:this.V(d,a)});case h.ModelImport.ImportStatusEnum.Done:return f=this.O(d,a,f),this.j(b.a,f),this.B({C:f});default:return this.l(b.a,"ImportStatusResponse",`Unhandled importStatus ${c}`)}}else switch(c){case h.ModelImport.ImportStatusEnum.InProgress:return this.L(!0),
this.b.same();case h.ModelImport.ImportStatusEnum.Done:return f={kind:"FinishedStructureFailed",slides:a.response.slideMediaAssets,failedSlides:a.response.failedSlideNumbers},this.j(b.a,f),this.B({C:f});default:return this.l(b.a,"ImportStatusResponse",`Unhandled importStatus ${c}`)}case "ImportStatusQueryFailure":return this.l(b.a,"ImportStatusQueryFailure",a.error.message);default:return q.Utils.assertNever(a)}}}}J(b){return{name:"waitingForFinish",handler:(a)=>{switch(a.kind){case "NewSubscriberForStatusEvents":var c=
[a.m];this.T(c,b.structure);this.I(c,b.slides,b.failedSlides);return this.J(Object.assign(Object.assign({},b),{a:b.a.concat(c)}));case "ImportStatusQueryResponse":switch(c=a.response.importStatus,a.response.importStatus){case h.ModelImport.ImportStatusEnum.InProgress:{c=a.response.slideMediaAssets;a=a.response.failedSlideNumbers;const d=c.filter((a)=>!b.D.hasOwnProperty(a.slideNumber)),f=a.filter((a)=>!b.D.hasOwnProperty(a));this.I(b.a,d,f);this.L(!1);return this.J(Object.assign(Object.assign({},
b),{slides:c,failedSlides:a,D:this.V(c,a)}))}case h.ModelImport.ImportStatusEnum.Done:return c=this.O(a.response.slideMediaAssets,a.response.failedSlideNumbers,b.structure),this.j(b.a,c),this.B({C:c});default:return this.l(b.a,"ImportStatusResponse",`Unhandled importStatus ${c}`)}case "ImportStatusQueryFailure":return this.l(b.a,"ImportStatusQueryFailure",a.error.message);default:return q.Utils.assertNever(a)}}}}O(b,a,c){return c&&b.length===c.slides.length&&0===a.length?{kind:"FinishedOk",structure:c,
slides:b}:c&&b.length+a.length===c.slides.length?{kind:"FinishedSlidesFailed",structure:c,slides:b,failedSlides:a}:{kind:"Crashed"}}B(b){return{name:"finished",handler:(a)=>{switch(a.kind){case "NewSubscriberForStatusEvents":return this.j([a.m],b.C),this.b.same();case "ImportStatusQueryResponse":return this.b.error("ImportStatusQueryResponse",{errorMessage:"Illegal message in finished state, but going on"}),this.b.same();case "ImportStatusQueryFailure":return this.b.error("ImportStatusQueryFailure",
{errorMessage:"Illegal message in finished state, but going on"}),this.b.same();default:return q.Utils.assertNever(a)}}}}defer(b){q.Utils.delay(b,0)}l(b,a,c){this.unregister();this.b.error(`crash-${a}`,{errorMessage:c},void 0);b.forEach((a)=>{this.defer(()=>{a({kind:"Crashed"})})});return this.b.stopped()}L(b){q.Utils.delay(()=>{this.w(b)},this.H)}w(b){b=this.F.u(b);b.take(1).onValue((a)=>{this.b.tell({kind:"ImportStatusQueryResponse",response:a})});b.onError((a)=>{this.b.tell({kind:"ImportStatusQueryFailure",
error:a})})}T(b,a){this.j(b,{kind:"StructureFinished",structure:a})}I(b,a,c){(0<a.length||0<c.length)&&this.j(b,{kind:"SlidesProgress",slides:a,failedSlides:c})}j(b,a){b.forEach((b)=>{this.defer(()=>{b(a)})})}V(b,a){const c={};b.map((a)=>a.slideNumber).concat(a).forEach((a)=>{c[a]=void 0});return c}}c.X=d})(z||(z={}));var w={},B=this&&w.da||function(c,d,b,a){function f(a){return a instanceof b?a:new b(function(b){b(a)})}return new (b||(b=Promise))(function(b,e){function p(b){try{g(a.next(b))}catch(n){e(n)}}
function t(b){try{g(a["throw"](b))}catch(n){e(n)}}function g(a){a.done?b(a.value):f(a.value).then(p,t)}g((a=a.apply(c,d||[])).next())})};Object.defineProperty(w,"__esModule",{value:!0});w.K=class{constructor(c,d,b){this.la=(this.isLocal=d)?y.isActive("js-use-local-pptx-import-server")?k.h.P("http://localhost:18100"):k.h.ja(c,b):k.h.P(c)}subscribeForStatusEvents(c,d,b){this.la.subscribeForStatusEvents(c,d,b)}ea(c,d){return{status:c,error:d}}uploadPpt(c,d,b){return B(this,void 0,void 0,function*(){if(this.isLocal){if(-1!==
d.name.indexOf("upload_fail_start"))throw Error("Test message: Upload failed to start");if(-1!==d.name.indexOf("upload_fail_progress")){var a=new Promise((a,b)=>{setTimeout(()=>b("Test message: Upload failed during progress"),2E3)});setTimeout(()=>b(20),1E3);return a}y.isActive("js-test-local-ppt-upload")&&(setTimeout(()=>b(20),1E3),setTimeout(()=>b(60),4E3),setTimeout(()=>b(100),6E3));return Promise.resolve({importId:d.name.split(".")[0]+"_"+(new Date).getTime()+d.name.split(".")[1]})}a=new FormData;
a.append("sourcePresentation",d,d.name);const f=Object.assign(Object.assign({},v.HttpService.getDefaultRetryOptions()),{times:3,timeout:2E3});return v.HttpService.createJQueryHttpRequester({type:"POST",cache:!1,processData:!1,contentType:!1,data:a,xhr:()=>{const a=$.ajaxSettings.xhr();a.upload.onprogress=(a)=>b(a.loaded/a.total*100);return a},xhrFields:{withCredentials:!0},url:`https://pptx-import.prezi.com/api/v1/pptx-import/?preziOid=${c}`},f,!0).request().toPromise().catch((a)=>{throw this.ea(e.PptNetworkErrorStatus.UploadFailed,
a);})})}getPpt(c,d){return B(this,void 0,void 0,function*(){const b=(a,b)=>({width:a.boundingBox?a.boundingBox.width:b.width,height:a.boundingBox?a.boundingBox.height:b.height,assetSourceFilename:"file",offlineAssetId:Math.random().toString(16),onlineAssetId:a.onlineAssetId,url:a.onlineAssetUrl,page:a.pageNumber}),a={},f={};let e=null;const h=[],k=new Promise((a)=>{e=a});let m=!1,g;const l=(c,e)=>{if(!m){var u=new Map,g=new Map;c.forEach((b)=>{u.set(b,new Promise((c,d)=>{a[b]=(d)=>{c(d);a[b]=()=>
{}};f[b]=(a)=>{d(a);f[b]=()=>{}}}));g.set(b,e.slides.find((a)=>a.number===b))});u.forEach((a,c)=>{a=a.then((a)=>{var c=e.slides[a.slideNumber-1].title,u={width:e.width,height:e.height},f=e.slides[a.slideNumber-1].notes;return Object.assign(Object.assign({},u),{sourcePageNumber:a.slideNumber,inPdfPageNumber:a.pdfAsset.pageNumber,originalAsset:b(a.pdfAsset,u),noBackgroundAsset:b(a.pdfAssetWithoutBackground,u),jobId:d,title:c,narrative:f})});h.push({slideStructure:g.get(c),slideResult:a})});m=!0}};return new Promise((b)=>
{this.subscribeForStatusEvents(c,d,(c)=>{switch(c.kind){case "StructureFinished":g=c.structure;l(c.structure.slides.filter((a)=>null!=a).map((a)=>a.number),g);b({jobId:d,slides:h,fullPptResult:k});break;case "SlidesProgress":l(c.failedSlides.filter((a)=>null!=a).concat(c.slides.filter((a)=>null!=a).map((a)=>a.slideNumber)).filter((a)=>null!=a),g);c.slides.forEach((b)=>a[b.slideNumber](b));c.failedSlides.forEach((a)=>f[a](`SlidesProgress:failedSlide:${a}`));b({jobId:d,slides:h,fullPptResult:k});break;
case "FinishedOk":g=c.structure;l(c.slides.filter((a)=>null!=a).map((a)=>a.slideNumber),g);c.slides.forEach((b)=>a[b.slideNumber](b));e(c.kind);b({jobId:d,slides:h,fullPptResult:k});break;case "FinishedSlidesFailed":g=c.structure;l(c.failedSlides.filter((a)=>null!=a).concat(c.slides.filter((a)=>null!=a).map((a)=>a.slideNumber)).filter((a)=>null!=a),g);c.slides.forEach((b)=>a[b.slideNumber](b));c.failedSlides.forEach((a)=>f[a](`FinishedSlidesFailed:failedSlide:${a}`));e(c.kind);b({jobId:d,slides:h,
fullPptResult:k});break;case "FinishedStructureFailed":e(c.kind);b({jobId:d,slides:h,fullPptResult:k});break;case "Crashed":e(c.kind);b({jobId:d,slides:h,fullPptResult:k});break;default:q.Utils.assertNever(c)}})})})}};var e={};Object.defineProperty(e,"__esModule",{value:!0});e.SAMPLE_PPT_JOB_ID="91170655-65a3-44a6-a1dd-3da64104f102";e.SAMPLE_NUMBER_OF_SLIDES_TO_SHOW=8;e.SAMPLE_ONLINE_ASSET_IDS=["767932178","767932178"];e.SAMPLE_ONLINE_ASSET_URLS=["http://0103.static.prezi.com.s3.amazonaws.com/media/e/5/d/f4d531bcd78fdb246763bb3bdc753e765015a.pdf",
"http://0103.static.prezi.com.s3.amazonaws.com/media/e/5/d/f4d531bcd78fdb246763bb3bdc753e765015a.pdf"];e.SAMPLE_BG_ONLINE_ASSET_IDS=["5005331322","5005331322"];e.SAMPLE_BG_ONLINE_ASSET_URLS=["http://0103.static.prezi.com.s3.amazonaws.com/media/6/1/2/1549fea97d5d867f829a21ebca062cd8b3be3.pdf","http://0103.static.prezi.com.s3.amazonaws.com/media/6/1/2/1549fea97d5d867f829a21ebca062cd8b3be3.pdf"];(function(c){c.GetCrashed="get-crashed";c.GetStructurFailed="get-structure-failed";c.UploadFailed="upload-failed"})(e.PptNetworkErrorStatus||
(e.PptNetworkErrorStatus={}));(function(c){c.createPptService=function(c,b){return new w.K(c,b,null)};c.forTest_createPptService=function(c,b,a){return new w.K(c,b,a)}})(e.PptServiceModule||(e.PptServiceModule={}));return e});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_ppt_service",["require","prezi_bacon","prezi_bbpptximportapitypes","prezi_featureswitcher","prezi_service_http","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_ppt_service.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_bacon"),require("prezi_bbpptximportapitypes"),require("prezi_featureswitcher"),require("prezi_service_http"),require("prezi_utils"));}else{this["prezi_ppt_service"]=__factory(this["prezi_bacon"],this["prezi_bbpptximportapitypes"],this["prezi_featureswitcher"],this["prezi_service_http"],this["prezi_utils"]);}}).call(this);