;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_pdf_insert";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_cet":dependencies[0],"prezi_cet_model":dependencies[1],"prezi_cet_model_editor":dependencies[2],"prezi_i18n":dependencies[3],"prezi_logger":dependencies[4],"prezi_plugin_api":dependencies[5],"prezi_plugin_meta":dependencies[6],"prezi_utils":dependencies[7]}};})());};})(arguments);var moduleImpl=(function(){return module(function(g){var q=g.dependencies.prezi_cet_model_editor,m=g.dependencies.prezi_i18n,h=g.dependencies.prezi_logger,r=g.dependencies.prezi_utils,e=g.dependencies.prezi_plugin_api,l={},p=this&&l.__awaiter||function(a,f,d,c){function b(b){return b instanceof d?b:new d(function(a){a(b)})}return new (d||(d=Promise))(function(d,e){function t(b){try{g(c.next(b))}catch(n){e(n)}}function k(b){try{g(c["throw"](b))}catch(n){e(n)}}function g(a){a.done?d(a.value):b(a.value).then(t,k)}g((c=c.apply(a,f||[])).next())})};
Object.defineProperty(l,"__esModule",{value:!0});l.PdfPlugin=class{constructor(){this.logger=h.LoggerModule.getLoggerManager().createLogger("prezi_pdf_plugin.PdfPlugin")}init(a){this.uiRoot=a.declareUI({progress:e.ListProgress.finished,filename:"",results:[],thumbnails:[],selectedIds:[]},(a,d)=>{this.createTabMenuItem(d);this.createSidebar(a,d);this.createDialog(d,!1);this.createDialog(d,!0)});a.onFileDrop({allowPdf:!0},(a,{data:d,stageX:c,stageY:b})=>p(this,void 0,void 0,function*(){this.insertPdfFromFile(a,
d.file,c,b)}))}processMessage(a){switch(a.kind){case "openInsertPdfDialog":this.uiRoot.dialog.show("upload-pdf-dialog");break;case "openReplacePdfDialog":this.uiRoot.dialog.show("replace-pdf-dialog");break;default:r.Utils.assertNever(a.kind)}}createTabMenuItem(a){a.createMenuItem({kind:e.MenuItemKind.largeButton,enabled:!0,icon:e.IconSmallId.PdfFile,onClick:()=>{h.avro.Avro.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"PDF"});this.uiRoot.dialog.show("upload-pdf-dialog")},parent:e.TabMenuId.Insert,
weight:52,id:"insertMenu/pdf",title:m.I18n.ts("PDF")})}createSidebar(a,f){f.createSidebar((d)=>({id:`${l.PdfPlugin.sidebarId}-${a.filename}`,root:{title:m.I18n.ts("Pages"),content:[d.multiSelectList((c)=>({itemType:e.ListItemType.numbered,itemLayout:e.ListItemLayout.dynamic,selectedIds:a.selectedIds,onSelectionChange:(b)=>this.uiRoot.setState({selectedIds:b.selectedIds}),items:a.thumbnails.map((b,a)=>c.droppableImage({id:`${a}`,src:{url:b},dataLookup:`pdf-slide-thumbnail-${a}`})),requestAdditionalItems:()=>
p(this,void 0,void 0,function*(){var b=a.thumbnails.length;const c=Math.min(b+10,a.results.length);b>=c?this.uiRoot.setState({progress:e.ListProgress.finished}):(this.uiRoot.setState({progress:e.ListProgress.working}),b=a.results.slice(b,c).map((b)=>b.pdfPageInfo.thumbnail()),b=a.thumbnails.concat(yield Promise.all(b)),this.uiRoot.setState({progress:a.results.length<=b.length?e.ListProgress.finished:e.ListProgress.idle,thumbnails:b}))}),flexGrow:1,progress:a.progress,onDrop:(b,c)=>{this.session.document.executeApiCommand(b,
{name:"drop",run:(d)=>{const f=c.draggedIds.map((b)=>a.results[parseInt(b,10)].pdfAsset);this.insertPdfsI(b,d,f,c.stageX,c.stageY,a.results.length).forEach((b)=>h.avro.Avro.createDefaultLogger().logInsertPdfPage({object_id:b,insert_method:c.dropKind===e.DropKind.drag?"DRAG":"DOUBLE_CLICK"}))}})}})),d.separator(),d.button(e.ButtonSize.Small,e.ButtonAlign.Center,(c)=>[c.button({id:"insert-all-pages-button",color:e.ButtonColor.Ghost,content:{text:m.I18n.ts("Insert all pages")},onClick:(b)=>{h.avro.Avro.createDefaultLogger().logInsertAllPdfPages();
this.insertPdfs(b,a.results.map((b)=>b.pdfAsset),null,null,a.results.length)}})])]},onClose:()=>h.avro.Avro.createDefaultLogger().logClosePdfSidebar()}))}replaceFromFileCmd(a,f,d){this.logReplace(f,d);this.session.document.executeApiCommand(a,{name:"pdf upload for replace",run:(a)=>{var b=this.session.selection.getSelectionInfo(a).allObjects;1===b.length&&(b=b[0],b.is(q.base.ObjectKind.pdf)?(a=a.toDecorator(b),b=this.session.document.progressiveAssetManager.uploadPdf(f),a.pdfAsset=b.token,h.avro.Avro.createDefaultLogger().logModifiedObject({object_type:"PDF",
modify_action:"REPLACE",topic_relationship:a,object_id:a.id})):b.is(q.base.ObjectKind.swf)&&(a=a.toDecorator(b),b=this.session.document.progressiveAssetManager.uploadPdf(f),a.parent.add.pdf(b.token).fitInto(a.layoutBox),h.avro.Avro.createDefaultLogger().logModifiedObject({object_type:a,modify_action:"REPLACE",topic_relationship:a,object_id:a.id}),a.delete()))}})}logReplace(a,f){const {name:d,size:c,type:b}=a;this.logger.info({action:"replace",object:"pdf",trigger:f,payload:{filename:d,size:c,type:b,
context:""}})}insertPdfs(a,f,d,c,b){return this.session.document.executeApiCommand(a,{name:"insert pdf",run:(e)=>this.insertPdfsI(a,e,f,d,c,b)})}insertPdfsI(a,e,d,c,b,g){const f=this.session.insertTarget.getSimpleObjectParent(e);c=this.session.positionFinder.findLayoutBoxes(f,d.map(()=>({width:42,height:42})),c,b).map((a,b)=>{b=d[b];const c=f.add.pdf(b);c.fitInto(a);this.logNewObject(c,e.intent,b,g);return c});this.session.selection.setSelection(a,c);return c.map((a)=>a.id)}logNewObject(a,e,d,c){h.avro.Avro.createDefaultLogger().logNewObject({object_id:a.id,
object_type:a,topic_relationship:a,parent_type:a});this.logger.info({action:"create",object:"pdf",trigger:"machine",payload:{user_intent_id:e.userIntentId,object_id:a.id,page_number:d.page,length_in_pages:c}})}insertPdfFromFile(a,f,d,c){return p(this,void 0,void 0,function*(){var b=this.session.document.progressiveAssetManager.uploadPdf(f);const g=this.insertPdfs(a,[b.token],d,c,1),k=yield b.finished;g.forEach((a)=>h.avro.Avro.createDefaultLogger().logInsertPdf({object_id:a,pdf_page_count:k.length}));
1<k.length&&(this.uiRoot.setState({progress:e.ListProgress.working,filename:f.name,results:k,thumbnails:[]}),this.uiRoot.sidebar.open(`${l.PdfPlugin.sidebarId}-${f.name}`),b=yield Promise.all(k.slice(0,Math.min(10,k.length)).map((a)=>a.pdfPageInfo.thumbnail())),this.uiRoot.setState({progress:k.length<=b.length?e.ListProgress.finished:e.ListProgress.idle,thumbnails:b}))})}createDialog(a,f){const d=f?"replace-pdf-dialog":"upload-pdf-dialog";return a.dialog.small((a)=>({id:d,title:m.I18n.ts("Upload PDF file"),
align:e.DialogAlign.center,content:[a.droparea({text:m.I18n.ts("**Drag and drop** your .pdf file here or upload one from your computer."),illustration:e.IllustrationSmallId.Pdf,filter:{allowPdf:!0},onFileSelected:(a,c)=>{this.uiRoot.dialog.hide(d);c=c.file;f?this.replaceFromFileCmd(a,c,"propertybar"):this.insertPdfFromFile(a,c,null,null)},color:e.ButtonColor.Blue})],onCloseButtonClicked:()=>{this.uiRoot.dialog.hide(d)}}))}};l.PdfPlugin.sidebarId="sidebar-pdf-insert";g={};Object.defineProperty(g,"__esModule",
{value:!0});g.lazyModule={createPlugin(){return new l.PdfPlugin}};return g});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_pdf_insert",["require","prezi_cet","prezi_cet_model","prezi_cet_model_editor","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_pdf_insert.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_cet"),require("prezi_cet_model"),require("prezi_cet_model_editor"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_utils"));}else{this["prezi_pdf_insert"]=__factory(this["prezi_cet"],this["prezi_cet_model"],this["prezi_cet_model_editor"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_utils"]);}}).call(this);