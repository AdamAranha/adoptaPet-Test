;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_watermark";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_cet_model_editor":dependencies[0],"prezi_editor_store_ui":dependencies[1],"prezi_i18n":dependencies[2],"prezi_logger":dependencies[3],"prezi_playback":dependencies[4],"prezi_plugin_api":dependencies[5],"prezi_plugin_meta":dependencies[6],"prezi_utils":dependencies[7],"prezi_widgets":dependencies[8]}};})());};})(arguments);var moduleImpl=(function(){return module(function(h){var n=h.dependencies.prezi_utils,l=h.dependencies.prezi_widgets,p=h.dependencies.prezi_cet_model_editor,c=h.dependencies.prezi_i18n,u=h.dependencies.prezi_editor_store_ui,b=h.dependencies.prezi_plugin_api,v=h.dependencies.prezi_playback,m=h.dependencies.prezi_logger,r={},w=this&&r.Ba||function(a,b,d,g){function e(a){return a instanceof d?a:new d(function(d){d(a)})}return new (d||(d=Promise))(function(d,k){function q(a){try{f(g.next(a))}catch(t){k(t)}}function c(a){try{f(g["throw"](a))}catch(t){k(t)}}
function f(a){a.done?d(a.value):e(a.value).then(q,c)}f((g=g.apply(a,b||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});r.pa=class{constructor(){this.w="watermark-sidebar"}processMessage(a){return w(this,void 0,void 0,function*(){switch(a.request){case "openSidebar":this.toggleSidebar();break;default:throw n.Utils.assertNever(a.request);}})}init(a){if(this.Aa()){var b=this.session.document.preziMetaData.logoType,d=this.ba();this.f=a.declareUI({$:!1,oa:!1,da:!1,logoType:b,i:d,aa:null,
v:!1,u:this.ga(b,d)},(a,d)=>{this.createMenuItem(a,d);a.da?this.qa(a,d):this.ta(a,d)});a.onLicenseChange((a)=>{this.f.setState({oa:a.noWatermark,da:a.customLogo})});a.onDocumentChange(()=>{this.f.getState().$&&this.f.setState({i:this.ba(),aa:null})})}}openSidebar(){m.avro.Avro.createDefaultLogger().logOpenWatermarkSidebar();const a=this.f.getState();this.f.setState({$:!0,u:this.ga(a.logoType,a.i)});this.f.getState().oa?(this.f.setState({i:this.ba(),aa:null}),this.f.sidebar.open(this.w),m.avro.Avro.createDefaultLogger().logLoadedWatermarkSidebar()):
this.xa()}ia(){m.avro.Avro.createDefaultLogger().logCloseWatermarkSidebar();this.f.setState({$:!1})}toggleSidebar(){this.f.getState().$?this.f.sidebar.close(this.w):this.openSidebar()}xa(){this.f.dialog.showBuiltIn(u.BuiltinDialog.upgradeLicenseNoWatermark)}ja(){this.f.dialog.showBuiltIn(u.BuiltinDialog.upgradeLicenseCustomLogo)}ba(){return this.session.document.read((a)=>{var b,d,g,k,q,f;const c=null===(d=null===(b=a.logo)||void 0===b?void 0:b.asset)||void 0===d?void 0:d.url;b=null!=c?this.session.document.progressiveAssetManager.rewriteUrl(c):
null;d=(null===(g=a.logo)||void 0===g?void 0:g.logoKind)===p.base.LogoKind.next?null===(k=a.logo)||void 0===k?void 0:k.linkUrl:null;a=(null===(q=a.logo)||void 0===q?void 0:q.logoKind)===p.base.LogoKind.next?null===(f=a.logo)||void 0===f?void 0:f.color:null;return{assetUrl:b,linkUrl:d,fill:{solidFill:{fillKind:l.FillKind.solid,color:a},current:null==a?l.FillKind.clear:l.FillKind.solid,hasAlpha:!0,canPickClearFill:!0}}})}setLogo(a,e){a.doAsync(e.finished,(a,e)=>w(this,void 0,void 0,function*(){if(a.isValid()){m.avro.Avro.createDefaultLogger().logConfigureWatermark({watermark_action_type:"UPLOAD_OWN_LOGO"});
const d=this.f.getState();this.session.document.setDocumentLogoType(b.PreziLogoType.DocumentBased);this.session.document.executeApiCommand(a,{name:"set custom logo",run:(a)=>a.logo={logoKind:p.base.LogoKind.next,asset:e,color:d.i.fill.solidFill.color,linkUrl:d.i.linkUrl}});const g=this.session.document.progressiveAssetManager.rewriteUrl(e.url);this.f.setState({logoType:b.PreziLogoType.DocumentBased,i:Object.assign(Object.assign({},d.i),{assetUrl:g}),v:!1,u:g})}}))}za(a){const b=a.logo;if(null!=b&&
b.logoKind===p.base.LogoKind.next){var d=this.f.getState().i.linkUrl;if(""===d||this.ha(d))m.avro.Avro.createDefaultLogger().logConfigureWatermark({watermark_action_type:"ADD_URL"}),a.logo=Object.assign(Object.assign({},b),{linkUrl:d})}}ya(a){var b,d,g,k;const c=this.f.getState().i.fill,f=a.logo;null==f||f.logoKind!==p.base.LogoKind.next||c.current===l.FillKind.clear&&null==f.color||c.current!==l.FillKind.clear&&n.Utils.deepEquals(f.color,c.solidFill.color)||(c.current!==l.FillKind.clear&&(null===
(b=f.color)||void 0===b?void 0:b.a)===c.solidFill.color.a||m.avro.Avro.createDefaultLogger().logConfigureWatermark({watermark_action_type:"CHANGE_OPACITY"}),c.current!==l.FillKind.clear&&(null===(d=f.color)||void 0===d?void 0:d.r)===c.solidFill.color.r&&(null===(g=f.color)||void 0===g?void 0:g.g)===c.solidFill.color.g&&(null===(k=f.color)||void 0===k?void 0:k.b)===c.solidFill.color.b||m.avro.Avro.createDefaultLogger().logConfigureWatermark({watermark_action_type:"CHANGE_BACKGROUND_COLOR"}),a.logo=
Object.assign(Object.assign({},f),{color:c.current===l.FillKind.clear?null:c.solidFill.color}))}ka(){m.avro.Avro.createDefaultLogger().logConfigureWatermark({watermark_action_type:"REMOVE_WATERMARK"});this.session.document.setDocumentLogoType(b.PreziLogoType.None);this.f.setState({logoType:b.PreziLogoType.None,v:!1,u:null})}la(){this.session.document.setDocumentLogoType(b.PreziLogoType.Watermark);this.f.setState({logoType:b.PreziLogoType.Watermark,v:!1,u:v.getWatermarkAssetUrl()})}Aa(){return null==
this.session.document.preziMetaData.ownerId?!0:this.userSettings.getUserId()===this.session.document.preziMetaData.ownerId.toString()}createMenuItem(a,e){e.createMenuItem({id:"add-watermark-tab-menu-item",kind:b.MenuItemKind.largeButton,enabled:!0,parent:b.TabMenuId.Insert,weight:110,title:c.I18n.ts("Watermark"),icon:b.IconSmallId.Staffpick,onClick:()=>{this.toggleSidebar()}})}qa(a,b){b.createSidebar((b)=>({id:this.w,root:{title:c.I18n.ts("Watermark"),content:[this.fa(a,b),this.ra(a,b),b.separator(),
...this.wa(a,b),b.separator(),...this.ua(a,b),b.separator()]},onClose:()=>this.ia()}))}ta(a,b){b.createSidebar((b)=>({id:this.w,root:{title:c.I18n.ts("Watermark"),content:[this.fa(a,b),this.sa(a,b),...this.va(b)]},onClose:()=>this.ia()}))}ga(a,c){switch(a){case b.PreziLogoType.DocumentBased:return c.assetUrl;case b.PreziLogoType.Watermark:return v.getWatermarkAssetUrl();case b.PreziLogoType.None:return null;default:throw n.Utils.assertNever(a);}}fa(a,b){return b.droparea({text:c.I18n.ts("**Drag and drop** your file"),
filter:{allowImage:!0},illustration:l.IllustrationSmallId.Image,onFileSelected:(b,c)=>{a.da?(this.f.setState({v:!0,u:null}),c=this.session.document.progressiveAssetManager.uploadLogo(c.file),this.setLogo(b,c)):this.ja()},hideUploadButton:!0,showSpinner:a.v,url:a.u})}ra(a,e){return e.button(b.ButtonSize.Small,b.ButtonAlign.Start,(d)=>[d.upload({color:b.ButtonColor.Gray,id:"upload-logo",content:{text:c.I18n.ts("Upload logo")},fileFilter:{allowImage:!0},onFileSelected:(a,{file:b})=>{b=this.session.document.progressiveAssetManager.uploadLogo(b);
this.f.setState({v:!0,u:null});this.setLogo(a,b)}}),d.button({color:b.ButtonColor.Ghost,id:"remove-logo",disabled:a.logoType===b.PreziLogoType.None,content:{icon:b.IconSmallId.Trash},onClick:()=>{this.ka()}}),d.button({color:b.ButtonColor.Ghost,id:"revert-logo",disabled:a.logoType===b.PreziLogoType.Watermark,content:{icon:b.IconSmallId.Cycle},onClick:()=>{this.la()},tooltipText:a.logoType===b.PreziLogoType.Watermark?null:c.I18n.ts("Revert to Prezi watermark"),tooltipPosition:"bottom"})])}sa(a,e){return e.button(b.ButtonSize.Small,
b.ButtonAlign.Start,(d)=>[d.button({color:b.ButtonColor.Gray,id:"remove-logo",disabled:a.logoType===b.PreziLogoType.None,content:{text:c.I18n.ts("Remove logo")},onClick:()=>{this.ka()}}),d.button({color:b.ButtonColor.Ghost,id:"revert-logo",disabled:a.logoType===b.PreziLogoType.Watermark,content:{icon:b.IconSmallId.Cycle},onClick:()=>{this.la()},tooltipText:a.logoType===b.PreziLogoType.Watermark?null:c.I18n.ts("Revert to Prezi watermark"),tooltipPosition:"bottom"})])}ua(a,e){return[e.sectionHeader({content:c.I18n.ts("Style")}),
e.colorPicker({label:c.I18n.ts("Logo background"),id:"watermark-background-color-picker",disabled:a.logoType!==b.PreziLogoType.DocumentBased,fills:a.i.fill,onChange:(a,c)=>{null!=this.j&&this.j.isActive()||(this.j=this.session.document.beginLongRunningCommand(a,{name:"logo color edit"},(a)=>{switch(a.reason){case b.FinishEventKind.RollbackTransaction:case b.FinishEventKind.AbortTransaction:break;case b.FinishEventKind.EndTransaction:case b.FinishEventKind.BeginOtherTransaction:this.ya(a.api);break;
default:n.Utils.assertNever(a)}}),this.ea=this.ma());this.f.setState({i:Object.assign(Object.assign({},this.f.getState().i),{fill:c.fills})});clearTimeout(this.ea);c.isFinal?null!=this.j&&this.j.isActive()&&this.j.end():this.ea=this.ma()},showColorWheel:!0,showThemeColors:!1})]}ma(){return window.setTimeout(()=>{null!=this.j&&this.j.isActive()&&this.j.end()},300)}wa(a,e){return[e.sectionHeader({content:c.I18n.ts("Add url")}),e.inputField({id:"watermark-url-input-field",disabled:a.logoType!==b.PreziLogoType.DocumentBased,
placeholderText:"https://prezi.com",maxLength:2E3,value:a.i.linkUrl,onValueChange:(a,e)=>{null!=this.o&&this.o.isActive()||(this.o=this.session.document.beginLongRunningCommand(a,{name:"logo link url edit"},(a)=>{switch(a.reason){case b.FinishEventKind.RollbackTransaction:case b.FinishEventKind.AbortTransaction:break;case b.FinishEventKind.EndTransaction:case b.FinishEventKind.BeginOtherTransaction:this.za(a.api);break;default:n.Utils.assertNever(a)}}),this.ca=this.na());a=""===e||this.ha(e);this.f.setState({i:Object.assign(Object.assign({},
this.f.getState().i),{linkUrl:e}),aa:a?null:c.I18n.ts("Please provide a valid url.")});clearTimeout(this.ca);this.ca=this.na()},errorText:a.aa,onEnter:()=>{clearTimeout(this.ca);null!=this.o&&this.o.isActive()&&this.o.end()},tooltipText:a.logoType!==b.PreziLogoType.DocumentBased?c.I18n.ts("Upload a logo first"):null,tooltipPosition:"bottom"})]}na(){return window.setTimeout(()=>{null!=this.o&&this.o.isActive()&&this.o.end()},1E3)}ha(a){return a.match(n.Utils.getUrlRegExp())}va(a){return[a.sectionHeader({content:c.I18n.ts("Ready to unlock more features")}),
a.label(c.I18n.ts("Get access to advanced color editing and much more by upgrading your Prezi license.")),a.button(b.ButtonSize.Small,b.ButtonAlign.Start,(a)=>[a.button({color:b.ButtonColor.Blue,id:"upgrade-premium",content:{text:c.I18n.ts("Upgrade now")},onClick:()=>{this.ja()}})])]}};h={};Object.defineProperty(h,"__esModule",{value:!0});h.lazyModule={createPlugin(){return new r.pa}};return h});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_watermark",["require","prezi_cet_model_editor","prezi_editor_store_ui","prezi_i18n","prezi_logger","prezi_playback","prezi_plugin_api","prezi_plugin_meta","prezi_utils","prezi_widgets"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_watermark.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_cet_model_editor"),require("prezi_editor_store_ui"),require("prezi_i18n"),require("prezi_logger"),require("prezi_playback"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_utils"),require("prezi_widgets"));}else{this["prezi_watermark"]=__factory(this["prezi_cet_model_editor"],this["prezi_editor_store_ui"],this["prezi_i18n"],this["prezi_logger"],this["prezi_playback"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_utils"],this["prezi_widgets"]);}}).call(this);