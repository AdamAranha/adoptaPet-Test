;(function(){var baseUrl;var __factory=function(){var module=(function(dependencies){return function(init){return init.call({},(function(){return{getSpaghettiVersion:function(){return "13.0-25-g6015dbc";},getModuleName:function(){return "prezi_chart_insert";},getModuleVersion:function(){return "release-2021w06-base-26-gaeb382e";},getResourceUrl:function(resource){if(resource.substr(0,1)!="/"){resource="/"+resource;}return baseUrl+resource;},"dependencies":{"prezi_cet_model_editor":dependencies[0],"prezi_editor_error":dependencies[1],"prezi_i18n":dependencies[2],"prezi_logger":dependencies[3],"prezi_plugin_api":dependencies[4],"prezi_plugin_meta":dependencies[5],"prezi_utils":dependencies[6]}};})());};})(arguments);var moduleImpl=(function(){return module(function(k){var q=k.dependencies.prezi_cet_model_editor,v=k.dependencies.prezi_editor_error,b=k.dependencies.prezi_i18n,f=k.dependencies.prezi_logger,c=k.dependencies.prezi_plugin_api,r=k.dependencies.prezi_plugin_meta,w=k.dependencies.prezi_utils,l={};Object.defineProperty(l,"__esModule",{value:!0});l.ba=[{name:b.I18n.ts("Line"),f:"line",u:[{name:b.I18n.ts("Line"),f:"line",i:"6_0"}]},{name:b.I18n.ts("Bar"),f:"bar",u:[{name:b.I18n.ts("Bar"),f:"bar",i:"4_0"},{name:b.I18n.ts("Stacked"),f:"stacked_bar",
i:"17_0"},{name:b.I18n.ts("Grouped"),f:"grouped_bar",i:"4_1"},{name:b.I18n.ts("Radial"),f:"radial",i:"2_1"}]},{name:b.I18n.ts("Column"),f:"column",u:[{name:b.I18n.ts("Column"),f:"column",i:"1_0"},{name:b.I18n.ts("Stacked"),f:"stacked_column",i:"10_0"},{name:b.I18n.ts("Grouped"),f:"grouped_column",i:"1_1"}]},{name:b.I18n.ts("Pie"),f:"pie",u:[{name:b.I18n.ts("Pie"),f:"pie",i:"2_0"},{name:b.I18n.ts("Doughnut"),f:"doughnut",i:"2_2"},{name:b.I18n.ts("Irregular"),f:"irregular",i:"22_0"},{name:b.I18n.ts("Semi Circle"),
f:"semicircle",i:"34_0"}]},{name:b.I18n.ts("Multiple axes"),f:"multiple_axes",u:[{name:b.I18n.ts("Column & Line"),f:"column_and_line",i:"30_0"},{name:b.I18n.ts("Line & Line"),f:"line_and_line",i:"31_0"},{name:b.I18n.ts("Grouped Column & Line"),f:"grouped_column_and_line",i:"35_0"},{name:b.I18n.ts("Stacked Column & Line"),f:"stacked_column_and_line",i:"36_0"}]},{name:b.I18n.ts("Scatter"),f:"scatter",u:[{name:b.I18n.ts("Scatter"),f:"scatter",i:"20_0"}]},{name:b.I18n.ts("Hierarchy"),f:"hierarchy",u:[{name:b.I18n.ts("Funnel"),
f:"funnel",i:"29_1"}]}];var h={},u=this&&h.na||function(b,a,d,g){function e(a){return a instanceof d?a:new d(function(b){b(a)})}return new (d||(d=Promise))(function(d,t){function c(a){try{m(g.next(a))}catch(n){t(n)}}function f(a){try{m(g["throw"](a))}catch(n){t(n)}}function m(a){a.done?d(a.value):e(a.value).then(c,f)}m((g=g.apply(b,a||[])).next())})};Object.defineProperty(h,"__esModule",{value:!0});const x={$:!1,w:"DARK",aa:!1,ca:!1};h.o=class{constructor(){this.editChart=(b)=>{if(this.j.getState().aa){var a=
this.session.document.read((a)=>{a=this.session.selection.getReadonlySelectionInfo(a);if(1!==a.allObjects.length)return null;a=a.allObjects[0];return a.is(q.base.ObjectKind.chart)?{id:a.id,chartAsset:a.chartAsset}:null});if(null!=a){var {id:e,chartAsset:a}=a;this.logger.info({action:"open",feature:"charts",object:"chart_editor",trigger:"click",payload:{chart_type:a.chartType}});b.doAsync(this.ja(e,a.chartId),(a,b)=>{null!=b&&a.isValid()&&this.session.document.executeApiCommand(a,{name:"chart upload for replace",
run:(a)=>{a=a.lookup.chart(e);var d=a.chartAsset;d=this.session.document.progressiveAssetManager.uploadChart({params:b,chartType:d.chartType,width:d.width,height:d.height});d.finished.catch(()=>{this.j.dialog.showBuiltInError(v.EditorErrorCase.CHART_UPLOAD_ERROR,!1)});a.chartAsset=d.token;f.avro.Avro.createDefaultLogger().logModifiedObject({object_type:"CHART",modify_action:"REPLACE",topic_relationship:a,object_id:e})}})})}}else this.j.dialog.showBuiltIn(c.BuiltinDialog.upgradeLicenseInsertChart)};
this.logger=f.LoggerModule.getLoggerManager().createLogger("prezi_chart_insert.ChartInsertPlugin")}init(b){this.da=this.fa(b);this.j=b.declareUI(x,(a,b)=>{this.createSidebar(a,b);this.ia(a,b);this.ga(a,b)});b.onLicenseChange((a)=>{this.j.setState({aa:a.editChart})});b.onSelectionChange(()=>{this.session.document.read((a)=>{a=this.session.selection.getReadonlySelectionInfo(a).allObjects;this.j.setState({ca:1===a.length&&a[0].is(q.base.ObjectKind.chart)})})})}la(b,a){this.logger.info({feature:"charts",
action:"insert",object:"chart",trigger:b.dropKind===c.DropKind.click?"double_click":"dragdrop",payload:{chart_type:a}});f.avro.Avro.createDefaultLogger().logInsertChart({chart_source:b.dropKind===c.DropKind.click?"DOUBLE_CLICK":"DRAG_DROP",chart_type:a})}processMessage(b){if("openChartInsertSidebar"===b)this.openSidebar();else throw Error(`unexpected message: ${b}`);}openSidebar(){this.j.getState().$||this.j.sidebar.open(h.o.v)}unload(){}ma(b,a){const d=f.LoggerModule.getAvroLoggerHelper().getLogTopicRelationship(a),
e=f.LoggerModule.getAvroLoggerHelper().getLogParentType(a),c=a.id;b.finished.then(()=>{f.avro.Avro.createDefaultLogger().logNewObject({object_type:"CHART",topic_relationship:d,parent_type:e,object_id:c})})}ja(e,a){return u(this,void 0,void 0,function*(){f.avro.Avro.createDefaultLogger().logOpenEditChartDialog({object_id:e});const d=yield this.da.editChart(a),g=new URL(d.edit_url);return new Promise((a)=>{let e;const f=(b)=>{b.origin===g.origin&&("update"===b.data.action&&null!=b.data.pdf&&null!=b.data.chartId?
(this.logger.info({feature:"charts",action:"update_changes",trigger:"click",object:"chart_editor",payload:{chart_type:b.data.chartType,ka:b.data.insertData}}),b={pdf:w.Utils.arrayBufferToPdfFile(b.data.pdf),chartId:b.data.chartId},window.removeEventListener("message",f),a(b)):"close"===b.data.action&&(this.logger.info({feature:"charts",action:"cancel_changes",trigger:"click",object:"chart_editor",payload:{chart_type:b.data.chartType,ka:b.data.insertData}}),window.removeEventListener("message",f),
a(null)),this.j.dialog.hide(e))};e=this.j.dialog.showIFrame({url:d.edit_url,size:c.DialogType.full,title:b.I18n.ts("Edit chart"),onOpen:()=>{window.addEventListener("message",f,!1)},onClose:()=>{window.removeEventListener("message",f);a(null)}})})})}createSidebar(e,a){a.createSidebar((a)=>{const d={};l.ba.forEach((g)=>{d[g.f]={title:g.name,content:[a.tabMenuButtons({activeId:e.w,onChange:(a,b)=>{f.avro.Avro.createDefaultLogger().logClickChartBar({chart_item:b});this.j.setState({w:b})},options:[{title:b.I18n.ts("Dark"),
id:"DARK"},{title:b.I18n.ts("Light"),id:"LIGHT"}]}),a.simpleList((a)=>({itemType:c.ListItemType.large,itemLayout:c.ListItemLayout.dynamic,showTitle:!0,items:g.u.map((b)=>a.droppableImage({title:b.name,src:{url:k.getResourceUrl(e.w.toLowerCase()+"/"+b.f+".png")},onDrop:(a,d)=>{d.dropKind===c.DropKind.click&&f.avro.Avro.createDefaultLogger().logClickChartBar({chart_item:"CHART_TYPE"});this.j.getState().aa?this.session.document.executeApiCommand(a,{name:"insert chart",run:(c)=>{this.la(d,b.i);const f=
this.session.document.progressiveAssetManager.uploadChart({chartType:b.i,params:{colors:"DARK"===e.w?c.styleSheet.chartStyle.dark:c.styleSheet.chartStyle.light},width:160,height:90});var g=this.session.insertTarget.getSimpleObjectParent(c);c=this.session.positionFinder.findLayoutBox(g,160,90,d.stageX,d.stageY);g=g.add.chart(f.token);this.ma(f,g);g.fitInto(c);this.session.selection.setSelection(a,[g])}}):this.j.dialog.showBuiltIn(c.BuiltinDialog.upgradeLicenseInsertChart)}}))}))]}});return{id:h.o.v,
root:{title:b.I18n.ts("CHARTS"),content:[...this.ha(a),this.ea(a)]},pages:d,onCloseButtonClicked:()=>{f.avro.Avro.createDefaultLogger().logCloseChartSidebar()},onOpen:()=>{this.logger.info({feature:"charts",action:"open",object:"sidebar",trigger:"click"});f.avro.Avro.createDefaultLogger().logShowChartInsertOptions();this.j.setState({$:!0})},onClose:()=>{this.j.setState({$:!1})}}})}ea(b){return b.simpleList((b)=>({itemLayout:c.ListItemLayout.fixed,itemType:c.ListItemType.large,showTitle:!0,items:l.ba.map((a)=>
b.folder({src:{url:k.getResourceUrl("folders/"+a.f+".png")},title:a.name,onClick:()=>{this.j.sidebar.open(h.o.v,a.f)}}))}))}ha(e){return[e.sectionHeader({content:b.I18n.ts("My Library")}),e.button(c.ButtonSize.Large,c.ButtonAlign.Start,(a)=>[a.button({id:"open-my-library-button",color:c.ButtonColor.Blue,content:{text:b.I18n.ts("Add from my library")},onClick:()=>{this.pluginAccess.send(r.favorites,r.createOpenFavoritesFromAnotherSidebarMessage("charts"))}})]),e.separator()]}ia(e,a){a.createMenuItem({id:"chart-insert-menuitem",
title:b.I18n.ts("Chart"),icon:c.IconSmallId.Charts,onClick:()=>{f.avro.Avro.createDefaultLogger().logClickTabMenuItem({tab_menu_item:"CHART"});this.j.getState().aa?e.$?this.j.sidebar.close(h.o.v):this.j.sidebar.open(h.o.v):this.j.dialog.showBuiltIn(c.BuiltinDialog.upgradeLicenseInsertChart)},kind:c.MenuItemKind.largeButton,parent:c.TabMenuId.Insert,weight:54})}ga(e,a){e.ca&&(a.createMenuItem({id:"context-menu-edit-chart",title:b.I18n.ts("Edit chart"),onClick:this.editChart,kind:c.MenuItemKind.context,
weight:67}),a.createPropertyBarItem((a)=>a.button({id:"propertybar-edit-chart",title:b.I18n.ts("Edit chart..."),weight:0,parent:c.PropertyBarId.Left,onClick:(a)=>{f.avro.Avro.createDefaultLogger().logClickPropertyBar({property_item:"ANY"});this.editChart(a)}})))}fa(c){return c.service(["api","v4","presentation-ext","chart"],(a)=>({editChart(c){return u(this,void 0,void 0,function*(){const d=yield a.access("PUT",[c],{},{});return{chart_uuid:d.chart_uuid,edit_url:`https://prezi.infogram.com/prezi?chart_id=${d.chart_uuid}&lang=${b.I18n.getLanguage()}`}})}}))}};
h.o.v="chart-sidebar";var p={};Object.defineProperty(p,"__esModule",{value:!0});p.lazyModule={createPlugin(){return new h.o}};return p});

})() || {};
moduleImpl["module"]=moduleImpl;
return moduleImpl;};if(typeof define==="function"&&define.amd){define("prezi_chart_insert",["require","prezi_cet_model_editor","prezi_editor_error","prezi_i18n","prezi_logger","prezi_plugin_api","prezi_plugin_meta","prezi_utils"],function(){var moduleUrl=arguments[0]["toUrl"]("prezi_chart_insert.js");baseUrl=moduleUrl.substr(0,moduleUrl.lastIndexOf("/"));return(__factory).apply({},[].slice.call(arguments,1));});}else if(typeof exports==="object"&&typeof exports.nodeName!=="string"){baseUrl=__dirname;module.exports=(__factory)(require("prezi_cet_model_editor"),require("prezi_editor_error"),require("prezi_i18n"),require("prezi_logger"),require("prezi_plugin_api"),require("prezi_plugin_meta"),require("prezi_utils"));}else{this["prezi_chart_insert"]=__factory(this["prezi_cet_model_editor"],this["prezi_editor_error"],this["prezi_i18n"],this["prezi_logger"],this["prezi_plugin_api"],this["prezi_plugin_meta"],this["prezi_utils"]);}}).call(this);